"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[372],{90249:function(e,t,a){a.d(t,{J:function(){return r}});var s=a(57437);let l=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function r(e){let{history:t,loading:a}=e;return(0,s.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-white",children:"History (last 10 blocks)"}),a?(0,s.jsx)("ul",{className:"mt-4 space-y-3",children:Array.from({length:4}).map((e,t)=>(0,s.jsx)("li",{className:"h-12 animate-pulse rounded-md bg-slate-800/40"},t))}):0===t.length?(0,s.jsx)("p",{className:"mt-4 text-sm text-slate-400",children:"No block history yet. Run the simulator to populate readings."}):(0,s.jsx)("ul",{className:"mt-4 space-y-3",children:t.map((e,t)=>{let a=e.percent_of_target,r="";try{let t=new Date(e.block_start_local),a=new Date(t.getTime()+18e5);r="".concat(l.format(t)," – ").concat(l.format(a))}catch(t){r=e.block_start_local}return(0,s.jsxs)("li",{className:"flex items-center justify-between rounded-lg border border-slate-800 bg-slate-950/60 px-4 py-3 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-slate-100",children:r}),(0,s.jsxs)("p",{className:"text-xs text-slate-500",children:[e.accumulated_kwh.toFixed(2)," / ",e.target_kwh.toFixed(1)," kWh"]})]}),(0,s.jsxs)("span",{className:"text-sm font-semibold ".concat(a>100?"text-danger":a>=80?"text-warning":"text-success"),children:[a.toFixed(1),"%"]})]},"".concat(e.block_start_local,"-").concat(t))})})]})}},39514:function(e,t,a){a.d(t,{l:function(){return j}});var s=a(57437),l=a(92566),r=a(25974),n=a(16638),i=a(45745),c=a(68295),o=a(92893),d=a(35231),u=a(54142),m=a(2842),x=a(9542),h=a(85475),p=a(2265);let g="Asia/Kuala_Lumpur",b=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:g}),f=new Intl.NumberFormat(void 0,{maximumFractionDigits:2});function v(e,t,a){let s=e.replace("#",""),l=t.replace("#",""),r=parseInt(s.substr(0,2),16),n=parseInt(s.substr(2,2),16),i=parseInt(s.substr(4,2),16),c=parseInt(l.substr(0,2),16),o=parseInt(l.substr(2,2),16),d=parseInt(l.substr(4,2),16);return"#".concat([Math.round(r+(c-r)*a),Math.round(n+(o-n)*a),Math.round(i+(d-i)*a)].map(e=>{let t=e.toString(16);return 1===t.length?"0"+t:t}).join(""))}function j(e){var t,a,j;let{block:k,loading:N,targetKwh:y,targetPeakKwh:_,mode:F,lastReadingTs:T}=e,D=null!==(t=null!=y?y:null==k?void 0:k.target_kwh)&&void 0!==t?t:0,{data:M,startTs:S,endTs:A,binSeconds:E}=function(e,t,a){var s,l,r,n;if(!e||!e.block_start_local){let e=new Date().getTime();return{data:Array(60).fill(null).map((t,a)=>({ts:e+(a+1)*3e4,value:0})),startTs:e,endTs:e+18e5,binSeconds:30}}let i=new Date(e.block_start_local).getTime(),c=null!==(r=null===(s=e.chart_bins)||void 0===s?void 0:s.points)&&void 0!==r?r:[],o=null!==(n=null===(l=e.chart_bins)||void 0===l?void 0:l.bin_seconds)&&void 0!==n?n:30,d=[];if("accumulate"===t)d=c.map((e,t)=>({ts:i+(t+1)*o*1e3,value:e}));else{let e=a?a/60:0;d=c.map((t,a)=>{let s=t-(0===a?0:c[a-1]),l=e>0?s/e*100:0;return{ts:i+(a+1)*o*1e3,value:s,color:function(e){let t=Math.max(0,Math.min(120,e));return t<=50?v("#22c55e","#84cc16",t/50):t<=75?v("#84cc16","#eab308",(t-50)/25):t<=90?v("#eab308","#f97316",(t-75)/15):t<=100?v("#f97316","#ef4444",(t-90)/10):v("#ef4444","#dc2626",Math.min(1,(t-100)/20))}(l),percentOfTarget:l}})}return{data:Array(Math.floor(1800/o)).fill(null).map((e,t)=>{let a=i+(t+1)*o*1e3,s=d.find(e=>e.ts===a);return null!=s?s:{ts:a,value:0,color:"#22c55e",percentOfTarget:0}}),startTs:i,endTs:i+18e5,binSeconds:o}}(k,F,_),I=function(e,t){try{let a=new Date(e),s=new Date(t);return function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Asia/Kuala_Lumpur",s=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:a});try{let a=new Date(e),l=new Date(t);return"".concat(s.format(a)," – ").concat(s.format(l))}catch(e){return"Invalid time range"}}(a.toISOString(),s.toISOString(),g)}catch(e){return"Invalid time range"}}(S,A),O="accumulate"===F,L=(0,p.useRef)([]),[W,K]=(0,p.useState)(new Map),[R,C]=(0,p.useState)([]),P=(0,p.useRef)(null),[V,Y]=(0,p.useState)(0);(0,p.useEffect)(()=>{if(P.current&&(clearTimeout(P.current),P.current=null),O||0===M.length){L.current=M,C([...M]);return}if(!(JSON.stringify(L.current)!==JSON.stringify(M)))return;let e=new Map(W),t=[];return M.forEach((e,a)=>{let s=L.current[a];e.value>0&&(!s||0===s.value)&&t.push(a)}),t.length>0?(C([...M.map((a,s)=>{let l=a.color||"#22c55e";return t.includes(s)?(e.set(s,"#22c55e"),{ts:a.ts,value:0,color:"#22c55e",percentOfTarget:0}):(e.set(s,l),{...a})})]),K(new Map(e)),P.current=setTimeout(()=>{requestAnimationFrame(()=>{Y(e=>e+1),C([...M.map((e,t)=>({...e}))]),setTimeout(()=>{M.forEach((e,a)=>{if(t.includes(a)){let t=e.color||"#22c55e";K(e=>{let s=new Map(e);return s.set(a,t),s})}})},400)})},150)):(M.forEach((t,a)=>{e.set(a,t.color||"#22c55e")}),K(new Map(e)),C(M.map(e=>({...e})))),L.current=[...M],()=>{P.current&&clearTimeout(P.current)}},[M,O]);let Z=O?l.w:r.v,B=O?(0,s.jsx)(n.x,{type:"monotone",dataKey:"value",stroke:"#22d3ee",strokeWidth:2,dot:!1,isAnimationActive:!0,animationDuration:800}):(0,s.jsx)(i.$,{dataKey:"value",radius:[4,4,0,0],isAnimationActive:!0,animationDuration:1500,animationBegin:0,children:R.map((e,t)=>{let a=W.get(t)||e.color||"#22c55e";return(0,s.jsx)(c.b,{fill:a,style:{transition:"fill 1.2s cubic-bezier(0.4, 0, 0.2, 1)"}},"cell-".concat(e.ts,"-").concat(t))})}),G=O?(0,s.jsx)(o.d,{y:D,stroke:"#f97316",strokeDasharray:"6 6"}):_?(0,s.jsx)(o.d,{y:_/60,stroke:"rgba(255, 255, 255, 0.18)",strokeWidth:2,strokeDasharray:"4 4",label:{value:"Peak Target",position:"right",fill:"rgba(255, 255, 255, 0.6)",fontSize:11}}):null;return(0,s.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-4 sm:p-6",children:[(0,s.jsxs)("header",{className:"mb-4 sm:mb-6 flex flex-col sm:flex-row sm:items-end sm:justify-between gap-2 sm:gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-white",children:"Current 30-minute block"}),(0,s.jsxs)("p",{className:"text-xs sm:text-sm text-slate-400",children:["Window ",I]})]}),(0,s.jsx)("div",{className:"rounded-md border border-slate-800 px-3 sm:px-4 py-2 text-xs text-slate-400",children:O?(0,s.jsxs)(s.Fragment,{children:["Target ",D.toFixed(1)," kWh \xb7 Accumulated ",null!==(a=null==k?void 0:k.accumulated_kwh.toFixed(2))&&void 0!==a?a:"—"," kWh"]}):(0,s.jsxs)(s.Fragment,{children:["Peak Target ",null!==(j=null==_?void 0:_.toFixed(1))&&void 0!==j?j:"—"," kWh/30min \xb7 Target per bin ",(_?_/60:0).toFixed(3)," kWh"]})})]}),(0,s.jsx)("div",{className:"h-48 md:h-72 w-full",children:N&&!k?(0,s.jsx)("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:(0,s.jsx)("span",{className:"text-sm text-slate-500",children:"Loading chart…"})}):0===M.length||M.every(e=>0===e.value)?(0,s.jsx)("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:(0,s.jsx)("span",{className:"text-sm text-slate-500",children:"No readings for this block yet."})}):(0,s.jsx)(d.h,{width:"100%",height:"100%",children:(0,s.jsxs)(Z,{data:O?M:R,margin:{left:12,right:12,top:12,bottom:12},children:[(0,s.jsx)(u.q,{strokeDasharray:"4 4",stroke:"#1f2937"}),(0,s.jsx)(m.K,{dataKey:"ts",type:"number",domain:[S,A],tickFormatter:e=>b.format(e),stroke:"#64748b",tickLine:!1}),(0,s.jsx)(x.B,{dataKey:"value",stroke:"#64748b",tickLine:!1,width:60,tickFormatter:e=>f.format(e)}),(0,s.jsx)(h.u,{content:(0,s.jsx)(w,{target:D,targetPeakKwh:_,mode:F,binSeconds:E})}),G,B]},O?void 0:"chart-".concat(V))})}),(0,s.jsx)("p",{className:"mt-4 text-xs text-slate-500",children:"Streaming series updates replace the entire 60-point window whenever the backend publishes a block update."})]})}function w(e){var t,a,l,r;let{active:n,payload:i,label:c,target:o,targetPeakKwh:d,mode:u,binSeconds:m}=e;if(!n||!i||0===i.length||!c)return null;let x=null!==(r=null===(t=i[0])||void 0===t?void 0:t.value)&&void 0!==r?r:0,h=b.format(c);if("accumulate"===u){let e=o>0?(x/o*100).toFixed(1):"0";return(0,s.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-xs text-slate-200 shadow-lg",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[h," \xb7 ",f.format(x)," kWh"]}),(0,s.jsxs)("p",{className:"text-slate-400",children:["Accumulated \xb7 ",e,"% of target"]})]})}let p=d?d/60:0,g=p>0?(x/p*100).toFixed(1):"0",v=(null===(l=i[0])||void 0===l?void 0:null===(a=l.payload)||void 0===a?void 0:a.color)||"#22c55e",j=parseFloat(g),w="Green";return w=j>=100?"Red (≥100%)":j>=90?"Orange-Red (90-100%)":j>=75?"Yellow-Orange (75-90%)":j>=50?"Yellow-Green (50-75%)":"Green (<50%)",(0,s.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-xs text-slate-200 shadow-lg",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[h," \xb7 ",f.format(x)," kWh"]}),(0,s.jsxs)("p",{className:"text-slate-400",children:["Peak usage per ",m,"s \xb7 ",g,"% of peak target"]}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"h-3 w-3 rounded",style:{backgroundColor:v}}),(0,s.jsx)("span",{className:"text-slate-400",children:w})]})]})}},15597:function(e,t,a){a.d(t,{C:function(){return r}});var s=a(57437);let l=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function r(e){var t;let{connected:a,reconnecting:r,lastReadingTs:n,block:i,targetKwh:c}=e,o="bg-slate-500",d="Disconnected";a?(o="bg-emerald-400 animate-pulse",d="Connected"):r&&(o="bg-amber-400 animate-pulse",d="Reconnecting");let u=n?l.format(new Date(n)):"—",m=null!==(t=null!=c?c:null==i?void 0:i.target_kwh)&&void 0!==t?t:0,x=function(e,t){let a,s;if(!e||!e.block_start_local||t<=0)return{projectedTotal:0,status:"SAFE",color:"bg-emerald-500",elapsedMinutes:0};let l=new Date(e.block_start_local),r=Math.max(0,(new Date().getTime()-l.getTime())/6e4);if(r<1){let a=e.accumulated_kwh/t*100;return{projectedTotal:e.accumulated_kwh,status:a<80?"SAFE":a<100?"VERY CLOSE":"OVER",color:a<80?"bg-emerald-500":a<100?"bg-amber-500":"bg-red-500",elapsedMinutes:r}}let n=e.accumulated_kwh/r*30,i=n/t*100;return i<80?(a="SAFE",s="bg-emerald-500"):i<100?(a="VERY CLOSE",s="bg-amber-500"):(a="OVER",s="bg-red-500"),{projectedTotal:n,status:a,color:s,elapsedMinutes:Math.min(30,r)}}(i,m);return(0,s.jsxs)("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Live status"}),(0,s.jsxs)("div",{className:"mt-4 flex items-center gap-3",children:[(0,s.jsx)("span",{className:"h-3 w-3 rounded-full ".concat(o),"aria-hidden":"true"}),(0,s.jsx)("span",{className:"text-sm text-slate-200",children:d})]}),(0,s.jsx)("dl",{className:"mt-4 space-y-2 text-xs text-slate-400",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("dt",{className:"uppercase tracking-[0.2em] text-slate-500",children:"Last reading"}),(0,s.jsx)("dd",{className:"mt-1 text-sm text-slate-200",children:u})]})}),i&&m>0&&(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsx)("div",{className:"mb-2 text-xs uppercase tracking-[0.2em] text-slate-500",children:"30-Min Projection"}),(0,s.jsxs)("div",{className:"".concat(x.color," rounded-lg p-4 text-center shadow-lg"),children:[(0,s.jsx)("div",{className:"text-2xl font-bold text-white",children:x.status}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-white/90",children:["Projected: ",x.projectedTotal.toFixed(2)," kWh"]}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-white/80",children:["(",(x.projectedTotal/m*100).toFixed(1),"% of target)"]}),x.elapsedMinutes>0&&(0,s.jsxs)("div",{className:"mt-1 text-xs text-white/70",children:["Based on ",x.elapsedMinutes.toFixed(1)," min avg"]})]})]})]})}}}]);