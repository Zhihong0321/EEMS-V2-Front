"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[372],{90249:function(e,t,a){a.d(t,{J:function(){return r}});var s=a(57437);let l=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function r(e){let{history:t,loading:a}=e;return(0,s.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-white",children:"History (last 10 blocks)"}),a?(0,s.jsx)("ul",{className:"mt-4 space-y-3",children:Array.from({length:4}).map((e,t)=>(0,s.jsx)("li",{className:"h-12 animate-pulse rounded-md bg-slate-800/40"},t))}):0===t.length?(0,s.jsx)("p",{className:"mt-4 text-sm text-slate-400",children:"No block history yet. Run the simulator to populate readings."}):(0,s.jsx)("ul",{className:"mt-4 space-y-3",children:t.map((e,t)=>{let a=e.percent_of_target,r="";try{let t=new Date(e.block_start_local),a=new Date(t.getTime()+18e5);r="".concat(l.format(t)," – ").concat(l.format(a))}catch(t){r=e.block_start_local}return(0,s.jsxs)("li",{className:"flex items-center justify-between rounded-lg border border-slate-800 bg-slate-950/60 px-4 py-3 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-slate-100",children:r}),(0,s.jsxs)("p",{className:"text-xs text-slate-500",children:[e.accumulated_kwh.toFixed(2)," / ",e.target_kwh.toFixed(1)," kWh"]})]}),(0,s.jsxs)("span",{className:"text-sm font-semibold ".concat(a>100?"text-danger":a>=80?"text-warning":"text-success"),children:[a.toFixed(1),"%"]})]},"".concat(e.block_start_local,"-").concat(t))})})]})}},39514:function(e,t,a){a.d(t,{l:function(){return j}});var s=a(57437),l=a(92566),r=a(25974),n=a(16638),i=a(45745),o=a(68295),c=a(92893),d=a(35231),u=a(54142),m=a(2842),x=a(9542),h=a(85475),p=a(2265);let b="Asia/Kuala_Lumpur",g=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:b}),f=new Intl.NumberFormat(void 0,{maximumFractionDigits:2});function v(e,t,a){let s=e.replace("#",""),l=t.replace("#",""),r=parseInt(s.substr(0,2),16),n=parseInt(s.substr(2,2),16),i=parseInt(s.substr(4,2),16),o=parseInt(l.substr(0,2),16),c=parseInt(l.substr(2,2),16),d=parseInt(l.substr(4,2),16);return"#".concat([Math.round(r+(o-r)*a),Math.round(n+(c-n)*a),Math.round(i+(d-i)*a)].map(e=>{let t=e.toString(16);return 1===t.length?"0"+t:t}).join(""))}function j(e){var t,a,j;let{block:w,loading:N,targetKwh:y,targetPeakKwh:_,mode:D,lastReadingTs:F}=e,T=null!==(t=null!=y?y:null==w?void 0:w.target_kwh)&&void 0!==t?t:0,{data:I,startTs:A,endTs:S,binSeconds:K}=function(e,t,a){var s,l,r,n;if(!e||!e.block_start_local){let e=new Date().getTime();return{data:Array(60).fill(null).map((t,a)=>({ts:e+(a+1)*3e4,value:0})),startTs:e,endTs:e+18e5,binSeconds:30}}let i=new Date(e.block_start_local).getTime(),o=null!==(r=null===(s=e.chart_bins)||void 0===s?void 0:s.points)&&void 0!==r?r:[],c=null!==(n=null===(l=e.chart_bins)||void 0===l?void 0:l.bin_seconds)&&void 0!==n?n:30,d=[];if("accumulate"===t)d=o.map((e,t)=>({ts:i+(t+1)*c*1e3,value:e}));else{let e=a?a/60:0;d=o.map((t,a)=>{let s=t-(0===a?0:o[a-1]),l=e>0?s/e*100:0;return{ts:i+(a+1)*c*1e3,value:s,color:function(e){let t=Math.max(0,Math.min(120,e));return t<=50?v("#22c55e","#84cc16",t/50):t<=75?v("#84cc16","#eab308",(t-50)/25):t<=90?v("#eab308","#f97316",(t-75)/15):t<=100?v("#f97316","#ef4444",(t-90)/10):v("#ef4444","#dc2626",Math.min(1,(t-100)/20))}(l),percentOfTarget:l}})}return{data:Array(Math.floor(1800/c)).fill(null).map((e,t)=>{let a=i+(t+1)*c*1e3,s=d.find(e=>e.ts===a);return null!=s?s:{ts:a,value:0,color:"#22c55e",percentOfTarget:0}}),startTs:i,endTs:i+18e5,binSeconds:c}}(w,D,_),M=function(e,t){try{let a=new Date(e),s=new Date(t);return function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Asia/Kuala_Lumpur",s=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:a});try{let a=new Date(e),l=new Date(t);return"".concat(s.format(a)," – ").concat(s.format(l))}catch(e){return"Invalid time range"}}(a.toISOString(),s.toISOString(),b)}catch(e){return"Invalid time range"}}(A,S),W="accumulate"===D,L=(0,p.useRef)([]),[C,E]=(0,p.useState)(new Map),[O,R]=(0,p.useState)([]);(0,p.useEffect)(()=>{if(W||0===I.length){L.current=I,R(I);return}let e=new Map(C);if(I.some((e,t)=>{let a=L.current[t];return e.value>0&&(!a||0===a.value)})){R(I.map((t,a)=>{let s=L.current[a],l=t.color||"#22c55e";return t.value>0&&(!s||0===s.value)?(e.set(a,"#22c55e"),setTimeout(()=>{E(e=>{let t=new Map(e);return t.set(a,l),t})},400),{...t,value:0,color:"#22c55e"}):(e.set(a,l),t)})),E(e);let t=setTimeout(()=>{R(I)},50);return L.current=I,()=>clearTimeout(t)}I.forEach((t,a)=>{e.set(a,t.color||"#22c55e")}),E(e),R(I),L.current=I},[I,W]);let P=W?l.w:r.v,Z=W?(0,s.jsx)(n.x,{type:"monotone",dataKey:"value",stroke:"#22d3ee",strokeWidth:2,dot:!1,isAnimationActive:!0,animationDuration:800}):(0,s.jsx)(i.$,{dataKey:"value",radius:[4,4,0,0],isAnimationActive:!0,animationDuration:1500,animationBegin:0,children:O.map((e,t)=>{let a=C.get(t)||e.color||"#22c55e";return(0,s.jsx)(o.b,{fill:a,style:{transition:"fill 1.2s cubic-bezier(0.4, 0, 0.2, 1)"}},"cell-".concat(t))})}),G=W?(0,s.jsx)(c.d,{y:T,stroke:"#f97316",strokeDasharray:"6 6"}):_?(0,s.jsx)(c.d,{y:_/60,stroke:"rgba(255, 255, 255, 0.18)",strokeWidth:2,strokeDasharray:"4 4",label:{value:"Peak Target",position:"right",fill:"rgba(255, 255, 255, 0.6)",fontSize:11}}):null;return(0,s.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-6",children:[(0,s.jsxs)("header",{className:"mb-6 flex flex-wrap items-end justify-between gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-white",children:"Current 30-minute block"}),(0,s.jsxs)("p",{className:"text-sm text-slate-400",children:["Window ",M]})]}),(0,s.jsx)("div",{className:"rounded-md border border-slate-800 px-4 py-2 text-xs text-slate-400",children:W?(0,s.jsxs)(s.Fragment,{children:["Target ",T.toFixed(1)," kWh \xb7 Accumulated ",null!==(a=null==w?void 0:w.accumulated_kwh.toFixed(2))&&void 0!==a?a:"—"," kWh"]}):(0,s.jsxs)(s.Fragment,{children:["Peak Target ",null!==(j=null==_?void 0:_.toFixed(1))&&void 0!==j?j:"—"," kWh/30min \xb7 Target per bin ",(_?_/60:0).toFixed(3)," kWh"]})})]}),(0,s.jsx)("div",{className:"h-72 w-full",children:N&&!w?(0,s.jsx)("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:(0,s.jsx)("span",{className:"text-sm text-slate-500",children:"Loading chart…"})}):0===I.length||I.every(e=>0===e.value)?(0,s.jsx)("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:(0,s.jsx)("span",{className:"text-sm text-slate-500",children:"No readings for this block yet."})}):(0,s.jsx)(d.h,{width:"100%",height:"100%",children:(0,s.jsxs)(P,{data:W?I:O,margin:{left:12,right:12,top:12,bottom:12},children:[(0,s.jsx)(u.q,{strokeDasharray:"4 4",stroke:"#1f2937"}),(0,s.jsx)(m.K,{dataKey:"ts",type:"number",domain:[A,S],tickFormatter:e=>g.format(e),stroke:"#64748b",tickLine:!1}),(0,s.jsx)(x.B,{dataKey:"value",stroke:"#64748b",tickLine:!1,width:60,tickFormatter:e=>f.format(e)}),(0,s.jsx)(h.u,{content:(0,s.jsx)(k,{target:T,targetPeakKwh:_,mode:D,binSeconds:K})}),G,Z]})})}),(0,s.jsx)("p",{className:"mt-4 text-xs text-slate-500",children:"Streaming series updates replace the entire 60-point window whenever the backend publishes a block update."})]})}function k(e){var t,a,l,r;let{active:n,payload:i,label:o,target:c,targetPeakKwh:d,mode:u,binSeconds:m}=e;if(!n||!i||0===i.length||!o)return null;let x=null!==(r=null===(t=i[0])||void 0===t?void 0:t.value)&&void 0!==r?r:0,h=g.format(o);if("accumulate"===u){let e=c>0?(x/c*100).toFixed(1):"0";return(0,s.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-xs text-slate-200 shadow-lg",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[h," \xb7 ",f.format(x)," kWh"]}),(0,s.jsxs)("p",{className:"text-slate-400",children:["Accumulated \xb7 ",e,"% of target"]})]})}let p=d?d/60:0,b=p>0?(x/p*100).toFixed(1):"0",v=(null===(l=i[0])||void 0===l?void 0:null===(a=l.payload)||void 0===a?void 0:a.color)||"#22c55e",j=parseFloat(b),k="Green";return k=j>=100?"Red (≥100%)":j>=90?"Orange-Red (90-100%)":j>=75?"Yellow-Orange (75-90%)":j>=50?"Yellow-Green (50-75%)":"Green (<50%)",(0,s.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-xs text-slate-200 shadow-lg",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[h," \xb7 ",f.format(x)," kWh"]}),(0,s.jsxs)("p",{className:"text-slate-400",children:["Peak usage per ",m,"s \xb7 ",b,"% of peak target"]}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"h-3 w-3 rounded",style:{backgroundColor:v}}),(0,s.jsx)("span",{className:"text-slate-400",children:k})]})]})}},15597:function(e,t,a){a.d(t,{C:function(){return r}});var s=a(57437);let l=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function r(e){let{connected:t,reconnecting:a,lastReadingTs:r,simulatorId:n}=e,i="bg-slate-500",o="Disconnected";t?(i="bg-emerald-400 animate-pulse",o="Connected"):a&&(i="bg-amber-400 animate-pulse",o="Reconnecting");let c=r?l.format(new Date(r)):"—";return(0,s.jsxs)("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Live status"}),(0,s.jsxs)("div",{className:"mt-4 flex items-center gap-3",children:[(0,s.jsx)("span",{className:"h-3 w-3 rounded-full ".concat(i),"aria-hidden":"true"}),(0,s.jsx)("span",{className:"text-sm text-slate-200",children:o})]}),(0,s.jsxs)("dl",{className:"mt-4 space-y-2 text-xs text-slate-400",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("dt",{className:"uppercase tracking-[0.2em] text-slate-500",children:"Last reading"}),(0,s.jsx)("dd",{className:"mt-1 text-sm text-slate-200",children:c})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("dt",{className:"uppercase tracking-[0.2em] text-slate-500",children:"SSE endpoint"}),(0,s.jsxs)("dd",{className:"mt-1 text-sm text-slate-200",children:["/api/v1/stream/",null!=n?n:"<id>"]})]})]})]})}}}]);