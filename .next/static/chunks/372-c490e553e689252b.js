"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[372],{90249:function(e,t,a){a.d(t,{J:function(){return l}});var s=a(57437);let r=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function l(e){let{history:t,loading:a}=e;return(0,s.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-white",children:"History (last 10 blocks)"}),a?(0,s.jsx)("ul",{className:"mt-4 space-y-3",children:Array.from({length:4}).map((e,t)=>(0,s.jsx)("li",{className:"h-12 animate-pulse rounded-md bg-slate-800/40"},t))}):0===t.length?(0,s.jsx)("p",{className:"mt-4 text-sm text-slate-400",children:"No block history yet. Run the simulator to populate readings."}):(0,s.jsx)("ul",{className:"mt-4 space-y-3",children:t.map((e,t)=>{let a=e.percent_of_target,l="";try{let t=new Date(e.block_start_local),a=new Date(t.getTime()+18e5);l="".concat(r.format(t)," – ").concat(r.format(a))}catch(t){l=e.block_start_local}return(0,s.jsxs)("li",{className:"flex items-center justify-between rounded-lg border border-slate-800 bg-slate-950/60 px-4 py-3 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-slate-100",children:l}),(0,s.jsxs)("p",{className:"text-xs text-slate-500",children:[e.accumulated_kwh.toFixed(2)," / ",e.target_kwh.toFixed(1)," kWh"]})]}),(0,s.jsxs)("span",{className:"text-sm font-semibold ".concat(a>100?"text-danger":a>=80?"text-warning":"text-success"),children:[a.toFixed(1),"%"]})]},"".concat(e.block_start_local,"-").concat(t))})})]})}},39514:function(e,t,a){a.d(t,{l:function(){return j}});var s=a(57437),r=a(92566),l=a(25974),n=a(16638),i=a(45745),c=a(68295),o=a(92893),d=a(35231),u=a(54142),m=a(2842),x=a(9542),h=a(85475),p=a(2265);let f="Asia/Kuala_Lumpur",g=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:f}),b=new Intl.NumberFormat(void 0,{maximumFractionDigits:2});function v(e,t,a){let s=e.replace("#",""),r=t.replace("#",""),l=parseInt(s.substr(0,2),16),n=parseInt(s.substr(2,2),16),i=parseInt(s.substr(4,2),16),c=parseInt(r.substr(0,2),16),o=parseInt(r.substr(2,2),16),d=parseInt(r.substr(4,2),16);return"#".concat([Math.round(l+(c-l)*a),Math.round(n+(o-n)*a),Math.round(i+(d-i)*a)].map(e=>{let t=e.toString(16);return 1===t.length?"0"+t:t}).join(""))}function j(e){var t,a,j;let{block:w,loading:N,targetKwh:y,targetPeakKwh:_,mode:F,lastReadingTs:D}=e,T=null!==(t=null!=y?y:null==w?void 0:w.target_kwh)&&void 0!==t?t:0,{data:S,startTs:I,endTs:A,binSeconds:M}=function(e,t,a){var s,r,l,n;if(!e||!e.block_start_local){let e=new Date().getTime();return{data:Array(60).fill(null).map((t,a)=>({ts:e+(a+1)*3e4,value:0})),startTs:e,endTs:e+18e5,binSeconds:30}}let i=new Date(e.block_start_local).getTime(),c=null!==(l=null===(s=e.chart_bins)||void 0===s?void 0:s.points)&&void 0!==l?l:[],o=null!==(n=null===(r=e.chart_bins)||void 0===r?void 0:r.bin_seconds)&&void 0!==n?n:30,d=[];if("accumulate"===t)d=c.map((e,t)=>({ts:i+(t+1)*o*1e3,value:e}));else{let e=a?a/60:0;d=c.map((t,a)=>{let s=t-(0===a?0:c[a-1]),r=e>0?s/e*100:0;return{ts:i+(a+1)*o*1e3,value:s,color:function(e){let t=Math.max(0,Math.min(120,e));return t<=50?v("#22c55e","#84cc16",t/50):t<=75?v("#84cc16","#eab308",(t-50)/25):t<=90?v("#eab308","#f97316",(t-75)/15):t<=100?v("#f97316","#ef4444",(t-90)/10):v("#ef4444","#dc2626",Math.min(1,(t-100)/20))}(r),percentOfTarget:r}})}return{data:Array(Math.floor(1800/o)).fill(null).map((e,t)=>{let a=i+(t+1)*o*1e3,s=d.find(e=>e.ts===a);return null!=s?s:{ts:a,value:0,color:"#22c55e",percentOfTarget:0}}),startTs:i,endTs:i+18e5,binSeconds:o}}(w,F,_),K=function(e,t){try{let a=new Date(e),s=new Date(t);return function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Asia/Kuala_Lumpur",s=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:a});try{let a=new Date(e),r=new Date(t);return"".concat(s.format(a)," – ").concat(s.format(r))}catch(e){return"Invalid time range"}}(a.toISOString(),s.toISOString(),f)}catch(e){return"Invalid time range"}}(I,A),W="accumulate"===F,L=(0,p.useRef)([]),[O,E]=(0,p.useState)(new Map),[C,R]=(0,p.useState)([]),P=(0,p.useRef)(null),[Z,G]=(0,p.useState)(0);(0,p.useEffect)(()=>{if(P.current&&(clearTimeout(P.current),P.current=null),W||0===S.length){L.current=S,R([...S]);return}if(!(JSON.stringify(L.current)!==JSON.stringify(S)))return;let e=new Map(O),t=[];return S.forEach((e,a)=>{let s=L.current[a];e.value>0&&(!s||0===s.value)&&t.push(a)}),t.length>0?(R([...S.map((a,s)=>{let r=a.color||"#22c55e";return t.includes(s)?(e.set(s,"#22c55e"),{ts:a.ts,value:0,color:"#22c55e",percentOfTarget:0}):(e.set(s,r),{...a})})]),E(new Map(e)),P.current=setTimeout(()=>{requestAnimationFrame(()=>{G(e=>e+1),R([...S.map((e,t)=>({...e}))]),setTimeout(()=>{S.forEach((e,a)=>{if(t.includes(a)){let t=e.color||"#22c55e";E(e=>{let s=new Map(e);return s.set(a,t),s})}})},400)})},150)):(S.forEach((t,a)=>{e.set(a,t.color||"#22c55e")}),E(new Map(e)),R(S.map(e=>({...e})))),L.current=[...S],()=>{P.current&&clearTimeout(P.current)}},[S,W]);let J=W?r.w:l.v,q=W?(0,s.jsx)(n.x,{type:"monotone",dataKey:"value",stroke:"#22d3ee",strokeWidth:2,dot:!1,isAnimationActive:!0,animationDuration:800}):(0,s.jsx)(i.$,{dataKey:"value",radius:[4,4,0,0],isAnimationActive:!0,animationDuration:1500,animationBegin:0,children:C.map((e,t)=>{let a=O.get(t)||e.color||"#22c55e";return(0,s.jsx)(c.b,{fill:a,style:{transition:"fill 1.2s cubic-bezier(0.4, 0, 0.2, 1)"}},"cell-".concat(e.ts,"-").concat(t))})}),z=W?(0,s.jsx)(o.d,{y:T,stroke:"#f97316",strokeDasharray:"6 6"}):_?(0,s.jsx)(o.d,{y:_/60,stroke:"rgba(255, 255, 255, 0.18)",strokeWidth:2,strokeDasharray:"4 4",label:{value:"Peak Target",position:"right",fill:"rgba(255, 255, 255, 0.6)",fontSize:11}}):null;return(0,s.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-4 sm:p-6",children:[(0,s.jsxs)("header",{className:"mb-4 sm:mb-6 flex flex-col sm:flex-row sm:items-end sm:justify-between gap-2 sm:gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-white",children:"Current 30-minute block"}),(0,s.jsxs)("p",{className:"text-xs sm:text-sm text-slate-400",children:["Window ",K]})]}),(0,s.jsx)("div",{className:"rounded-md border border-slate-800 px-3 sm:px-4 py-2 text-xs text-slate-400",children:W?(0,s.jsxs)(s.Fragment,{children:["Target ",T.toFixed(1)," kWh \xb7 Accumulated ",null!==(a=null==w?void 0:w.accumulated_kwh.toFixed(2))&&void 0!==a?a:"—"," kWh"]}):(0,s.jsxs)(s.Fragment,{children:["Peak Target ",null!==(j=null==_?void 0:_.toFixed(1))&&void 0!==j?j:"—"," kWh/30min \xb7 Target per bin ",(_?_/60:0).toFixed(3)," kWh"]})})]}),(0,s.jsx)("div",{className:"h-48 md:h-72 w-full",children:N&&!w?(0,s.jsx)("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:(0,s.jsx)("span",{className:"text-sm text-slate-500",children:"Loading chart…"})}):0===S.length||S.every(e=>0===e.value)?(0,s.jsx)("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:(0,s.jsx)("span",{className:"text-sm text-slate-500",children:"No readings for this block yet."})}):(0,s.jsx)(d.h,{width:"100%",height:"100%",children:(0,s.jsxs)(J,{data:W?S:C,margin:{left:12,right:12,top:12,bottom:12},children:[(0,s.jsx)(u.q,{strokeDasharray:"4 4",stroke:"#1f2937"}),(0,s.jsx)(m.K,{dataKey:"ts",type:"number",domain:[I,A],tickFormatter:e=>g.format(e),stroke:"#64748b",tickLine:!1}),(0,s.jsx)(x.B,{dataKey:"value",stroke:"#64748b",tickLine:!1,width:60,tickFormatter:e=>b.format(e)}),(0,s.jsx)(h.u,{content:(0,s.jsx)(k,{target:T,targetPeakKwh:_,mode:F,binSeconds:M})}),z,q]},W?void 0:"chart-".concat(Z))})}),(0,s.jsx)("p",{className:"mt-4 text-xs text-slate-500",children:"Streaming series updates replace the entire 60-point window whenever the backend publishes a block update."})]})}function k(e){var t,a,r,l;let{active:n,payload:i,label:c,target:o,targetPeakKwh:d,mode:u,binSeconds:m}=e;if(!n||!i||0===i.length||!c)return null;let x=null!==(l=null===(t=i[0])||void 0===t?void 0:t.value)&&void 0!==l?l:0,h=g.format(c);if("accumulate"===u){let e=o>0?(x/o*100).toFixed(1):"0";return(0,s.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-xs text-slate-200 shadow-lg",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[h," \xb7 ",b.format(x)," kWh"]}),(0,s.jsxs)("p",{className:"text-slate-400",children:["Accumulated \xb7 ",e,"% of target"]})]})}let p=d?d/60:0,f=p>0?(x/p*100).toFixed(1):"0",v=(null===(r=i[0])||void 0===r?void 0:null===(a=r.payload)||void 0===a?void 0:a.color)||"#22c55e",j=parseFloat(f),k="Green";return k=j>=100?"Red (≥100%)":j>=90?"Orange-Red (90-100%)":j>=75?"Yellow-Orange (75-90%)":j>=50?"Yellow-Green (50-75%)":"Green (<50%)",(0,s.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-xs text-slate-200 shadow-lg",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[h," \xb7 ",b.format(x)," kWh"]}),(0,s.jsxs)("p",{className:"text-slate-400",children:["Peak usage per ",m,"s \xb7 ",f,"% of peak target"]}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,s.jsx)("div",{className:"h-3 w-3 rounded",style:{backgroundColor:v}}),(0,s.jsx)("span",{className:"text-slate-400",children:k})]})]})}},15597:function(e,t,a){a.d(t,{C:function(){return l}});var s=a(57437);let r=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function l(e){let{connected:t,reconnecting:a,lastReadingTs:l,simulatorId:n}=e,i="bg-slate-500",c="Disconnected";t?(i="bg-emerald-400 animate-pulse",c="Connected"):a&&(i="bg-amber-400 animate-pulse",c="Reconnecting");let o=l?r.format(new Date(l)):"—";return(0,s.jsxs)("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-6",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Live status"}),(0,s.jsxs)("div",{className:"mt-4 flex items-center gap-3",children:[(0,s.jsx)("span",{className:"h-3 w-3 rounded-full ".concat(i),"aria-hidden":"true"}),(0,s.jsx)("span",{className:"text-sm text-slate-200",children:c})]}),(0,s.jsxs)("dl",{className:"mt-4 space-y-2 text-xs text-slate-400",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("dt",{className:"uppercase tracking-[0.2em] text-slate-500",children:"Last reading"}),(0,s.jsx)("dd",{className:"mt-1 text-sm text-slate-200",children:o})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("dt",{className:"uppercase tracking-[0.2em] text-slate-500",children:"SSE endpoint"}),(0,s.jsxs)("dd",{className:"mt-1 text-sm text-slate-200",children:["/api/v1/stream/",null!=n?n:"<id>"]})]})]})]})}}}]);