(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{96516:function(e,t,a){Promise.resolve().then(a.bind(a,40823))},40823:function(e,t,a){"use strict";a.d(t,{CombinedDashboard:function(){return g}});var n=a(57437),s=a(2265),r=a(39514),l=a(32876),i=a(15597),o=a(84686),c=a(17166),d=a(81622),u=a(74044),m=a(77209);let x=new Intl.NumberFormat(void 0,{maximumFractionDigits:1});function g(e){var t;let{simulatorId:a,simulatorName:g,targetKwh:h,initialBlock:f,initialHistory:p}=e,[b,v]=(0,s.useState)("accumulate"),[w,k]=(0,s.useState)(!0),[j,N]=(0,s.useState)(null),[y,C]=(0,s.useState)(320),[S,_]=(0,s.useState)(12),[R,E]=(0,s.useState)(.5),[L,A]=(0,s.useState)(800),[M,Z]=(0,s.useState)(100),O=(0,s.useMemo)(()=>R*L,[R,L]),{history:F,loading:I,refresh:K}=(0,d.NX)(a,10,p),W=(0,s.useCallback)(()=>{K()},[K]),{block:T,loading:B,connected:D,reconnecting:P,lastReadingTs:V,refresh:H}=(0,d.AF)(a,{onWindowChange:W},f),z=(0,s.useCallback)(e=>{e.device_ts&&(N(e.device_ts),H())},[H]),J=(0,u.V)(a,y,S,w,z),U=(0,u.o)(a,()=>O,w,z);(0,s.useEffect)(()=>{if(!(J.isRunning||U.isRunning))return;let e=setInterval(()=>{H()},2e3);return()=>clearInterval(e)},[J.isRunning,U.isRunning,H]);let X=null!=V?V:j,q=()=>{J.isRunning?J.stop():(U.stop(),J.start())},G=()=>{U.isRunning?U.stop():(J.stop(),U.start())},Q=null!==(t=null==T?void 0:T.percent_of_target)&&void 0!==t?t:0,Y=Q>100?"text-danger":Q>=80?"text-warning":"text-success";return(0,n.jsxs)("section",{className:"space-y-10 animate-fadeIn",children:[(0,n.jsxs)("header",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Simulator Dashboard"}),(0,n.jsx)("h1",{children:g}),(0,n.jsx)("p",{className:"text-sm sm:text-base text-slate-400",children:"Live chart and block history update in real time via server-sent events from the backend."})]}),(0,n.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-sm text-slate-300",children:[(0,n.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-3 sm:px-4 py-2 text-right",children:[(0,n.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Target"}),(0,n.jsx)("p",{className:"text-sm sm:text-base font-semibold text-slate-100",children:h?"".concat(h.toFixed(1)," kWh"):"â€”"})]}),(0,n.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-3 sm:px-4 py-2 text-right",children:[(0,n.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Current block"}),(0,n.jsxs)("p",{className:"text-sm sm:text-base font-semibold ".concat(Y),children:[x.format(Q),"%"]})]})]})]}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[(0,n.jsx)("label",{htmlFor:"chart-mode-select",className:"text-sm font-medium text-slate-300",children:"Chart Mode:"}),(0,n.jsxs)(m.Ph,{id:"chart-mode-select",value:b,onChange:e=>v(e.target.value),className:"w-full sm:w-auto","aria-label":"Select chart mode",children:[(0,n.jsx)("option",{value:"accumulate",children:"Accumulate"}),(0,n.jsx)("option",{value:"non-accumulate",children:"Non-Accumulate (Peak Usage)"})]}),"non-accumulate"===b&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("label",{htmlFor:"target-peak-kwh",className:"text-sm font-medium text-slate-300 sm:ml-4",children:"Target Accumulated (kWh):"}),(0,n.jsx)(m.II,{id:"target-peak-kwh",type:"number",value:M,onChange:e=>Z(parseFloat(e.target.value)||100),min:"0",step:"0.1",className:"w-full sm:w-32","aria-label":"Target accumulated kWh for peak usage mode"})]})]}),(0,n.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[(0,n.jsx)(r.l,{block:null!=T?T:{simulator_id:a,block_start_local:new Date().toISOString(),block_start_utc:new Date().toISOString(),block_end_utc:new Date().toISOString(),target_kwh:null!=h?h:0,accumulated_kwh:0,percent_of_target:0,alerted_80pct:!1,chart_bins:{bin_seconds:30,points:[]}},loading:B,targetKwh:h,targetPeakKwh:"non-accumulate"===b?M:void 0,mode:b,lastReadingTs:X}),(0,n.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,n.jsx)(i.C,{connected:D,reconnecting:P,lastReadingTs:null!=X?X:void 0,block:T,targetKwh:h,targetPeakKwh:"non-accumulate"===b?M:void 0}),(0,n.jsx)(l.J,{history:F,loading:I})]})]}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 border-b border-slate-800 pb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Simulator Controls"}),(0,n.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:"Configure auto and manual emitters. Only one mode can run at a time."})]}),(0,n.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-300 min-h-[44px]",children:[(0,n.jsx)("input",{type:"checkbox",checked:w,onChange:e=>k(e.target.checked),className:"w-5 h-5 rounded border-slate-600 bg-slate-800 text-primary focus:ring-2 focus:ring-primary"}),(0,n.jsx)("span",{children:"Fast-forward (30x speed)"})]})]}),(0,n.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,n.jsx)(o.l,{baseKw:y,onBaseKwChange:C,volatility:S,onVolatilityChange:_,isRunning:J.isRunning,onStart:q,onStop:q,sentCount:J.sentCount,lastSentAt:J.lastSentAt,disabled:U.isRunning,disabledReason:U.isRunning?"Manual emitter is active. Stop it before running auto mode.":void 0}),(0,n.jsx)(c.x,{sliderValue:R,onSliderChange:E,maxKw:L,onMaxKwChange:A,isRunning:U.isRunning,onStart:G,onStop:G,sentCount:U.sentCount,lastSentAt:U.lastSentAt,disabled:J.isRunning,disabledReason:J.isRunning?"Auto emitter is active. Stop it before running manual mode.":void 0})]})]}),(0,n.jsxs)("p",{className:"text-xs text-slate-500",children:["Timezone reference: ","Asia/Kuala_Lumpur",". Chart displays the current 30-minute block based on the last received reading timestamp (prototype mode). Fast-forward mode advances simulated time by 30 seconds per real second."]})]})}},85130:function(e,t,a){"use strict";var n=a(2265);let s=n.forwardRef(function(e,t){let{title:a,titleId:s,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},r),a?n.createElement("title",{id:s},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});t.Z=s},11853:function(e,t,a){"use strict";var n=a(2265);let s=n.forwardRef(function(e,t){let{title:a,titleId:s,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},r),a?n.createElement("title",{id:s},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))});t.Z=s},13934:function(e,t,a){"use strict";var n=a(2265);let s=n.forwardRef(function(e,t){let{title:a,titleId:s,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},r),a?n.createElement("title",{id:s},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))});t.Z=s},39519:function(e,t,a){"use strict";var n=a(2265);let s=n.forwardRef(function(e,t){let{title:a,titleId:s,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},r),a?n.createElement("title",{id:s},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});t.Z=s},84573:function(e,t,a){"use strict";var n=a(2265);let s=n.forwardRef(function(e,t){let{title:a,titleId:s,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},r),a?n.createElement("title",{id:s},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))});t.Z=s},44839:function(e,t,a){"use strict";t.Z=function(){for(var e,t,a=0,n="",s=arguments.length;a<s;a++)(e=arguments[a])&&(t=function e(t){var a,n,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t){if(Array.isArray(t)){var r=t.length;for(a=0;a<r;a++)t[a]&&(n=e(t[a]))&&(s&&(s+=" "),s+=n)}else for(n in t)t[n]&&(s&&(s+=" "),s+=n)}return s}(e))&&(n&&(n+=" "),n+=t);return n}}},function(e){e.O(0,[740,836,622,555,260,971,23,744],function(){return e(e.s=96516)}),_N_E=e.O()}]);