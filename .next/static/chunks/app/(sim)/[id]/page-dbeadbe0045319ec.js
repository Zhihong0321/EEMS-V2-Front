(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{96516:function(e,t,a){Promise.resolve().then(a.bind(a,28857))},28857:function(e,t,a){"use strict";a.d(t,{CombinedDashboard:function(){return f}});var s=a(57437),n=a(2265),r=a(39514),l=a(32876),i=a(15597),o=a(84686),c=a(17166),d=a(81622),m=a(74044),u=a(77209),x=a(55164);let h=n.forwardRef(function(e,t){let{title:a,titleId:s,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":s},r),a?n.createElement("title",{id:s},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))});var g=a(23047),p=a(44839);let b=new Intl.NumberFormat(void 0,{maximumFractionDigits:1});function f(e){var t;let{simulatorId:a,simulatorName:f,targetKwh:v,initialBlock:j,initialHistory:w}=e,[k,N]=(0,n.useState)("dashboard"),[y,C]=(0,n.useState)("accumulate"),[S,_]=(0,n.useState)(!0),[R,E]=(0,n.useState)(null),[A,M]=(0,n.useState)(320),[F,I]=(0,n.useState)(12),[Z,K]=(0,n.useState)(.5),[O,L]=(0,n.useState)(800),[W,D]=(0,n.useState)(100),T=(0,n.useMemo)(()=>Z*O,[Z,O]),{history:V,loading:P,refresh:B}=(0,d.NX)(a,10,w),z=(0,n.useCallback)(()=>{B()},[B]),{block:H,loading:J,connected:U,reconnecting:X,lastReadingTs:q,refresh:G}=(0,d.AF)(a,{onWindowChange:z},j),Q=(0,n.useCallback)(e=>{e.device_ts&&(E(e.device_ts),G())},[G]),Y=(0,m.V)(a,A,F,S,Q),$=(0,m.o)(a,()=>T,S,Q);(0,n.useEffect)(()=>{if(!(Y.isRunning||$.isRunning))return;let e=setInterval(()=>{G()},2e3);return()=>clearInterval(e)},[Y.isRunning,$.isRunning,G]);let ee=null!=q?q:R,et=()=>{Y.isRunning?Y.stop():($.stop(),Y.start())},ea=()=>{$.isRunning?$.stop():(Y.stop(),$.start())},es=null!==(t=null==H?void 0:H.percent_of_target)&&void 0!==t?t:0,en=es>100?"text-danger":es>=80?"text-warning":"text-success";return(0,s.jsxs)("section",{className:"space-y-6 animate-fadeIn",children:[(0,s.jsxs)("header",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Simulator Dashboard"}),(0,s.jsx)("h1",{children:f}),(0,s.jsx)("p",{className:"text-sm sm:text-base text-slate-400",children:"dashboard"===k?"Live chart and block history update in real time via server-sent events from the backend.":"Manage WhatsApp notifications for energy usage thresholds."})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-sm text-slate-300",children:[(0,s.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-3 sm:px-4 py-2 text-right",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Target"}),(0,s.jsx)("p",{className:"text-sm sm:text-base font-semibold text-slate-100",children:v?"".concat(v.toFixed(1)," kWh"):"â€”"})]}),(0,s.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-3 sm:px-4 py-2 text-right",children:[(0,s.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Current block"}),(0,s.jsxs)("p",{className:"text-sm sm:text-base font-semibold ".concat(en),children:[b.format(es),"%"]})]})]})]}),(0,s.jsx)("div",{className:"border-b border-slate-700",children:(0,s.jsxs)("nav",{className:"flex space-x-8",children:[(0,s.jsxs)("button",{onClick:()=>N("dashboard"),className:(0,p.Z)("flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors","dashboard"===k?"border-primary text-primary":"border-transparent text-slate-400 hover:text-slate-300 hover:border-slate-300"),children:[(0,s.jsx)(h,{className:"h-5 w-5"}),"Dashboard"]}),(0,s.jsxs)("button",{onClick:()=>N("notifications"),className:(0,p.Z)("flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors","notifications"===k?"border-primary text-primary":"border-transparent text-slate-400 hover:text-slate-300 hover:border-slate-300"),children:[(0,s.jsx)(g.Z,{className:"h-5 w-5"}),"Notifications"]})]})}),"dashboard"===k&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[(0,s.jsx)("label",{htmlFor:"chart-mode-select",className:"text-sm font-medium text-slate-300",children:"Chart Mode:"}),(0,s.jsxs)(u.Ph,{id:"chart-mode-select",value:y,onChange:e=>C(e.target.value),className:"w-full sm:w-auto","aria-label":"Select chart mode",children:[(0,s.jsx)("option",{value:"accumulate",children:"Accumulate"}),(0,s.jsx)("option",{value:"non-accumulate",children:"Non-Accumulate (Peak Usage)"})]}),"non-accumulate"===y&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("label",{htmlFor:"target-peak-kwh",className:"text-sm font-medium text-slate-300 sm:ml-4",children:"Target Accumulated (kWh):"}),(0,s.jsx)(u.II,{id:"target-peak-kwh",type:"number",value:W,onChange:e=>D(parseFloat(e.target.value)||100),min:"0",step:"0.1",className:"w-full sm:w-32","aria-label":"Target accumulated kWh for peak usage mode"})]})]}),(0,s.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[(0,s.jsx)(r.l,{block:null!=H?H:{simulator_id:a,block_start_local:new Date().toISOString(),block_start_utc:new Date().toISOString(),block_end_utc:new Date().toISOString(),target_kwh:null!=v?v:0,accumulated_kwh:0,percent_of_target:0,alerted_80pct:!1,chart_bins:{bin_seconds:30,points:[]}},loading:J,targetKwh:v,targetPeakKwh:"non-accumulate"===y?W:void 0,mode:y,lastReadingTs:ee}),(0,s.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,s.jsx)(i.C,{connected:U,reconnecting:X,lastReadingTs:null!=ee?ee:void 0,block:H,targetKwh:v,targetPeakKwh:"non-accumulate"===y?W:void 0}),(0,s.jsx)(l.J,{history:V,loading:P})]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 border-b border-slate-800 pb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{children:"Simulator Controls"}),(0,s.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:"Configure auto and manual emitters. Only one mode can run at a time."})]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-300 min-h-[44px]",children:[(0,s.jsx)("input",{type:"checkbox",checked:S,onChange:e=>_(e.target.checked),className:"w-5 h-5 rounded border-slate-600 bg-slate-800 text-primary focus:ring-2 focus:ring-primary"}),(0,s.jsx)("span",{children:"Fast-forward (30x speed)"})]})]}),(0,s.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,s.jsx)(o.l,{baseKw:A,onBaseKwChange:M,volatility:F,onVolatilityChange:I,isRunning:Y.isRunning,onStart:et,onStop:et,sentCount:Y.sentCount,lastSentAt:Y.lastSentAt,disabled:$.isRunning,disabledReason:$.isRunning?"Manual emitter is active. Stop it before running auto mode.":void 0}),(0,s.jsx)(c.x,{sliderValue:Z,onSliderChange:K,maxKw:O,onMaxKwChange:L,isRunning:$.isRunning,onStart:ea,onStop:ea,sentCount:$.sentCount,lastSentAt:$.lastSentAt,disabled:Y.isRunning,disabledReason:Y.isRunning?"Auto emitter is active. Stop it before running manual mode.":void 0})]})]}),(0,s.jsxs)("p",{className:"text-xs text-slate-500",children:["Timezone reference: ","Asia/Kuala_Lumpur",". Chart displays the current 30-minute block based on the last received reading timestamp (prototype mode). Fast-forward mode advances simulated time by 30 seconds per real second."]})]}),"notifications"===k&&(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsx)(x.fn,{simulatorId:a,simulatorName:f})})]})}},13934:function(e,t,a){"use strict";var s=a(2265);let n=s.forwardRef(function(e,t){let{title:a,titleId:n,...r}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},r),a?s.createElement("title",{id:n},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"}))});t.Z=n},84573:function(e,t,a){"use strict";var s=a(2265);let n=s.forwardRef(function(e,t){let{title:a,titleId:n,...r}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},r),a?s.createElement("title",{id:n},a):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))});t.Z=n}},function(e){e.O(0,[740,836,622,164,555,260,971,23,744],function(){return e(e.s=96516)}),_N_E=e.O()}]);