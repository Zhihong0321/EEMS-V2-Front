(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[879],{96516:function(e,t,s){Promise.resolve().then(s.bind(s,40823))},40823:function(e,t,s){"use strict";s.d(t,{CombinedDashboard:function(){return x}});var a=s(57437),n=s(2265),l=s(39514),r=s(90249),i=s(15597),c=s(84686),o=s(17166),d=s(81622),u=s(74044);let m=new Intl.NumberFormat(void 0,{maximumFractionDigits:1});function x(e){var t;let{simulatorId:s,simulatorName:x,targetKwh:g,initialBlock:h,initialHistory:p}=e,[b,f]=(0,n.useState)("accumulate"),[v,j]=(0,n.useState)(!0),[N,w]=(0,n.useState)(null),[k,S]=(0,n.useState)(320),[y,_]=(0,n.useState)(12),[C,R]=(0,n.useState)(.5),[A,K]=(0,n.useState)(800),[F,D]=(0,n.useState)(100),I=(0,n.useMemo)(()=>C*A,[C,A]),{history:O,loading:T,refresh:E}=(0,d.NX)(s,10,p),M=(0,n.useCallback)(()=>{E()},[E]),{block:P,loading:V,connected:W,reconnecting:L,lastReadingTs:U,refresh:z}=(0,d.AF)(s,{onWindowChange:M},h),B=(0,n.useCallback)(e=>{e.device_ts&&(w(e.device_ts),z())},[z]),J=(0,u.V)(s,k,y,v,B),X=(0,u.o)(s,()=>I,v,B);(0,n.useEffect)(()=>{if(!(J.isRunning||X.isRunning))return;let e=setInterval(()=>{z()},2e3);return()=>clearInterval(e)},[J.isRunning,X.isRunning,z]);let Z=null!=U?U:N,q=()=>{J.isRunning?J.stop():(X.stop(),J.start())},G=()=>{X.isRunning?X.stop():(J.stop(),X.start())},H=null!==(t=null==P?void 0:P.percent_of_target)&&void 0!==t?t:0,Q=H>100?"text-danger":H>=80?"text-warning":"text-success";return(0,a.jsxs)("section",{className:"space-y-10",children:[(0,a.jsxs)("header",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Simulator Dashboard"}),(0,a.jsx)("h1",{className:"text-2xl sm:text-3xl font-semibold text-white",children:x}),(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"Live chart and block history update in real time via server-sent events from the backend."})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-sm text-slate-300",children:[(0,a.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-3 sm:px-4 py-2 text-right",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Target"}),(0,a.jsx)("p",{className:"text-sm sm:text-base font-semibold text-slate-100",children:g?"".concat(g.toFixed(1)," kWh"):"â€”"})]}),(0,a.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-3 sm:px-4 py-2 text-right",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Current block"}),(0,a.jsxs)("p",{className:"text-sm sm:text-base font-semibold ".concat(Q),children:[m.format(H),"%"]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[(0,a.jsx)("label",{className:"text-sm text-slate-300",children:"Chart Mode:"}),(0,a.jsxs)("select",{value:b,onChange:e=>f(e.target.value),className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-2 text-sm text-slate-100",children:[(0,a.jsx)("option",{value:"accumulate",children:"Accumulate"}),(0,a.jsx)("option",{value:"non-accumulate",children:"Non-Accumulate (Peak Usage)"})]}),"non-accumulate"===b&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("label",{className:"text-sm text-slate-300 sm:ml-4",children:"Target Accumulated Usage (kWh for 30min block):"}),(0,a.jsx)("input",{type:"number",value:F,onChange:e=>D(parseFloat(e.target.value)||100),min:"0",step:"0.1",className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-2 text-sm text-slate-100 w-full sm:w-32"})]})]}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[(0,a.jsx)(l.l,{block:null!=P?P:{simulator_id:s,block_start_local:new Date().toISOString(),block_start_utc:new Date().toISOString(),block_end_utc:new Date().toISOString(),target_kwh:null!=g?g:0,accumulated_kwh:0,percent_of_target:0,alerted_80pct:!1,chart_bins:{bin_seconds:30,points:[]}},loading:V,targetKwh:g,targetPeakKwh:"non-accumulate"===b?F:void 0,mode:b,lastReadingTs:Z}),(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsx)(i.C,{connected:W,reconnecting:L,lastReadingTs:null!=Z?Z:void 0,block:P,targetKwh:g,targetPeakKwh:"non-accumulate"===b?F:void 0}),(0,a.jsx)(r.J,{history:O,loading:T})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 border-b border-slate-800 pb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl sm:text-2xl font-semibold text-white",children:"Simulator Controls"}),(0,a.jsx)("p",{className:"text-sm text-slate-400 mt-1",children:"Configure auto and manual emitters. Only one mode can run at a time."})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-300 min-h-[44px]",children:[(0,a.jsx)("input",{type:"checkbox",checked:v,onChange:e=>j(e.target.checked),className:"w-5 h-5 rounded border-slate-600 bg-slate-800 text-primary focus:ring-2 focus:ring-primary"}),(0,a.jsx)("span",{children:"Fast-forward (30x speed)"})]})]}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,a.jsx)(c.l,{baseKw:k,onBaseKwChange:S,volatility:y,onVolatilityChange:_,isRunning:J.isRunning,onStart:q,onStop:q,sentCount:J.sentCount,lastSentAt:J.lastSentAt,disabled:X.isRunning,disabledReason:X.isRunning?"Manual emitter is active. Stop it before running auto mode.":void 0}),(0,a.jsx)(o.x,{sliderValue:C,onSliderChange:R,maxKw:A,onMaxKwChange:K,isRunning:X.isRunning,onStart:G,onStop:G,sentCount:X.sentCount,lastSentAt:X.lastSentAt,disabled:J.isRunning,disabledReason:J.isRunning?"Auto emitter is active. Stop it before running manual mode.":void 0})]})]}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:["Timezone reference: ","Asia/Kuala_Lumpur",". Chart displays the current 30-minute block based on the last received reading timestamp (prototype mode). Fast-forward mode advances simulated time by 30 seconds per real second."]})]})}},44839:function(e,t,s){"use strict";t.Z=function(){for(var e,t,s=0,a="",n=arguments.length;s<n;s++)(e=arguments[s])&&(t=function e(t){var s,a,n="";if("string"==typeof t||"number"==typeof t)n+=t;else if("object"==typeof t){if(Array.isArray(t)){var l=t.length;for(s=0;s<l;s++)t[s]&&(a=e(t[s]))&&(n&&(n+=" "),n+=a)}else for(a in t)t[a]&&(n&&(n+=" "),n+=a)}return n}(e))&&(a&&(a+=" "),a+=t);return a}}},function(e){e.O(0,[454,622,372,260,971,23,744],function(){return e(e.s=96516)}),_N_E=e.O()}]);