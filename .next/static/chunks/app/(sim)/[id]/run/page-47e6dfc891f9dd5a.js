(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[998],{71536:function(t,e,n){Promise.resolve().then(n.bind(n,15521))},87138:function(t,e,n){"use strict";n.d(e,{default:function(){return r.a}});var i=n(231),r=n.n(i)},20357:function(t,e,n){"use strict";var i,r;t.exports=(null==(i=n.g.process)?void 0:i.env)&&"object"==typeof(null==(r=n.g.process)?void 0:r.env)?n.g.process:n(88081)},88081:function(t){!function(){var e={229:function(t){var e,n,i,r=t.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function s(t){if(e===setTimeout)return setTimeout(t,0);if((e===a||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(n){try{return e.call(null,t,0)}catch(n){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:a}catch(t){e=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(t){n=o}}();var l=[],u=!1,c=-1;function d(){u&&i&&(u=!1,i.length?l=i.concat(l):c=-1,l.length&&f())}function f(){if(!u){var t=s(d);u=!0;for(var e=l.length;e;){for(i=l,l=[];++c<e;)i&&i[c].run();c=-1,e=l.length}i=null,u=!1,function(t){if(n===clearTimeout)return clearTimeout(t);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function m(t,e){this.fun=t,this.array=e}function h(){}r.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];l.push(new m(t,e)),1!==l.length||u||s(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=h,r.addListener=h,r.once=h,r.off=h,r.removeListener=h,r.removeAllListeners=h,r.emit=h,r.prependListener=h,r.prependOnceListener=h,r.listeners=function(t){return[]},r.binding=function(t){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(t){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},n={};function i(t){var r=n[t];if(void 0!==r)return r.exports;var a=n[t]={exports:{}},o=!0;try{e[t](a,a.exports,i),o=!1}finally{o&&delete n[t]}return a.exports}i.ab="//";var r=i(229);t.exports=r}()},15521:function(t,e,n){"use strict";n.d(e,{SimulatorRunContent:function(){return u}});var i=n(57437),r=n(2265),a=n(87138),o=n(84686),s=n(17166),l=n(74044);function u(t){let{simulatorId:e,simulatorName:n,targetKwh:u}=t,[c,d]=(0,r.useState)(320),[f,m]=(0,r.useState)(12),[h,v]=(0,r.useState)(.5),[p,g]=(0,r.useState)(800),x=(0,r.useMemo)(()=>h*p,[h,p]),y=(0,l.V)(e,c,f),w=(0,l.o)(e,()=>x),b=()=>{y.isRunning?y.stop():(w.stop(),y.start())},T=()=>{w.isRunning?w.stop():(y.stop(),w.start())};return(0,i.jsxs)("section",{className:"space-y-10",children:[(0,i.jsxs)("header",{className:"flex flex-wrap items-end justify-between gap-4",children:[(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Simulator controls"}),(0,i.jsx)("h1",{className:"text-3xl font-semibold text-white",children:n}),(0,i.jsx)("p",{className:"text-sm text-slate-400",children:"Configure auto and manual emitters. Only one mode can run at a time to avoid duplicate ticks."}),(0,i.jsxs)("p",{className:"text-xs text-slate-500",children:["Target block: ",u?"".concat(u," kWh"):"—"," \xb7 Timezone ","Asia/Kuala_Lumpur"]})]}),(0,i.jsx)(a.default,{href:{pathname:"/sim/[id]",query:{id:e}},className:"inline-flex items-center rounded-md border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:border-slate-500 hover:text-white",children:"Back to dashboard"})]}),(0,i.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,i.jsx)(o.l,{baseKw:c,onBaseKwChange:d,volatility:f,onVolatilityChange:m,isRunning:y.isRunning,onStart:b,onStop:b,sentCount:y.sentCount,lastSentAt:y.lastSentAt,disabled:w.isRunning,disabledReason:w.isRunning?"Manual emitter is active. Stop it before running auto mode.":void 0}),(0,i.jsx)(s.x,{sliderValue:h,onSliderChange:v,maxKw:p,onMaxKwChange:g,isRunning:w.isRunning,onStart:T,onStop:T,sentCount:w.sentCount,lastSentAt:w.lastSentAt,disabled:y.isRunning,disabledReason:y.isRunning?"Auto emitter is active. Stop it before running manual mode.":void 0})]}),(0,i.jsxs)("p",{className:"text-xs text-slate-500",children:["Auto mode sends gaussianised readings every 15 seconds; manual fast-forward emits every second with ",(0,i.jsx)("code",{className:"rounded bg-slate-800 px-1 py-0.5",children:"sample_seconds=30"})," so the backend advances by 30 seconds per tick (30x speed)."]})]})}},46068:function(t,e,n){"use strict";n.d(e,{ToastProvider:function(){return s},p:function(){return l}});var i=n(57437),r=n(2265),a=n(44839);let o=(0,r.createContext)(void 0);function s(t){let{children:e}=t,[n,a]=(0,r.useState)([]),s=(0,r.useCallback)(t=>{let e="".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,8));return a(n=>[...n,{...t,id:e}]),e},[]),l=(0,r.useCallback)(t=>{a(e=>e.filter(e=>e.id!==t))},[]),c=(0,r.useCallback)(()=>a([]),[]),d=(0,r.useMemo)(()=>({toasts:n,push:s,dismiss:l,clear:c}),[n,s,l,c]);return(0,i.jsxs)(o.Provider,{value:d,children:[e,(0,i.jsx)(u,{toasts:n,onDismiss:l})]})}function l(){let t=(0,r.useContext)(o);if(!t)throw Error("useToast must be used within a ToastProvider");return t}function u(t){let{toasts:e,onDismiss:n}=t;return(0,i.jsx)("div",{className:"pointer-events-none fixed inset-x-0 top-20 z-40 flex flex-col items-end gap-3 px-4 sm:items-end sm:px-6",children:e.map(t=>(0,i.jsx)(c,{toast:t,onDismiss:n},t.id))})}function c(t){var e,n;let{toast:r,onDismiss:o}=t,s=null!==(e=r.variant)&&void 0!==e?e:"default";return(0,i.jsx)("div",{className:(0,a.Z)("pointer-events-auto w-full max-w-sm rounded-lg px-4 py-3 shadow-lg ring-1 ring-black/20 backdrop-blur","success"===s?"bg-emerald-500/90 text-white":"error"===s?"bg-red-500/90 text-white":"warning"===s?"bg-amber-500/90 text-black":"bg-slate-800/90 text-white"),role:"status",children:(0,i.jsxs)("div",{className:"flex items-start gap-3",children:[(0,i.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,i.jsx)("p",{className:"text-sm font-semibold leading-tight",children:r.title}),r.description?(0,i.jsx)("p",{className:"text-xs leading-tight",children:r.description}):null,r.action?(0,i.jsx)("button",{type:"button",onClick:()=>{var t;null===(t=r.action)||void 0===t||t.onClick(),o(r.id)},className:"mt-2 inline-flex rounded-md border border-white/30 px-2 py-1 text-xs font-semibold text-white transition hover:border-white hover:bg-white/10",children:r.action.label}):null]}),(null===(n=r.dismissible)||void 0===n||n)&&(0,i.jsx)("button",{type:"button",onClick:()=>o(r.id),className:"-m-1 rounded-md p-1 text-xs opacity-70 transition hover:opacity-100","aria-label":"Dismiss notification",children:"✕"})]})})}},8374:function(t,e,n){"use strict";n.d(e,{$T:function(){return m},Dr:function(){return d},HM:function(){return p},Oz:function(){return v},Qu:function(){return x},tQ:function(){return y},w:function(){return g},wC:function(){return h},wE:function(){return f}});var i=n(20357);let r="eems.apiKeyOverride",a=[{name:"NEXT_PUBLIC_BACKEND_TOKEN",value:"01121000099"},{name:"NEXT_PUBLIC_BACKEND_WRITE_TOKEN",value:i.env.NEXT_PUBLIC_BACKEND_WRITE_TOKEN},{name:"NEXT_PUBLIC_BACKEND_KEY",value:i.env.NEXT_PUBLIC_BACKEND_KEY},{name:"NEXT_PUBLIC_BACKEND_API_KEY",value:i.env.NEXT_PUBLIC_BACKEND_API_KEY}],o=null,s=!1,l=!1;function u(){if(!s){s=!0;try{let t=window.localStorage.getItem(r);t&&(o=t,l=!0)}catch(t){}}}function c(){for(let t of a)if(t.value)return{name:t.name,value:t.value};return null}function d(){var t,e;return null!==(e=null===(t=c())||void 0===t?void 0:t.value)&&void 0!==e?e:""}function f(){var t,e;return null!==(e=null===(t=c())||void 0===t?void 0:t.name)&&void 0!==e?e:null}function m(){return u(),o}function h(){return u(),l&&!!o}function v(t,e){o=t.trim()||null,l=!!((null==e?void 0:e.persist)&&o);try{l&&o?window.localStorage.setItem(r,o):window.localStorage.removeItem(r)}catch(t){}}function p(){o=null,l=!1;try{window.localStorage.removeItem(r)}catch(t){}}function g(){return m()||d()}function x(){return g().length>0}function y(){return d().length>0}},92800:function(t,e,n){"use strict";n.d(e,{Aq:function(){return w},Bj:function(){return h},CT:function(){return r},LK:function(){return m},M8:function(){return y},Mf:function(){return v},QY:function(){return x},b0:function(){return f},he:function(){return b},ji:function(){return p},lA:function(){return g}});var i=n(8374);let r="/api/bridge",a=new Set([429,500,502,503,504]);class o extends Error{constructor(t,e,n,i){super(t),this.status=e,this.code=n,this.details=i}}function s(t){if(!r)throw new o("Backend base URL is not configured.",0);return t.startsWith("http")?t:"".concat(r).concat(t)}async function l(t){let e=await t.text();if(e)try{return JSON.parse(e)}catch(e){throw new o("Invalid JSON response: ".concat(e.message),t.status)}}async function u(t){var e,n,i,r,a,s;let l;try{l=await t.clone().json()}catch(t){}if(!l)try{let e=await t.text();if(e)return new o(e,t.status)}catch(t){}let u=null!==(s=null!==(a=null!==(r=null==l?void 0:null===(e=l.error)||void 0===e?void 0:e.message)&&void 0!==r?r:null==l?void 0:l.message)&&void 0!==a?a:t.statusText)&&void 0!==s?s:"Request failed with status ".concat(t.status),c=null==l?void 0:null===(n=l.error)||void 0===n?void 0:n.code,d=null==l?void 0:null===(i=l.error)||void 0===i?void 0:i.details;if(l&&l.detail){d=l.detail;try{if(Array.isArray(l.detail)){let t=l.detail.map(t=>(null==t?void 0:t.msg)||(null==t?void 0:t.detail)||"Validation error").filter(Boolean);t.length>0&&(u=t.join("; "))}else"string"==typeof l.detail&&(u=l.detail)}catch(t){}}return new o(u,t.status,c,d)}function c(t){return new Promise(e=>setTimeout(e,t))}async function d(t,e){var n,i;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=s(t),f=null!==(n=r.retryDelays)&&void 0!==n?n:[],m=0,h=new Headers(null==e?void 0:e.headers);h.set("Accept","application/json");let v={...e,headers:h};for(;;)try{let t=await fetch(d,v);if(!t.ok){let e=await u(t);if(i=t.status,a.has(i)&&m<f.length){await c(f[m++]);continue}throw e}if(204===t.status)return;return await l(t)}catch(t){if(t instanceof o)throw t;if(m<f.length){await c(f[m++]);continue}throw t}}function f(t){let e=new Headers(null==t?void 0:t.headers);e.set("Content-Type","application/json");let n=(0,i.w)();return n?e.set("x-api-key",n):e.delete("x-api-key"),{...t,headers:e}}async function m(t,e){try{return await d(t,e)}catch(n){if(!(n instanceof o))return await d(t,e,{retryDelays:[500]});throw n}}function h(t){return s(t)}async function v(){var t;let e=await m("/api/v1/simulators");return Array.isArray(e)?e:null!==(t=e.data)&&void 0!==t?t:[]}async function p(t){let e=await d("/api/v1/simulators",f({method:"POST",body:JSON.stringify(t)}),{retryDelays:[500,1500,3500]});return"data"in e?e.data:e}async function g(t){return await m("/api/v1/blocks/latest?simulator_id=".concat(encodeURIComponent(t)))}async function x(t){var e;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=await m("/api/v1/blocks/history?simulator_id=".concat(encodeURIComponent(t),"&limit=").concat(n));return Array.isArray(i)?i:null!==(e=i.data)&&void 0!==e?e:[]}async function y(t){await d("/api/v1/readings:ingest",f({method:"POST",body:JSON.stringify(t)}),{retryDelays:[500,1500,3500]})}async function w(t){try{let e=new Date().toISOString();await d("/api/v1/readings?simulator_id=".concat(encodeURIComponent(t),"&before=").concat(encodeURIComponent(e)),f({method:"DELETE"}),{retryDelays:[500,1500]})}catch(e){try{await d("/api/v1/simulators/".concat(encodeURIComponent(t),"/readings"),f({method:"DELETE"}),{retryDelays:[500,1500]})}catch(t){console.warn("Failed to delete future readings from backend:",e,t)}}}async function b(t){try{var e;let n=await g(t);if((null===(e=n.chart_bins)||void 0===e?void 0:e.points)&&n.chart_bins.points.length>0){let t=new Date(n.block_start_local),e=n.chart_bins.bin_seconds||30,i=n.chart_bins.points.length;return new Date(t.getTime()+i*e*1e3).toISOString()}return null}catch(t){return console.warn("Failed to fetch last reading timestamp:",t),null}}}},function(t){t.O(0,[770,260,971,23,744],function(){return t(t.s=71536)}),_N_E=t.O()}]);