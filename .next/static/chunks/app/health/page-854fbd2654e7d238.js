(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{35660:function(e,t,n){Promise.resolve().then(n.bind(n,43786))},20357:function(e,t,n){"use strict";var a,s;e.exports=(null==(a=n.g.process)?void 0:a.env)&&"object"==typeof(null==(s=n.g.process)?void 0:s.env)?n.g.process:n(88081)},88081:function(e){!function(){var t={229:function(e){var t,n,a,s=e.exports={};function r(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{n="function"==typeof clearTimeout?clearTimeout:i}catch(e){n=i}}();var l=[],c=!1,u=-1;function d(){c&&a&&(c=!1,a.length?l=a.concat(l):u=-1,l.length&&h())}function h(){if(!c){var e=o(d);c=!0;for(var t=l.length;t;){for(a=l,l=[];++u<t;)a&&a[u].run();u=-1,t=l.length}a=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===i||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new m(e,t)),1!==l.length||c||o(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},n={};function a(e){var s=n[e];if(void 0!==s)return s.exports;var r=n[e]={exports:{}},i=!0;try{t[e](r,r.exports,a),i=!1}finally{i&&delete n[e]}return r.exports}a.ab="//";var s=a(229);e.exports=s}()},43786:function(e,t,n){"use strict";n.d(t,{default:function(){return y}});var a=n(57437),s=n(2265),r=n(44839);let i={idle:"bg-slate-800 text-slate-300 ring-1 ring-inset ring-slate-700",running:"bg-amber-500/20 text-amber-200 ring-1 ring-inset ring-amber-400/60",success:"bg-emerald-500/20 text-emerald-200 ring-1 ring-inset ring-emerald-400/70",error:"bg-rose-500/20 text-rose-200 ring-1 ring-inset ring-rose-400/60"};function o(e){let{status:t}=e;return(0,a.jsxs)("span",{className:(0,r.Z)("inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold",i[t]),children:[(0,a.jsx)("span",{className:"h-2 w-2 rounded-full bg-current opacity-80"}),function(e){switch(e){case"running":return"Running";case"success":return"Healthy";case"error":return"Issue";default:return"Idle"}}(t)]})}function l(e){let{title:t,description:n,status:s,meta:r,body:i,onRun:l,actionLabel:c="Run check",disabled:u}=e;return(0,a.jsxs)("section",{className:"flex flex-col gap-4 rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-lg shadow-slate-950/30",children:[(0,a.jsxs)("header",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white",children:t}),(0,a.jsx)("p",{className:"max-w-xl text-sm text-slate-400",children:n})]}),(0,a.jsx)(o,{status:s})]}),r&&(0,a.jsx)("div",{className:"text-xs text-slate-400",children:r}),(0,a.jsx)("div",{className:"flex flex-col gap-4 text-sm text-slate-300",children:i}),l&&(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{type:"button",onClick:l,disabled:u,className:"inline-flex items-center gap-2 rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition hover:bg-cyan-600 disabled:cursor-not-allowed disabled:bg-slate-700 disabled:text-slate-300",children:c})})]})}function c(e){let{entries:t}=e;return 0===t.length?(0,a.jsx)("p",{className:"rounded-lg border border-dashed border-slate-800 bg-slate-900/30 px-4 py-6 text-center text-xs text-slate-500",children:"Run any check to start logging responses."}):(0,a.jsx)("ul",{className:"space-y-3 text-xs",children:t.map(e=>(0,a.jsxs)("li",{className:"rounded-lg border border-slate-800 bg-slate-900/30 p-3 text-left text-slate-300 shadow-inner shadow-slate-950/30",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-[11px] uppercase tracking-widest text-slate-500",children:[(0,a.jsx)("span",{children:e.title}),(0,a.jsx)("span",{children:new Date(e.timestamp).toLocaleTimeString()})]}),(0,a.jsx)("p",{className:"mt-1 text-sm font-medium text-white",children:"success"===e.status?"Success":"Error"}),(0,a.jsx)("pre",{className:"mt-2 max-h-48 overflow-auto whitespace-pre-wrap rounded bg-slate-950/60 p-3 text-[11px] leading-relaxed text-slate-400",children:e.detail})]},e.id))})}var u=n(92800),d=n(8374);let h=["/healthz","/api/v1/health","/"];async function m(e,t){if(!u.CT)return{ok:!1,status:0,durationMs:0,message:"Backend base URL is not configured."};let n=(0,u.Bj)(e),a=Date.now();try{let e;let s=await fetch(n,t),r=Date.now()-a,i="".concat(s.status," ").concat(s.statusText);try{let t=await s.text();e=t,t&&(i="".concat(i,"\n").concat(t))}catch(e){}return{ok:s.ok,status:s.status,durationMs:r,message:i,raw:e}}catch(e){return{ok:!1,status:0,durationMs:Date.now()-a,message:e instanceof Error?e.message:"Request failed"}}}async function f(){for(let e of h){let t=await m(e);if(t.ok)return{...t,message:"Health endpoint responded at ".concat(e,".\n").concat(t.message)};if(404!==t.status&&405!==t.status)return{...t,message:"Health check failed at ".concat(e,".\n").concat(t.message)}}return{ok:!1,status:404,durationMs:0,message:"No health endpoints responded (tried /healthz, /api/v1/health, /)."}}async function p(){if(!(0,d.Qu)())return{ok:!1,status:0,durationMs:0,message:"API key is not configured. Provide one above or set NEXT_PUBLIC_BACKEND_TOKEN (or another supported env) to run the handshake check."};let e={simulator_id:"health-check",mode:"auto",ticks:[{power_kw:1,sample_seconds:15,device_ts:new Date().toISOString()}]},t=await m("/api/v1/readings:ingest",(0,u.b0)({method:"POST",body:JSON.stringify(e)}));return t.ok||401!==t.status?{...t,message:t.ok?"Ingestion endpoint accepted the payload. Review acknowledgement below.":"Handshake request failed.\n".concat(t.message)}:{...t,message:"Handshake request failed: backend rejected the API key. Double-check the value provided above or the NEXT_PUBLIC_BACKEND_TOKEN environment variable."}}async function g(){let e=Date.now();try{var t;let n=await (0,u.LK)("/api/v1/simulators"),a=Date.now()-e,s=Array.isArray(n)?n:null!==(t=n.data)&&void 0!==t?t:[];return{ok:!0,status:200,durationMs:a,message:s.length?"Fetched ".concat(s.length," simulator(s)."):"Simulator list responded successfully but returned no items.",raw:JSON.stringify(s,null,2)}}catch(n){let t=Date.now()-e;return{ok:!1,status:n instanceof Error&&"status"in n?Number(n.status):0,durationMs:t,message:n instanceof Error?n.message:"Simulator read failed"}}}let x={backend:{status:"idle"},handshake:{status:"idle"},simulatorRead:{status:"idle"}};function y(){var e,t,n;let[r,i]=(0,s.useState)(x),[o,u]=(0,s.useState)([]),h=(0,s.useMemo)(()=>"https://eems-v2-backend-production.up.railway.app",[]),m=h.length>0,y=(0,s.useMemo)(()=>(0,d.Dr)(),[]),v=(0,d.tQ)(),w=(0,s.useMemo)(()=>(0,d.wE)(),[]),[b,k]=(0,s.useState)(""),[N,j]=(0,s.useState)(!1),[E,_]=(0,s.useState)(!1),[T,I]=(0,s.useState)("");(0,s.useEffect)(()=>{let e=(0,d.$T)();e?(k(e),_(!0),j((0,d.wC)())):(k(y),_(!1),j(!1)),I((0,d.w)())},[y]);let C=E?N?"Using manual override (saved locally)":"Using manual override":v?"Using ".concat(null!=w?w:"environment API key"):"API key not configured",A=async e=>{i(t=>({...t,[e]:{...t[e],status:"running",message:void 0}}));try{let t="backend"===e?await f():"handshake"===e?await p():await g();i(n=>({...n,[e]:{status:t.ok?"success":"error",duration:t.durationMs,message:t.message}})),u(n=>{var a;return[{id:"".concat(e,"-").concat(Date.now()),title:"".concat(e," check"),status:t.ok?"success":"error",detail:null!==(a=t.raw)&&void 0!==a?a:t.message,timestamp:new Date().toISOString()},...n]})}catch(n){let t=n instanceof Error?n.message:"Unknown failure";i(n=>({...n,[e]:{status:"error",message:t}})),u(n=>[{id:"".concat(e,"-").concat(Date.now()),title:"".concat(e," check"),status:"error",detail:t,timestamp:new Date().toISOString()},...n])}};return(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("header",{className:"space-y-3",children:[(0,a.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Communication Health Checks"}),(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"Run quick diagnostics to verify if the frontend can reach the backend services. These checks will automatically attach prototype headers and surface full responses for debugging."}),(0,a.jsxs)("div",{className:"space-y-4 rounded-xl border border-slate-800 bg-slate-900/50 p-4 text-xs text-slate-400",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-semibold text-slate-200",children:"Backend base URL:"})," ",m?h:"Not configured"]}),(0,a.jsxs)("p",{className:"mt-1",children:[(0,a.jsx)("span",{className:"font-semibold text-slate-200",children:"API key:"})," ",T?"Configured":"Missing"]}),(0,a.jsx)("p",{className:"mt-1 text-[11px] uppercase tracking-[0.2em] text-slate-500",children:C})]}),(0,a.jsxs)("div",{className:"space-y-2 text-slate-300",children:[(0,a.jsx)("label",{className:"block text-xs font-semibold text-slate-200",htmlFor:"health-api-key",children:"Manual API key override"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[(0,a.jsx)("input",{id:"health-api-key",type:"password",value:b,onChange:e=>k(e.target.value),className:"flex-1 rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-100 focus:border-primary focus:outline-none",placeholder:"Paste prototype API key"}),(0,a.jsx)("button",{type:"button",onClick:()=>{(0,d.Oz)(b,{persist:N});let e=b.trim().length>0;_(e),j(!!e&&(0,d.wC)()),I((0,d.w)())},className:"inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition hover:bg-cyan-600",children:"Apply key"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-slate-400",children:[(0,a.jsxs)("label",{className:"inline-flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-700 bg-slate-900 text-primary focus:ring-primary",checked:N,onChange:e=>j(e.target.checked)}),"Remember on this device"]}),E&&(0,a.jsx)("button",{type:"button",onClick:()=>{(0,d.HM)(),_(!1),j(!1),k(y),I((0,d.w)())},className:"text-slate-300 underline-offset-2 hover:text-white hover:underline",children:"Clear override"}),(0,a.jsx)("span",{className:"text-slate-500",children:"Useful when Railway rewrites environment variables with “API” into secret references."})]})]})]})]}),(0,a.jsx)(l,{title:"API availability",description:"Calls the health endpoint to ensure the backend server is reachable and responding.",status:r.backend.status,meta:r.backend.duration&&(0,a.jsxs)("span",{children:["Latest response time: ",(0,a.jsxs)("strong",{children:[r.backend.duration.toFixed(0),"ms"]})]}),body:(0,a.jsx)("p",{className:"text-sm text-slate-300",children:null!==(e=r.backend.message)&&void 0!==e?e:"No response logged yet."}),onRun:()=>A("backend"),disabled:!m||"running"===r.backend.status}),(0,a.jsx)(l,{title:"Simulator handshake",description:"Sends a prototype handshake payload to validate the simulator ingestion endpoint and API key authentication.",status:r.handshake.status,meta:r.handshake.duration&&(0,a.jsxs)("span",{children:["Latest response time: ",(0,a.jsxs)("strong",{children:[r.handshake.duration.toFixed(0),"ms"]})]}),body:(0,a.jsx)("p",{className:"text-sm text-slate-300",children:null!==(t=r.handshake.message)&&void 0!==t?t:"No response logged yet."}),onRun:()=>A("handshake"),disabled:!m||"running"===r.handshake.status,actionLabel:"Send handshake"}),(0,a.jsx)(l,{title:"Read API sample",description:"Fetches a small simulator list to confirm read endpoints return data correctly.",status:r.simulatorRead.status,meta:r.simulatorRead.duration&&(0,a.jsxs)("span",{children:["Latest response time: ",(0,a.jsxs)("strong",{children:[r.simulatorRead.duration.toFixed(0),"ms"]})]}),body:(0,a.jsx)("p",{className:"text-sm text-slate-300",children:null!==(n=r.simulatorRead.message)&&void 0!==n?n:"No response logged yet."}),onRun:()=>A("simulatorRead"),disabled:!m||"running"===r.simulatorRead.status,actionLabel:"Fetch simulators"})]}),(0,a.jsxs)("aside",{className:"space-y-3",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-white",children:"Response log"}),(0,a.jsx)(c,{entries:o})]})]})}},8374:function(e,t,n){"use strict";n.d(t,{$T:function(){return m},Dr:function(){return d},HM:function(){return g},Oz:function(){return p},Qu:function(){return y},tQ:function(){return v},w:function(){return x},wC:function(){return f},wE:function(){return h}});var a=n(20357);let s="eems.apiKeyOverride",r=[{name:"NEXT_PUBLIC_BACKEND_TOKEN",value:"01121000099"},{name:"NEXT_PUBLIC_BACKEND_WRITE_TOKEN",value:a.env.NEXT_PUBLIC_BACKEND_WRITE_TOKEN},{name:"NEXT_PUBLIC_BACKEND_KEY",value:a.env.NEXT_PUBLIC_BACKEND_KEY},{name:"NEXT_PUBLIC_BACKEND_API_KEY",value:a.env.NEXT_PUBLIC_BACKEND_API_KEY}],i=null,o=!1,l=!1;function c(){if(!o){o=!0;try{let e=window.localStorage.getItem(s);e&&(i=e,l=!0)}catch(e){}}}function u(){for(let e of r)if(e.value)return{name:e.name,value:e.value};return null}function d(){var e,t;return null!==(t=null===(e=u())||void 0===e?void 0:e.value)&&void 0!==t?t:""}function h(){var e,t;return null!==(t=null===(e=u())||void 0===e?void 0:e.name)&&void 0!==t?t:null}function m(){return c(),i}function f(){return c(),l&&!!i}function p(e,t){i=e.trim()||null,l=!!((null==t?void 0:t.persist)&&i);try{l&&i?window.localStorage.setItem(s,i):window.localStorage.removeItem(s)}catch(e){}}function g(){i=null,l=!1;try{window.localStorage.removeItem(s)}catch(e){}}function x(){return m()||d()}function y(){return x().length>0}function v(){return d().length>0}},92800:function(e,t,n){"use strict";n.d(t,{Aq:function(){return w},Bj:function(){return f},CT:function(){return s},LK:function(){return m},M8:function(){return v},Mf:function(){return p},QY:function(){return y},b0:function(){return h},he:function(){return b},ji:function(){return g},lA:function(){return x}});var a=n(8374);let s="/api/bridge",r=new Set([429,500,502,503,504]);class i extends Error{constructor(e,t,n,a){super(e),this.status=t,this.code=n,this.details=a}}function o(e){if(!s)throw new i("Backend base URL is not configured.",0);return e.startsWith("http")?e:"".concat(s).concat(e)}async function l(e){let t=await e.text();if(t)try{return JSON.parse(t)}catch(t){throw new i("Invalid JSON response: ".concat(t.message),e.status)}}async function c(e){var t,n,a,s,r,o;let l;try{l=await e.clone().json()}catch(e){}if(!l)try{let t=await e.text();if(t)return new i(t,e.status)}catch(e){}let c=null!==(o=null!==(r=null!==(s=null==l?void 0:null===(t=l.error)||void 0===t?void 0:t.message)&&void 0!==s?s:null==l?void 0:l.message)&&void 0!==r?r:e.statusText)&&void 0!==o?o:"Request failed with status ".concat(e.status),u=null==l?void 0:null===(n=l.error)||void 0===n?void 0:n.code,d=null==l?void 0:null===(a=l.error)||void 0===a?void 0:a.details;if(l&&l.detail){d=l.detail;try{if(Array.isArray(l.detail)){let e=l.detail.map(e=>(null==e?void 0:e.msg)||(null==e?void 0:e.detail)||"Validation error").filter(Boolean);e.length>0&&(c=e.join("; "))}else"string"==typeof l.detail&&(c=l.detail)}catch(e){}}return new i(c,e.status,u,d)}function u(e){return new Promise(t=>setTimeout(t,e))}async function d(e,t){var n,a;let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=o(e),h=null!==(n=s.retryDelays)&&void 0!==n?n:[],m=0,f=new Headers(null==t?void 0:t.headers);f.set("Accept","application/json");let p={...t,headers:f};for(;;)try{let e=await fetch(d,p);if(!e.ok){let t=await c(e);if(a=e.status,r.has(a)&&m<h.length){await u(h[m++]);continue}throw t}if(204===e.status)return;return await l(e)}catch(e){if(e instanceof i)throw e;if(m<h.length){await u(h[m++]);continue}throw e}}function h(e){let t=new Headers(null==e?void 0:e.headers);t.set("Content-Type","application/json");let n=(0,a.w)();return n?t.set("x-api-key",n):t.delete("x-api-key"),{...e,headers:t}}async function m(e,t){try{return await d(e,t)}catch(n){if(!(n instanceof i))return await d(e,t,{retryDelays:[500]});throw n}}function f(e){return o(e)}async function p(){var e;let t=await m("/api/v1/simulators");return Array.isArray(t)?t:null!==(e=t.data)&&void 0!==e?e:[]}async function g(e){let t=await d("/api/v1/simulators",h({method:"POST",body:JSON.stringify(e)}),{retryDelays:[500,1500,3500]});return"data"in t?t.data:t}async function x(e){return await m("/api/v1/blocks/latest?simulator_id=".concat(encodeURIComponent(e)))}async function y(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=await m("/api/v1/blocks/history?simulator_id=".concat(encodeURIComponent(e),"&limit=").concat(n));return Array.isArray(a)?a:null!==(t=a.data)&&void 0!==t?t:[]}async function v(e){await d("/api/v1/readings:ingest",h({method:"POST",body:JSON.stringify(e)}),{retryDelays:[500,1500,3500]})}async function w(e){try{let t=new Date().toISOString();await d("/api/v1/readings?simulator_id=".concat(encodeURIComponent(e),"&before=").concat(encodeURIComponent(t)),h({method:"DELETE"}),{retryDelays:[500,1500]})}catch(t){try{await d("/api/v1/simulators/".concat(encodeURIComponent(e),"/readings"),h({method:"DELETE"}),{retryDelays:[500,1500]})}catch(e){console.warn("Failed to delete future readings from backend:",t,e)}}}async function b(e){try{var t;let n=await x(e);if((null===(t=n.chart_bins)||void 0===t?void 0:t.points)&&n.chart_bins.points.length>0){let e=new Date(n.block_start_local),t=n.chart_bins.bin_seconds||30,a=n.chart_bins.points.length;return new Date(e.getTime()+a*t*1e3).toISOString()}return null}catch(e){return console.warn("Failed to fetch last reading timestamp:",e),null}}},44839:function(e,t,n){"use strict";t.Z=function(){for(var e,t,n=0,a="",s=arguments.length;n<s;n++)(e=arguments[n])&&(t=function e(t){var n,a,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t){if(Array.isArray(t)){var r=t.length;for(n=0;n<r;n++)t[n]&&(a=e(t[n]))&&(s&&(s+=" "),s+=a)}else for(a in t)t[a]&&(s&&(s+=" "),s+=a)}return s}(e))&&(a&&(a+=" "),a+=t);return a}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=35660)}),_N_E=e.O()}]);