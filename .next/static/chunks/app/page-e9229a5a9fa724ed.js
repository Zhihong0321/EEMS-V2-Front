(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{75858:function(e,t,a){Promise.resolve().then(a.bind(a,33811))},33811:function(e,t,a){"use strict";a.d(t,{SimulatorsPage:function(){return m}});var s=a(57437),r=a(2265),l=a(87138),n=a(59226),i=a(60943),o=a(81622),d=a(44839);let c=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function m(e){let{initialSimulators:t}=e,{simulators:a,loading:n,refresh:i,create:d}=(0,o.a1)(t),[m,u]=(0,r.useState)(!1),[p,h]=(0,r.useState)({name:"",target:500,whatsapp:""}),[b,f]=(0,r.useState)(!1),[g,y]=(0,r.useState)(null),j=a.length>0,N=(0,r.useMemo)(()=>{if(!j)return"—";let e=a.map(e=>{var t,a,s;return null!==(s=null!==(a=null===(t=e.latest_block)||void 0===t?void 0:t.block_start_local)&&void 0!==a?a:e.updated_at)&&void 0!==s?s:e.created_at}).filter(Boolean).sort().pop();return e?c.format(new Date(e)):"—"},[j,a]),v=async e=>{if(e.preventDefault(),!p.name.trim()){y("Name is required");return}if(p.target<=0){y("Target kWh must be greater than zero");return}let t=p.whatsapp.trim(),a=t.length>0?Number.parseInt(t,10):void 0;if(t.length>0&&Number.isNaN(a)){y("WhatsApp number must contain digits only");return}y(null),f(!0);try{await d({name:p.name.trim(),target_kwh:p.target,...void 0!==a?{whatsapp_number:a}:{}}),h({name:"",target:500,whatsapp:""}),u(!1)}catch(e){y(e instanceof Error?e.message:"Failed to create simulator")}finally{f(!1)}};return(0,s.jsxs)("section",{className:"space-y-10",children:[(0,s.jsxs)("header",{className:"space-y-3",children:[(0,s.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Simulators"}),(0,s.jsx)("p",{className:"max-w-2xl text-sm text-slate-400",children:"Connect to an existing simulator profile or create a new one. Each profile produces live readings feeding the EMS dashboard."}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>u(!0),className:"rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground shadow-sm transition hover:bg-cyan-600",children:"New simulator"}),(0,s.jsx)("button",{type:"button",onClick:()=>{i()},className:"rounded-md border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:border-slate-600 hover:text-white",disabled:n,children:n?"Refreshing…":"Refresh list"}),(0,s.jsxs)("span",{className:"text-xs text-slate-500",children:["Last activity snapshot: ",N]})]})]}),j?(0,s.jsx)("div",{className:"grid gap-4 sm:grid-cols-2",children:a.map(e=>{var t,a;let r=e.latest_block,n=null!==(a=null!==(t=null==r?void 0:r.block_start_local)&&void 0!==t?t:e.updated_at)&&void 0!==a?a:e.created_at,i=n?c.format(new Date(n)):"—",o=null==r?void 0:r.percent_of_target,d=null!=o?"".concat(o.toFixed(1),"%"):"—";return(0,s.jsxs)("article",{className:"flex flex-col justify-between rounded-xl border border-slate-800 bg-slate-900/60 p-6",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-white",children:e.name}),(0,s.jsxs)("dl",{className:"grid grid-cols-2 gap-2 text-sm text-slate-400",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("dt",{className:"text-xs uppercase tracking-widest text-slate-500",children:"Target kWh"}),(0,s.jsx)("dd",{className:"text-base text-slate-100",children:e.target_kwh.toFixed(1)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("dt",{className:"text-xs uppercase tracking-widest text-slate-500",children:"Last activity"}),(0,s.jsx)("dd",{className:"text-base text-slate-100",children:i})]})]}),(0,s.jsxs)("p",{className:"text-xs text-slate-500",children:["Latest block progress: ",(0,s.jsx)("span",{className:null!=o?o>100?"text-danger":o>=80?"text-warning":"text-success":"text-slate-400",children:d})]})]}),(0,s.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,s.jsx)(l.default,{href:"/".concat(e.id),className:"inline-flex flex-1 items-center justify-center rounded-md border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-100 transition hover:border-primary hover:text-white",children:"Open dashboard"}),(0,s.jsx)(l.default,{href:"/".concat(e.id,"/run"),className:"inline-flex flex-1 items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition hover:bg-cyan-600",children:"Run simulator"})]})]},e.id)})}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 rounded-2xl border border-dashed border-slate-800 bg-slate-900/40 p-10 text-center",children:[(0,s.jsx)("p",{className:"text-lg font-semibold text-white",children:"No simulators yet"}),(0,s.jsx)("p",{className:"text-sm text-slate-400",children:"Create your first simulator to start sending readings to the EMS backend."}),(0,s.jsx)("button",{type:"button",onClick:()=>u(!0),className:"rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition hover:bg-cyan-600",children:"Create simulator"})]}),(0,s.jsx)(x,{open:m,onClose:()=>{b||(u(!1),y(null))},form:p,onFormChange:h,onSubmit:v,submitting:b,error:g})]})}function x(e){let{open:t,onClose:a,form:l,onFormChange:o,onSubmit:c,submitting:m,error:x}=e,u=e=>t=>{if("target"===e){o({...l,target:Number(t.target.value)});return}if("whatsapp"===e){let e=t.target.value.replace(/[^0-9]/g,"");o({...l,whatsapp:e});return}o({...l,name:t.target.value})};return(0,s.jsx)(n.u,{appear:!0,show:t,as:r.Fragment,children:(0,s.jsxs)(i.V,{as:"div",className:"relative z-50",onClose:a,children:[(0,s.jsx)(n.u.Child,{as:r.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50"})}),(0,s.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,s.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,s.jsx)(n.u.Child,{as:r.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,s.jsxs)(i.V.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl border border-slate-800 bg-slate-950 p-6 text-left align-middle shadow-xl transition-all",children:[(0,s.jsx)(i.V.Title,{className:"text-lg font-semibold text-white",children:"Create simulator"}),(0,s.jsx)("p",{className:"mt-1 text-sm text-slate-400",children:"Provide a friendly name, target kWh, and optional WhatsApp number for alerting. Enter digits only (no plus sign)."}),(0,s.jsxs)("form",{className:"mt-6 space-y-4",onSubmit:c,children:[(0,s.jsxs)("label",{className:"flex flex-col gap-2 text-sm",children:[(0,s.jsx)("span",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Name"}),(0,s.jsx)("input",{type:"text",required:!0,value:l.name,onChange:u("name"),className:"w-full rounded-md border border-slate-800 bg-slate-950/60 px-3 py-2 text-sm text-white focus:border-cyan-500 focus:outline-none"})]}),(0,s.jsxs)("label",{className:"flex flex-col gap-2 text-sm",children:[(0,s.jsx)("span",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Target kWh"}),(0,s.jsx)("input",{type:"number",min:1,step:1,value:l.target,onChange:u("target"),className:"w-full rounded-md border border-slate-800 bg-slate-950/60 px-3 py-2 text-sm text-white focus:border-cyan-500 focus:outline-none"})]}),(0,s.jsxs)("label",{className:"flex flex-col gap-2 text-sm",children:[(0,s.jsx)("span",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"WhatsApp number (digits only, optional)"}),(0,s.jsx)("input",{type:"tel",inputMode:"numeric",pattern:"\\d*",value:l.whatsapp,onChange:u("whatsapp"),className:"w-full rounded-md border border-slate-800 bg-slate-950/60 px-3 py-2 text-sm text-white focus:border-cyan-500 focus:outline-none"})]}),x?(0,s.jsx)("p",{className:"text-xs text-danger",children:x}):null,(0,s.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,s.jsx)("button",{type:"button",onClick:a,className:"rounded-md border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:border-slate-500 hover:text-white",disabled:m,children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:m,className:(0,d.Z)("rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition",m?"opacity-60":"hover:bg-cyan-600"),children:m?"Creating…":"Create"})]})]})]})})})})]})})}}},function(e){e.O(0,[770,198,622,971,23,744],function(){return e(e.s=75858)}),_N_E=e.O()}]);