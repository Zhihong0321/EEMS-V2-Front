(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{75858:function(e,t,a){Promise.resolve().then(a.bind(a,18424))},20357:function(e,t,a){"use strict";var r,s;e.exports=(null==(r=a.g.process)?void 0:r.env)&&"object"==typeof(null==(s=a.g.process)?void 0:s.env)?a.g.process:a(88081)},88081:function(e){!function(){var t={229:function(e){var t,a,r,s=e.exports={};function n(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(a){try{return t.call(null,e,0)}catch(a){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{a="function"==typeof clearTimeout?clearTimeout:l}catch(e){a=l}}();var o=[],d=!1,c=-1;function u(){d&&r&&(d=!1,r.length?o=r.concat(o):c=-1,o.length&&m())}function m(){if(!d){var e=i(u);d=!0;for(var t=o.length;t;){for(r=o,o=[];++c<t;)r&&r[c].run();c=-1,t=o.length}r=null,d=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===l||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function x(e,t){this.fun=e,this.array=t}function h(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];o.push(new x(e,t)),1!==o.length||d||i(m)},x.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=h,s.addListener=h,s.once=h,s.off=h,s.removeListener=h,s.removeAllListeners=h,s.emit=h,s.prependListener=h,s.prependOnceListener=h,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},a={};function r(e){var s=a[e];if(void 0!==s)return s.exports;var n=a[e]={exports:{}},l=!0;try{t[e](n,n.exports,r),l=!1}finally{l&&delete a[e]}return n.exports}r.ab="//";var s=r(229);e.exports=s}()},18424:function(e,t,a){"use strict";a.d(t,{SimulatorsPage:function(){return y}});var r=a(57437),s=a(46068),n=a(2265),l=a(87138),i=a(59226),o=a(60943),d=a(81622),c=a(89733),u=a(44839);let m={default:"bg-slate-900/60",elevated:"bg-slate-900 shadow-lg",interactive:"cursor-pointer hover:border-primary-700 hover:shadow-lg",flat:"shadow-none"},x=(0,n.forwardRef)((e,t)=>{let{className:a,variant:s="default",...n}=e;return(0,r.jsx)("div",{ref:t,className:(0,u.Z)("rounded-xl border border-slate-800 backdrop-blur-sm shadow-md transition-shadow duration-200",m[s],a),...n})});x.displayName="Card",(0,n.forwardRef)((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,u.Z)("p-4 sm:p-6 border-b border-slate-800",a),...s})}).displayName="CardHeader";let h=(0,n.forwardRef)((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,u.Z)("p-4 sm:p-6",a),...s})});h.displayName="CardContent",(0,n.forwardRef)((e,t)=>{let{className:a,...s}=e;return(0,r.jsx)("div",{ref:t,className:(0,u.Z)("p-4 sm:p-6 border-t border-slate-800",a),...s})}).displayName="CardFooter";var p=a(77209);let f={success:"bg-success/10 text-success border-success/20",warning:"bg-warning/10 text-warning border-warning/20",danger:"bg-danger/10 text-danger border-danger/20",info:"bg-primary/10 text-primary border-primary/20",neutral:"bg-slate-800 text-slate-300 border-slate-700"};function g(e){let{variant:t="neutral",className:a,children:s,...n}=e;return(0,r.jsx)("span",{className:(0,u.Z)("inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs font-medium",f[t],a),...n,children:s})}function v(e){let{icon:t,title:a,description:s,action:n}=e;return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 rounded-2xl border border-dashed border-slate-800 bg-slate-900/40 p-10 text-center",children:[t&&(0,r.jsx)("div",{className:"rounded-full bg-slate-800/50 p-3 text-slate-500",children:t}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"text-lg font-semibold text-white",children:a}),(0,r.jsx)("p",{className:"text-sm text-slate-400 max-w-md",children:s})]}),n&&(0,r.jsx)("div",{className:"mt-2",children:n})]})}let b=n.forwardRef(function(e,t){let{title:a,titleId:r,...s}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},s),a?n.createElement("title",{id:r},a):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}),j=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function y(e){let{initialSimulators:t}=e,{push:a}=(0,s.p)(),{simulators:i,loading:o,refresh:u,create:m,delete:p}=(0,d.a1)(t),[f,y]=(0,n.useState)(!1),[k,C]=(0,n.useState)({name:"",target:500,whatsapp:""}),[T,z]=(0,n.useState)(!1),[_,F]=(0,n.useState)(null),[L,E]=(0,n.useState)(!1),[S,D]=(0,n.useState)(null),[I,W]=(0,n.useState)(!1),A=i.length>0,M=(0,n.useMemo)(()=>{if(!A)return"—";let e=i.map(e=>{var t,a,r;return null!==(r=null!==(a=null===(t=e.latest_block)||void 0===t?void 0:t.block_start_local)&&void 0!==a?a:e.updated_at)&&void 0!==r?r:e.created_at}).filter(Boolean).sort().pop();return e?j.format(new Date(e)):"—"},[A,i]),P=async e=>{if(e.preventDefault(),!k.name.trim()){F("Name is required");return}if(k.target<=0){F("Target kWh must be greater than zero");return}let t=k.whatsapp.trim(),a=t.length>0?Number.parseInt(t,10):void 0;if(t.length>0&&Number.isNaN(a)){F("WhatsApp number must contain digits only");return}F(null),z(!0);try{await m({name:k.name.trim(),target_kwh:k.target,...void 0!==a?{whatsapp_number:a}:{}}),C({name:"",target:500,whatsapp:""}),y(!1)}catch(e){F(e instanceof Error?e.message:"Failed to create simulator")}finally{z(!1)}},R=async e=>{W(!0);try{await p(e)}finally{W(!1),E(!1)}};return(0,r.jsxs)("section",{className:"space-y-10 animate-fadeIn",children:[(0,r.jsxs)("header",{className:"space-y-3",children:[(0,r.jsx)("h1",{children:"Simulators"}),(0,r.jsx)("p",{className:"max-w-2xl text-sm sm:text-base text-slate-400",children:"Connect to an existing simulator profile or create a new one. Each profile produces live readings feeding the EMS dashboard."}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,r.jsx)(c.z,{variant:"primary",size:"md",onClick:()=>y(!0),children:"New simulator"}),(0,r.jsx)(c.z,{variant:"secondary",size:"md",onClick:()=>void u(),isLoading:o,disabled:o,children:o?"Refreshing…":"Refresh list"}),(0,r.jsxs)("span",{className:"text-xs text-slate-500",children:["Last activity snapshot: ",M]})]})]}),A?(0,r.jsx)("div",{className:"grid gap-4 sm:grid-cols-1 lg:grid-cols-2 animate-slideUp",children:i.map(e=>{var t,a;let s=e.latest_block,n=null!==(a=null!==(t=null==s?void 0:s.block_start_local)&&void 0!==t?t:e.updated_at)&&void 0!==a?a:e.created_at,i=n?j.format(new Date(n)):"—",o=null==s?void 0:s.percent_of_target,d=null!=o?"".concat(o.toFixed(1),"%"):"—";return(0,r.jsx)(x,{variant:"default",children:(0,r.jsxs)(h,{className:"flex flex-col justify-between min-h-[200px]",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-white",children:e.name}),(0,r.jsx)(g,{variant:null!=o?o>100?"danger":o>=80?"warning":"success":"neutral",children:d})]}),(0,r.jsxs)("dl",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("dt",{className:"text-xs uppercase tracking-widest text-slate-500",children:"Target kWh"}),(0,r.jsx)("dd",{className:"text-base font-medium text-slate-100",children:e.target_kwh.toFixed(1)})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)("dt",{className:"text-xs uppercase tracking-widest text-slate-500",children:"Last activity"}),(0,r.jsx)("dd",{className:"text-base font-medium text-slate-100",children:i})]})]})]}),(0,r.jsxs)("div",{className:"mt-6 flex flex-col sm:flex-row gap-2",children:[(0,r.jsx)(l.default,{href:"/".concat(e.id),className:"flex-1",children:(0,r.jsx)(c.z,{variant:"secondary",size:"md",className:"w-full",children:"Dashboard"})}),(0,r.jsx)(l.default,{href:"/".concat(e.id,"/run"),className:"flex-1",children:(0,r.jsx)(c.z,{variant:"primary",size:"md",className:"w-full",children:"Run"})}),(0,r.jsx)(c.z,{variant:"ghost",size:"md",onClick:()=>{D(e.id),E(!0)},className:"text-danger hover:text-danger hover:bg-danger/10",children:"Delete"})]})]})},e.id)})}):(0,r.jsx)(v,{icon:(0,r.jsx)(b,{className:"h-12 w-12"}),title:"No simulators yet",description:"Create your first simulator to start sending readings to the EMS backend.",action:(0,r.jsx)(c.z,{variant:"primary",size:"md",onClick:()=>y(!0),children:"Create simulator"})}),(0,r.jsx)(w,{open:f,onClose:()=>{T||(y(!1),F(null))},form:k,onFormChange:C,onSubmit:P,submitting:T,error:_}),(0,r.jsx)(N,{open:L,onClose:()=>{I||E(!1)},onConfirm:()=>S&&R(S),deleting:I})]})}function w(e){let{open:t,onClose:a,form:s,onFormChange:l,onSubmit:d,submitting:u,error:m}=e,x=e=>t=>{if("target"===e){l({...s,target:Number(t.target.value)});return}if("whatsapp"===e){let e=t.target.value.replace(/[^0-9]/g,"");l({...s,whatsapp:e});return}l({...s,name:t.target.value})};return(0,r.jsx)(i.u,{appear:!0,show:t,as:n.Fragment,children:(0,r.jsxs)(o.V,{as:"div",className:"relative z-50",onClose:a,children:[(0,r.jsx)(i.u.Child,{as:n.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50"})}),(0,r.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,r.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,r.jsx)(i.u.Child,{as:n.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,r.jsxs)(o.V.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl border border-slate-700/50 bg-slate-900/95 backdrop-blur-xl p-6 text-left align-middle shadow-2xl ring-1 ring-white/5 transition-all",children:[(0,r.jsx)(o.V.Title,{className:"text-xl font-semibold text-white tracking-tight",children:"Create simulator"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-slate-400 leading-relaxed",children:"Provide a friendly name, target kWh, and optional WhatsApp number for alerting. Enter digits only (no plus sign)."}),(0,r.jsxs)("form",{className:"mt-6 space-y-4",onSubmit:d,children:[(0,r.jsx)(p.SP,{label:"Name",required:!0,error:m&&""===s.name.trim()?"Name is required":void 0,children:(0,r.jsx)(p.II,{type:"text",required:!0,value:s.name,onChange:x("name"),placeholder:"Enter simulator name",error:!!m&&""===s.name.trim()})}),(0,r.jsx)(p.SP,{label:"Target kWh",required:!0,children:(0,r.jsx)(p.II,{type:"number",min:1,step:1,value:s.target,onChange:x("target"),placeholder:"e.g. 500"})}),(0,r.jsx)(p.SP,{label:"WhatsApp number",helperText:"Digits only (no plus sign). Optional for alerts.",children:(0,r.jsx)(p.II,{type:"tel",inputMode:"numeric",pattern:"\\d*",value:s.whatsapp,onChange:x("whatsapp"),placeholder:"e.g. 60123456789"})}),m&&!1==!s.name.trim()&&(0,r.jsx)("p",{className:"text-xs text-danger",children:m}),(0,r.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3 pt-2",children:[(0,r.jsx)(c.z,{type:"button",variant:"secondary",size:"md",onClick:a,disabled:u,className:"w-full sm:w-auto",children:"Cancel"}),(0,r.jsx)(c.z,{type:"submit",variant:"primary",size:"md",isLoading:u,disabled:u,className:"w-full sm:w-auto",children:u?"Creating…":"Create"})]})]})]})})})})]})})}function N(e){let{open:t,onClose:a,onConfirm:s,deleting:l}=e;return(0,r.jsx)(i.u,{as:n.Fragment,show:t,children:(0,r.jsxs)(o.V,{as:"div",className:"relative z-50",onClose:a,children:[(0,r.jsx)(i.u.Child,{as:n.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50"})}),(0,r.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,r.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,r.jsx)(i.u.Child,{as:n.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,r.jsxs)(o.V.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl border border-danger/20 bg-slate-900/95 backdrop-blur-xl p-6 text-left align-middle shadow-2xl ring-1 ring-danger/10 transition-all",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3 mb-4",children:[(0,r.jsx)("div",{className:"flex-shrink-0 rounded-full bg-danger/10 p-3",children:(0,r.jsx)("svg",{className:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)(o.V.Title,{className:"text-xl font-semibold text-white tracking-tight",children:"Confirm Deletion"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-slate-400 leading-relaxed",children:"Are you sure you want to delete this simulator? This action cannot be undone."})]})]}),(0,r.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3",children:[(0,r.jsx)(c.z,{type:"button",variant:"secondary",size:"md",onClick:a,disabled:l,className:"w-full sm:w-auto",children:"Cancel"}),(0,r.jsx)(c.z,{type:"button",variant:"danger",size:"md",onClick:s,isLoading:l,disabled:l,className:"w-full sm:w-auto",children:l?"Deleting…":"Delete"})]})]})})})})]})})}}},function(e){e.O(0,[462,293,836,622,971,23,744],function(){return e(e.s=75858)}),_N_E=e.O()}]);