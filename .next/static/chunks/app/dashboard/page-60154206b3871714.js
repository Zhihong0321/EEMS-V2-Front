(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{28297:function(e,t,s){Promise.resolve().then(s.bind(s,73373))},87138:function(e,t,s){"use strict";s.d(t,{default:function(){return l.a}});var a=s(231),l=s.n(a)},73373:function(e,t,s){"use strict";s.d(t,{default:function(){return u}});var a=s(57437),l=s(2265),r=s(87138),n=s(39514),i=s(90249),c=s(15597),o=s(81622);let d=new Intl.NumberFormat(void 0,{maximumFractionDigits:1});function x(e){var t;let{simulatorId:s,simulatorName:x,targetKwh:u,initialBlock:m,initialHistory:h}=e,[g,p]=(0,l.useState)("accumulate"),{history:f,loading:b,refresh:v}=(0,o.NX)(s,10,h),j=(0,l.useCallback)(()=>{v()},[v]),{block:N,loading:k,connected:y,reconnecting:_,lastReadingTs:w,refresh:S}=(0,o.AF)(s,{onWindowChange:j},m);(0,l.useEffect)(()=>{w&&"non-accumulate"===g&&S()},[w,S,g]),(0,l.useEffect)(()=>{let e=setInterval(()=>{S()},15e3);return()=>clearInterval(e)},[S]);let C=null!==(t=null==N?void 0:N.percent_of_target)&&void 0!==t?t:0,I=C>100?"text-danger":C>=80?"text-warning":"text-success";return(0,a.jsxs)("section",{className:"space-y-10",children:[(0,a.jsxs)("header",{className:"flex flex-wrap items-end justify-between gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Simulator"}),(0,a.jsx)("h1",{className:"text-3xl font-semibold text-white",children:x}),(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"Live chart and block history update in real time via server-sent events from the backend."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-slate-300",children:[(0,a.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-4 py-2 text-right",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Target"}),(0,a.jsx)("p",{className:"text-base font-semibold text-slate-100",children:u?"".concat(u.toFixed(1)," kWh"):"â€”"})]}),(0,a.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-4 py-2 text-right",children:[(0,a.jsx)("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Current block"}),(0,a.jsxs)("p",{className:"text-base font-semibold ".concat(I),children:[d.format(C),"%"]})]}),(0,a.jsx)(r.default,{href:{pathname:"/sim/[id]/run",query:{id:s}},className:"inline-flex items-center rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition hover:bg-cyan-600",children:"Open controls"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("label",{className:"text-sm text-slate-300",children:"Chart Mode:"}),(0,a.jsxs)("select",{value:g,onChange:e=>p(e.target.value),className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-2 text-sm text-slate-100",children:[(0,a.jsx)("option",{value:"accumulate",children:"Accumulate"}),(0,a.jsx)("option",{value:"non-accumulate",children:"Non-Accumulate (Raw Readings)"})]})]})]}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[(0,a.jsx)(n.l,{block:null!=N?N:{simulator_id:s,block_start_local:new Date().toISOString(),block_start_utc:new Date().toISOString(),block_end_utc:new Date().toISOString(),target_kwh:null!=u?u:0,accumulated_kwh:0,percent_of_target:0,alerted_80pct:!1,chart_bins:{bin_seconds:30,points:[]}},loading:k,targetKwh:u,mode:g}),(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[(0,a.jsx)(c.C,{connected:y,reconnecting:_,lastReadingTs:w,simulatorId:s}),(0,a.jsx)(i.J,{history:f,loading:b})]})]}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:["Timezone reference: ","Asia/Kuala_Lumpur",". SSE events automatically trigger a history refresh when the backend rolls to a new block."]})]})}function u(e){var t,s,r;let{simulators:n,initialDataMap:i}=e,[c,o]=(0,l.useState)(null!==(s=null===(t=n[0])||void 0===t?void 0:t.id)&&void 0!==s?s:null);if(0===n.length)return(0,a.jsx)("div",{className:"flex flex-col items-center justify-center h-screen text-slate-400",children:(0,a.jsx)("p",{children:"No simulators available. Please create one first."})});let d=n.find(e=>e.id===c),u=null!==(r=i[null!=c?c:""])&&void 0!==r?r:{initialBlock:null,initialHistory:[],targetKwh:void 0};return(0,a.jsxs)("div",{className:"space-y-8",children:[(0,a.jsxs)("header",{className:"space-y-2",children:[(0,a.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"EMS Dashboard"}),(0,a.jsx)("p",{className:"text-sm text-slate-400",children:"Select a meter to view its live chart and block history."})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("label",{htmlFor:"meter-select",className:"text-sm font-medium text-slate-300",children:"Select Meter:"}),(0,a.jsx)("select",{id:"meter-select",value:null!=c?c:"",onChange:e=>o(e.target.value),className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-2 text-sm text-slate-100 focus:border-primary focus:outline-none",children:n.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (Target: ",e.target_kwh," kWh)"]},e.id))})]}),d&&(0,a.jsx)(x,{simulatorId:c,simulatorName:d.name,targetKwh:u.targetKwh,initialBlock:u.initialBlock,initialHistory:u.initialHistory})]})}}},function(e){e.O(0,[770,454,622,372,971,23,744],function(){return e(e.s=28297)}),_N_E=e.O()}]);