"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[622],{46068:function(e,t,r){r.d(t,{ToastProvider:function(){return f},p:function(){return g}});var n=r(57437),a=r(2265),o=r(85130),l=r(39519),i=r(11853),s=r(13934),c=r(84573),d=r(44839);let u=(0,a.createContext)(void 0);function f(e){let{children:t}=e,[r,o]=(0,a.useState)([]),l=(0,a.useCallback)(e=>{let t="".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,8));return o(r=>[...r,{...e,id:t}]),setTimeout(()=>{o(e=>e.filter(e=>e.id!==t))},5e3),t},[]),i=(0,a.useCallback)(e=>{o(t=>t.filter(t=>t.id!==e))},[]),s=(0,a.useCallback)(()=>o([]),[]),c=(0,a.useMemo)(()=>({toasts:r,push:l,dismiss:i,clear:s}),[r,l,i,s]);return(0,n.jsxs)(u.Provider,{value:c,children:[t,(0,n.jsx)(h,{toasts:r,onDismiss:i})]})}function g(){let e=(0,a.useContext)(u);if(!e)throw Error("useToast must be used within a ToastProvider");return e}function h(e){let{toasts:t,onDismiss:r}=e;return(0,n.jsx)("div",{className:"pointer-events-none fixed inset-x-0 bottom-0 sm:top-20 sm:bottom-auto z-50 flex flex-col items-center sm:items-end gap-3 px-4 sm:px-6 pb-6 sm:pb-0","aria-live":"polite","aria-atomic":"true",children:t.map(e=>(0,n.jsx)(m,{toast:e,onDismiss:r},e.id))})}function m(e){var t,r;let{toast:u,onDismiss:f}=e,[g,h]=(0,a.useState)(!1),m=null!==(t=u.variant)&&void 0!==t?t:"default";(0,a.useEffect)(()=>{requestAnimationFrame(()=>h(!0))},[]);let b=()=>{h(!1),setTimeout(()=>f(u.id),200)},p="success"===m?o.Z:"error"===m?l.Z:"warning"===m?i.Z:s.Z;return(0,n.jsx)("div",{className:(0,d.Z)("pointer-events-auto w-full max-w-sm rounded-xl px-4 py-3 shadow-2xl border backdrop-blur-md transition-all duration-300 ease-out","success"===m?"bg-success/95 text-white border-success/20":"error"===m?"bg-danger/95 text-white border-danger/20":"warning"===m?"bg-warning/95 text-white border-warning/20":"bg-slate-800/95 text-white border-slate-700/20",g?"translate-y-0 opacity-100":"translate-y-2 sm:translate-y-0 sm:translate-x-4 opacity-0"),role:"alert","aria-live":"assertive",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)(p,{className:"h-5 w-5 flex-shrink-0 mt-0.5","aria-hidden":"true"}),(0,n.jsxs)("div",{className:"flex-1 space-y-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-sm font-semibold leading-tight",children:u.title}),u.description&&(0,n.jsx)("p",{className:"text-xs leading-tight opacity-90",children:u.description}),u.action&&(0,n.jsx)("button",{type:"button",onClick:()=>{var e;null===(e=u.action)||void 0===e||e.onClick(),b()},className:"mt-2 inline-flex rounded-md border border-current/30 px-3 py-1.5 text-xs font-semibold transition hover:border-current hover:bg-white/10",children:u.action.label})]}),(null===(r=u.dismissible)||void 0===r||r)&&(0,n.jsx)("button",{type:"button",onClick:b,className:"flex-shrink-0 rounded-md p-1 transition hover:bg-white/10","aria-label":"Dismiss notification",children:(0,n.jsx)(c.Z,{className:"h-5 w-5","aria-hidden":"true"})})]})})}},81622:function(e,t,r){r.d(t,{AF:function(){return s},NX:function(){return c},a1:function(){return i}});var n=r(2265),a=r(92800),o=r(46068),l=r(87381);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{push:t}=(0,o.p)(),[r,l]=(0,n.useState)(e),[i,s]=(0,n.useState)(0===e.length),[c,d]=(0,n.useState)(null),u=(0,n.useCallback)(async()=>{s(!0);try{let e=await (0,a.Mf)();l(e),d(null)}catch(r){let e=r instanceof Error?r.message:"Failed to load simulators";d(e),t({title:"Unable to load simulators",description:e,variant:"error"})}finally{s(!1)}},[t]);(0,n.useEffect)(()=>{0===e.length&&u()},[e.length,u]),(0,n.useEffect)(()=>{let e=()=>{u()};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[u]);let f=(0,n.useCallback)(async e=>{try{let r=await (0,a.ji)(e);return await u(),t({title:"Simulator created",description:"".concat(r.name," is ready to run."),variant:"success"}),r}catch(r){let e=r instanceof Error?r.message:"Failed to create simulator";throw console.error("Create simulator failed",r),t({title:"Create simulator failed",description:e,variant:"error"}),r}},[t,u]),g=(0,n.useCallback)(async e=>{try{await (0,a.aj)(e),l(t=>t.filter(t=>t.id!==e)),u(),t({title:"Simulator deleted",variant:"success"})}catch(n){let e="Delete failed",r="Failed to delete simulator";throw n instanceof Error&&(404===n.status?(e="Delete not supported",r="Backend DELETE endpoint not implemented. Contact backend team to add DELETE /api/v1/simulators/{id}"):500===n.status||502===n.status||503===n.status?(e="Server error",r="The backend server encountered an error. Please try again."):401===n.status||403===n.status?(e="Permission denied",r="You don't have permission to delete this simulator"):n.status?r=n.message:(e="Connection failed",r="Could not connect to the server. Check your internet connection.")),console.error("Delete simulator failed",n),t({title:e,description:r,variant:"error"}),n}},[t,u]);return(0,n.useMemo)(()=>({simulators:r,loading:i,error:c,refresh:u,create:f,delete:g}),[r,i,c,u,f,g])}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,{push:i,dismiss:s}=(0,o.p)(),{onAlert80pct:c,onWindowChange:d}=t,[u,f]=(0,n.useState)({block:r,loading:!r&&!!e,error:null,connected:!1,reconnecting:!1,lastReadingTs:void 0}),g=(0,n.useRef)(!1),h=(0,n.useRef)(null),m=(0,n.useCallback)(async()=>{if(e){f(e=>({...e,loading:null==e.block}));try{let t=await (0,a.lA)(e);f(e=>({...e,block:t,loading:!1,error:null}))}catch(t){let e=t instanceof Error?t.message:"Failed to load latest block";f(t=>({...t,loading:!1,error:e})),i({title:"Unable to load latest block",description:e,variant:"error"})}finally{f(e=>({...e,loading:!1}))}}},[e,i]);return(0,n.useEffect)(()=>{let t;if(!e){f(e=>({...e,block:null,loading:!1,error:null,connected:!1,reconnecting:!1}));return}r&&f(e=>({...e,block:r,loading:!1}));let n=!1;(async()=>{f(e=>({...e,loading:null==e.block}));try{let t=await (0,a.lA)(e);n||f(e=>({...e,block:t,loading:!1,error:null}))}catch(e){if(!n){let t=e instanceof Error?e.message:"Failed to load latest block";f(e=>({...e,loading:!1,error:t})),i({title:"Unable to load latest block",description:t,variant:"error"})}}})();let o=null,u=!1,b=null;try{t=(0,a.Bj)("/api/v1/stream/".concat(e))}catch(t){let e=t instanceof Error?t.message:"Backend URL is not configured.";return f(t=>({...t,error:e,reconnecting:!1,connected:!1})),i({title:"SSE connection failed",description:e,variant:"error"}),()=>void 0}return(()=>{if(u)return;(o=new EventSource(t)).addEventListener("open",()=>{h.current&&(s(h.current),h.current=null),f(e=>({...e,connected:!0,reconnecting:!1}))}),o.addEventListener("error",()=>{f(e=>({...e,connected:!1,reconnecting:!0})),h.current||(h.current=i({title:"Reconnecting to live stream",description:"Attempting to re-establish SSE connectionâ€¦",variant:"warning",dismissible:!1}))});let r=e=>{try{let t=JSON.parse(e.data);a(t)}catch(e){console.warn("Failed to parse SSE event",e)}},a=t=>{if("reading"===t.type){f(e=>({...e,lastReadingTs:t.ts})),n||u||(b&&clearTimeout(b),b=setTimeout(()=>{u||n||m()},500));return}f(r=>{if("alert-80pct"===t.type)return g.current||(g.current=!0),null==c||c(t.message),i({title:"Block alert",description:t.message||"Reached 80% of target for this block.",variant:"warning"}),r;if("block-update"===t.type){var n,a;console.log("\uD83D\uDD04 [SSE] Block-update event received:",t);let o=r.block,i=o?{...o,accumulated_kwh:t.accumulated_kwh,percent_of_target:t.percent_of_target,chart_bins:null!==(n=t.chart_bins)&&void 0!==n?n:o.chart_bins,block_start_local:null!==(a=t.block_start_local)&&void 0!==a?a:o.block_start_local}:o;if(o&&t.block_start_local&&t.block_start_local!==o.block_start_local&&(g.current=!1,null==d||d(t.block_start_local)),void 0!==t.percent_of_target){console.log("\uD83D\uDD14 [SSE] Checking thresholds for ".concat(e,": ").concat(t.percent_of_target,"%")),console.log("\uD83D\uDD14 [SSE] NotificationManager available:",!!l.O);try{l.O.checkThresholds(e,t.percent_of_target).then(()=>{console.log("\uD83D\uDD14 [SSE] Threshold check completed for ".concat(e))}).catch(e=>{console.error("\uD83D\uDD14 [SSE] Error checking notification thresholds:",e)})}catch(e){console.error("\uD83D\uDD14 [SSE] Synchronous error calling checkThresholds:",e)}}return{...r,block:i,error:null}}return r})};o.addEventListener("message",r),o.addEventListener("reading",r),o.addEventListener("block-update",r),o.addEventListener("alert-80pct",r),o.addEventListener("ping",()=>{f(e=>({...e,connected:!0,reconnecting:!1}))})})(),()=>{n=!0,u=!0,o&&o.close(),b&&(clearTimeout(b),b=null),h.current&&(s(h.current),h.current=null)}},[s,r,c,d,i,m,e]),{block:u.block,loading:u.loading,error:u.error,connected:u.connected,reconnecting:u.reconnecting,lastReadingTs:u.lastReadingTs,refresh:m}}function c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],{push:l}=(0,o.p)(),[i,s]=(0,n.useState)(r),[c,d]=(0,n.useState)(!!e&&0===r.length),[u,f]=(0,n.useState)(null),g=(0,n.useCallback)(async()=>{if(e){d(!0);try{let r=await (0,a.QY)(e,t);s(r),f(null)}catch(t){let e=t instanceof Error?t.message:"Failed to load block history";f(e),l({title:"Unable to load block history",description:e,variant:"error"})}finally{d(!1)}}},[t,l,e]);return(0,n.useEffect)(()=>{e?r.length>0?(s(r),d(!1)):g():(s([]),d(!1))},[r,g,e]),{history:i,loading:c,error:u,refresh:g}}console.log("\uD83D\uDE80 [HOOKS] Hooks file loaded, notificationManager imported:",!!l.O)}}]);