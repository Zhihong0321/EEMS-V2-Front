"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[622],{46068:function(t,e,n){n.d(e,{ToastProvider:function(){return o},p:function(){return c}});var r=n(57437),a=n(2265),i=n(44839);let l=(0,a.createContext)(void 0);function o(t){let{children:e}=t,[n,i]=(0,a.useState)([]),o=(0,a.useCallback)(t=>{let e="".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,8));return i(n=>[...n,{...t,id:e}]),e},[]),c=(0,a.useCallback)(t=>{i(e=>e.filter(e=>e.id!==t))},[]),u=(0,a.useCallback)(()=>i([]),[]),d=(0,a.useMemo)(()=>({toasts:n,push:o,dismiss:c,clear:u}),[n,o,c,u]);return(0,r.jsxs)(l.Provider,{value:d,children:[e,(0,r.jsx)(s,{toasts:n,onDismiss:c})]})}function c(){let t=(0,a.useContext)(l);if(!t)throw Error("useToast must be used within a ToastProvider");return t}function s(t){let{toasts:e,onDismiss:n}=t;return(0,r.jsx)("div",{className:"pointer-events-none fixed inset-x-0 top-4 z-50 flex flex-col items-end gap-3 px-4 sm:items-end sm:px-6",children:e.map(t=>(0,r.jsx)(u,{toast:t,onDismiss:n},t.id))})}function u(t){var e,n;let{toast:a,onDismiss:l}=t,o=null!==(e=a.variant)&&void 0!==e?e:"default";return(0,r.jsx)("div",{className:(0,i.Z)("pointer-events-auto w-full max-w-sm rounded-lg px-4 py-3 shadow-lg ring-1 ring-black/20 backdrop-blur","success"===o?"bg-emerald-500/90 text-white":"error"===o?"bg-red-500/90 text-white":"warning"===o?"bg-amber-500/90 text-black":"bg-slate-800/90 text-white"),role:"status",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,r.jsx)("p",{className:"text-sm font-semibold leading-tight",children:a.title}),a.description?(0,r.jsx)("p",{className:"text-xs leading-tight",children:a.description}):null,a.action?(0,r.jsx)("button",{type:"button",onClick:()=>{var t;null===(t=a.action)||void 0===t||t.onClick(),l(a.id)},className:"mt-2 inline-flex rounded-md border border-white/30 px-2 py-1 text-xs font-semibold text-white transition hover:border-white hover:bg-white/10",children:a.action.label}):null]}),(null===(n=a.dismissible)||void 0===n||n)&&(0,r.jsx)("button",{type:"button",onClick:()=>l(a.id),className:"-m-1 rounded-md p-1 text-xs opacity-70 transition hover:opacity-100","aria-label":"Dismiss notification",children:"✕"})]})})}},8374:function(t,e,n){n.d(e,{$T:function(){return v},Dr:function(){return d},HM:function(){return m},Oz:function(){return h},Qu:function(){return w},tQ:function(){return y},w:function(){return p},wC:function(){return g},wE:function(){return f}});var r=n(20357);let a="eems.apiKeyOverride",i=[{name:"NEXT_PUBLIC_BACKEND_TOKEN",value:"01121000099"},{name:"NEXT_PUBLIC_BACKEND_WRITE_TOKEN",value:r.env.NEXT_PUBLIC_BACKEND_WRITE_TOKEN},{name:"NEXT_PUBLIC_BACKEND_KEY",value:r.env.NEXT_PUBLIC_BACKEND_KEY},{name:"NEXT_PUBLIC_BACKEND_API_KEY",value:r.env.NEXT_PUBLIC_BACKEND_API_KEY}],l=null,o=!1,c=!1;function s(){if(!o){o=!0;try{let t=window.localStorage.getItem(a);t&&(l=t,c=!0)}catch(t){}}}function u(){for(let t of i)if(t.value)return{name:t.name,value:t.value};return null}function d(){var t,e;return null!==(e=null===(t=u())||void 0===t?void 0:t.value)&&void 0!==e?e:""}function f(){var t,e;return null!==(e=null===(t=u())||void 0===t?void 0:t.name)&&void 0!==e?e:null}function v(){return s(),l}function g(){return s(),c&&!!l}function h(t,e){l=t.trim()||null,c=!!((null==e?void 0:e.persist)&&l);try{c&&l?window.localStorage.setItem(a,l):window.localStorage.removeItem(a)}catch(t){}}function m(){l=null,c=!1;try{window.localStorage.removeItem(a)}catch(t){}}function p(){return v()||d()}function w(){return p().length>0}function y(){return d().length>0}},92800:function(t,e,n){n.d(e,{Bj:function(){return g},CT:function(){return a},LK:function(){return v},M8:function(){return y},Mf:function(){return h},QY:function(){return w},b0:function(){return f},ji:function(){return m},lA:function(){return p}});var r=n(8374);let a="/api/bridge",i=new Set([429,500,502,503,504]);class l extends Error{constructor(t,e,n,r){super(t),this.status=e,this.code=n,this.details=r}}function o(t){if(!a)throw new l("Backend base URL is not configured.",0);return t.startsWith("http")?t:"".concat(a).concat(t)}async function c(t){let e=await t.text();if(e)try{return JSON.parse(e)}catch(e){throw new l("Invalid JSON response: ".concat(e.message),t.status)}}async function s(t){var e,n,r,a,i,o;let c;try{c=await t.clone().json()}catch(t){}if(!c)try{let e=await t.text();if(e)return new l(e,t.status)}catch(t){}let s=null!==(o=null!==(i=null!==(a=null==c?void 0:null===(e=c.error)||void 0===e?void 0:e.message)&&void 0!==a?a:null==c?void 0:c.message)&&void 0!==i?i:t.statusText)&&void 0!==o?o:"Request failed with status ".concat(t.status),u=null==c?void 0:null===(n=c.error)||void 0===n?void 0:n.code,d=null==c?void 0:null===(r=c.error)||void 0===r?void 0:r.details;if(c&&c.detail){d=c.detail;try{if(Array.isArray(c.detail)){let t=c.detail.map(t=>(null==t?void 0:t.msg)||(null==t?void 0:t.detail)||"Validation error").filter(Boolean);t.length>0&&(s=t.join("; "))}else"string"==typeof c.detail&&(s=c.detail)}catch(t){}}return new l(s,t.status,u,d)}function u(t){return new Promise(e=>setTimeout(e,t))}async function d(t,e){var n,r;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},d=o(t),f=null!==(n=a.retryDelays)&&void 0!==n?n:[],v=0,g=new Headers(null==e?void 0:e.headers);g.set("Accept","application/json");let h={...e,headers:g};for(;;)try{let t=await fetch(d,h);if(!t.ok){let e=await s(t);if(r=t.status,i.has(r)&&v<f.length){await u(f[v++]);continue}throw e}if(204===t.status)return;return await c(t)}catch(t){if(t instanceof l)throw t;if(v<f.length){await u(f[v++]);continue}throw t}}function f(t){let e=new Headers(null==t?void 0:t.headers);e.set("Content-Type","application/json");let n=(0,r.w)();return n?e.set("x-api-key",n):e.delete("x-api-key"),{...t,headers:e}}async function v(t,e){try{return await d(t,e)}catch(n){if(!(n instanceof l))return await d(t,e,{retryDelays:[500]});throw n}}function g(t){return o(t)}async function h(){var t;let e=await v("/api/v1/simulators");return Array.isArray(e)?e:null!==(t=e.data)&&void 0!==t?t:[]}async function m(t){let e=await d("/api/v1/simulators",f({method:"POST",body:JSON.stringify(t)}),{retryDelays:[500,1500,3500]});return"data"in e?e.data:e}async function p(t){return await v("/api/v1/blocks/latest?simulator_id=".concat(encodeURIComponent(t)))}async function w(t){var e;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=await v("/api/v1/blocks/history?simulator_id=".concat(encodeURIComponent(t),"&limit=").concat(n));return Array.isArray(r)?r:null!==(e=r.data)&&void 0!==e?e:[]}async function y(t){await d("/api/v1/readings:ingest",f({method:"POST",body:JSON.stringify(t)}),{retryDelays:[500,1500,3500]})}},81622:function(t,e,n){n.d(e,{AF:function(){return o},NX:function(){return c},a1:function(){return l}});var r=n(2265),a=n(92800),i=n(46068);function l(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{push:e}=(0,i.p)(),[n,l]=(0,r.useState)(t),[o,c]=(0,r.useState)(0===t.length),[s,u]=(0,r.useState)(null),d=(0,r.useCallback)(async()=>{c(!0);try{let t=await (0,a.Mf)();l(t),u(null)}catch(n){let t=n instanceof Error?n.message:"Failed to load simulators";u(t),e({title:"Unable to load simulators",description:t,variant:"error"})}finally{c(!1)}},[e]);(0,r.useEffect)(()=>{0===t.length&&d()},[t.length,d]);let f=(0,r.useCallback)(async t=>{try{let n=await (0,a.ji)(t);return await d(),e({title:"Simulator created",description:"".concat(n.name," is ready to run."),variant:"success"}),n}catch(n){let t=n instanceof Error?n.message:"Failed to create simulator";throw console.error("Create simulator failed",n),e({title:"Create simulator failed",description:t,variant:"error"}),n}},[e,d]);return(0,r.useMemo)(()=>({simulators:n,loading:o,error:s,refresh:d,create:f}),[n,o,s,d,f])}function o(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,{push:l,dismiss:o}=(0,i.p)(),{onAlert80pct:c,onWindowChange:s}=e,[u,d]=(0,r.useState)({block:n,loading:!n&&!!t,error:null,connected:!1,reconnecting:!1}),f=(0,r.useRef)(!1),v=(0,r.useRef)(null),g=(0,r.useCallback)(async()=>{if(t){d(t=>({...t,loading:!0}));try{let e=await (0,a.lA)(t);d(t=>({...t,block:e,loading:!1,error:null}))}catch(e){let t=e instanceof Error?e.message:"Failed to load latest block";d(e=>({...e,loading:!1,error:t})),l({title:"Unable to load latest block",description:t,variant:"error"})}finally{d(t=>({...t,loading:!1}))}}},[t,l]);return(0,r.useEffect)(()=>{let e;if(!t){d(t=>({...t,block:null,loading:!1,error:null,connected:!1,reconnecting:!1}));return}n&&d(t=>({...t,block:n,loading:!1}));let r=!1;(async()=>{d(t=>({...t,loading:null==t.block}));try{let e=await (0,a.lA)(t);r||d(t=>({...t,block:e,loading:!1,error:null}))}catch(t){if(!r){let e=t instanceof Error?t.message:"Failed to load latest block";d(t=>({...t,loading:!1,error:e})),l({title:"Unable to load latest block",description:e,variant:"error"})}}})();let i=null,u=!1;try{e=(0,a.Bj)("/api/v1/stream/".concat(t))}catch(e){let t=e instanceof Error?e.message:"Backend URL is not configured.";return d(e=>({...e,error:t,reconnecting:!1,connected:!1})),l({title:"SSE connection failed",description:t,variant:"error"}),()=>void 0}return(()=>{if(u)return;(i=new EventSource(e)).addEventListener("open",()=>{v.current&&(o(v.current),v.current=null),d(t=>({...t,connected:!0,reconnecting:!1}))}),i.addEventListener("error",()=>{d(t=>({...t,connected:!1,reconnecting:!0})),v.current||(v.current=l({title:"Reconnecting to live stream",description:"Attempting to re-establish SSE connection…",variant:"warning",dismissible:!1}))});let t=t=>{try{let e=JSON.parse(t.data);n(e)}catch(t){console.warn("Failed to parse SSE event",t)}},n=t=>{if("reading"===t.type){g();return}d(e=>{if("alert-80pct"===t.type)return f.current||(f.current=!0),null==c||c(t.message),l({title:"Block alert",description:t.message||"Reached 80% of target for this block.",variant:"warning"}),e;if("block-update"===t.type){var n;let r=e.block,a=r?{...r,accumulated_kwh:t.accumulated_kwh,percent_of_target:t.percent_of_target,block_start_local:null!==(n=t.block_start_local)&&void 0!==n?n:r.block_start_local}:r;return r&&t.block_start_local&&t.block_start_local!==r.block_start_local&&(f.current=!1,null==s||s(t.block_start_local)),{...e,block:a,error:null}}return e})};i.addEventListener("message",t),i.addEventListener("reading",t),i.addEventListener("block-update",t),i.addEventListener("alert-80pct",t),i.addEventListener("ping",()=>{d(t=>({...t,connected:!0,reconnecting:!1}))})})(),()=>{r=!0,u=!0,i&&i.close(),v.current&&(o(v.current),v.current=null)}},[o,n,c,s,l,g,t]),{block:u.block,loading:u.loading,error:u.error,connected:u.connected,reconnecting:u.reconnecting,lastReadingTs:u.lastReadingTs,refresh:g}}function c(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],{push:l}=(0,i.p)(),[o,c]=(0,r.useState)(n),[s,u]=(0,r.useState)(!!t&&0===n.length),[d,f]=(0,r.useState)(null),v=(0,r.useCallback)(async()=>{if(t){u(!0);try{let n=await (0,a.QY)(t,e);c(n),f(null)}catch(e){let t=e instanceof Error?e.message:"Failed to load block history";f(t),l({title:"Unable to load block history",description:t,variant:"error"})}finally{u(!1)}}},[e,l,t]);return(0,r.useEffect)(()=>{t?n.length>0?(c(n),u(!1)):v():(c([]),u(!1))},[n,v,t]),{history:o,loading:s,error:d,refresh:v}}}}]);