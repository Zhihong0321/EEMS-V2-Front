"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[555],{32876:function(e,t,s){s.d(t,{J:function(){return i}});var a=s(57437),l=s(44839);function r(e){let{className:t}=e;return(0,a.jsx)("div",{className:(0,l.Z)("animate-pulse rounded-md bg-slate-800/40",t)})}let n=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function i(e){let{history:t,loading:s}=e;return(0,a.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur-sm p-6 shadow-md hover:shadow-lg transition-shadow duration-300",role:"region","aria-label":"Block history",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"History (last 10 blocks)"}),s?(0,a.jsx)("ul",{className:"mt-4 space-y-3",children:Array.from({length:6}).map((e,t)=>(0,a.jsxs)("li",{className:"space-y-2",children:[(0,a.jsx)(r,{className:"h-4 w-32"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(r,{className:"h-3 w-24"}),(0,a.jsx)(r,{className:"h-6 w-16 rounded-full"})]})]},t))}):0===t.length?(0,a.jsx)("p",{className:"mt-4 text-sm text-slate-400",children:"No block history yet. Run the simulator to populate readings."}):(0,a.jsx)("ul",{className:"mt-4 space-y-3",children:t.map((e,t)=>{let s=e.percent_of_target,l="";try{let t=new Date(e.block_start_local),s=new Date(t.getTime()+18e5);l="".concat(n.format(t)," – ").concat(n.format(s))}catch(t){l=e.block_start_local}return(0,a.jsxs)("li",{className:"flex items-center justify-between rounded-lg border border-slate-800 bg-slate-950/60 px-4 py-3 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium text-slate-100",children:l}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:[e.accumulated_kwh.toFixed(2)," / ",e.target_kwh.toFixed(1)," kWh"]})]}),(0,a.jsxs)("span",{className:"text-sm font-semibold ".concat(s>100?"text-danger":s>=80?"text-warning":"text-success"),children:[s.toFixed(1),"%"]})]},"".concat(e.block_start_local,"-").concat(t))})})]})}},39514:function(e,t,s){s.d(t,{l:function(){return w}});var a=s(57437),l=s(92566),r=s(25974),n=s(16638),i=s(45745),d=s(68295),c=s(92893),o=s(35231),m=s(54142),u=s(2842),x=s(9542),h=s(85475),b=s(2265),p=s(76218),g=s(89733);let f="Asia/Kuala_Lumpur",j=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:f}),v=new Intl.NumberFormat(void 0,{maximumFractionDigits:2});function N(e,t,s){let a=e.replace("#",""),l=t.replace("#",""),r=parseInt(a.substr(0,2),16),n=parseInt(a.substr(2,2),16),i=parseInt(a.substr(4,2),16),d=parseInt(l.substr(0,2),16),c=parseInt(l.substr(2,2),16),o=parseInt(l.substr(4,2),16);return"#".concat([Math.round(r+(d-r)*s),Math.round(n+(c-n)*s),Math.round(i+(o-i)*s)].map(e=>{let t=e.toString(16);return 1===t.length?"0"+t:t}).join(""))}function w(e){var t,s,w;let{block:y,loading:_,targetKwh:F,targetPeakKwh:T,mode:D,lastReadingTs:A}=e,M=null!==(t=null!=F?F:null==y?void 0:y.target_kwh)&&void 0!==t?t:0,{data:S,startTs:E,endTs:I,binSeconds:W}=function(e,t,s){var a,l,r,n;if(!e||!e.block_start_local){let e=new Date().getTime();return{data:Array(60).fill(null).map((t,s)=>({ts:e+(s+1)*3e4,value:0})),startTs:e,endTs:e+18e5,binSeconds:30}}let i=new Date(e.block_start_local).getTime(),d=null!==(r=null===(a=e.chart_bins)||void 0===a?void 0:a.points)&&void 0!==r?r:[],c=null!==(n=null===(l=e.chart_bins)||void 0===l?void 0:l.bin_seconds)&&void 0!==n?n:30,o=[];if("accumulate"===t)o=d.map((e,t)=>({ts:i+(t+1)*c*1e3,value:e}));else{let e=s?s/60:0;o=d.map((t,s)=>{let a=t-(0===s?0:d[s-1]),l=e>0?a/e*100:0;return{ts:i+(s+1)*c*1e3,value:a,color:function(e){let t=Math.max(0,Math.min(120,e));return t<=50?N("#22c55e","#84cc16",t/50):t<=75?N("#84cc16","#eab308",(t-50)/25):t<=90?N("#eab308","#f97316",(t-75)/15):t<=100?N("#f97316","#ef4444",(t-90)/10):N("#ef4444","#dc2626",Math.min(1,(t-100)/20))}(l),percentOfTarget:l}})}return{data:Array(Math.floor(1800/c)).fill(null).map((e,t)=>{let s=i+(t+1)*c*1e3,a=o.find(e=>e.ts===s);return null!=a?a:{ts:s,value:0,color:"#22c55e",percentOfTarget:0}}),startTs:i,endTs:i+18e5,binSeconds:c}}(y,D,T),C=function(e,t){try{let s=new Date(e),a=new Date(t);return function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Asia/Kuala_Lumpur",a=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:s});try{let s=new Date(e),l=new Date(t);return"".concat(a.format(s)," – ").concat(a.format(l))}catch(e){return"Invalid time range"}}(s.toISOString(),a.toISOString(),f)}catch(e){return"Invalid time range"}}(E,I),L="accumulate"===D,O=(0,b.useRef)([]),[P,K]=(0,b.useState)(new Map),[R,Z]=(0,b.useState)([]),B=(0,b.useRef)(null),[z,V]=(0,b.useState)(0);(0,b.useEffect)(()=>{if(B.current&&(clearTimeout(B.current),B.current=null),L||0===S.length){O.current=S,Z([...S]);return}if(!(JSON.stringify(O.current)!==JSON.stringify(S)))return;let e=new Map(P),t=[];return S.forEach((e,s)=>{let a=O.current[s];e.value>0&&(!a||0===a.value)&&t.push(s)}),t.length>0?(Z([...S.map((s,a)=>{let l=s.color||"#22c55e";return t.includes(a)?(e.set(a,"#22c55e"),{ts:s.ts,value:0,color:"#22c55e",percentOfTarget:0}):(e.set(a,l),{...s})})]),K(new Map(e)),B.current=setTimeout(()=>{requestAnimationFrame(()=>{V(e=>e+1),Z([...S.map((e,t)=>({...e}))]),setTimeout(()=>{S.forEach((e,s)=>{if(t.includes(s)){let t=e.color||"#22c55e";K(e=>{let a=new Map(e);return a.set(s,t),a})}})},400)})},150)):(S.forEach((t,s)=>{e.set(s,t.color||"#22c55e")}),K(new Map(e)),Z(S.map(e=>({...e})))),O.current=[...S],()=>{B.current&&clearTimeout(B.current)}},[S,L]);let Y=L?l.w:r.v,G=L?(0,a.jsx)(n.x,{type:"monotone",dataKey:"value",stroke:"#22d3ee",strokeWidth:2,dot:!1,isAnimationActive:!0,animationDuration:800}):(0,a.jsx)(i.$,{dataKey:"value",radius:[4,4,0,0],isAnimationActive:!0,animationDuration:1500,animationBegin:0,children:R.map((e,t)=>{let s=P.get(t)||e.color||"#22c55e";return(0,a.jsx)(d.b,{fill:s,style:{transition:"fill 1.2s cubic-bezier(0.4, 0, 0.2, 1)"}},"cell-".concat(e.ts,"-").concat(t))})}),J=L?(0,a.jsx)(c.d,{y:M,stroke:"#f97316",strokeDasharray:"6 6"}):T?(0,a.jsx)(c.d,{y:T/60,stroke:"rgba(255, 255, 255, 0.18)",strokeWidth:2,strokeDasharray:"4 4",label:{value:"Peak Target",position:"right",fill:"rgba(255, 255, 255, 0.6)",fontSize:11}}):null;return(0,a.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur-sm p-4 sm:p-6 shadow-md hover:shadow-lg transition-shadow duration-300",role:"region","aria-label":"Current block chart",children:[(0,a.jsxs)("header",{className:"mb-4 sm:mb-6 flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3 sm:gap-4",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg sm:text-xl font-semibold text-white",children:"Current 30-minute block"}),(0,a.jsxs)("p",{className:"text-xs sm:text-sm text-slate-400",children:["Window ",C]})]}),(0,a.jsx)(g.z,{variant:"ghost",size:"sm",className:"text-slate-400 hover:text-white","aria-label":"Export chart data",title:"Export data (Coming soon)",children:(0,a.jsx)(p.Z,{className:"h-4 w-4","aria-hidden":"true"})})]})}),(0,a.jsx)("div",{className:"rounded-md border border-slate-800 bg-slate-900/40 px-3 sm:px-4 py-2 text-xs text-slate-400",children:L?(0,a.jsxs)(a.Fragment,{children:["Target ",M.toFixed(1)," kWh \xb7 Accumulated ",null!==(s=null==y?void 0:y.accumulated_kwh.toFixed(2))&&void 0!==s?s:"—"," kWh"]}):(0,a.jsxs)(a.Fragment,{children:["Target ",null!==(w=null==T?void 0:T.toFixed(1))&&void 0!==w?w:"—"," kWh (total) \xb7 Per bin ",(T?T/60:0).toFixed(3)," kWh"]})})]}),(0,a.jsx)("div",{className:"h-48 md:h-72 w-full",children:_&&!y?(0,a.jsx)("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:(0,a.jsx)("span",{className:"text-sm text-slate-500",children:"Loading chart…"})}):0===S.length||S.every(e=>0===e.value)?(0,a.jsx)("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:(0,a.jsx)("span",{className:"text-sm text-slate-500",children:"No readings for this block yet."})}):(0,a.jsx)(o.h,{width:"100%",height:"100%",children:(0,a.jsxs)(Y,{data:L?S:R,margin:{left:12,right:12,top:12,bottom:12},children:[(0,a.jsx)(m.q,{strokeDasharray:"4 4",stroke:"#1f2937"}),(0,a.jsx)(u.K,{dataKey:"ts",type:"number",domain:[E,I],tickFormatter:e=>j.format(e),stroke:"#64748b",tickLine:!1}),(0,a.jsx)(x.B,{dataKey:"value",stroke:"#64748b",tickLine:!1,width:60,tickFormatter:e=>v.format(e)}),(0,a.jsx)(h.u,{content:(0,a.jsx)(k,{target:M,targetPeakKwh:T,mode:D,binSeconds:W})}),J,G]},L?void 0:"chart-".concat(z))})}),(0,a.jsx)("p",{className:"mt-4 text-xs text-slate-500",children:"Streaming series updates replace the entire 60-point window whenever the backend publishes a block update."})]})}function k(e){var t,s,l,r;let{active:n,payload:i,label:d,target:c,targetPeakKwh:o,mode:m,binSeconds:u}=e;if(!n||!i||0===i.length||!d)return null;let x=null!==(r=null===(t=i[0])||void 0===t?void 0:t.value)&&void 0!==r?r:0,h=j.format(d);if("accumulate"===m){let e=c>0?(x/c*100).toFixed(1):"0",t=parseFloat(e);return(0,a.jsxs)("div",{className:"rounded-xl border border-slate-600/50 bg-slate-900/98 backdrop-blur-md p-4 shadow-2xl ring-1 ring-white/5",children:[(0,a.jsxs)("div",{className:"mb-2 pb-2 border-b border-slate-700/50",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-white",children:h}),(0,a.jsx)("p",{className:"text-xs text-slate-400",children:"Accumulated reading"})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsx)("span",{className:"text-xs text-slate-400",children:"Accumulated:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-emerald-400",children:[v.format(x)," kWh"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsx)("span",{className:"text-xs text-slate-400",children:"Target:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-slate-300",children:[v.format(c)," kWh"]})]}),(0,a.jsx)("div",{className:"mt-2 pt-2 border-t border-slate-700/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsx)("span",{className:"text-xs text-slate-400",children:"Progress:"}),(0,a.jsxs)("span",{className:"text-sm font-semibold ".concat(t>100?"text-danger":t>90?"text-warning":"text-success"),children:[e,"%"]})]})})]})]})}let b=o?o/60:0,p=b>0?(x/b*100).toFixed(1):"0",g=(null===(l=i[0])||void 0===l?void 0:null===(s=l.payload)||void 0===s?void 0:s.color)||"#22c55e",f=parseFloat(p),N="Green";return N=f>=100?"Red (≥100%)":f>=90?"Orange-Red (90-100%)":f>=75?"Yellow-Orange (75-90%)":f>=50?"Yellow-Green (50-75%)":"Green (<50%)",(0,a.jsxs)("div",{className:"rounded-xl border border-slate-600/50 bg-slate-900/98 backdrop-blur-md p-4 shadow-2xl ring-1 ring-white/5",children:[(0,a.jsxs)("div",{className:"mb-2 pb-2 border-b border-slate-700/50",children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-white",children:h}),(0,a.jsxs)("p",{className:"text-xs text-slate-400",children:["Peak usage reading (",u,"s)"]})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsx)("span",{className:"text-xs text-slate-400",children:"Usage:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-cyan-400",children:[v.format(x)," kWh"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsx)("span",{className:"text-xs text-slate-400",children:"Target/bin:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-slate-300",children:[v.format(b)," kWh"]})]}),(0,a.jsx)("div",{className:"mt-2 pt-2 border-t border-slate-700/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,a.jsx)("span",{className:"text-xs text-slate-400",children:"Intensity:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"h-3 w-3 rounded-full",style:{backgroundColor:g}}),(0,a.jsx)("span",{className:"text-xs font-medium text-slate-300",children:N})]})]})})]})]})}},15597:function(e,t,s){s.d(t,{C:function(){return n}});var a=s(57437),l=s(2265);let r=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function n(e){var t,s;let{connected:n,reconnecting:i,lastReadingTs:d,block:c,targetKwh:o,targetPeakKwh:m}=e,[u,x]=(0,l.useState)(new Date);(0,l.useEffect)(()=>{let e=setInterval(()=>{x(new Date)},1e3);return()=>clearInterval(e)},[]);let h="bg-slate-500",b="Disconnected";n?(h="bg-emerald-400 animate-pulse",b="Connected"):i&&(h="bg-amber-400 animate-pulse",b="Reconnecting");let p=d?r.format(new Date(d)):"—",g=null!==(s=null!==(t=null!=m?m:o)&&void 0!==t?t:null==c?void 0:c.target_kwh)&&void 0!==s?s:0,f=function(e,t){var s;let a,l;if(!e||!e.block_start_local||t<=0)return{projectedTotal:0,status:"SAFE",color:"bg-emerald-500",elapsedMinutes:0,currentAccumulated:0,fillPercentage:0};let r=new Date(e.block_start_local),n=Math.min(30,Math.max(0,new Date().getTime()-r.getTime())/6e4),i=null!==(s=e.accumulated_kwh)&&void 0!==s?s:0,d=Math.min(100,i/t*100);if(n<1||0===i)return{projectedTotal:i,status:d<80?"SAFE":d<100?"VERY CLOSE":"OVER",color:d<80?"bg-emerald-500":d<100?"bg-amber-500":"bg-red-500",elapsedMinutes:n,currentAccumulated:i,fillPercentage:d};let c=i/n*30,o=c/t*100;return o<80?(a="SAFE",l="bg-emerald-500"):o<100?(a="VERY CLOSE",l="bg-amber-500"):(a="OVER",l="bg-red-500"),{projectedTotal:c,status:a,color:l,elapsedMinutes:n,currentAccumulated:i,fillPercentage:d}}(c,g);return(0,a.jsxs)("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur-sm p-6 shadow-md hover:shadow-lg transition-shadow duration-300",role:"region","aria-label":"Live connection status and usage projection",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Live status"}),(0,a.jsxs)("div",{className:"mt-4 flex items-center gap-3",role:"status","aria-live":"polite",children:[(0,a.jsx)("span",{className:"h-3 w-3 rounded-full ".concat(h),"aria-hidden":"true"}),(0,a.jsx)("span",{className:"text-sm text-slate-200",children:b})]}),(0,a.jsx)("dl",{className:"mt-4 space-y-2 text-xs text-slate-400",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("dt",{className:"uppercase tracking-[0.2em] text-slate-500",children:"Last reading"}),(0,a.jsx)("dd",{className:"mt-1 text-sm text-slate-200",children:p})]})}),c&&g>0&&(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,a.jsx)("div",{className:"text-xs uppercase tracking-[0.2em] text-slate-500 mb-3",children:"Usage Bucket"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"relative h-48 w-full rounded-b-lg border-4 border-slate-600 bg-slate-800/50 overflow-hidden",children:[(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 transition-all duration-500 ease-out",style:{height:"".concat(Math.min(100,f.fillPercentage),"%"),backgroundColor:f.fillPercentage<80?"#22c55e":f.fillPercentage<100?"#f59e0b":"#ef4444"},children:[(0,a.jsx)("div",{className:"absolute inset-0 opacity-20 bg-gradient-to-t from-transparent via-white to-transparent animate-pulse"}),f.fillPercentage>0&&(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 h-0.5 bg-white/50"})]}),(0,a.jsx)("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-amber-400 opacity-60",style:{bottom:"20%"},children:(0,a.jsx)("span",{className:"absolute -left-12 -top-2 text-xs text-amber-400",children:"80%"})}),(0,a.jsx)("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-red-400 opacity-60",style:{bottom:"0%"},children:(0,a.jsx)("span",{className:"absolute -left-12 -top-2 text-xs text-red-400",children:"100%"})}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-white drop-shadow-lg",children:[f.currentAccumulated.toFixed(2)," kWh"]}),(0,a.jsxs)("div",{className:"text-xs text-slate-300 mt-1",children:[f.fillPercentage.toFixed(1),"% filled"]})]})})]}),(0,a.jsx)("div",{className:"absolute -top-2 -left-3 w-8 h-4 border-2 border-slate-600 rounded-t-full"}),(0,a.jsx)("div",{className:"absolute -top-2 -right-3 w-8 h-4 border-2 border-slate-600 rounded-t-full"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,a.jsxs)("div",{className:"rounded border border-slate-700 bg-slate-800/50 p-2",children:[(0,a.jsx)("div",{className:"text-slate-400",children:"Target"}),(0,a.jsxs)("div",{className:"text-white font-semibold",children:[g.toFixed(2)," kWh"]})]}),(0,a.jsxs)("div",{className:"rounded border border-slate-700 bg-slate-800/50 p-2",children:[(0,a.jsx)("div",{className:"text-slate-400",children:"Current"}),(0,a.jsxs)("div",{className:"text-white font-semibold",children:[f.currentAccumulated.toFixed(2)," kWh"]})]})]}),(0,a.jsxs)("div",{className:"".concat(f.color," rounded-lg p-4 text-center shadow-lg"),role:"status","aria-live":"polite","aria-label":"Usage projection: ".concat(f.status),children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-white",children:f.status}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-white/90",children:["Projected: ",f.projectedTotal.toFixed(2)," kWh"]}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-white/80",children:["(",(f.projectedTotal/g*100).toFixed(1),"% of target)"]}),f.elapsedMinutes>0&&(0,a.jsxs)("div",{className:"mt-1 text-xs text-white/70",children:["Based on ",f.elapsedMinutes.toFixed(1)," min avg"]})]})]})]})}}}]);