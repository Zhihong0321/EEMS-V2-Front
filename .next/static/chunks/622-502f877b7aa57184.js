"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[622],{46068:function(e,t,r){r.d(t,{ToastProvider:function(){return m},p:function(){return f}});var n=r(57437),a=r(2265),l=r(85130),o=r(39519),i=r(11853),s=r(13934),c=r(84573),d=r(44839);let u=(0,a.createContext)(void 0);function m(e){let{children:t}=e,[r,l]=(0,a.useState)([]),o=(0,a.useCallback)(e=>{let t="".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2,8));return l(r=>[...r,{...e,id:t}]),setTimeout(()=>{l(e=>e.filter(e=>e.id!==t))},5e3),t},[]),i=(0,a.useCallback)(e=>{l(t=>t.filter(t=>t.id!==e))},[]),s=(0,a.useCallback)(()=>l([]),[]),c=(0,a.useMemo)(()=>({toasts:r,push:o,dismiss:i,clear:s}),[r,o,i,s]);return(0,n.jsxs)(u.Provider,{value:c,children:[t,(0,n.jsx)(b,{toasts:r,onDismiss:i})]})}function f(){let e=(0,a.useContext)(u);if(!e)throw Error("useToast must be used within a ToastProvider");return e}function b(e){let{toasts:t,onDismiss:r}=e;return(0,n.jsx)("div",{className:"pointer-events-none fixed inset-x-0 bottom-0 sm:top-20 sm:bottom-auto z-50 flex flex-col items-center sm:items-end gap-3 px-4 sm:px-6 pb-6 sm:pb-0","aria-live":"polite","aria-atomic":"true",children:t.map(e=>(0,n.jsx)(g,{toast:e,onDismiss:r},e.id))})}function g(e){var t,r;let{toast:u,onDismiss:m}=e,[f,b]=(0,a.useState)(!1),g=null!==(t=u.variant)&&void 0!==t?t:"default";(0,a.useEffect)(()=>{requestAnimationFrame(()=>b(!0))},[]);let h=()=>{b(!1),setTimeout(()=>m(u.id),200)},v="success"===g?l.Z:"error"===g?o.Z:"warning"===g?i.Z:s.Z;return(0,n.jsx)("div",{className:(0,d.Z)("pointer-events-auto w-full max-w-sm rounded-xl px-4 py-3 shadow-2xl border backdrop-blur-md transition-all duration-300 ease-out","success"===g?"bg-success/95 text-white border-success/20":"error"===g?"bg-danger/95 text-white border-danger/20":"warning"===g?"bg-warning/95 text-white border-warning/20":"bg-slate-800/95 text-white border-slate-700/20",f?"translate-y-0 opacity-100":"translate-y-2 sm:translate-y-0 sm:translate-x-4 opacity-0"),role:"alert","aria-live":"assertive",children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)(v,{className:"h-5 w-5 flex-shrink-0 mt-0.5","aria-hidden":"true"}),(0,n.jsxs)("div",{className:"flex-1 space-y-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-sm font-semibold leading-tight",children:u.title}),u.description&&(0,n.jsx)("p",{className:"text-xs leading-tight opacity-90",children:u.description}),u.action&&(0,n.jsx)("button",{type:"button",onClick:()=>{var e;null===(e=u.action)||void 0===e||e.onClick(),h()},className:"mt-2 inline-flex rounded-md border border-current/30 px-3 py-1.5 text-xs font-semibold transition hover:border-current hover:bg-white/10",children:u.action.label})]}),(null===(r=u.dismissible)||void 0===r||r)&&(0,n.jsx)("button",{type:"button",onClick:h,className:"flex-shrink-0 rounded-md p-1 transition hover:bg-white/10","aria-label":"Dismiss notification",children:(0,n.jsx)(c.Z,{className:"h-5 w-5","aria-hidden":"true"})})]})})}},81622:function(e,t,r){r.d(t,{AF:function(){return i},NX:function(){return s},a1:function(){return o}});var n=r(2265),a=r(92800),l=r(46068);function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],{push:t}=(0,l.p)(),[r,o]=(0,n.useState)(e),[i,s]=(0,n.useState)(0===e.length),[c,d]=(0,n.useState)(null),u=(0,n.useCallback)(async()=>{s(!0);try{let e=await (0,a.Mf)();o(e),d(null)}catch(r){let e=r instanceof Error?r.message:"Failed to load simulators";d(e),t({title:"Unable to load simulators",description:e,variant:"error"})}finally{s(!1)}},[t]);(0,n.useEffect)(()=>{0===e.length&&u()},[e.length,u]),(0,n.useEffect)(()=>{let e=()=>{u()};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[u]);let m=(0,n.useCallback)(async e=>{try{let r=await (0,a.ji)(e);return await u(),t({title:"Simulator created",description:"".concat(r.name," is ready to run."),variant:"success"}),r}catch(r){let e=r instanceof Error?r.message:"Failed to create simulator";throw console.error("Create simulator failed",r),t({title:"Create simulator failed",description:e,variant:"error"}),r}},[t,u]),f=(0,n.useCallback)(async e=>{try{await (0,a.aj)(e),o(t=>t.filter(t=>t.id!==e)),u(),t({title:"Simulator deleted",variant:"success"})}catch(n){let e="Delete failed",r="Failed to delete simulator";throw n instanceof Error&&(404===n.status?(e="Delete not supported",r="Backend DELETE endpoint not implemented. Contact backend team to add DELETE /api/v1/simulators/{id}"):500===n.status||502===n.status||503===n.status?(e="Server error",r="The backend server encountered an error. Please try again."):401===n.status||403===n.status?(e="Permission denied",r="You don't have permission to delete this simulator"):n.status?r=n.message:(e="Connection failed",r="Could not connect to the server. Check your internet connection.")),console.error("Delete simulator failed",n),t({title:e,description:r,variant:"error"}),n}},[t,u]);return(0,n.useMemo)(()=>({simulators:r,loading:i,error:c,refresh:u,create:m,delete:f}),[r,i,c,u,m,f])}function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,{push:o,dismiss:i}=(0,l.p)(),{onAlert80pct:s,onWindowChange:c}=t,[d,u]=(0,n.useState)({block:r,loading:!r&&!!e,error:null,connected:!1,reconnecting:!1,lastReadingTs:void 0}),m=(0,n.useRef)(!1),f=(0,n.useRef)(null),b=(0,n.useCallback)(async()=>{if(e){u(e=>({...e,loading:null==e.block}));try{let t=await (0,a.lA)(e);u(e=>({...e,block:t,loading:!1,error:null}))}catch(t){let e=t instanceof Error?t.message:"Failed to load latest block";u(t=>({...t,loading:!1,error:e})),o({title:"Unable to load latest block",description:e,variant:"error"})}finally{u(e=>({...e,loading:!1}))}}},[e,o]);return(0,n.useEffect)(()=>{let t;if(!e){u(e=>({...e,block:null,loading:!1,error:null,connected:!1,reconnecting:!1}));return}r&&u(e=>({...e,block:r,loading:!1}));let n=!1;(async()=>{u(e=>({...e,loading:null==e.block}));try{let t=await (0,a.lA)(e);n||u(e=>({...e,block:t,loading:!1,error:null}))}catch(e){if(!n){let t=e instanceof Error?e.message:"Failed to load latest block";u(e=>({...e,loading:!1,error:t})),o({title:"Unable to load latest block",description:t,variant:"error"})}}})();let l=null,d=!1,g=null;try{t=(0,a.Bj)("/api/v1/stream/".concat(e))}catch(t){let e=t instanceof Error?t.message:"Backend URL is not configured.";return u(t=>({...t,error:e,reconnecting:!1,connected:!1})),o({title:"SSE connection failed",description:e,variant:"error"}),()=>void 0}return(()=>{if(d)return;(l=new EventSource(t)).addEventListener("open",()=>{f.current&&(i(f.current),f.current=null),u(e=>({...e,connected:!0,reconnecting:!1}))}),l.addEventListener("error",()=>{u(e=>({...e,connected:!1,reconnecting:!0})),f.current||(f.current=o({title:"Reconnecting to live stream",description:"Attempting to re-establish SSE connectionâ€¦",variant:"warning",dismissible:!1}))});let e=e=>{try{let t=JSON.parse(e.data);r(t)}catch(e){console.warn("Failed to parse SSE event",e)}},r=e=>{if("reading"===e.type){u(t=>({...t,lastReadingTs:e.ts})),n||d||(g&&clearTimeout(g),g=setTimeout(()=>{d||n||b()},500));return}u(t=>{if("alert-80pct"===e.type)return m.current||(m.current=!0),null==s||s(e.message),o({title:"Block alert",description:e.message||"Reached 80% of target for this block.",variant:"warning"}),t;if("block-update"===e.type){var r,n;let a=t.block,l=a?{...a,accumulated_kwh:e.accumulated_kwh,percent_of_target:e.percent_of_target,chart_bins:null!==(r=e.chart_bins)&&void 0!==r?r:a.chart_bins,block_start_local:null!==(n=e.block_start_local)&&void 0!==n?n:a.block_start_local}:a;return a&&e.block_start_local&&e.block_start_local!==a.block_start_local&&(m.current=!1,null==c||c(e.block_start_local)),{...t,block:l,error:null}}return t})};l.addEventListener("message",e),l.addEventListener("reading",e),l.addEventListener("block-update",e),l.addEventListener("alert-80pct",e),l.addEventListener("ping",()=>{u(e=>({...e,connected:!0,reconnecting:!1}))})})(),()=>{n=!0,d=!0,l&&l.close(),g&&(clearTimeout(g),g=null),f.current&&(i(f.current),f.current=null)}},[i,r,s,c,o,b,e]),{block:d.block,loading:d.loading,error:d.error,connected:d.connected,reconnecting:d.reconnecting,lastReadingTs:d.lastReadingTs,refresh:b}}function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],{push:o}=(0,l.p)(),[i,s]=(0,n.useState)(r),[c,d]=(0,n.useState)(!!e&&0===r.length),[u,m]=(0,n.useState)(null),f=(0,n.useCallback)(async()=>{if(e){d(!0);try{let r=await (0,a.QY)(e,t);s(r),m(null)}catch(t){let e=t instanceof Error?t.message:"Failed to load block history";m(e),o({title:"Unable to load block history",description:e,variant:"error"})}finally{d(!1)}}},[t,o,e]);return(0,n.useEffect)(()=>{e?r.length>0?(s(r),d(!1)):f():(s([]),d(!1))},[r,f,e]),{history:i,loading:c,error:u,refresh:f}}}}]);