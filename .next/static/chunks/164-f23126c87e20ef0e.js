"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[164],{55164:function(e,t,s){s.d(t,{fn:function(){return z}});var r,a,i=s(57437),n=s(2265),o=s(89733),l=s(77209),c=s(48185);function d(e){if(!e||"string"!=typeof e)return{isValid:!1,error:"Phone number is required"};let t=e.replace(/[\s\-\(\)]/g,"");if(!t.startsWith("+"))return{isValid:!1,error:"Phone number must start with country code (e.g., +60123456789)"};let s=t.substring(1);return/^\d+$/.test(s)?s.length<10||s.length>15?{isValid:!1,error:"Phone number must be 10-15 digits including country code"}:s.match(/^(\d{1,4})/)?{isValid:!0,formattedNumber:t}:{isValid:!1,error:"Invalid country code format"}:{isValid:!1,error:"Phone number can only contain digits after country code"}}function h(e){if(null==e||""===e)return{isValid:!1,error:"Threshold percentage is required"};let t="string"==typeof e?parseFloat(e):e;return isNaN(t)?{isValid:!1,error:"Threshold must be a valid number"}:t<1?{isValid:!1,error:"Threshold must be at least 1%"}:t>200?{isValid:!1,error:"Threshold cannot exceed 200%"}:{isValid:!0,normalizedValue:Math.round(10*t)/10}}function u(e){let t=d(e);if(!t.isValid||!t.formattedNumber)return e;let s=t.formattedNumber;return s.length<=13?s.replace(/(\+\d{1,3})(\d{3})(\d{3})(\d+)/,"$1 $2 $3 $4"):s}(r=a||(a={})).WHATSAPP_API_UNAVAILABLE="WHATSAPP_API_UNAVAILABLE",r.INVALID_PHONE_NUMBER="INVALID_PHONE_NUMBER",r.RATE_LIMIT_EXCEEDED="RATE_LIMIT_EXCEEDED",r.STORAGE_ERROR="STORAGE_ERROR",r.VALIDATION_ERROR="VALIDATION_ERROR",r.DUPLICATE_TRIGGER="DUPLICATE_TRIGGER",r.COOLDOWN_ACTIVE="COOLDOWN_ACTIVE";let m={TRIGGERS:"notification_triggers",HISTORY:"notification_history",SETTINGS:"notification_settings",COOLDOWNS:"notification_cooldowns"},g={cooldownMinutes:15,maxDailyNotifications:10,enabledGlobally:!0};class x{safeParseJSON(e,t){try{let s=localStorage.getItem(e);if(null===s)return t;return JSON.parse(s)}catch(s){return console.error("Error parsing localStorage item ".concat(e,":"),s),t}}safeSaveJSON(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(t){throw console.error("Error saving to localStorage ".concat(e,":"),t),Error("Storage error: ".concat(t instanceof Error?t.message:"Unknown error"))}}generateId(){return"".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))}async saveTrigger(e){let t=this.safeParseJSON(m.TRIGGERS,[]);if(t.find(t=>t.simulatorId===e.simulatorId&&t.phoneNumber===e.phoneNumber&&t.thresholdPercentage===e.thresholdPercentage&&t.id!==e.id))throw Error("A trigger with the same simulator, phone number, and threshold already exists");let s=t.findIndex(t=>t.id===e.id);s>=0?t[s]=e:t.push(e),this.safeSaveJSON(m.TRIGGERS,t)}async getTrigger(e){return this.safeParseJSON(m.TRIGGERS,[]).find(t=>t.id===e)||null}async getTriggersBySimulator(e){return this.safeParseJSON(m.TRIGGERS,[]).filter(t=>t.simulatorId===e)}async getAllTriggers(){return this.safeParseJSON(m.TRIGGERS,[])}async updateTrigger(e,t){let s=this.safeParseJSON(m.TRIGGERS,[]),r=s.findIndex(t=>t.id===e);if(-1===r)throw Error("Trigger with id ".concat(e," not found"));s[r]={...s[r],...t,updatedAt:new Date().toISOString()},this.safeSaveJSON(m.TRIGGERS,s)}async deleteTrigger(e){let t=this.safeParseJSON(m.TRIGGERS,[]),s=t.filter(t=>t.id!==e);if(t.length===s.length)throw Error("Trigger with id ".concat(e," not found"));this.safeSaveJSON(m.TRIGGERS,s);let r=this.safeParseJSON(m.COOLDOWNS,{});delete r[e],this.safeSaveJSON(m.COOLDOWNS,r)}async saveNotificationHistory(e){let t=this.safeParseJSON(m.HISTORY,[]);t.push(e),t.length>1e3&&t.splice(0,t.length-1e3),this.safeSaveJSON(m.HISTORY,t)}async getNotificationHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return this.safeParseJSON(m.HISTORY,[]).filter(t=>t.simulatorId===e).sort((e,t)=>new Date(t.sentAt).getTime()-new Date(e.sentAt).getTime()).slice(0,t)}async getAllNotificationHistory(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;return this.safeParseJSON(m.HISTORY,[]).sort((e,t)=>new Date(t.sentAt).getTime()-new Date(e.sentAt).getTime()).slice(0,e)}async getSettings(){return this.safeParseJSON(m.SETTINGS,g)}async updateSettings(e){let t={...await this.getSettings(),...e};this.safeSaveJSON(m.SETTINGS,t)}async getLastNotificationTime(e){let t=this.safeParseJSON(m.COOLDOWNS,{})[e];return t?new Date(t):null}async setLastNotificationTime(e,t){let s=this.safeParseJSON(m.COOLDOWNS,{});s[e]=t.toISOString(),this.safeSaveJSON(m.COOLDOWNS,s)}async clearAllData(){Object.values(m).forEach(e=>{localStorage.removeItem(e)})}async exportData(){return JSON.stringify({triggers:this.safeParseJSON(m.TRIGGERS,[]),history:this.safeParseJSON(m.HISTORY,[]),settings:this.safeParseJSON(m.SETTINGS,g),cooldowns:this.safeParseJSON(m.COOLDOWNS,{}),exportedAt:new Date().toISOString()},null,2)}async importData(e){try{let t=JSON.parse(e);t.triggers&&this.safeSaveJSON(m.TRIGGERS,t.triggers),t.history&&this.safeSaveJSON(m.HISTORY,t.history),t.settings&&this.safeSaveJSON(m.SETTINGS,t.settings),t.cooldowns&&this.safeSaveJSON(m.COOLDOWNS,t.cooldowns)}catch(e){throw Error("Invalid import data: ".concat(e instanceof Error?e.message:"Unknown error"))}}}function f(e,t,s,r){return{id:"history-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),triggerId:e.id,simulatorId:e.simulatorId,phoneNumber:e.phoneNumber,thresholdPercentage:e.thresholdPercentage,actualPercentage:t,sentAt:new Date().toISOString(),success:s,errorMessage:r}}new x;var p=s(61233);class b extends Error{constructor(e,t,s){super(t),this.name="NotificationValidationError",this.type=e,this.field=s,this.code=e}}class N extends Error{constructor(e,t){super(e),this.name="NotificationStorageError",this.type=a.STORAGE_ERROR,this.operation=t}}class w extends Error{constructor(e,t){super(e),this.name="NotificationRateLimitError",this.type=a.RATE_LIMIT_EXCEEDED,this.waitTimeMinutes=t}}class y extends Error{constructor(e,t,s=!0){super(e),this.name="NotificationWhatsAppError",this.type=a.WHATSAPP_API_UNAVAILABLE,this.apiError=t,this.retryable=s}}class v{handleError(e,t){let s=t||"general",r=this.errorCounts.get(s)||0;return(this.errorCounts.set(s,r+1),this.lastErrors.set(s,new Date),e instanceof b)?{type:e.type,message:e.message,shouldRetry:!1}:e instanceof w?{type:e.type,message:e.message,shouldRetry:!0,retryAfterMinutes:e.waitTimeMinutes}:e instanceof y?{type:e.type,message:e.message,shouldRetry:e.retryable,retryAfterMinutes:e.retryable?5:void 0}:e instanceof N?{type:e.type,message:e.message,shouldRetry:!0,retryAfterMinutes:1}:e.message.includes("localStorage")?{type:a.STORAGE_ERROR,message:"Storage is not available or full",shouldRetry:!1}:e.message.includes("network")||e.message.includes("fetch")?{type:a.WHATSAPP_API_UNAVAILABLE,message:"Network error occurred",shouldRetry:!0,retryAfterMinutes:2}:{type:a.VALIDATION_ERROR,message:e.message||"Unknown error occurred",shouldRetry:!1}}getErrorStats(){let e=Array.from(this.errorCounts.values()).reduce((e,t)=>e+t,0),t={},s={};return this.errorCounts.forEach((e,s)=>{t[s]=e}),this.lastErrors.forEach((e,t)=>{s[t]=e}),{totalErrors:e,errorsByContext:t,recentErrors:s}}clearErrorStats(){this.errorCounts.clear(),this.lastErrors.clear()}hasTooManyErrors(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60,r=this.errorCounts.get(e)||0,a=this.lastErrors.get(e);return!!a&&!(r<t)&&(Date.now()-a.getTime())/6e4<s}constructor(){this.errorCounts=new Map,this.lastErrors=new Map}}class j{static validatePhoneNumber(e){if(!e||"string"!=typeof e)throw new b(a.INVALID_PHONE_NUMBER,"Phone number is required","phoneNumber");let t=e.replace(/[\s\-\(\)]/g,"");if(!t.startsWith("+"))throw new b(a.INVALID_PHONE_NUMBER,"Phone number must start with country code (e.g., +60123456789)","phoneNumber");let s=t.substring(1);if(!/^\d+$/.test(s))throw new b(a.INVALID_PHONE_NUMBER,"Phone number can only contain digits after country code","phoneNumber");if(s.length<10||s.length>15)throw new b(a.INVALID_PHONE_NUMBER,"Phone number must be 10-15 digits including country code","phoneNumber");if(["000","111","222","333","444","555","666","777","888","999"].includes(s.substring(0,3)))throw new b(a.INVALID_PHONE_NUMBER,"Invalid country code","phoneNumber")}static validateThresholdPercentage(e){if(null==e)throw new b(a.VALIDATION_ERROR,"Threshold percentage is required","thresholdPercentage");if("number"!=typeof e||isNaN(e))throw new b(a.VALIDATION_ERROR,"Threshold must be a valid number","thresholdPercentage");if(e<1)throw new b(a.VALIDATION_ERROR,"Threshold must be at least 1%","thresholdPercentage");if(e>200)throw new b(a.VALIDATION_ERROR,"Threshold cannot exceed 200%","thresholdPercentage");if((e.toString().split(".")[1]||"").length>1)throw new b(a.VALIDATION_ERROR,"Threshold can have at most 1 decimal place","thresholdPercentage")}static validateSimulatorId(e){if(!e||"string"!=typeof e)throw new b(a.VALIDATION_ERROR,"Simulator ID is required","simulatorId");if(0===e.trim().length)throw new b(a.VALIDATION_ERROR,"Simulator ID cannot be empty","simulatorId");if(e.length>100)throw new b(a.VALIDATION_ERROR,"Simulator ID is too long (max 100 characters)","simulatorId");if(!/^[a-zA-Z0-9\-_]+$/.test(e))throw new b(a.VALIDATION_ERROR,"Simulator ID can only contain letters, numbers, hyphens, and underscores","simulatorId")}static validateNotificationSettings(e){if("object"!=typeof e||null===e)throw new b(a.VALIDATION_ERROR,"Settings must be an object","settings");if(void 0!==e.cooldownMinutes){if("number"!=typeof e.cooldownMinutes||isNaN(e.cooldownMinutes))throw new b(a.VALIDATION_ERROR,"Cooldown minutes must be a number","cooldownMinutes");if(e.cooldownMinutes<1||e.cooldownMinutes>1440)throw new b(a.VALIDATION_ERROR,"Cooldown minutes must be between 1 and 1440 (24 hours)","cooldownMinutes")}if(void 0!==e.maxDailyNotifications){if("number"!=typeof e.maxDailyNotifications||isNaN(e.maxDailyNotifications))throw new b(a.VALIDATION_ERROR,"Max daily notifications must be a number","maxDailyNotifications");if(e.maxDailyNotifications<1||e.maxDailyNotifications>100)throw new b(a.VALIDATION_ERROR,"Max daily notifications must be between 1 and 100","maxDailyNotifications")}if(void 0!==e.enabledGlobally&&"boolean"!=typeof e.enabledGlobally)throw new b(a.VALIDATION_ERROR,"Enabled globally must be a boolean","enabledGlobally")}static validateTriggerData(e){if("object"!=typeof e||null===e)throw new b(a.VALIDATION_ERROR,"Trigger data must be an object");if(this.validateSimulatorId(e.simulatorId),this.validatePhoneNumber(e.phoneNumber),this.validateThresholdPercentage(e.thresholdPercentage),void 0!==e.isActive&&"boolean"!=typeof e.isActive)throw new b(a.VALIDATION_ERROR,"isActive must be a boolean","isActive")}}class S{static handleWhatsAppError(e,t){let s="WhatsApp API error occurred",r=!0,a="";if(e&&"object"==typeof e&&(e.message&&(a=e.message,s="WhatsApp API error: ".concat(e.message)),e.code))switch(e.code){case"PHONE_NOT_WHATSAPP":s="Phone number ".concat(t," is not registered with WhatsApp"),r=!1;break;case"RATE_LIMIT":s="WhatsApp API rate limit exceeded",r=!0;break;case"INVALID_PHONE":s="Invalid phone number format: ".concat(t),r=!1;break;case"API_UNAVAILABLE":s="WhatsApp API is temporarily unavailable",r=!0;break;case"AUTHENTICATION_FAILED":s="WhatsApp API authentication failed",r=!1;break;default:s="WhatsApp API error (".concat(e.code,"): ").concat(e.message||"Unknown error")}return new y(s,a,r)}static isRetryableError(e){return e instanceof y?e.retryable:!!(e.message.includes("network")||e.message.includes("timeout")||e.message.includes("fetch"))}static getRetryDelay(e,t){return e instanceof w?Math.min(6e4*e.waitTimeMinutes,3e5):Math.min(1e3*Math.pow(2,t-1),3e5)}}let A=new v;class E{async createTrigger(e){try{if(j.validateTriggerData(e),(await this.storage.getTriggersBySimulator(e.simulatorId)).find(t=>t.phoneNumber===e.phoneNumber&&t.thresholdPercentage===e.thresholdPercentage))throw new b(a.DUPLICATE_TRIGGER,"A trigger with the same phone number and threshold already exists for this simulator");let t=function(e){let t=new Date().toISOString();return{id:"trigger-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),createdAt:t,updatedAt:t,...e}}(e);return await this.storage.saveTrigger(t),t}catch(e){throw A.handleError(e,"createTrigger"),e}}async updateTrigger(e,t){let s=await this.storage.getTrigger(e);if(!s)throw Error("Trigger with id ".concat(e," not found"));if(t.phoneNumber||t.thresholdPercentage||t.simulatorId){let r={phoneNumber:t.phoneNumber||s.phoneNumber,thresholdPercentage:t.thresholdPercentage||s.thresholdPercentage,simulatorId:t.simulatorId||s.simulatorId},a=function(e){let t=[],s=d(e.phoneNumber);s.isValid||t.push(s.error);let r=h(e.thresholdPercentage);return r.isValid||t.push(r.error),e.simulatorId&&"string"==typeof e.simulatorId&&0!==e.simulatorId.trim().length||t.push("Simulator ID is required"),{isValid:0===t.length,errors:t}}(r);if(!a.isValid)throw Error("Validation failed: ".concat(a.errors.join(", ")));if((await this.storage.getTriggersBySimulator(r.simulatorId)).find(t=>t.id!==e&&t.phoneNumber===r.phoneNumber&&t.thresholdPercentage===r.thresholdPercentage))throw Error("A trigger with the same phone number and threshold already exists for this simulator")}await this.storage.updateTrigger(e,t);let r=await this.storage.getTrigger(e);if(!r)throw Error("Failed to retrieve updated trigger");return r}async deleteTrigger(e){if(!await this.storage.getTrigger(e))throw Error("Trigger with id ".concat(e," not found"));await this.storage.deleteTrigger(e)}async getTrigger(e){return await this.storage.getTrigger(e)}async getTriggersBySimulator(e){return await this.storage.getTriggersBySimulator(e)}async getAllTriggers(){return await this.storage.getAllTriggers()}async getActiveTriggersBySimulator(e){return(await this.storage.getTriggersBySimulator(e)).filter(e=>e.isActive)}async checkThresholds(e,t){try{let s=await this.storage.getSettings();if(!s.enabledGlobally)return;for(let r of(await this.getActiveTriggersBySimulator(e)))t>=r.thresholdPercentage&&await this.processTrigger(r,t,s)}catch(e){console.error("Error checking thresholds:",e)}}async processTrigger(e,t,s){try{let r=await this.storage.getLastNotificationTime(e.id);if(r&&(Date.now()-r.getTime())/6e4<s.cooldownMinutes)return;let a=new Date;if(a.setHours(0,0,0,0),(await this.getTodayNotificationHistory(e.id,a)).length>=s.maxDailyNotifications)return;let i=await this.sendNotification(e,t),n=f(e,t,i,i?void 0:"Failed to send WhatsApp message");await this.storage.saveNotificationHistory(n),i&&await this.storage.setLastNotificationTime(e.id,new Date)}catch(r){console.error("Error processing trigger:",r);let s=f(e,t,!1,r instanceof Error?r.message:"Unknown error");await this.storage.saveNotificationHistory(s)}}async sendNotification(e,t){try{if(!(await (0,p.n_)()).ready)throw S.handleWhatsAppError({code:"API_UNAVAILABLE",message:"WhatsApp API is not ready"},e.phoneNumber);let s=this.createNotificationMessage(e.simulatorId,t,e.thresholdPercentage),r=await (0,p.U3)({to:e.phoneNumber,message:s});if(!r.success)throw S.handleWhatsAppError({message:r.error||"Failed to send WhatsApp message"},e.phoneNumber);return!0}catch(e){return console.error("Failed to send notification:",A.handleError(e,"sendNotification").message),!1}}createNotificationMessage(e,t,s){let r=new Date().toLocaleString();return"\uD83D\uDEA8 EMS Alert: Energy Usage Threshold Exceeded\n\nSimulator: ".concat(e,"\nCurrent Usage: ").concat(t.toFixed(1),"% of target\nThreshold: ").concat(s,"%\n\nTime: ").concat(r,"\n\nPlease check your energy consumption and take appropriate action.")}async getNotificationHistory(e,t){return await this.storage.getNotificationHistory(e,t)}async getAllNotificationHistory(e){return await this.storage.getAllNotificationHistory(e)}async getTodayNotificationHistory(e,t){let s=await this.storage.getAllNotificationHistory(1e3),r=new Date(t);return r.setDate(r.getDate()+1),s.filter(s=>{let a=new Date(s.sentAt);return s.triggerId===e&&a>=t&&a<r})}async getSettings(){return await this.storage.getSettings()}async updateSettings(e){try{return j.validateNotificationSettings(e),await this.storage.updateSettings(e),await this.storage.getSettings()}catch(e){throw A.handleError(e,"updateSettings"),e}}async getSystemStatus(){try{let[e,t,s,r]=await Promise.all([(0,p.n_)(),this.getAllTriggers(),this.getSettings(),this.getAllNotificationHistory(50)]),a=t.filter(e=>e.isActive),i=new Date(Date.now()-864e5),n=r.filter(e=>new Date(e.sentAt)>i).length;return{whatsappReady:e.ready,totalTriggers:t.length,activeTriggers:a.length,notificationsEnabled:s.enabledGlobally,recentNotifications:n}}catch(e){return console.error("Error getting system status:",e),{whatsappReady:!1,totalTriggers:0,activeTriggers:0,notificationsEnabled:!1,recentNotifications:0}}}async toggleTrigger(e,t){return await this.updateTrigger(e,{isActive:t})}async bulkToggleTriggers(e,t){for(let s of(await this.getTriggersBySimulator(e)))await this.updateTrigger(s.id,{isActive:t})}async clearNotificationHistory(e){if(e)throw(await this.storage.getAllNotificationHistory(1e4)).filter(t=>t.simulatorId!==e),Error("Selective history clearing not yet implemented");await this.storage.clearAllData()}constructor(e){this.storage=e||new x}}let T=new E;function I(e){var t,s;let{simulatorId:r,trigger:a,onSave:m,onCancel:g,isLoading:x=!1}=e,[f,p]=(0,n.useState)({phoneNumber:(null==a?void 0:a.phoneNumber)||"",thresholdPercentage:(null==a?void 0:null===(t=a.thresholdPercentage)||void 0===t?void 0:t.toString())||"",isActive:null===(s=null==a?void 0:a.isActive)||void 0===s||s}),[b,N]=(0,n.useState)({}),[w,y]=(0,n.useState)(!1),[v,j]=(0,n.useState)(!1),S=!!a;(0,n.useEffect)(()=>{a?p({phoneNumber:a.phoneNumber,thresholdPercentage:a.thresholdPercentage.toString(),isActive:a.isActive}):p({phoneNumber:"",thresholdPercentage:"",isActive:!0}),N({}),j(!1)},[a]);let A=(e,t)=>{switch(e){case"phoneNumber":if(!t||"string"!=typeof t)return"Phone number is required";let s=d(t);return s.isValid?void 0:s.error;case"thresholdPercentage":if(!t||"string"!=typeof t)return"Threshold percentage is required";let r=h(t);return r.isValid?void 0:r.error;default:return}},E=(e,t)=>{if(p(s=>({...s,[e]:t})),j(!0),b[e]&&N(t=>({...t,[e]:void 0})),"phoneNumber"===e||"thresholdPercentage"===e){let s=A(e,t);s&&N(t=>({...t,[e]:s}))}},I=()=>{let e={},t=A("phoneNumber",f.phoneNumber);t&&(e.phoneNumber=t);let s=A("thresholdPercentage",f.thresholdPercentage);return s&&(e.thresholdPercentage=s),N(e),0===Object.keys(e).length},R=async e=>{if(e.preventDefault(),I()){y(!0),N({});try{let e=parseFloat(f.thresholdPercentage);if(S&&a){let t={phoneNumber:f.phoneNumber,thresholdPercentage:e,isActive:f.isActive},s=await T.updateTrigger(a.id,t);m(s)}else{let t={simulatorId:r,phoneNumber:f.phoneNumber,thresholdPercentage:e,isActive:f.isActive},s=await T.createTrigger(t);m(s)}}catch(e){console.error("Error saving trigger:",e),N({general:e instanceof Error?e.message:"Failed to save trigger"})}finally{y(!1)}}};return(0,i.jsxs)(c.Zb,{children:[(0,i.jsxs)(c.Ol,{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:S?"Edit Notification Trigger":"Create Notification Trigger"}),(0,i.jsx)("p",{className:"text-sm text-slate-400",children:S?"Update the notification settings for this trigger":"Set up a new WhatsApp notification when energy usage exceeds the threshold"})]}),(0,i.jsx)(c.aY,{children:(0,i.jsxs)("form",{onSubmit:R,className:"space-y-6",children:[b.general&&(0,i.jsx)("div",{className:"p-3 rounded-md bg-danger/10 border border-danger/20",children:(0,i.jsx)("p",{className:"text-sm text-danger",children:b.general})}),(0,i.jsx)(l.SP,{label:"WhatsApp Phone Number",error:b.phoneNumber,helperText:"Enter phone number with country code (e.g., +60123456789)",required:!0,children:(0,i.jsx)(l.II,{type:"tel",value:f.phoneNumber,onChange:e=>E("phoneNumber",e.target.value),placeholder:"+60123456789",error:!!b.phoneNumber,disabled:w||x})}),f.phoneNumber&&!b.phoneNumber&&(0,i.jsxs)("div",{className:"text-xs text-slate-400",children:["Formatted: ",(e=>{if(!e)return e;let t=d(e);return t.isValid&&t.formattedNumber?u(t.formattedNumber):e})(f.phoneNumber)]}),(0,i.jsx)(l.SP,{label:"Threshold Percentage",error:b.thresholdPercentage,helperText:"Notification will be sent when usage reaches this percentage (1-200%)",required:!0,children:(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(l.II,{type:"number",min:"1",max:"200",step:"0.1",value:f.thresholdPercentage,onChange:e=>E("thresholdPercentage",e.target.value),placeholder:"80",error:!!b.thresholdPercentage,disabled:w||x,className:"pr-8"}),(0,i.jsx)("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm",children:"%"})]})}),(0,i.jsx)(l.SP,{label:"Status",helperText:"Enable or disable this notification trigger",children:(0,i.jsxs)(l.Ph,{value:f.isActive?"active":"inactive",onChange:e=>E("isActive","active"===e.target.value),disabled:w||x,children:[(0,i.jsx)("option",{value:"active",children:"Active - Notifications enabled"}),(0,i.jsx)("option",{value:"inactive",children:"Inactive - Notifications disabled"})]})}),(0,i.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,i.jsx)(o.z,{type:"submit",isLoading:w,disabled:x||!v||Object.keys(b).length>0,className:"flex-1",children:w?S?"Updating...":"Creating...":S?"Update Trigger":"Create Trigger"}),(0,i.jsx)(o.z,{type:"button",variant:"secondary",onClick:()=>{(!v||window.confirm("You have unsaved changes. Are you sure you want to cancel?"))&&g()},disabled:w||x,children:"Cancel"})]})]})})]})}var R=s(85130);let O=n.forwardRef(function(e,t){let{title:s,titleId:r,...a}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},a),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}),D=n.forwardRef(function(e,t){let{title:s,titleId:r,...a}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},a),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.636 5.636a9 9 0 1 0 12.728 0M12 3v9"}))}),P=n.forwardRef(function(e,t){let{title:s,titleId:r,...a}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},a),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))}),L=n.forwardRef(function(e,t){let{title:s,titleId:r,...a}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},a),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))});var k=s(11853),C=s(44839);function M(e){let{trigger:t,onEdit:s,onDelete:r,onToggle:a,isLoading:l}=e,[d,h]=(0,n.useState)(!1),[m,g]=(0,n.useState)(!1),x=async()=>{if(window.confirm("Are you sure you want to delete this notification trigger?\n\nPhone: ".concat(u(t.phoneNumber),"\nThreshold: ").concat(t.thresholdPercentage,"%\n\nThis action cannot be undone."))){h(!0);try{await r(t.id)}catch(e){console.error("Error deleting trigger:",e)}finally{h(!1)}}},f=async()=>{g(!0);try{await a(t.id,!t.isActive)}catch(e){console.error("Error toggling trigger:",e)}finally{g(!1)}},p=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return(0,i.jsx)(c.Zb,{className:(0,C.Z)("transition-all duration-200",t.isActive?"border-slate-700 bg-slate-900/60":"border-slate-800 bg-slate-900/30 opacity-75"),children:(0,i.jsx)(c.aY,{className:"p-4",children:(0,i.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,i.jsxs)("div",{className:(0,C.Z)("flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium",t.isActive?"bg-success/10 text-success border border-success/20":"bg-slate-700/50 text-slate-400 border border-slate-700"),children:[t.isActive?(0,i.jsx)(R.Z,{className:"h-3 w-3"}):(0,i.jsx)(O,{className:"h-3 w-3"}),t.isActive?"Active":"Inactive"]}),(0,i.jsxs)("div",{className:"px-2 py-1 rounded-full bg-primary/10 text-primary border border-primary/20 text-xs font-medium",children:[t.thresholdPercentage,"% threshold"]})]}),(0,i.jsxs)("div",{className:"mb-2",children:[(0,i.jsx)("p",{className:"text-sm font-medium text-white",children:u(t.phoneNumber)}),(0,i.jsxs)("p",{className:"text-xs text-slate-400",children:["WhatsApp notifications when usage ≥ ",t.thresholdPercentage,"%"]})]}),(0,i.jsxs)("div",{className:"flex flex-wrap gap-4 text-xs text-slate-500",children:[(0,i.jsxs)("span",{children:["Created: ",p(t.createdAt)]}),t.updatedAt!==t.createdAt&&(0,i.jsxs)("span",{children:["Updated: ",p(t.updatedAt)]})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(o.z,{variant:"ghost",size:"sm",onClick:f,disabled:l||m||d,isLoading:m,className:(0,C.Z)("h-8 w-8 p-0",t.isActive?"text-slate-400 hover:text-orange-400":"text-slate-500 hover:text-success"),title:t.isActive?"Disable notifications":"Enable notifications",children:(0,i.jsx)(D,{className:"h-4 w-4"})}),(0,i.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>s(t),disabled:l||m||d,className:"h-8 w-8 p-0 text-slate-400 hover:text-primary",title:"Edit trigger",children:(0,i.jsx)(P,{className:"h-4 w-4"})}),(0,i.jsx)(o.z,{variant:"ghost",size:"sm",onClick:x,disabled:l||m||d,isLoading:d,className:"h-8 w-8 p-0 text-slate-400 hover:text-danger",title:"Delete trigger",children:(0,i.jsx)(L,{className:"h-4 w-4"})})]})]})})})}function _(e){let{triggers:t,onEdit:s,onDelete:r,onToggle:a,isLoading:l=!1}=e,[d,h]=(0,n.useState)("created"),[u,m]=(0,n.useState)("all"),g=t.filter(e=>"all"===u||("active"===u?e.isActive:!e.isActive)).sort((e,t)=>{switch(d){case"threshold":return e.thresholdPercentage-t.thresholdPercentage;case"status":return Number(t.isActive)-Number(e.isActive);default:return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()}}),x=t.filter(e=>e.isActive).length,f=t.filter(e=>!e.isActive).length;return 0===t.length?(0,i.jsx)(c.Zb,{children:(0,i.jsxs)(c.aY,{className:"p-8 text-center",children:[(0,i.jsx)(k.Z,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"No Notification Triggers"}),(0,i.jsx)("p",{className:"text-slate-400 mb-4",children:"You haven't set up any WhatsApp notification triggers yet."}),(0,i.jsx)("p",{className:"text-sm text-slate-500",children:"Create your first trigger to receive alerts when energy usage exceeds your specified thresholds."})]})}):(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(c.Zb,{children:(0,i.jsx)(c.Ol,{className:"pb-4",children:(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Notification Triggers"}),(0,i.jsxs)("div",{className:"flex items-center gap-4 text-sm text-slate-400 mt-1",children:[(0,i.jsxs)("span",{children:[t.length," total"]}),(0,i.jsxs)("span",{className:"text-success",children:[x," active"]}),(0,i.jsxs)("span",{className:"text-slate-500",children:[f," inactive"]})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsxs)("select",{value:u,onChange:e=>m(e.target.value),className:"px-3 py-1.5 text-sm rounded-md border border-slate-700 bg-slate-800 text-white focus:border-primary focus:outline-none",disabled:l,children:[(0,i.jsx)("option",{value:"all",children:"All Status"}),(0,i.jsx)("option",{value:"active",children:"Active Only"}),(0,i.jsx)("option",{value:"inactive",children:"Inactive Only"})]}),(0,i.jsxs)("select",{value:d,onChange:e=>h(e.target.value),className:"px-3 py-1.5 text-sm rounded-md border border-slate-700 bg-slate-800 text-white focus:border-primary focus:outline-none",disabled:l,children:[(0,i.jsx)("option",{value:"created",children:"Sort by Created"}),(0,i.jsx)("option",{value:"threshold",children:"Sort by Threshold"}),(0,i.jsx)("option",{value:"status",children:"Sort by Status"})]})]})]})})}),0===g.length?(0,i.jsx)(c.Zb,{children:(0,i.jsx)(c.aY,{className:"p-6 text-center",children:(0,i.jsx)("p",{className:"text-slate-400",children:"No triggers match the current filter criteria."})})}):(0,i.jsx)("div",{className:"space-y-3",children:g.map(e=>(0,i.jsx)(M,{trigger:e,onEdit:s,onDelete:r,onToggle:a,isLoading:l},e.id))}),t.length>1&&(0,i.jsx)(c.Zb,{children:(0,i.jsx)(c.aY,{className:"p-4",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{className:"text-sm text-slate-400",children:"Bulk Actions"}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>{let e=t.filter(e=>!e.isActive);0!==e.length&&window.confirm("Enable notifications for ".concat(e.length," inactive trigger(s)?"))&&e.forEach(e=>a(e.id,!0))},disabled:l||0===f,className:"text-success hover:text-success",children:"Enable All"}),(0,i.jsx)(o.z,{variant:"ghost",size:"sm",onClick:()=>{let e=t.filter(e=>e.isActive);0!==e.length&&window.confirm("Disable notifications for ".concat(e.length," active trigger(s)?"))&&e.forEach(e=>a(e.id,!1))},disabled:l||0===x,className:"text-orange-400 hover:text-orange-300",children:"Disable All"})]})]})})})]})}var G=s(39519);let V=n.forwardRef(function(e,t){let{title:s,titleId:r,...a}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},a),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))});var Z=s(76218);function H(e){let{history:t}=e,[s,r]=(0,n.useState)(!1);return(0,i.jsx)(c.Zb,{className:(0,C.Z)("transition-all duration-200",t.success?"border-slate-700 bg-slate-900/60":"border-red-900/30 bg-red-900/10"),children:(0,i.jsx)(c.aY,{className:"p-4",children:(0,i.jsx)("div",{className:"flex items-start justify-between gap-4",children:(0,i.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,i.jsxs)("div",{className:(0,C.Z)("flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium border",t.success?"text-success bg-success/10 border-success/20":"text-danger bg-danger/10 border-danger/20"),children:[t.success?(0,i.jsx)(R.Z,{className:"h-3 w-3"}):(0,i.jsx)(G.Z,{className:"h-3 w-3"}),t.success?"Sent":"Failed"]}),(0,i.jsxs)("div",{className:"px-2 py-1 rounded-full bg-slate-700/50 text-slate-300 text-xs",children:[t.actualPercentage.toFixed(1),"% / ",t.thresholdPercentage,"%"]}),(0,i.jsxs)("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[(0,i.jsx)(O,{className:"h-3 w-3"}),(e=>{let t=new Date(e),s=new Date,r=s.getTime()-t.getTime(),a=Math.floor(r/6e4),i=Math.floor(r/36e5),n=Math.floor(r/864e5);return a<1?"Just now":a<60?"".concat(a,"m ago"):i<24?"".concat(i,"h ago"):n<7?"".concat(n,"d ago"):t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==s.getFullYear()?"numeric":void 0,hour:"2-digit",minute:"2-digit"})})(t.sentAt)]})]}),(0,i.jsxs)("div",{className:"mb-2",children:[(0,i.jsx)("p",{className:"text-sm font-medium text-white",children:u(t.phoneNumber)}),(0,i.jsxs)("p",{className:"text-xs text-slate-400",children:["Usage reached ",t.actualPercentage.toFixed(1),"% (threshold: ",t.thresholdPercentage,"%)"]})]}),!t.success&&t.errorMessage&&(0,i.jsx)("div",{className:"mt-2 p-2 rounded bg-red-900/20 border border-red-900/30",children:(0,i.jsxs)("p",{className:"text-xs text-red-300",children:["Error: ",t.errorMessage]})}),!t.success&&(0,i.jsx)("button",{onClick:()=>r(!s),className:"mt-2 text-xs text-slate-400 hover:text-slate-300 underline",children:s?"Hide Details":"Show Details"}),s&&!t.success&&(0,i.jsx)("div",{className:"mt-2 p-3 rounded bg-slate-800/50 border border-slate-700",children:(0,i.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-slate-400",children:"Trigger ID:"}),(0,i.jsx)("span",{className:"ml-2 text-slate-300 font-mono",children:t.triggerId})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-slate-400",children:"Simulator ID:"}),(0,i.jsx)("span",{className:"ml-2 text-slate-300 font-mono",children:t.simulatorId})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("span",{className:"text-slate-400",children:"Sent At:"}),(0,i.jsx)("span",{className:"ml-2 text-slate-300",children:new Date(t.sentAt).toLocaleString()})]})]})})]})})})})}function W(e){let{simulatorId:t,limit:s=50}=e,[r,a]=(0,n.useState)([]),[l,d]=(0,n.useState)(!0),[h,u]=(0,n.useState)(null),[m,g]=(0,n.useState)({status:"all",timeRange:"all"});(0,n.useEffect)(()=>{x()},[t,s]);let x=async()=>{try{d(!0),u(null);let e=await T.getNotificationHistory(t,s);a(e)}catch(e){console.error("Error loading notification history:",e),u(e instanceof Error?e.message:"Failed to load notification history")}finally{d(!1)}},f=r.filter(e=>{if("all"!==m.status&&!("success"===m.status?e.success:!e.success))return!1;if("all"!==m.timeRange){let t=new Date,s=new Date(e.sentAt),r=t.getTime()-s.getTime();switch(m.timeRange){case"24h":if(r>864e5)return!1;break;case"7d":if(r>6048e5)return!1;break;case"30d":if(r>2592e6)return!1}}return!0}),p=r.filter(e=>e.success).length,b=r.filter(e=>!e.success).length;return l?(0,i.jsx)(c.Zb,{children:(0,i.jsxs)(c.aY,{className:"p-8 text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,i.jsx)("p",{className:"text-slate-400",children:"Loading notification history..."})]})}):h?(0,i.jsx)(c.Zb,{children:(0,i.jsxs)(c.aY,{className:"p-8 text-center",children:[(0,i.jsx)(k.Z,{className:"h-12 w-12 text-danger mx-auto mb-4"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"Error Loading History"}),(0,i.jsx)("p",{className:"text-slate-400 mb-4",children:h}),(0,i.jsx)(o.z,{onClick:x,variant:"secondary",children:"Try Again"})]})}):0===r.length?(0,i.jsx)(c.Zb,{children:(0,i.jsxs)(c.aY,{className:"p-8 text-center",children:[(0,i.jsx)(O,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"No Notification History"}),(0,i.jsx)("p",{className:"text-slate-400 mb-4",children:"No notifications have been sent for this simulator yet."}),(0,i.jsx)("p",{className:"text-sm text-slate-500",children:"History will appear here once notification triggers are activated and thresholds are exceeded."})]})}):(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsx)(c.Zb,{children:(0,i.jsx)(c.Ol,{className:"pb-4",children:(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Notification History"}),(0,i.jsxs)("div",{className:"flex items-center gap-4 text-sm text-slate-400 mt-1",children:[(0,i.jsxs)("span",{children:[r.length," total"]}),(0,i.jsxs)("span",{className:"text-success",children:[p," sent"]}),(0,i.jsxs)("span",{className:"text-danger",children:[b," failed"]})]})]}),(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsxs)("div",{className:"flex items-center gap-2",children:[(0,i.jsx)(V,{className:"h-4 w-4 text-slate-400"}),(0,i.jsxs)("select",{value:m.status,onChange:e=>g(t=>({...t,status:e.target.value})),className:"px-3 py-1.5 text-sm rounded-md border border-slate-700 bg-slate-800 text-white focus:border-primary focus:outline-none",children:[(0,i.jsx)("option",{value:"all",children:"All Status"}),(0,i.jsx)("option",{value:"success",children:"Sent Only"}),(0,i.jsx)("option",{value:"failed",children:"Failed Only"})]})]}),(0,i.jsxs)("select",{value:m.timeRange,onChange:e=>g(t=>({...t,timeRange:e.target.value})),className:"px-3 py-1.5 text-sm rounded-md border border-slate-700 bg-slate-800 text-white focus:border-primary focus:outline-none",children:[(0,i.jsx)("option",{value:"all",children:"All Time"}),(0,i.jsx)("option",{value:"24h",children:"Last 24 Hours"}),(0,i.jsx)("option",{value:"7d",children:"Last 7 Days"}),(0,i.jsx)("option",{value:"30d",children:"Last 30 Days"})]}),(0,i.jsxs)(o.z,{variant:"ghost",size:"sm",onClick:()=>{let e=new Blob([["Date,Phone Number,Threshold %,Actual %,Status,Error Message",...f.map(e=>[new Date(e.sentAt).toISOString(),e.phoneNumber,e.thresholdPercentage,e.actualPercentage.toFixed(1),e.success?"Success":"Failed",e.errorMessage||""].map(e=>'"'.concat(e,'"')).join(","))].join("\n")],{type:"text/csv"}),s=URL.createObjectURL(e),r=document.createElement("a");r.href=s,r.download="notification-history-".concat(t,"-").concat(new Date().toISOString().split("T")[0],".csv"),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)},disabled:0===f.length,className:"flex items-center gap-2",children:[(0,i.jsx)(Z.Z,{className:"h-4 w-4"}),"Export CSV"]})]})]})})}),0===f.length?(0,i.jsx)(c.Zb,{children:(0,i.jsx)(c.aY,{className:"p-6 text-center",children:(0,i.jsx)("p",{className:"text-slate-400",children:"No notifications match the current filter criteria."})})}):(0,i.jsx)("div",{className:"space-y-3",children:f.map(e=>(0,i.jsx)(H,{history:e},e.id))}),r.length>=s&&(0,i.jsx)(c.Zb,{children:(0,i.jsx)(c.aY,{className:"p-4 text-center",children:(0,i.jsx)(o.z,{variant:"ghost",onClick:()=>x(),className:"text-slate-400 hover:text-white",children:"Load More History"})})})]})}function U(e){let{settings:t,onSave:s,onCancel:r,isLoading:a=!1}=e,[d,h]=(0,n.useState)({enabledGlobally:t.enabledGlobally,cooldownMinutes:t.cooldownMinutes.toString(),maxDailyNotifications:t.maxDailyNotifications.toString()}),[u,m]=(0,n.useState)({}),[g,x]=(0,n.useState)(!1),[f,p]=(0,n.useState)(!1);(0,n.useEffect)(()=>{h({enabledGlobally:t.enabledGlobally,cooldownMinutes:t.cooldownMinutes.toString(),maxDailyNotifications:t.maxDailyNotifications.toString()}),m({}),p(!1)},[t]);let b=(e,t)=>{switch(e){case"cooldownMinutes":if(!t||"string"!=typeof t)return"Cooldown minutes is required";let s=parseInt(t);if(isNaN(s))return"Cooldown must be a valid number";if(s<1)return"Cooldown must be at least 1 minute";if(s>1440)return"Cooldown cannot exceed 1440 minutes (24 hours)";return;case"maxDailyNotifications":if(!t||"string"!=typeof t)return"Max daily notifications is required";let r=parseInt(t);if(isNaN(r))return"Max daily notifications must be a valid number";if(r<1)return"Must allow at least 1 notification per day";if(r>100)return"Cannot exceed 100 notifications per day";return;default:return}},N=(e,t)=>{if(h(s=>({...s,[e]:t})),p(!0),u[e]&&m(t=>({...t,[e]:void 0})),"cooldownMinutes"===e||"maxDailyNotifications"===e){let s=b(e,t);s&&m(t=>({...t,[e]:s}))}},w=()=>{let e={},t=b("cooldownMinutes",d.cooldownMinutes);t&&(e.cooldownMinutes=t);let s=b("maxDailyNotifications",d.maxDailyNotifications);return s&&(e.maxDailyNotifications=s),m(e),0===Object.keys(e).length},y=async e=>{if(e.preventDefault(),w()){x(!0),m({});try{let e={enabledGlobally:d.enabledGlobally,cooldownMinutes:parseInt(d.cooldownMinutes),maxDailyNotifications:parseInt(d.maxDailyNotifications)},t=await T.updateSettings(e);s(t)}catch(e){console.error("Error saving settings:",e),m({general:e instanceof Error?e.message:"Failed to save settings"})}finally{x(!1)}}};return(0,i.jsxs)(c.Zb,{children:[(0,i.jsxs)(c.Ol,{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Notification Settings"}),(0,i.jsx)("p",{className:"text-sm text-slate-400",children:"Configure global notification behavior and rate limiting"})]}),(0,i.jsx)(c.aY,{children:(0,i.jsxs)("form",{onSubmit:y,className:"space-y-6",children:[u.general&&(0,i.jsx)("div",{className:"p-3 rounded-md bg-danger/10 border border-danger/20",children:(0,i.jsx)("p",{className:"text-sm text-danger",children:u.general})}),(0,i.jsx)(l.SP,{label:"Global Notifications",helperText:"Master switch to enable or disable all notifications system-wide",children:(0,i.jsxs)(l.Ph,{value:d.enabledGlobally?"enabled":"disabled",onChange:e=>N("enabledGlobally","enabled"===e.target.value),disabled:g||a,children:[(0,i.jsx)("option",{value:"enabled",children:"✅ Enabled - Notifications will be sent"}),(0,i.jsx)("option",{value:"disabled",children:"❌ Disabled - All notifications paused"})]})}),(0,i.jsxs)(l.SP,{label:"Cooldown Period",error:u.cooldownMinutes,helperText:"Minimum time between notifications for the same trigger (1-1440 minutes)",required:!0,children:[(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(l.II,{type:"number",min:"1",max:"1440",value:d.cooldownMinutes,onChange:e=>N("cooldownMinutes",e.target.value),placeholder:"15",error:!!u.cooldownMinutes,disabled:g||a,className:"pr-20"}),(0,i.jsx)("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm",children:"minutes"})]}),(0,i.jsxs)("div",{className:"mt-1 text-xs text-slate-500",children:["Current: ",parseInt(d.cooldownMinutes)||0," minutes",parseInt(d.cooldownMinutes)>=60&&" (".concat(Math.floor(parseInt(d.cooldownMinutes)/60),"h ").concat(parseInt(d.cooldownMinutes)%60,"m)")]})]}),(0,i.jsx)(l.SP,{label:"Daily Notification Limit",error:u.maxDailyNotifications,helperText:"Maximum notifications per trigger per day (1-100)",required:!0,children:(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(l.II,{type:"number",min:"1",max:"100",value:d.maxDailyNotifications,onChange:e=>N("maxDailyNotifications",e.target.value),placeholder:"10",error:!!u.maxDailyNotifications,disabled:g||a,className:"pr-16"}),(0,i.jsx)("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm",children:"per day"})]})}),(0,i.jsxs)("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700",children:[(0,i.jsx)("h4",{className:"text-sm font-medium text-white mb-3",children:"Settings Preview"}),(0,i.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-slate-400",children:"Status:"}),(0,i.jsx)("span",{className:d.enabledGlobally?"text-success":"text-slate-400",children:d.enabledGlobally?"Notifications Enabled":"Notifications Disabled"})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-slate-400",children:"Cooldown:"}),(0,i.jsxs)("span",{className:"text-slate-300",children:[parseInt(d.cooldownMinutes)||0," minutes between notifications"]})]}),(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)("span",{className:"text-slate-400",children:"Daily Limit:"}),(0,i.jsxs)("span",{className:"text-slate-300",children:[parseInt(d.maxDailyNotifications)||0," notifications per trigger per day"]})]})]})]}),(0,i.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,i.jsx)(o.z,{type:"submit",isLoading:g,disabled:a||!f||Object.keys(u).length>0,className:"flex-1",children:g?"Saving...":"Save Settings"}),(0,i.jsx)(o.z,{type:"button",variant:"secondary",onClick:()=>{window.confirm("Reset all settings to default values?")&&(h({enabledGlobally:!0,cooldownMinutes:"15",maxDailyNotifications:"10"}),p(!0),m({}))},disabled:g||a,children:"Reset"}),(0,i.jsx)(o.z,{type:"button",variant:"ghost",onClick:()=>{(!f||window.confirm("You have unsaved changes. Are you sure you want to cancel?"))&&r()},disabled:g||a,children:"Cancel"})]})]})})]})}var B=s(23047);let J=n.forwardRef(function(e,t){let{title:s,titleId:r,...a}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},a),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}),Y=n.forwardRef(function(e,t){let{title:s,titleId:r,...a}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":r},a),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))});function z(e){let{simulatorId:t,simulatorName:s}=e,[r,a]=(0,n.useState)([]),[l,d]=(0,n.useState)(null),[h,u]=(0,n.useState)(!0),[m,g]=(0,n.useState)(null),[x,f]=(0,n.useState)("triggers"),[p,b]=(0,n.useState)(null),[N,w]=(0,n.useState)(null),[y,v]=(0,n.useState)(null);(0,n.useEffect)(()=>{j()},[t]);let j=async()=>{try{u(!0),g(null);let[e,s,r]=await Promise.all([T.getTriggersBySimulator(t),T.getSettings(),T.getSystemStatus()]);a(e),d(s),v(r)}catch(e){console.error("Error loading notification data:",e),g(e instanceof Error?e.message:"Failed to load notification data")}finally{u(!1)}},S=async e=>{N?a(t=>t.map(t=>t.id===e.id?e:t)):a(t=>[...t,e]),b(null),w(null),v(await T.getSystemStatus())},A=async e=>{try{await T.deleteTrigger(e),a(t=>t.filter(t=>t.id!==e));let t=await T.getSystemStatus();v(t)}catch(e){console.error("Error deleting trigger:",e),alert("Failed to delete trigger: "+(e instanceof Error?e.message:"Unknown error"))}},E=async(e,t)=>{try{let s=await T.toggleTrigger(e,t);a(t=>t.map(t=>t.id===e?s:t));let r=await T.getSystemStatus();v(r)}catch(e){console.error("Error toggling trigger:",e),alert("Failed to update trigger: "+(e instanceof Error?e.message:"Unknown error"))}},O=async e=>{d(e),b(null),v(await T.getSystemStatus())},D=()=>{b(null),w(null)};return h?(0,i.jsx)(c.Zb,{children:(0,i.jsxs)(c.aY,{className:"p-8 text-center",children:[(0,i.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),(0,i.jsx)("p",{className:"text-slate-400",children:"Loading notification system..."})]})}):m?(0,i.jsx)(c.Zb,{children:(0,i.jsxs)(c.aY,{className:"p-8 text-center",children:[(0,i.jsx)(k.Z,{className:"h-12 w-12 text-danger mx-auto mb-4"}),(0,i.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"Error Loading Notifications"}),(0,i.jsx)("p",{className:"text-slate-400 mb-4",children:m}),(0,i.jsx)(o.z,{onClick:j,variant:"secondary",children:"Try Again"})]})}):(0,i.jsxs)("div",{className:"space-y-6",children:[(0,i.jsx)(c.Zb,{children:(0,i.jsx)(c.Ol,{children:(0,i.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[(0,i.jsx)(B.Z,{className:"h-6 w-6"}),"WhatsApp Notifications"]}),(0,i.jsx)("p",{className:"text-slate-400 mt-1",children:s?"Manage notifications for ".concat(s):"Simulator: ".concat(t)})]}),y&&(0,i.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,i.jsxs)("div",{className:(0,C.Z)("flex items-center gap-1.5 px-2 py-1 rounded-full border",y.whatsappReady?"bg-success/10 text-success border-success/20":"bg-danger/10 text-danger border-danger/20"),children:[y.whatsappReady?(0,i.jsx)(R.Z,{className:"h-3 w-3"}):(0,i.jsx)(k.Z,{className:"h-3 w-3"}),"WhatsApp ",y.whatsappReady?"Ready":"Not Ready"]}),(0,i.jsxs)("div",{className:(0,C.Z)("flex items-center gap-1.5 px-2 py-1 rounded-full border",y.notificationsEnabled?"bg-primary/10 text-primary border-primary/20":"bg-slate-700/50 text-slate-400 border-slate-700"),children:[(0,i.jsx)(B.Z,{className:"h-3 w-3"}),y.notificationsEnabled?"Enabled":"Disabled"]}),(0,i.jsxs)("div",{className:"text-slate-400",children:[y.activeTriggers," / ",y.totalTriggers," active"]})]})]})})}),(0,i.jsx)(c.Zb,{children:(0,i.jsx)(c.aY,{className:"p-0",children:(0,i.jsxs)("div",{className:"flex border-b border-slate-700",children:[(0,i.jsxs)("button",{onClick:()=>f("triggers"),className:(0,C.Z)("flex-1 px-6 py-4 text-sm font-medium transition-colors","triggers"===x?"text-primary border-b-2 border-primary bg-primary/5":"text-slate-400 hover:text-white"),children:["Triggers (",r.length,")"]}),(0,i.jsx)("button",{onClick:()=>f("history"),className:(0,C.Z)("flex-1 px-6 py-4 text-sm font-medium transition-colors","history"===x?"text-primary border-b-2 border-primary bg-primary/5":"text-slate-400 hover:text-white"),children:"History"}),(0,i.jsx)("button",{onClick:()=>f("settings"),className:(0,C.Z)("flex-1 px-6 py-4 text-sm font-medium transition-colors","settings"===x?"text-primary border-b-2 border-primary bg-primary/5":"text-slate-400 hover:text-white"),children:"Settings"})]})})}),"triggers"===x&&(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Notification Triggers"}),(0,i.jsx)("p",{className:"text-sm text-slate-400",children:"Configure when to send WhatsApp notifications based on energy usage thresholds"})]}),(0,i.jsxs)(o.z,{onClick:()=>{w(null),b("create")},className:"flex items-center gap-2",children:[(0,i.jsx)(J,{className:"h-4 w-4"}),"Add Trigger"]})]}),(0,i.jsx)(_,{triggers:r,onEdit:e=>{w(e),b("edit")},onDelete:A,onToggle:E,isLoading:h})]}),"history"===x&&(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Notification History"}),(0,i.jsx)("p",{className:"text-sm text-slate-400",children:"View all sent and failed notifications for this simulator"})]}),(0,i.jsx)(W,{simulatorId:t})]}),"settings"===x&&(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{className:"flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Notification Settings"}),(0,i.jsx)("p",{className:"text-sm text-slate-400",children:"Configure global notification behavior and rate limiting"})]}),(0,i.jsxs)(o.z,{variant:"ghost",onClick:()=>b("settings"),className:"flex items-center gap-2",children:[(0,i.jsx)(Y,{className:"h-4 w-4"}),"Edit Settings"]})]}),l&&(0,i.jsx)(c.Zb,{children:(0,i.jsx)(c.aY,{className:"p-6",children:(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-sm font-medium text-white mb-2",children:"Global Status"}),(0,i.jsx)("p",{className:(0,C.Z)("text-sm",l.enabledGlobally?"text-success":"text-slate-400"),children:l.enabledGlobally?"Notifications Enabled":"Notifications Disabled"})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-sm font-medium text-white mb-2",children:"Cooldown Period"}),(0,i.jsxs)("p",{className:"text-sm text-slate-300",children:[l.cooldownMinutes," minutes"]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-sm font-medium text-white mb-2",children:"Daily Limit"}),(0,i.jsxs)("p",{className:"text-sm text-slate-300",children:[l.maxDailyNotifications," per trigger"]})]})]})})})]}),("create"===p||"edit"===p)&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,i.jsx)("div",{className:"w-full max-w-md",children:(0,i.jsx)(I,{simulatorId:t,trigger:N||void 0,onSave:S,onCancel:D,isLoading:!1})})}),"settings"===p&&l&&(0,i.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,i.jsx)("div",{className:"w-full max-w-md",children:(0,i.jsx)(U,{settings:l,onSave:O,onCancel:D})})})]})}},48185:function(e,t,s){s.d(t,{Ol:function(){return l},Zb:function(){return o},aY:function(){return c}});var r=s(57437),a=s(2265),i=s(44839);let n={default:"bg-slate-900/60",elevated:"bg-slate-900 shadow-lg",interactive:"cursor-pointer hover:border-primary-700 hover:shadow-lg",flat:"shadow-none"},o=(0,a.forwardRef)((e,t)=>{let{className:s,variant:a="default",...o}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.Z)("rounded-xl border border-slate-800 backdrop-blur-sm shadow-md transition-shadow duration-200",n[a],s),...o})});o.displayName="Card";let l=(0,a.forwardRef)((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.Z)("p-4 sm:p-6 border-b border-slate-800",s),...a})});l.displayName="CardHeader";let c=(0,a.forwardRef)((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.Z)("p-4 sm:p-6",s),...a})});c.displayName="CardContent",(0,a.forwardRef)((e,t)=>{let{className:s,...a}=e;return(0,r.jsx)("div",{ref:t,className:(0,i.Z)("p-4 sm:p-6 border-t border-slate-800",s),...a})}).displayName="CardFooter"},61233:function(e,t,s){async function r(e){try{let t=await fetch("/api/whatsapp/send",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({to:e.to,message:e.message})});if(!t.ok){let e=await t.json().catch(()=>({}));return{success:!1,error:e.error||"Failed to send message: ".concat(t.status," ").concat(t.statusText)}}let s=await t.json();return{success:s.success||!0,id:s.id,to:s.to,message:s.message||"Message sent successfully"}}catch(e){return{success:!1,error:e instanceof Error?e.message:"Network error occurred"}}}async function a(){try{let e=await fetch("/api/whatsapp/status",{method:"GET",headers:{Accept:"application/json"}}),t=await e.json();return{ready:!0===t.ready,hasQR:!0===t.hasQR}}catch(e){return{ready:!1,hasQR:!1}}}async function i(){try{let e=await fetch("/api/whatsapp/qr",{method:"GET",headers:{Accept:"application/json"}});return{qr:(await e.json()).qr||null}}catch(e){return{qr:null}}}s.d(t,{U3:function(){return r},n_:function(){return a},sE:function(){return i}})},23047:function(e,t,s){var r=s(2265);let a=r.forwardRef(function(e,t){let{title:s,titleId:a,...i}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),s?r.createElement("title",{id:a},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0"}))});t.Z=a},85130:function(e,t,s){var r=s(2265);let a=r.forwardRef(function(e,t){let{title:s,titleId:a,...i}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),s?r.createElement("title",{id:a},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});t.Z=a},11853:function(e,t,s){var r=s(2265);let a=r.forwardRef(function(e,t){let{title:s,titleId:a,...i}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),s?r.createElement("title",{id:a},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))});t.Z=a},39519:function(e,t,s){var r=s(2265);let a=r.forwardRef(function(e,t){let{title:s,titleId:a,...i}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":a},i),s?r.createElement("title",{id:a},s):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});t.Z=a},44839:function(e,t,s){t.Z=function(){for(var e,t,s=0,r="",a=arguments.length;s<a;s++)(e=arguments[s])&&(t=function e(t){var s,r,a="";if("string"==typeof t||"number"==typeof t)a+=t;else if("object"==typeof t){if(Array.isArray(t)){var i=t.length;for(s=0;s<i;s++)t[s]&&(r=e(t[s]))&&(a&&(a+=" "),a+=r)}else for(r in t)t[r]&&(a&&(a+=" "),a+=r)}return a}(e))&&(r&&(r+=" "),r+=t);return r}}}]);