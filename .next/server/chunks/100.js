"use strict";exports.id=100,exports.ids=[100],exports.modules={17100:(e,t,s)=>{s.d(t,{fn:()=>Z});var a=s(10326),r=s(17577),i=s(91664),l=s(41190),n=s(29752),o=s(52041),c=s(13798);function d({simulatorId:e,trigger:t,onSave:s,onCancel:d,isLoading:m=!1}){let[x,h]=(0,r.useState)({phoneNumber:t?.phoneNumber||"",thresholdPercentage:t?.thresholdPercentage?.toString()||"",isActive:t?.isActive??!0}),[u,g]=(0,r.useState)({}),[p,b]=(0,r.useState)(!1),[f,j]=(0,r.useState)(!1),N=!!t,v=(e,t)=>{switch(e){case"phoneNumber":if(!t||"string"!=typeof t||""===t.trim())return"Phone number is required";let s=(0,o.Y0)(t);return s.isValid?void 0:s.error;case"thresholdPercentage":if(!t||"string"!=typeof t||""===t.trim())return"Threshold percentage is required";let a=(0,o.c4)(t);return a.isValid?void 0:a.error;default:return}},w=(e,t)=>{if(h(s=>({...s,[e]:t})),j(!0),u[e]&&g(t=>({...t,[e]:void 0})),"phoneNumber"===e||"thresholdPercentage"===e){let s=v(e,t);s?(g(t=>({...t,[e]:s})),console.log(`Validation error for ${e}:`,s)):console.log(`Validation passed for ${e}:`,t)}},y=()=>{let e={},t=v("phoneNumber",x.phoneNumber);t&&(e.phoneNumber=t);let s=v("thresholdPercentage",x.thresholdPercentage);return s&&(e.thresholdPercentage=s),g(e),0===Object.keys(e).length},S=async a=>{if(a.preventDefault(),y()){b(!0),g({});try{let a=parseFloat(x.thresholdPercentage);if(N&&t){let e={phoneNumber:x.phoneNumber,thresholdPercentage:a,isActive:x.isActive},r=await c.O.updateTrigger(t.id,e);s(r)}else{let t={simulatorId:e,phoneNumber:x.phoneNumber,thresholdPercentage:a,isActive:x.isActive},r=await c.O.createTrigger(t);s(r)}}catch(e){console.error("Error saving trigger:",e),g({general:e instanceof Error?e.message:"Failed to save trigger"})}finally{b(!1)}}};return(0,a.jsxs)(n.Zb,{children:[(0,a.jsxs)(n.Ol,{children:[a.jsx("h3",{className:"text-lg font-semibold text-white",children:N?"Edit Notification Trigger":"Create Notification Trigger"}),a.jsx("p",{className:"text-sm text-slate-400",children:N?"Update the notification settings for this trigger":"Set up a new WhatsApp notification when energy usage exceeds the threshold"})]}),a.jsx(n.aY,{children:(0,a.jsxs)("form",{onSubmit:S,className:"space-y-6",children:[u.general&&a.jsx("div",{className:"p-3 rounded-md bg-danger/10 border border-danger/20",children:a.jsx("p",{className:"text-sm text-danger",children:u.general})}),!1,a.jsx(l.SP,{label:"WhatsApp Phone Number",error:u.phoneNumber,helperText:"Enter phone number with country code (e.g., 60123456789)",required:!0,children:a.jsx(l.II,{type:"tel",value:x.phoneNumber,onChange:e=>w("phoneNumber",e.target.value),placeholder:"60123456789",error:!!u.phoneNumber,disabled:p||m})}),x.phoneNumber&&!u.phoneNumber&&(0,a.jsxs)("div",{className:"text-xs text-slate-400",children:["Formatted: ",(e=>{if(!e)return e;let t=(0,o.Y0)(e);return t.isValid&&t.formattedNumber?(0,o.We)(t.formattedNumber):e})(x.phoneNumber)]}),a.jsx(l.SP,{label:"Threshold Percentage",error:u.thresholdPercentage,helperText:"Notification will be sent when usage reaches this percentage (1-200%)",required:!0,children:(0,a.jsxs)("div",{className:"relative",children:[a.jsx(l.II,{type:"number",min:"1",max:"200",step:"0.1",value:x.thresholdPercentage,onChange:e=>w("thresholdPercentage",e.target.value),placeholder:"80",error:!!u.thresholdPercentage,disabled:p||m,className:"pr-8"}),a.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm",children:"%"})]})}),a.jsx(l.SP,{label:"Status",helperText:"Enable or disable this notification trigger",children:(0,a.jsxs)(l.Ph,{value:x.isActive?"active":"inactive",onChange:e=>w("isActive","active"===e.target.value),disabled:p||m,children:[a.jsx("option",{value:"active",children:"Active - Notifications enabled"}),a.jsx("option",{value:"inactive",children:"Inactive - Notifications disabled"})]})}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[a.jsx(i.z,{type:"submit",isLoading:p,disabled:m||!x.phoneNumber.trim()||!x.thresholdPercentage.trim(),className:"flex-1",children:p?N?"Updating...":"Creating...":N?"Update Trigger":"Create Trigger"}),a.jsx(i.z,{type:"button",variant:"secondary",onClick:()=>{(!f||window.confirm("You have unsaved changes. Are you sure you want to cancel?"))&&d()},disabled:p||m,children:"Cancel"})]})]})})]})}var m=s(83401);let x=r.forwardRef(function({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}),h=r.forwardRef(function({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.636 5.636a9 9 0 1 0 12.728 0M12 3v9"}))}),u=r.forwardRef(function({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"}))}),g=r.forwardRef(function({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))});var p=s(19381),b=s(41135);function f({trigger:e,onEdit:t,onDelete:s,onToggle:l,isLoading:c}){let[d,p]=(0,r.useState)(!1),[f,j]=(0,r.useState)(!1),N=async()=>{if(window.confirm(`Are you sure you want to delete this notification trigger?

Phone: ${(0,o.We)(e.phoneNumber)}
Threshold: ${e.thresholdPercentage}%

This action cannot be undone.`)){p(!0);try{await s(e.id)}catch(e){console.error("Error deleting trigger:",e)}finally{p(!1)}}},v=async()=>{j(!0);try{await l(e.id,!e.isActive)}catch(e){console.error("Error toggling trigger:",e)}finally{j(!1)}},w=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return a.jsx(n.Zb,{className:(0,b.Z)("transition-all duration-200",e.isActive?"border-slate-700 bg-slate-900/60":"border-slate-800 bg-slate-900/30 opacity-75"),children:a.jsx(n.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsxs)("div",{className:(0,b.Z)("flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium",e.isActive?"bg-success/10 text-success border border-success/20":"bg-slate-700/50 text-slate-400 border border-slate-700"),children:[e.isActive?a.jsx(m.Z,{className:"h-3 w-3"}):a.jsx(x,{className:"h-3 w-3"}),e.isActive?"Active":"Inactive"]}),(0,a.jsxs)("div",{className:"px-2 py-1 rounded-full bg-primary/10 text-primary border border-primary/20 text-xs font-medium",children:[e.thresholdPercentage,"% threshold"]})]}),(0,a.jsxs)("div",{className:"mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-white",children:(0,o.We)(e.phoneNumber)}),(0,a.jsxs)("p",{className:"text-xs text-slate-400",children:["WhatsApp notifications when usage ≥ ",e.thresholdPercentage,"%"]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-4 text-xs text-slate-500",children:[(0,a.jsxs)("span",{children:["Created: ",w(e.createdAt)]}),e.updatedAt!==e.createdAt&&(0,a.jsxs)("span",{children:["Updated: ",w(e.updatedAt)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(i.z,{variant:"ghost",size:"sm",onClick:v,disabled:c||f||d,isLoading:f,className:(0,b.Z)("h-8 w-8 p-0",e.isActive?"text-slate-400 hover:text-orange-400":"text-slate-500 hover:text-success"),title:e.isActive?"Disable notifications":"Enable notifications",children:a.jsx(h,{className:"h-4 w-4"})}),a.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>t(e),disabled:c||f||d,className:"h-8 w-8 p-0 text-slate-400 hover:text-primary",title:"Edit trigger",children:a.jsx(u,{className:"h-4 w-4"})}),a.jsx(i.z,{variant:"ghost",size:"sm",onClick:N,disabled:c||f||d,isLoading:d,className:"h-8 w-8 p-0 text-slate-400 hover:text-danger",title:"Delete trigger",children:a.jsx(g,{className:"h-4 w-4"})})]})]})})})}function j({triggers:e,onEdit:t,onDelete:s,onToggle:l,isLoading:o=!1}){let[c,d]=(0,r.useState)("created"),[m,x]=(0,r.useState)("all"),h=e.filter(e=>"all"===m||("active"===m?e.isActive:!e.isActive)).sort((e,t)=>{switch(c){case"threshold":return e.thresholdPercentage-t.thresholdPercentage;case"status":return Number(t.isActive)-Number(e.isActive);default:return new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()}}),u=e.filter(e=>e.isActive).length,g=e.filter(e=>!e.isActive).length;return 0===e.length?a.jsx(n.Zb,{children:(0,a.jsxs)(n.aY,{className:"p-8 text-center",children:[a.jsx(p.Z,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Notification Triggers"}),a.jsx("p",{className:"text-slate-400 mb-4",children:"You haven't set up any WhatsApp notification triggers yet."}),a.jsx("p",{className:"text-sm text-slate-500",children:"Create your first trigger to receive alerts when energy usage exceeds your specified thresholds."})]})}):(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx(n.Zb,{children:a.jsx(n.Ol,{className:"pb-4",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-white",children:"Notification Triggers"}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-slate-400 mt-1",children:[(0,a.jsxs)("span",{children:[e.length," total"]}),(0,a.jsxs)("span",{className:"text-success",children:[u," active"]}),(0,a.jsxs)("span",{className:"text-slate-500",children:[g," inactive"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("select",{value:m,onChange:e=>x(e.target.value),className:"px-3 py-1.5 text-sm rounded-md border border-slate-700 bg-slate-800 text-white focus:border-primary focus:outline-none",disabled:o,children:[a.jsx("option",{value:"all",children:"All Status"}),a.jsx("option",{value:"active",children:"Active Only"}),a.jsx("option",{value:"inactive",children:"Inactive Only"})]}),(0,a.jsxs)("select",{value:c,onChange:e=>d(e.target.value),className:"px-3 py-1.5 text-sm rounded-md border border-slate-700 bg-slate-800 text-white focus:border-primary focus:outline-none",disabled:o,children:[a.jsx("option",{value:"created",children:"Sort by Created"}),a.jsx("option",{value:"threshold",children:"Sort by Threshold"}),a.jsx("option",{value:"status",children:"Sort by Status"})]})]})]})})}),0===h.length?a.jsx(n.Zb,{children:a.jsx(n.aY,{className:"p-6 text-center",children:a.jsx("p",{className:"text-slate-400",children:"No triggers match the current filter criteria."})})}):a.jsx("div",{className:"space-y-3",children:h.map(e=>a.jsx(f,{trigger:e,onEdit:t,onDelete:s,onToggle:l,isLoading:o},e.id))}),e.length>1&&a.jsx(n.Zb,{children:a.jsx(n.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm text-slate-400",children:"Bulk Actions"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>{let t=e.filter(e=>!e.isActive);0!==t.length&&window.confirm(`Enable notifications for ${t.length} inactive trigger(s)?`)&&t.forEach(e=>l(e.id,!0))},disabled:o||0===g,className:"text-success hover:text-success",children:"Enable All"}),a.jsx(i.z,{variant:"ghost",size:"sm",onClick:()=>{let t=e.filter(e=>e.isActive);0!==t.length&&window.confirm(`Disable notifications for ${t.length} active trigger(s)?`)&&t.forEach(e=>l(e.id,!1))},disabled:o||0===u,className:"text-orange-400 hover:text-orange-300",children:"Disable All"})]})]})})})]})}var N=s(36902);let v=r.forwardRef(function({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))});var w=s(42553);function y({history:e}){let[t,s]=(0,r.useState)(!1);return a.jsx(n.Zb,{className:(0,b.Z)("transition-all duration-200",e.success?"border-slate-700 bg-slate-900/60":"border-red-900/30 bg-red-900/10"),children:a.jsx(n.aY,{className:"p-4",children:a.jsx("div",{className:"flex items-start justify-between gap-4",children:(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsxs)("div",{className:(0,b.Z)("flex items-center gap-1.5 px-2 py-1 rounded-full text-xs font-medium border",e.success?"text-success bg-success/10 border-success/20":"text-danger bg-danger/10 border-danger/20"),children:[e.success?a.jsx(m.Z,{className:"h-3 w-3"}):a.jsx(N.Z,{className:"h-3 w-3"}),e.success?"Sent":"Failed"]}),(0,a.jsxs)("div",{className:"px-2 py-1 rounded-full bg-slate-700/50 text-slate-300 text-xs",children:[e.actualPercentage.toFixed(1),"% / ",e.thresholdPercentage,"%"]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 text-xs text-slate-500",children:[a.jsx(x,{className:"h-3 w-3"}),(e=>{let t=new Date(e),s=new Date,a=s.getTime()-t.getTime(),r=Math.floor(a/6e4),i=Math.floor(a/36e5),l=Math.floor(a/864e5);return r<1?"Just now":r<60?`${r}m ago`:i<24?`${i}h ago`:l<7?`${l}d ago`:t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:t.getFullYear()!==s.getFullYear()?"numeric":void 0,hour:"2-digit",minute:"2-digit"})})(e.sentAt)]})]}),(0,a.jsxs)("div",{className:"mb-2",children:[a.jsx("p",{className:"text-sm font-medium text-white",children:(0,o.We)(e.phoneNumber)}),(0,a.jsxs)("p",{className:"text-xs text-slate-400",children:["Usage reached ",e.actualPercentage.toFixed(1),"% (threshold: ",e.thresholdPercentage,"%)"]})]}),!e.success&&e.errorMessage&&a.jsx("div",{className:"mt-2 p-2 rounded bg-red-900/20 border border-red-900/30",children:(0,a.jsxs)("p",{className:"text-xs text-red-300",children:["Error: ",e.errorMessage]})}),!e.success&&a.jsx("button",{onClick:()=>s(!t),className:"mt-2 text-xs text-slate-400 hover:text-slate-300 underline",children:t?"Hide Details":"Show Details"}),t&&!e.success&&a.jsx("div",{className:"mt-2 p-3 rounded bg-slate-800/50 border border-slate-700",children:(0,a.jsxs)("div",{className:"space-y-2 text-xs",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-slate-400",children:"Trigger ID:"}),a.jsx("span",{className:"ml-2 text-slate-300 font-mono",children:e.triggerId})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-slate-400",children:"Simulator ID:"}),a.jsx("span",{className:"ml-2 text-slate-300 font-mono",children:e.simulatorId})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-slate-400",children:"Sent At:"}),a.jsx("span",{className:"ml-2 text-slate-300",children:new Date(e.sentAt).toLocaleString()})]})]})})]})})})})}function S({simulatorId:e,limit:t=50}){let[s,l]=(0,r.useState)([]),[o,d]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),[u,g]=(0,r.useState)({status:"all",timeRange:"all"}),b=async()=>{try{d(!0),h(null);let s=await c.O.getNotificationHistory(e,t);l(s)}catch(e){console.error("Error loading notification history:",e),h(e instanceof Error?e.message:"Failed to load notification history")}finally{d(!1)}},f=s.filter(e=>{if("all"!==u.status&&!("success"===u.status?e.success:!e.success))return!1;if("all"!==u.timeRange){let t=new Date,s=new Date(e.sentAt),a=t.getTime()-s.getTime();switch(u.timeRange){case"24h":if(a>864e5)return!1;break;case"7d":if(a>6048e5)return!1;break;case"30d":if(a>2592e6)return!1}}return!0}),j=s.filter(e=>e.success).length,N=s.filter(e=>!e.success).length;return o?a.jsx(n.Zb,{children:(0,a.jsxs)(n.aY,{className:"p-8 text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),a.jsx("p",{className:"text-slate-400",children:"Loading notification history..."})]})}):m?a.jsx(n.Zb,{children:(0,a.jsxs)(n.aY,{className:"p-8 text-center",children:[a.jsx(p.Z,{className:"h-12 w-12 text-danger mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Error Loading History"}),a.jsx("p",{className:"text-slate-400 mb-4",children:m}),a.jsx(i.z,{onClick:b,variant:"secondary",children:"Try Again"})]})}):0===s.length?a.jsx(n.Zb,{children:(0,a.jsxs)(n.aY,{className:"p-8 text-center",children:[a.jsx(x,{className:"h-12 w-12 text-slate-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"No Notification History"}),a.jsx("p",{className:"text-slate-400 mb-4",children:"No notifications have been sent for this simulator yet."}),a.jsx("p",{className:"text-sm text-slate-500",children:"History will appear here once notification triggers are activated and thresholds are exceeded."})]})}):(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx(n.Zb,{children:a.jsx(n.Ol,{className:"pb-4",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-white",children:"Notification History"}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-slate-400 mt-1",children:[(0,a.jsxs)("span",{children:[s.length," total"]}),(0,a.jsxs)("span",{className:"text-success",children:[j," sent"]}),(0,a.jsxs)("span",{className:"text-danger",children:[N," failed"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx(v,{className:"h-4 w-4 text-slate-400"}),(0,a.jsxs)("select",{value:u.status,onChange:e=>g(t=>({...t,status:e.target.value})),className:"px-3 py-1.5 text-sm rounded-md border border-slate-700 bg-slate-800 text-white focus:border-primary focus:outline-none",children:[a.jsx("option",{value:"all",children:"All Status"}),a.jsx("option",{value:"success",children:"Sent Only"}),a.jsx("option",{value:"failed",children:"Failed Only"})]})]}),(0,a.jsxs)("select",{value:u.timeRange,onChange:e=>g(t=>({...t,timeRange:e.target.value})),className:"px-3 py-1.5 text-sm rounded-md border border-slate-700 bg-slate-800 text-white focus:border-primary focus:outline-none",children:[a.jsx("option",{value:"all",children:"All Time"}),a.jsx("option",{value:"24h",children:"Last 24 Hours"}),a.jsx("option",{value:"7d",children:"Last 7 Days"}),a.jsx("option",{value:"30d",children:"Last 30 Days"})]}),(0,a.jsxs)(i.z,{variant:"ghost",size:"sm",onClick:()=>{let t=new Blob([["Date,Phone Number,Threshold %,Actual %,Status,Error Message",...f.map(e=>[new Date(e.sentAt).toISOString(),e.phoneNumber,e.thresholdPercentage,e.actualPercentage.toFixed(1),e.success?"Success":"Failed",e.errorMessage||""].map(e=>`"${e}"`).join(","))].join("\n")],{type:"text/csv"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download=`notification-history-${e}-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)},disabled:0===f.length,className:"flex items-center gap-2",children:[a.jsx(w.Z,{className:"h-4 w-4"}),"Export CSV"]})]})]})})}),0===f.length?a.jsx(n.Zb,{children:a.jsx(n.aY,{className:"p-6 text-center",children:a.jsx("p",{className:"text-slate-400",children:"No notifications match the current filter criteria."})})}):a.jsx("div",{className:"space-y-3",children:f.map(e=>a.jsx(y,{history:e},e.id))}),s.length>=t&&a.jsx(n.Zb,{children:a.jsx(n.aY,{className:"p-4 text-center",children:a.jsx(i.z,{variant:"ghost",onClick:()=>b(),className:"text-slate-400 hover:text-white",children:"Load More History"})})})]})}function k({settings:e,onSave:t,onCancel:s,isLoading:o=!1}){let[d,m]=(0,r.useState)({enabledGlobally:e.enabledGlobally,cooldownMinutes:e.cooldownMinutes.toString(),maxDailyNotifications:e.maxDailyNotifications.toString()}),[x,h]=(0,r.useState)({}),[u,g]=(0,r.useState)(!1),[p,b]=(0,r.useState)(!1),f=(e,t)=>{switch(e){case"cooldownMinutes":if(!t||"string"!=typeof t)return"Cooldown minutes is required";let s=parseInt(t);if(isNaN(s))return"Cooldown must be a valid number";if(s<1)return"Cooldown must be at least 1 minute";if(s>1440)return"Cooldown cannot exceed 1440 minutes (24 hours)";return;case"maxDailyNotifications":if(!t||"string"!=typeof t)return"Max daily notifications is required";let a=parseInt(t);if(isNaN(a))return"Max daily notifications must be a valid number";if(a<1)return"Must allow at least 1 notification per day";if(a>100)return"Cannot exceed 100 notifications per day";return;default:return}},j=(e,t)=>{if(m(s=>({...s,[e]:t})),b(!0),x[e]&&h(t=>({...t,[e]:void 0})),"cooldownMinutes"===e||"maxDailyNotifications"===e){let s=f(e,t);s&&h(t=>({...t,[e]:s}))}},N=()=>{let e={},t=f("cooldownMinutes",d.cooldownMinutes);t&&(e.cooldownMinutes=t);let s=f("maxDailyNotifications",d.maxDailyNotifications);return s&&(e.maxDailyNotifications=s),h(e),0===Object.keys(e).length},v=async e=>{if(e.preventDefault(),N()){g(!0),h({});try{let e={enabledGlobally:d.enabledGlobally,cooldownMinutes:parseInt(d.cooldownMinutes),maxDailyNotifications:parseInt(d.maxDailyNotifications)},s=await c.O.updateSettings(e);t(s)}catch(e){console.error("Error saving settings:",e),h({general:e instanceof Error?e.message:"Failed to save settings"})}finally{g(!1)}}};return(0,a.jsxs)(n.Zb,{children:[(0,a.jsxs)(n.Ol,{children:[a.jsx("h3",{className:"text-lg font-semibold text-white",children:"Notification Settings"}),a.jsx("p",{className:"text-sm text-slate-400",children:"Configure global notification behavior and rate limiting"})]}),a.jsx(n.aY,{children:(0,a.jsxs)("form",{onSubmit:v,className:"space-y-6",children:[x.general&&a.jsx("div",{className:"p-3 rounded-md bg-danger/10 border border-danger/20",children:a.jsx("p",{className:"text-sm text-danger",children:x.general})}),a.jsx(l.SP,{label:"Global Notifications",helperText:"Master switch to enable or disable all notifications system-wide",children:(0,a.jsxs)(l.Ph,{value:d.enabledGlobally?"enabled":"disabled",onChange:e=>j("enabledGlobally","enabled"===e.target.value),disabled:u||o,children:[a.jsx("option",{value:"enabled",children:"✅ Enabled - Notifications will be sent"}),a.jsx("option",{value:"disabled",children:"❌ Disabled - All notifications paused"})]})}),(0,a.jsxs)(l.SP,{label:"Cooldown Period",error:x.cooldownMinutes,helperText:"Minimum time between notifications for the same trigger (1-1440 minutes)",required:!0,children:[(0,a.jsxs)("div",{className:"relative",children:[a.jsx(l.II,{type:"number",min:"1",max:"1440",value:d.cooldownMinutes,onChange:e=>j("cooldownMinutes",e.target.value),placeholder:"15",error:!!x.cooldownMinutes,disabled:u||o,className:"pr-20"}),a.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm",children:"minutes"})]}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-slate-500",children:["Current: ",parseInt(d.cooldownMinutes)||0," minutes",parseInt(d.cooldownMinutes)>=60&&` (${Math.floor(parseInt(d.cooldownMinutes)/60)}h ${parseInt(d.cooldownMinutes)%60}m)`]})]}),a.jsx(l.SP,{label:"Daily Notification Limit",error:x.maxDailyNotifications,helperText:"Maximum notifications per trigger per day (1-100)",required:!0,children:(0,a.jsxs)("div",{className:"relative",children:[a.jsx(l.II,{type:"number",min:"1",max:"100",value:d.maxDailyNotifications,onChange:e=>j("maxDailyNotifications",e.target.value),placeholder:"10",error:!!x.maxDailyNotifications,disabled:u||o,className:"pr-16"}),a.jsx("span",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 text-sm",children:"per day"})]})}),(0,a.jsxs)("div",{className:"p-4 rounded-lg bg-slate-800/50 border border-slate-700",children:[a.jsx("h4",{className:"text-sm font-medium text-white mb-3",children:"Settings Preview"}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-slate-400",children:"Status:"}),a.jsx("span",{className:d.enabledGlobally?"text-success":"text-slate-400",children:d.enabledGlobally?"Notifications Enabled":"Notifications Disabled"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-slate-400",children:"Cooldown:"}),(0,a.jsxs)("span",{className:"text-slate-300",children:[parseInt(d.cooldownMinutes)||0," minutes between notifications"]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("span",{className:"text-slate-400",children:"Daily Limit:"}),(0,a.jsxs)("span",{className:"text-slate-300",children:[parseInt(d.maxDailyNotifications)||0," notifications per trigger per day"]})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-3 pt-4",children:[a.jsx(i.z,{type:"submit",isLoading:u,disabled:o||!p||Object.keys(x).length>0,className:"flex-1",children:u?"Saving...":"Save Settings"}),a.jsx(i.z,{type:"button",variant:"secondary",onClick:()=>{window.confirm("Reset all settings to default values?")&&(m({enabledGlobally:!0,cooldownMinutes:"15",maxDailyNotifications:"10"}),b(!0),h({}))},disabled:u||o,children:"Reset"}),a.jsx(i.z,{type:"button",variant:"ghost",onClick:()=>{(!p||window.confirm("You have unsaved changes. Are you sure you want to cancel?"))&&s()},disabled:u||o,children:"Cancel"})]})]})})]})}var C=s(59675);let E=r.forwardRef(function({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))}),A=r.forwardRef(function({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}))});function Z({simulatorId:e,simulatorName:t}){let[s,l]=(0,r.useState)([]),[o,x]=(0,r.useState)(null),[h,u]=(0,r.useState)(!0),[g,f]=(0,r.useState)(null),[N,v]=(0,r.useState)("triggers"),[w,y]=(0,r.useState)(null),[Z,L]=(0,r.useState)(null),[D,P]=(0,r.useState)(null),M=async()=>{try{u(!0),f(null);let[t,s,a]=await Promise.all([c.O.getTriggersBySimulator(e),c.O.getSettings(),c.O.getSystemStatus()]);l(t),x(s),P(a)}catch(e){console.error("Error loading notification data:",e),f(e instanceof Error?e.message:"Failed to load notification data")}finally{u(!1)}},T=async e=>{Z?l(t=>t.map(t=>t.id===e.id?e:t)):l(t=>[...t,e]),y(null),L(null),P(await c.O.getSystemStatus())},O=async e=>{try{await c.O.deleteTrigger(e),l(t=>t.filter(t=>t.id!==e));let t=await c.O.getSystemStatus();P(t)}catch(e){console.error("Error deleting trigger:",e),alert("Failed to delete trigger: "+(e instanceof Error?e.message:"Unknown error"))}},I=async(e,t)=>{try{let s=await c.O.toggleTrigger(e,t);l(t=>t.map(t=>t.id===e?s:t));let a=await c.O.getSystemStatus();P(a)}catch(e){console.error("Error toggling trigger:",e),alert("Failed to update trigger: "+(e instanceof Error?e.message:"Unknown error"))}},R=async e=>{x(e),y(null),P(await c.O.getSystemStatus())},z=()=>{y(null),L(null)};return h?a.jsx(n.Zb,{children:(0,a.jsxs)(n.aY,{className:"p-8 text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),a.jsx("p",{className:"text-slate-400",children:"Loading notification system..."})]})}):g?a.jsx(n.Zb,{children:(0,a.jsxs)(n.aY,{className:"p-8 text-center",children:[a.jsx(p.Z,{className:"h-12 w-12 text-danger mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-medium text-white mb-2",children:"Error Loading Notifications"}),a.jsx("p",{className:"text-slate-400 mb-4",children:g}),a.jsx(i.z,{onClick:M,variant:"secondary",children:"Try Again"})]})}):(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx(n.Zb,{children:a.jsx(n.Ol,{children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center gap-2",children:[a.jsx(C.Z,{className:"h-6 w-6"}),"WhatsApp Notifications"]}),a.jsx("p",{className:"text-slate-400 mt-1",children:t?`Manage notifications for ${t}`:`Simulator: ${e}`})]}),D&&(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,a.jsxs)("div",{className:(0,b.Z)("flex items-center gap-1.5 px-2 py-1 rounded-full border",D.whatsappReady?"bg-success/10 text-success border-success/20":"bg-danger/10 text-danger border-danger/20"),children:[D.whatsappReady?a.jsx(m.Z,{className:"h-3 w-3"}):a.jsx(p.Z,{className:"h-3 w-3"}),"WhatsApp ",D.whatsappReady?"Ready":"Not Ready"]}),(0,a.jsxs)("div",{className:(0,b.Z)("flex items-center gap-1.5 px-2 py-1 rounded-full border",D.notificationsEnabled?"bg-primary/10 text-primary border-primary/20":"bg-slate-700/50 text-slate-400 border-slate-700"),children:[a.jsx(C.Z,{className:"h-3 w-3"}),D.notificationsEnabled?"Enabled":"Disabled"]}),(0,a.jsxs)("div",{className:"text-slate-400",children:[D.activeTriggers," / ",D.totalTriggers," active"]})]})]})})}),a.jsx(n.Zb,{children:a.jsx(n.aY,{className:"p-0",children:(0,a.jsxs)("div",{className:"flex border-b border-slate-700",children:[(0,a.jsxs)("button",{onClick:()=>v("triggers"),className:(0,b.Z)("flex-1 px-6 py-4 text-sm font-medium transition-colors","triggers"===N?"text-primary border-b-2 border-primary bg-primary/5":"text-slate-400 hover:text-white"),children:["Triggers (",s.length,")"]}),a.jsx("button",{onClick:()=>v("history"),className:(0,b.Z)("flex-1 px-6 py-4 text-sm font-medium transition-colors","history"===N?"text-primary border-b-2 border-primary bg-primary/5":"text-slate-400 hover:text-white"),children:"History"}),a.jsx("button",{onClick:()=>v("settings"),className:(0,b.Z)("flex-1 px-6 py-4 text-sm font-medium transition-colors","settings"===N?"text-primary border-b-2 border-primary bg-primary/5":"text-slate-400 hover:text-white"),children:"Settings"})]})})}),"triggers"===N&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-white",children:"Notification Triggers"}),a.jsx("p",{className:"text-sm text-slate-400",children:"Configure when to send WhatsApp notifications based on energy usage thresholds"})]}),(0,a.jsxs)(i.z,{onClick:()=>{L(null),y("create")},className:"flex items-center gap-2",children:[a.jsx(E,{className:"h-4 w-4"}),"Add Trigger"]})]}),a.jsx(j,{triggers:s,onEdit:e=>{L(e),y("edit")},onDelete:O,onToggle:I,isLoading:h})]}),"history"===N&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-white",children:"Notification History"}),a.jsx("p",{className:"text-sm text-slate-400",children:"View all sent and failed notifications for this simulator"})]}),a.jsx(S,{simulatorId:e})]}),"settings"===N&&(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-white",children:"Notification Settings"}),a.jsx("p",{className:"text-sm text-slate-400",children:"Configure global notification behavior and rate limiting"})]}),(0,a.jsxs)(i.z,{variant:"ghost",onClick:()=>y("settings"),className:"flex items-center gap-2",children:[a.jsx(A,{className:"h-4 w-4"}),"Edit Settings"]})]}),o&&a.jsx(n.Zb,{children:a.jsx(n.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"Global Status"}),a.jsx("p",{className:(0,b.Z)("text-sm",o.enabledGlobally?"text-success":"text-slate-400"),children:o.enabledGlobally?"Notifications Enabled":"Notifications Disabled"})]}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"Cooldown Period"}),(0,a.jsxs)("p",{className:"text-sm text-slate-300",children:[o.cooldownMinutes," minutes"]})]}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-sm font-medium text-white mb-2",children:"Daily Limit"}),(0,a.jsxs)("p",{className:"text-sm text-slate-300",children:[o.maxDailyNotifications," per trigger"]})]})]})})})]}),("create"===w||"edit"===w)&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"w-full max-w-md",children:a.jsx(d,{simulatorId:e,trigger:Z||void 0,onSave:T,onCancel:z,isLoading:!1})})}),"settings"===w&&o&&a.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:a.jsx("div",{className:"w-full max-w-md",children:a.jsx(k,{settings:o,onSave:R,onCancel:z})})})]})}},29752:(e,t,s)=>{s.d(t,{Ol:()=>o,Zb:()=>n,aY:()=>c});var a=s(10326),r=s(17577),i=s(41135);let l={default:"bg-slate-900/60",elevated:"bg-slate-900 shadow-lg",interactive:"cursor-pointer hover:border-primary-700 hover:shadow-lg",flat:"shadow-none"},n=(0,r.forwardRef)(({className:e,variant:t="default",...s},r)=>a.jsx("div",{ref:r,className:(0,i.Z)("rounded-xl border border-slate-800 backdrop-blur-sm shadow-md transition-shadow duration-200",l[t],e),...s}));n.displayName="Card";let o=(0,r.forwardRef)(({className:e,...t},s)=>a.jsx("div",{ref:s,className:(0,i.Z)("p-4 sm:p-6 border-b border-slate-800",e),...t}));o.displayName="CardHeader";let c=(0,r.forwardRef)(({className:e,...t},s)=>a.jsx("div",{ref:s,className:(0,i.Z)("p-4 sm:p-6",e),...t}));c.displayName="CardContent",(0,r.forwardRef)(({className:e,...t},s)=>a.jsx("div",{ref:s,className:(0,i.Z)("p-4 sm:p-6 border-t border-slate-800",e),...t})).displayName="CardFooter"},41190:(e,t,s)=>{s.d(t,{II:()=>n,Ph:()=>o,SP:()=>c});var a=s(10326),r=s(17577),i=s(41135),l=s(19381);let n=(0,r.forwardRef)(({className:e,error:t,success:s,...r},l)=>a.jsx("input",{className:(0,i.Z)("w-full rounded-md border px-3 py-2 text-sm text-white transition-colors duration-150","placeholder:text-slate-500","focus:outline-none focus:ring-2","disabled:opacity-50 disabled:cursor-not-allowed",t?"border-danger bg-danger/5 focus:border-danger focus:ring-danger/20":s?"border-success bg-success/5 focus:border-success focus:ring-success/20":"border-slate-800 bg-slate-950/60 focus:border-primary focus:ring-primary/20",e),ref:l,...r}));n.displayName="Input";let o=(0,r.forwardRef)(({className:e,error:t,success:s,children:r,...l},n)=>a.jsx("select",{className:(0,i.Z)("w-full rounded-md border px-3 py-2 text-sm text-white transition-colors duration-150","focus:outline-none focus:ring-2","disabled:opacity-50 disabled:cursor-not-allowed",t?"border-danger bg-danger/5 focus:border-danger focus:ring-danger/20":s?"border-success bg-success/5 focus:border-success focus:ring-success/20":"border-slate-800 bg-slate-950/60 focus:border-primary focus:ring-primary/20",e),ref:n,...l,children:r}));function c({label:e,error:t,helperText:s,required:r,children:i}){return(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-slate-300",children:[e,r&&a.jsx("span",{className:"text-danger ml-1",children:"*"})]}),i,t&&(0,a.jsxs)("p",{className:"text-xs text-danger flex items-center gap-1",children:[a.jsx(l.Z,{className:"h-4 w-4","aria-hidden":"true"}),t]}),!t&&s&&a.jsx("p",{className:"text-xs text-slate-500",children:s})]})}o.displayName="Select"},59675:(e,t,s)=>{s.d(t,{Z:()=>r});var a=s(17577);let r=a.forwardRef(function({title:e,titleId:t,...s},r){return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},s),e?a.createElement("title",{id:t},e):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0"}))})}};