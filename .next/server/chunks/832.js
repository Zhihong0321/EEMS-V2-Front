"use strict";exports.id=832,exports.ids=[832],exports.modules={30064:(e,t,s)=>{s.d(t,{J:()=>n});var a=s(10326),l=s(41135);function r({className:e}){return a.jsx("div",{className:(0,l.Z)("animate-pulse rounded-md bg-slate-800/40",e)})}let i=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function n({history:e,loading:t}){return(0,a.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur-sm p-6 shadow-md hover:shadow-lg transition-shadow duration-300",role:"region","aria-label":"Block history",children:[a.jsx("h3",{className:"text-lg font-semibold text-white",children:"History (last 10 blocks)"}),t?a.jsx("ul",{className:"mt-4 space-y-3",children:Array.from({length:6}).map((e,t)=>(0,a.jsxs)("li",{className:"space-y-2",children:[a.jsx(r,{className:"h-4 w-32"}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[a.jsx(r,{className:"h-3 w-24"}),a.jsx(r,{className:"h-6 w-16 rounded-full"})]})]},t))}):0===e.length?a.jsx("p",{className:"mt-4 text-sm text-slate-400",children:"No block history yet. Run the simulator to populate readings."}):a.jsx("ul",{className:"mt-4 space-y-3",children:e.map((e,t)=>{let s=e.percent_of_target,l="";try{let t=new Date(e.block_start_local),s=new Date(t.getTime()+18e5);l=`${i.format(t)} – ${i.format(s)}`}catch{l=e.block_start_local}return(0,a.jsxs)("li",{className:"flex items-center justify-between rounded-lg border border-slate-800 bg-slate-950/60 px-4 py-3 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium text-slate-100",children:l}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:[e.accumulated_kwh.toFixed(2)," / ",e.target_kwh.toFixed(1)," kWh"]})]}),(0,a.jsxs)("span",{className:`text-sm font-semibold ${s>100?"text-danger":s>=80?"text-warning":"text-success"}`,children:[s.toFixed(1),"%"]})]},`${e.block_start_local}-${t}`)})})]})}},20:(e,t,s)=>{s.d(t,{l:()=>w});var a=s(10326),l=s(14958),r=s(49844),i=s(74390),n=s(8564),d=s(99630),o=s(34734),c=s(30660),m=s(18423),x=s(62637),u=s(9997),h=s(44675),b=s(17577),g=s(42553),p=s(91664);let f="Asia/Kuala_Lumpur",j=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:f}),v=new Intl.NumberFormat(void 0,{maximumFractionDigits:2});function N(e,t,s){let a=e.replace("#",""),l=t.replace("#",""),r=parseInt(a.substr(0,2),16),i=parseInt(a.substr(2,2),16),n=parseInt(a.substr(4,2),16),d=parseInt(l.substr(0,2),16),o=parseInt(l.substr(2,2),16),c=parseInt(l.substr(4,2),16);return`#${[Math.round(r+(d-r)*s),Math.round(i+(o-i)*s),Math.round(n+(c-n)*s)].map(e=>{let t=e.toString(16);return 1===t.length?"0"+t:t}).join("")}`}function w({block:e,loading:t,targetKwh:s,targetPeakKwh:w,mode:y,lastReadingTs:F}){let _=s??e?.target_kwh??0,{data:D,startTs:S,endTs:T,binSeconds:A}=function(e,t,s){if(!e||!e.block_start_local){let e=new Date().getTime();return{data:Array(60).fill(null).map((t,s)=>({ts:e+(s+1)*3e4,value:0})),startTs:e,endTs:e+18e5,binSeconds:30}}let a=new Date(e.block_start_local).getTime(),l=e.chart_bins?.points??[],r=e.chart_bins?.bin_seconds??30,i=[];if("accumulate"===t)i=l.map((e,t)=>({ts:a+(t+1)*r*1e3,value:e}));else{let e=s?s/60:0;i=l.map((t,s)=>{let i=t-(0===s?0:l[s-1]),n=e>0?i/e*100:0;return{ts:a+(s+1)*r*1e3,value:i,color:function(e){let t=Math.max(0,Math.min(120,e));return t<=50?N("#22c55e","#84cc16",t/50):t<=75?N("#84cc16","#eab308",(t-50)/25):t<=90?N("#eab308","#f97316",(t-75)/15):t<=100?N("#f97316","#ef4444",(t-90)/10):N("#ef4444","#dc2626",Math.min(1,(t-100)/20))}(n),percentOfTarget:n}})}return{data:Array(Math.floor(1800/r)).fill(null).map((e,t)=>{let s=a+(t+1)*r*1e3;return i.find(e=>e.ts===s)??{ts:s,value:0,color:"#22c55e",percentOfTarget:0}}),startTs:a,endTs:a+18e5,binSeconds:r}}(e,y,w),E=function(e,t){try{let s=new Date(e),a=new Date(t);return function(e,t,s="Asia/Kuala_Lumpur"){let a=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:s});try{let s=new Date(e),l=new Date(t);return`${a.format(s)} – ${a.format(l)}`}catch{return"Invalid time range"}}(s.toISOString(),a.toISOString(),f)}catch{return"Invalid time range"}}(S,T),C="accumulate"===y;(0,b.useRef)([]);let[M,$]=(0,b.useState)(new Map),[I,W]=(0,b.useState)([]);(0,b.useRef)(null);let[R,L]=(0,b.useState)(0),P=C?l.w:r.v,K=C?a.jsx(i.x,{type:"monotone",dataKey:"value",stroke:"#22d3ee",strokeWidth:2,dot:!1,isAnimationActive:!0,animationDuration:800}):a.jsx(n.$,{dataKey:"value",radius:[4,4,0,0],isAnimationActive:!0,animationDuration:1500,animationBegin:0,children:I.map((e,t)=>{let s=M.get(t)||e.color||"#22c55e";return a.jsx(d.b,{fill:s,style:{transition:"fill 1.2s cubic-bezier(0.4, 0, 0.2, 1)"}},`cell-${e.ts}-${t}`)})}),O=C?a.jsx(o.d,{y:_,stroke:"#f97316",strokeDasharray:"6 6"}):w?a.jsx(o.d,{y:w/60,stroke:"rgba(255, 255, 255, 0.18)",strokeWidth:2,strokeDasharray:"4 4",label:{value:"Peak Target",position:"right",fill:"rgba(255, 255, 255, 0.6)",fontSize:11}}):null;return(0,a.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur-sm p-4 sm:p-6 shadow-md hover:shadow-lg transition-shadow duration-300",role:"region","aria-label":"Current block chart",children:[(0,a.jsxs)("header",{className:"mb-4 sm:mb-6 flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3 sm:gap-4",children:[a.jsx("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,a.jsxs)("div",{children:[a.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-white",children:"Current 30-minute block"}),(0,a.jsxs)("p",{className:"text-xs sm:text-sm text-slate-400",children:["Window ",E]})]}),a.jsx(p.z,{variant:"ghost",size:"sm",className:"text-slate-400 hover:text-white","aria-label":"Export chart data",title:"Export data (Coming soon)",children:a.jsx(g.Z,{className:"h-4 w-4","aria-hidden":"true"})})]})}),a.jsx("div",{className:"rounded-md border border-slate-800 bg-slate-900/40 px-3 sm:px-4 py-2 text-xs text-slate-400",children:C?(0,a.jsxs)(a.Fragment,{children:["Target ",_.toFixed(1)," kWh \xb7 Accumulated ",e?.accumulated_kwh.toFixed(2)??"—"," kWh"]}):(0,a.jsxs)(a.Fragment,{children:["Target ",w?.toFixed(1)??"—"," kWh (total) \xb7 Per bin ",(w?w/60:0).toFixed(3)," kWh"]})})]}),a.jsx("div",{className:"h-48 md:h-72 w-full",children:t&&!e?a.jsx("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:a.jsx("span",{className:"text-sm text-slate-500",children:"Loading chart…"})}):0===D.length||D.every(e=>0===e.value)?a.jsx("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:a.jsx("span",{className:"text-sm text-slate-500",children:"No readings for this block yet."})}):a.jsx(c.h,{width:"100%",height:"100%",children:(0,a.jsxs)(P,{data:C?D:I,margin:{left:12,right:12,top:12,bottom:12},children:[a.jsx(m.q,{strokeDasharray:"4 4",stroke:"#1f2937"}),a.jsx(x.K,{dataKey:"ts",type:"number",domain:[S,T],tickFormatter:e=>j.format(e),stroke:"#64748b",tickLine:!1}),a.jsx(u.B,{dataKey:"value",stroke:"#64748b",tickLine:!1,width:60,tickFormatter:e=>v.format(e)}),a.jsx(h.u,{content:a.jsx(k,{target:_,targetPeakKwh:w,mode:y,binSeconds:A})}),O,K]},C?void 0:`chart-${R}`)})}),a.jsx("p",{className:"mt-4 text-xs text-slate-500",children:"Streaming series updates replace the entire 60-point window whenever the backend publishes a block update."})]})}function k({active:e,payload:t,label:s,target:l,targetPeakKwh:r,mode:i,binSeconds:n}){if(!e||!t||0===t.length||!s)return null;let d=t[0]?.value??0,o=j.format(s);if("accumulate"===i){let e=l>0?(d/l*100).toFixed(1):"0",t=parseFloat(e);return(0,a.jsxs)("div",{className:"rounded-xl border border-slate-600/50 bg-slate-900/98 backdrop-blur-md p-4 shadow-2xl ring-1 ring-white/5",children:[(0,a.jsxs)("div",{className:"mb-2 pb-2 border-b border-slate-700/50",children:[a.jsx("p",{className:"text-sm font-semibold text-white",children:o}),a.jsx("p",{className:"text-xs text-slate-400",children:"Accumulated reading"})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[a.jsx("span",{className:"text-xs text-slate-400",children:"Accumulated:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-emerald-400",children:[v.format(d)," kWh"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[a.jsx("span",{className:"text-xs text-slate-400",children:"Target:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-slate-300",children:[v.format(l)," kWh"]})]}),a.jsx("div",{className:"mt-2 pt-2 border-t border-slate-700/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[a.jsx("span",{className:"text-xs text-slate-400",children:"Progress:"}),(0,a.jsxs)("span",{className:`text-sm font-semibold ${t>100?"text-danger":t>90?"text-warning":"text-success"}`,children:[e,"%"]})]})})]})]})}let c=r?r/60:0,m=c>0?(d/c*100).toFixed(1):"0",x=t[0]?.payload?.color||"#22c55e",u=parseFloat(m),h="Green";return h=u>=100?"Red (≥100%)":u>=90?"Orange-Red (90-100%)":u>=75?"Yellow-Orange (75-90%)":u>=50?"Yellow-Green (50-75%)":"Green (<50%)",(0,a.jsxs)("div",{className:"rounded-xl border border-slate-600/50 bg-slate-900/98 backdrop-blur-md p-4 shadow-2xl ring-1 ring-white/5",children:[(0,a.jsxs)("div",{className:"mb-2 pb-2 border-b border-slate-700/50",children:[a.jsx("p",{className:"text-sm font-semibold text-white",children:o}),(0,a.jsxs)("p",{className:"text-xs text-slate-400",children:["Peak usage reading (",n,"s)"]})]}),(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[a.jsx("span",{className:"text-xs text-slate-400",children:"Usage:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-cyan-400",children:[v.format(d)," kWh"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[a.jsx("span",{className:"text-xs text-slate-400",children:"Target/bin:"}),(0,a.jsxs)("span",{className:"text-sm font-medium text-slate-300",children:[v.format(c)," kWh"]})]}),a.jsx("div",{className:"mt-2 pt-2 border-t border-slate-700/50",children:(0,a.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[a.jsx("span",{className:"text-xs text-slate-400",children:"Intensity:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"h-3 w-3 rounded-full",style:{backgroundColor:x}}),a.jsx("span",{className:"text-xs font-medium text-slate-300",children:h})]})]})})]})]})}},70065:(e,t,s)=>{s.d(t,{C:()=>i});var a=s(10326),l=s(17577);let r=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function i({connected:e,reconnecting:t,lastReadingTs:s,block:i,targetKwh:n,targetPeakKwh:d}){let[o,c]=(0,l.useState)(new Date),m="bg-slate-500",x="Disconnected";e?(m="bg-emerald-400 animate-pulse",x="Connected"):t&&(m="bg-amber-400 animate-pulse",x="Reconnecting");let u=s?r.format(new Date(s)):"—",h=d??n??i?.target_kwh??0,b=function(e,t){let s,a;if(!e||!e.block_start_local||t<=0)return{projectedTotal:0,status:"SAFE",color:"bg-emerald-500",elapsedMinutes:0,currentAccumulated:0,fillPercentage:0};let l=new Date(e.block_start_local),r=Math.min(30,Math.max(0,new Date().getTime()-l.getTime())/6e4),i=e.accumulated_kwh??0,n=Math.min(100,i/t*100);if(r<1||0===i)return{projectedTotal:i,status:n<80?"SAFE":n<100?"VERY CLOSE":"OVER",color:n<80?"bg-emerald-500":n<100?"bg-amber-500":"bg-red-500",elapsedMinutes:r,currentAccumulated:i,fillPercentage:n};let d=i/r*30,o=d/t*100;return o<80?(s="SAFE",a="bg-emerald-500"):o<100?(s="VERY CLOSE",a="bg-amber-500"):(s="OVER",a="bg-red-500"),{projectedTotal:d,status:s,color:a,elapsedMinutes:r,currentAccumulated:i,fillPercentage:n}}(i,h);return(0,a.jsxs)("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur-sm p-6 shadow-md hover:shadow-lg transition-shadow duration-300",role:"region","aria-label":"Live connection status and usage projection",children:[a.jsx("h3",{className:"text-lg font-semibold text-white",children:"Live status"}),(0,a.jsxs)("div",{className:"mt-4 flex items-center gap-3",role:"status","aria-live":"polite",children:[a.jsx("span",{className:`h-3 w-3 rounded-full ${m}`,"aria-hidden":"true"}),a.jsx("span",{className:"text-sm text-slate-200",children:x})]}),a.jsx("dl",{className:"mt-4 space-y-2 text-xs text-slate-400",children:(0,a.jsxs)("div",{children:[a.jsx("dt",{className:"uppercase tracking-[0.2em] text-slate-500",children:"Last reading"}),a.jsx("dd",{className:"mt-1 text-sm text-slate-200",children:u})]})}),i&&h>0&&(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[a.jsx("div",{className:"text-xs uppercase tracking-[0.2em] text-slate-500 mb-3",children:"Usage Bucket"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("div",{className:"relative h-48 w-full rounded-b-lg border-4 border-slate-600 bg-slate-800/50 overflow-hidden",children:[(0,a.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 transition-all duration-500 ease-out",style:{height:`${Math.min(100,b.fillPercentage)}%`,backgroundColor:b.fillPercentage<80?"#22c55e":b.fillPercentage<100?"#f59e0b":"#ef4444"},children:[a.jsx("div",{className:"absolute inset-0 opacity-20 bg-gradient-to-t from-transparent via-white to-transparent animate-pulse"}),b.fillPercentage>0&&a.jsx("div",{className:"absolute top-0 left-0 right-0 h-0.5 bg-white/50"})]}),a.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-amber-400 opacity-60",style:{bottom:"20%"},children:a.jsx("span",{className:"absolute -left-12 -top-2 text-xs text-amber-400",children:"80%"})}),a.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-red-400 opacity-60",style:{bottom:"0%"},children:a.jsx("span",{className:"absolute -left-12 -top-2 text-xs text-red-400",children:"100%"})}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-white drop-shadow-lg",children:[b.currentAccumulated.toFixed(2)," kWh"]}),(0,a.jsxs)("div",{className:"text-xs text-slate-300 mt-1",children:[b.fillPercentage.toFixed(1),"% filled"]})]})})]}),a.jsx("div",{className:"absolute -top-2 -left-3 w-8 h-4 border-2 border-slate-600 rounded-t-full"}),a.jsx("div",{className:"absolute -top-2 -right-3 w-8 h-4 border-2 border-slate-600 rounded-t-full"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,a.jsxs)("div",{className:"rounded border border-slate-700 bg-slate-800/50 p-2",children:[a.jsx("div",{className:"text-slate-400",children:"Target"}),(0,a.jsxs)("div",{className:"text-white font-semibold",children:[h.toFixed(2)," kWh"]})]}),(0,a.jsxs)("div",{className:"rounded border border-slate-700 bg-slate-800/50 p-2",children:[a.jsx("div",{className:"text-slate-400",children:"Current"}),(0,a.jsxs)("div",{className:"text-white font-semibold",children:[b.currentAccumulated.toFixed(2)," kWh"]})]})]}),(0,a.jsxs)("div",{className:`${b.color} rounded-lg p-4 text-center shadow-lg`,role:"status","aria-live":"polite","aria-label":`Usage projection: ${b.status}`,children:[a.jsx("div",{className:"text-2xl font-bold text-white",children:b.status}),(0,a.jsxs)("div",{className:"mt-2 text-xs text-white/90",children:["Projected: ",b.projectedTotal.toFixed(2)," kWh"]}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-white/80",children:["(",(b.projectedTotal/h*100).toFixed(1),"% of target)"]}),b.elapsedMinutes>0&&(0,a.jsxs)("div",{className:"mt-1 text-xs text-white/70",children:["Based on ",b.elapsedMinutes.toFixed(1)," min avg"]})]})]})]})}},90422:(e,t,s)=>{s.d(t,{AF:()=>n,NX:()=>d,a1:()=>i});var a=s(17577),l=s(18069),r=s(11004);function i(e=[]){let{push:t}=(0,r.p)(),[s,i]=(0,a.useState)(e),[n,d]=(0,a.useState)(0===e.length),[o,c]=(0,a.useState)(null),m=(0,a.useCallback)(async()=>{d(!0);try{let e=await (0,l.Mf)();i(e),c(null)}catch(s){let e=s instanceof Error?s.message:"Failed to load simulators";c(e),t({title:"Unable to load simulators",description:e,variant:"error"})}finally{d(!1)}},[t]),x=(0,a.useCallback)(async e=>{try{let s=await (0,l.ji)(e);return await m(),t({title:"Simulator created",description:`${s.name} is ready to run.`,variant:"success"}),s}catch(s){let e=s instanceof Error?s.message:"Failed to create simulator";throw console.error("Create simulator failed",s),t({title:"Create simulator failed",description:e,variant:"error"}),s}},[t,m]),u=(0,a.useCallback)(async e=>{try{await (0,l.aj)(e),i(t=>t.filter(t=>t.id!==e)),m(),t({title:"Simulator deleted",variant:"success"})}catch(a){let e="Delete failed",s="Failed to delete simulator";throw a instanceof Error&&(404===a.status?(e="Delete not supported",s="Backend DELETE endpoint not implemented. Contact backend team to add DELETE /api/v1/simulators/{id}"):500===a.status||502===a.status||503===a.status?(e="Server error",s="The backend server encountered an error. Please try again."):401===a.status||403===a.status?(e="Permission denied",s="You don't have permission to delete this simulator"):a.status?s=a.message:(e="Connection failed",s="Could not connect to the server. Check your internet connection.")),console.error("Delete simulator failed",a),t({title:e,description:s,variant:"error"}),a}},[t,m]);return(0,a.useMemo)(()=>({simulators:s,loading:n,error:o,refresh:m,create:x,delete:u}),[s,n,o,m,x,u])}function n(e,t={},s=null){let{push:i,dismiss:n}=(0,r.p)(),{onAlert80pct:d,onWindowChange:o}=t,[c,m]=(0,a.useState)({block:s,loading:!s&&!!e,error:null,connected:!1,reconnecting:!1,lastReadingTs:void 0});(0,a.useRef)(!1),(0,a.useRef)(null);let x=(0,a.useCallback)(async()=>{if(e){m(e=>({...e,loading:null==e.block}));try{let t=await (0,l.lA)(e);m(e=>({...e,block:t,loading:!1,error:null}))}catch(t){let e=t instanceof Error?t.message:"Failed to load latest block";m(t=>({...t,loading:!1,error:e})),i({title:"Unable to load latest block",description:e,variant:"error"})}finally{m(e=>({...e,loading:!1}))}}},[e,i]);return{block:c.block,loading:c.loading,error:c.error,connected:c.connected,reconnecting:c.reconnecting,lastReadingTs:c.lastReadingTs,refresh:x}}function d(e,t=10,s=[]){let{push:i}=(0,r.p)(),[n,d]=(0,a.useState)(s),[o,c]=(0,a.useState)(!!e&&0===s.length),[m,x]=(0,a.useState)(null);return{history:n,loading:o,error:m,refresh:(0,a.useCallback)(async()=>{if(e){c(!0);try{let s=await (0,l.QY)(e,t);d(s),x(null)}catch(t){let e=t instanceof Error?t.message:"Failed to load block history";x(e),i({title:"Unable to load block history",description:e,variant:"error"})}finally{c(!1)}}},[t,i,e])}}}};