"use strict";exports.id=760,exports.ids=[760],exports.modules={3020:(e,t,a)=>{a.d(t,{J:()=>l});var s=a(326);let r=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function l({history:e,loading:t}){return(0,s.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-white",children:"History (last 10 blocks)"}),t?s.jsx("ul",{className:"mt-4 space-y-3",children:Array.from({length:4}).map((e,t)=>s.jsx("li",{className:"h-12 animate-pulse rounded-md bg-slate-800/40"},t))}):0===e.length?s.jsx("p",{className:"mt-4 text-sm text-slate-400",children:"No block history yet. Run the simulator to populate readings."}):s.jsx("ul",{className:"mt-4 space-y-3",children:e.map((e,t)=>{let a=e.percent_of_target,l="";try{let t=new Date(e.block_start_local),a=new Date(t.getTime()+18e5);l=`${r.format(t)} – ${r.format(a)}`}catch{l=e.block_start_local}return(0,s.jsxs)("li",{className:"flex items-center justify-between rounded-lg border border-slate-800 bg-slate-950/60 px-4 py-3 text-sm",children:[(0,s.jsxs)("div",{children:[s.jsx("p",{className:"font-medium text-slate-100",children:l}),(0,s.jsxs)("p",{className:"text-xs text-slate-500",children:[e.accumulated_kwh.toFixed(2)," / ",e.target_kwh.toFixed(1)," kWh"]})]}),(0,s.jsxs)("span",{className:`text-sm font-semibold ${a>100?"text-danger":a>=80?"text-warning":"text-success"}`,children:[a.toFixed(1),"%"]})]},`${e.block_start_local}-${t}`)})})]})}},20:(e,t,a)=>{a.d(t,{l:()=>w});var s=a(326),r=a(4958),l=a(9844),n=a(4390),i=a(8564),o=a(9564),c=a(4734),d=a(660),u=a(8423),m=a(2637),h=a(9997),x=a(4675),f=a(7577);let p="Asia/Kuala_Lumpur",g=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:p}),b=new Intl.NumberFormat(void 0,{maximumFractionDigits:2});function y(e,t,a){let s=e.replace("#",""),r=t.replace("#",""),l=parseInt(s.substr(0,2),16),n=parseInt(s.substr(2,2),16),i=parseInt(s.substr(4,2),16),o=parseInt(r.substr(0,2),16),c=parseInt(r.substr(2,2),16),d=parseInt(r.substr(4,2),16);return`#${[Math.round(l+(o-l)*a),Math.round(n+(c-n)*a),Math.round(i+(d-i)*a)].map(e=>{let t=e.toString(16);return 1===t.length?"0"+t:t}).join("")}`}function w({block:e,loading:t,targetKwh:a,targetPeakKwh:w,mode:k,lastReadingTs:v}){let N=a??e?.target_kwh??0,{data:_,startTs:A,endTs:D,binSeconds:F}=function(e,t,a){if(!e||!e.block_start_local){let e=new Date().getTime();return{data:Array(60).fill(null).map((t,a)=>({ts:e+(a+1)*3e4,value:0})),startTs:e,endTs:e+18e5,binSeconds:30}}let s=new Date(e.block_start_local).getTime(),r=e.chart_bins?.points??[],l=e.chart_bins?.bin_seconds??30,n=[];if("accumulate"===t)n=r.map((e,t)=>({ts:s+(t+1)*l*1e3,value:e}));else{let e=a?a/60:0;n=r.map((t,a)=>{let n=t-(0===a?0:r[a-1]),i=e>0?n/e*100:0;return{ts:s+(a+1)*l*1e3,value:n,color:function(e){let t=Math.max(0,Math.min(120,e));return t<=50?y("#22c55e","#84cc16",t/50):t<=75?y("#84cc16","#eab308",(t-50)/25):t<=90?y("#eab308","#f97316",(t-75)/15):t<=100?y("#f97316","#ef4444",(t-90)/10):y("#ef4444","#dc2626",Math.min(1,(t-100)/20))}(i),percentOfTarget:i}})}return{data:Array(Math.floor(1800/l)).fill(null).map((e,t)=>{let a=s+(t+1)*l*1e3;return n.find(e=>e.ts===a)??{ts:a,value:0,color:"#22c55e",percentOfTarget:0}}),startTs:s,endTs:s+18e5,binSeconds:l}}(e,k,w),S=function(e,t){try{let a=new Date(e),s=new Date(t);return function(e,t,a="Asia/Kuala_Lumpur"){let s=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:a});try{let a=new Date(e),r=new Date(t);return`${s.format(a)} – ${s.format(r)}`}catch{return"Invalid time range"}}(a.toISOString(),s.toISOString(),p)}catch{return"Invalid time range"}}(A,D),T="accumulate"===k;(0,f.useRef)([]);let[I,$]=(0,f.useState)(new Map),[C,E]=(0,f.useState)([]),K=T?r.w:l.v,R=T?s.jsx(n.x,{type:"monotone",dataKey:"value",stroke:"#22d3ee",strokeWidth:2,dot:!1,isAnimationActive:!0,animationDuration:800}):s.jsx(i.$,{dataKey:"value",radius:[4,4,0,0],isAnimationActive:!0,animationDuration:1500,animationBegin:0,children:C.map((e,t)=>{let a=I.get(t)||e.color||"#22c55e";return s.jsx(o.b,{fill:a,style:{transition:"fill 1.2s cubic-bezier(0.4, 0, 0.2, 1)"}},`cell-${t}`)})}),L=T?s.jsx(c.d,{y:N,stroke:"#f97316",strokeDasharray:"6 6"}):w?s.jsx(c.d,{y:w/60,stroke:"rgba(255, 255, 255, 0.18)",strokeWidth:2,strokeDasharray:"4 4",label:{value:"Peak Target",position:"right",fill:"rgba(255, 255, 255, 0.6)",fontSize:11}}):null;return(0,s.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-6",children:[(0,s.jsxs)("header",{className:"mb-6 flex flex-wrap items-end justify-between gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"text-xl font-semibold text-white",children:"Current 30-minute block"}),(0,s.jsxs)("p",{className:"text-sm text-slate-400",children:["Window ",S]})]}),s.jsx("div",{className:"rounded-md border border-slate-800 px-4 py-2 text-xs text-slate-400",children:T?(0,s.jsxs)(s.Fragment,{children:["Target ",N.toFixed(1)," kWh \xb7 Accumulated ",e?.accumulated_kwh.toFixed(2)??"—"," kWh"]}):(0,s.jsxs)(s.Fragment,{children:["Peak Target ",w?.toFixed(1)??"—"," kWh/30min \xb7 Target per bin ",(w?w/60:0).toFixed(3)," kWh"]})})]}),s.jsx("div",{className:"h-72 w-full",children:t&&!e?s.jsx("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:s.jsx("span",{className:"text-sm text-slate-500",children:"Loading chart…"})}):0===_.length||_.every(e=>0===e.value)?s.jsx("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:s.jsx("span",{className:"text-sm text-slate-500",children:"No readings for this block yet."})}):s.jsx(d.h,{width:"100%",height:"100%",children:(0,s.jsxs)(K,{data:T?_:C,margin:{left:12,right:12,top:12,bottom:12},children:[s.jsx(u.q,{strokeDasharray:"4 4",stroke:"#1f2937"}),s.jsx(m.K,{dataKey:"ts",type:"number",domain:[A,D],tickFormatter:e=>g.format(e),stroke:"#64748b",tickLine:!1}),s.jsx(h.B,{dataKey:"value",stroke:"#64748b",tickLine:!1,width:60,tickFormatter:e=>b.format(e)}),s.jsx(x.u,{content:s.jsx(j,{target:N,targetPeakKwh:w,mode:k,binSeconds:F})}),L,R]})})}),s.jsx("p",{className:"mt-4 text-xs text-slate-500",children:"Streaming series updates replace the entire 60-point window whenever the backend publishes a block update."})]})}function j({active:e,payload:t,label:a,target:r,targetPeakKwh:l,mode:n,binSeconds:i}){if(!e||!t||0===t.length||!a)return null;let o=t[0]?.value??0,c=g.format(a);if("accumulate"===n){let e=r>0?(o/r*100).toFixed(1):"0";return(0,s.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-xs text-slate-200 shadow-lg",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[c," \xb7 ",b.format(o)," kWh"]}),(0,s.jsxs)("p",{className:"text-slate-400",children:["Accumulated \xb7 ",e,"% of target"]})]})}let d=l?l/60:0,u=d>0?(o/d*100).toFixed(1):"0",m=t[0]?.payload?.color||"#22c55e",h=parseFloat(u),x="Green";return x=h>=100?"Red (≥100%)":h>=90?"Orange-Red (90-100%)":h>=75?"Yellow-Orange (75-90%)":h>=50?"Yellow-Green (50-75%)":"Green (<50%)",(0,s.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-xs text-slate-200 shadow-lg",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[c," \xb7 ",b.format(o)," kWh"]}),(0,s.jsxs)("p",{className:"text-slate-400",children:["Peak usage per ",i,"s \xb7 ",u,"% of peak target"]}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[s.jsx("div",{className:"h-3 w-3 rounded",style:{backgroundColor:m}}),s.jsx("span",{className:"text-slate-400",children:x})]})]})}},65:(e,t,a)=>{a.d(t,{C:()=>l});var s=a(326);let r=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function l({connected:e,reconnecting:t,lastReadingTs:a,simulatorId:l}){let n="bg-slate-500",i="Disconnected";e?(n="bg-emerald-400 animate-pulse",i="Connected"):t&&(n="bg-amber-400 animate-pulse",i="Reconnecting");let o=a?r.format(new Date(a)):"—";return(0,s.jsxs)("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Live status"}),(0,s.jsxs)("div",{className:"mt-4 flex items-center gap-3",children:[s.jsx("span",{className:`h-3 w-3 rounded-full ${n}`,"aria-hidden":"true"}),s.jsx("span",{className:"text-sm text-slate-200",children:i})]}),(0,s.jsxs)("dl",{className:"mt-4 space-y-2 text-xs text-slate-400",children:[(0,s.jsxs)("div",{children:[s.jsx("dt",{className:"uppercase tracking-[0.2em] text-slate-500",children:"Last reading"}),s.jsx("dd",{className:"mt-1 text-sm text-slate-200",children:o})]}),(0,s.jsxs)("div",{children:[s.jsx("dt",{className:"uppercase tracking-[0.2em] text-slate-500",children:"SSE endpoint"}),(0,s.jsxs)("dd",{className:"mt-1 text-sm text-slate-200",children:["/api/v1/stream/",l??"<id>"]})]})]})]})}},422:(e,t,a)=>{a.d(t,{AF:()=>i,NX:()=>o,a1:()=>n});var s=a(7577),r=a(8069),l=a(1004);function n(e=[]){let{push:t}=(0,l.p)(),[a,n]=(0,s.useState)(e),[i,o]=(0,s.useState)(0===e.length),[c,d]=(0,s.useState)(null),u=(0,s.useCallback)(async()=>{o(!0);try{let e=await (0,r.Mf)();n(e),d(null)}catch(a){let e=a instanceof Error?a.message:"Failed to load simulators";d(e),t({title:"Unable to load simulators",description:e,variant:"error"})}finally{o(!1)}},[t]),m=(0,s.useCallback)(async e=>{try{let a=await (0,r.ji)(e);return await u(),t({title:"Simulator created",description:`${a.name} is ready to run.`,variant:"success"}),a}catch(a){let e=a instanceof Error?a.message:"Failed to create simulator";throw console.error("Create simulator failed",a),t({title:"Create simulator failed",description:e,variant:"error"}),a}},[t,u]);return(0,s.useMemo)(()=>({simulators:a,loading:i,error:c,refresh:u,create:m}),[a,i,c,u,m])}function i(e,t={},a=null){let{push:n,dismiss:i}=(0,l.p)(),{onAlert80pct:o,onWindowChange:c}=t,[d,u]=(0,s.useState)({block:a,loading:!a&&!!e,error:null,connected:!1,reconnecting:!1,lastReadingTs:void 0});(0,s.useRef)(!1),(0,s.useRef)(null);let m=(0,s.useCallback)(async()=>{if(e){u(e=>({...e,loading:null==e.block}));try{let t=await (0,r.lA)(e);u(e=>({...e,block:t,loading:!1,error:null}))}catch(t){let e=t instanceof Error?t.message:"Failed to load latest block";u(t=>({...t,loading:!1,error:e})),n({title:"Unable to load latest block",description:e,variant:"error"})}finally{u(e=>({...e,loading:!1}))}}},[e,n]);return{block:d.block,loading:d.loading,error:d.error,connected:d.connected,reconnecting:d.reconnecting,lastReadingTs:d.lastReadingTs,refresh:m}}function o(e,t=10,a=[]){let{push:n}=(0,l.p)(),[i,o]=(0,s.useState)(a),[c,d]=(0,s.useState)(!!e&&0===a.length),[u,m]=(0,s.useState)(null);return{history:i,loading:c,error:u,refresh:(0,s.useCallback)(async()=>{if(e){d(!0);try{let a=await (0,r.QY)(e,t);o(a),m(null)}catch(t){let e=t instanceof Error?t.message:"Failed to load block history";m(e),n({title:"Unable to load block history",description:e,variant:"error"})}finally{d(!1)}}},[t,n,e])}}},9905:(e,t,a)=>{a.d(t,{QY:()=>h,lA:()=>m,Mf:()=>u}),process.env.NEXT_PUBLIC_BACKEND_WRITE_TOKEN,process.env.NEXT_PUBLIC_BACKEND_KEY,process.env.NEXT_PUBLIC_BACKEND_API_KEY;let s="/api/bridge",r=new Set([429,500,502,503,504]);class l extends Error{constructor(e,t,a,s){super(e),this.status=t,this.code=a,this.details=s}}async function n(e){let t=await e.text();if(t)try{return JSON.parse(t)}catch(t){throw new l(`Invalid JSON response: ${t.message}`,e.status)}}async function i(e){let t;try{t=await e.clone().json()}catch{}if(!t)try{let t=await e.text();if(t)return new l(t,e.status)}catch{}let a=t?.error?.message??t?.message??e.statusText??`Request failed with status ${e.status}`,s=t?.error?.code,r=t?.error?.details;if(t&&t.detail){r=t.detail;try{if(Array.isArray(t.detail)){let e=t.detail.map(e=>e?.msg||e?.detail||"Validation error").filter(Boolean);e.length>0&&(a=e.join("; "))}else"string"==typeof t.detail&&(a=t.detail)}catch{}}return new l(a,e.status,s,r)}function o(e){return new Promise(t=>setTimeout(t,e))}async function c(e,t,a={}){let c=function(e){if(!s)throw new l("Backend base URL is not configured.",0);return e.startsWith("http")?e:`${s}${e}`}(e);c=`http://localhost${c}`;let d=a.retryDelays??[],u=0,m=new Headers(t?.headers);m.set("Accept","application/json");let h={...t,headers:m};for(;;)try{let e=await fetch(c,h);if(!e.ok){var x;let t=await i(e);if(x=e.status,r.has(x)&&u<d.length){await o(d[u++]);continue}throw t}if(204===e.status)return;return await n(e)}catch(e){if(e instanceof l)throw e;if(u<d.length){await o(d[u++]);continue}throw e}}async function d(e,t){try{return await c(e,t)}catch(a){if(!(a instanceof l))return await c(e,t,{retryDelays:[500]});throw a}}async function u(){let e=await d("/api/v1/simulators");return Array.isArray(e)?e:e.data??[]}async function m(e){return await d(`/api/v1/blocks/latest?simulator_id=${encodeURIComponent(e)}`)}async function h(e,t=10){let a=await d(`/api/v1/blocks/history?simulator_id=${encodeURIComponent(e)}&limit=${t}`);return Array.isArray(a)?a:a.data??[]}}};