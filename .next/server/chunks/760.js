"use strict";exports.id=760,exports.ids=[760],exports.modules={33020:(e,t,a)=>{a.d(t,{J:()=>l});var s=a(10326);let r=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function l({history:e,loading:t}){return(0,s.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-white",children:"History (last 10 blocks)"}),t?s.jsx("ul",{className:"mt-4 space-y-3",children:Array.from({length:4}).map((e,t)=>s.jsx("li",{className:"h-12 animate-pulse rounded-md bg-slate-800/40"},t))}):0===e.length?s.jsx("p",{className:"mt-4 text-sm text-slate-400",children:"No block history yet. Run the simulator to populate readings."}):s.jsx("ul",{className:"mt-4 space-y-3",children:e.map((e,t)=>{let a=e.percent_of_target,l="";try{let t=new Date(e.block_start_local),a=new Date(t.getTime()+18e5);l=`${r.format(t)} – ${r.format(a)}`}catch{l=e.block_start_local}return(0,s.jsxs)("li",{className:"flex items-center justify-between rounded-lg border border-slate-800 bg-slate-950/60 px-4 py-3 text-sm",children:[(0,s.jsxs)("div",{children:[s.jsx("p",{className:"font-medium text-slate-100",children:l}),(0,s.jsxs)("p",{className:"text-xs text-slate-500",children:[e.accumulated_kwh.toFixed(2)," / ",e.target_kwh.toFixed(1)," kWh"]})]}),(0,s.jsxs)("span",{className:`text-sm font-semibold ${a>100?"text-danger":a>=80?"text-warning":"text-success"}`,children:[a.toFixed(1),"%"]})]},`${e.block_start_local}-${t}`)})})]})}},20:(e,t,a)=>{a.d(t,{l:()=>w});var s=a(10326),r=a(14958),l=a(49844),i=a(74390),n=a(8564),o=a(99630),d=a(34734),c=a(30660),u=a(18423),m=a(62637),h=a(9997),x=a(44675),b=a(17577);let f="Asia/Kuala_Lumpur",g=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:f}),p=new Intl.NumberFormat(void 0,{maximumFractionDigits:2});function j(e,t,a){let s=e.replace("#",""),r=t.replace("#",""),l=parseInt(s.substr(0,2),16),i=parseInt(s.substr(2,2),16),n=parseInt(s.substr(4,2),16),o=parseInt(r.substr(0,2),16),d=parseInt(r.substr(2,2),16),c=parseInt(r.substr(4,2),16);return`#${[Math.round(l+(o-l)*a),Math.round(i+(d-i)*a),Math.round(n+(c-n)*a)].map(e=>{let t=e.toString(16);return 1===t.length?"0"+t:t}).join("")}`}function w({block:e,loading:t,targetKwh:a,targetPeakKwh:w,mode:y,lastReadingTs:N}){let k=a??e?.target_kwh??0,{data:_,startTs:F,endTs:A,binSeconds:T}=function(e,t,a){if(!e||!e.block_start_local){let e=new Date().getTime();return{data:Array(60).fill(null).map((t,a)=>({ts:e+(a+1)*3e4,value:0})),startTs:e,endTs:e+18e5,binSeconds:30}}let s=new Date(e.block_start_local).getTime(),r=e.chart_bins?.points??[],l=e.chart_bins?.bin_seconds??30,i=[];if("accumulate"===t)i=r.map((e,t)=>({ts:s+(t+1)*l*1e3,value:e}));else{let e=a?a/60:0;i=r.map((t,a)=>{let i=t-(0===a?0:r[a-1]),n=e>0?i/e*100:0;return{ts:s+(a+1)*l*1e3,value:i,color:function(e){let t=Math.max(0,Math.min(120,e));return t<=50?j("#22c55e","#84cc16",t/50):t<=75?j("#84cc16","#eab308",(t-50)/25):t<=90?j("#eab308","#f97316",(t-75)/15):t<=100?j("#f97316","#ef4444",(t-90)/10):j("#ef4444","#dc2626",Math.min(1,(t-100)/20))}(n),percentOfTarget:n}})}return{data:Array(Math.floor(1800/l)).fill(null).map((e,t)=>{let a=s+(t+1)*l*1e3;return i.find(e=>e.ts===a)??{ts:a,value:0,color:"#22c55e",percentOfTarget:0}}),startTs:s,endTs:s+18e5,binSeconds:l}}(e,y,w),S=function(e,t){try{let a=new Date(e),s=new Date(t);return function(e,t,a="Asia/Kuala_Lumpur"){let s=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:a});try{let a=new Date(e),r=new Date(t);return`${s.format(a)} – ${s.format(r)}`}catch{return"Invalid time range"}}(a.toISOString(),s.toISOString(),f)}catch{return"Invalid time range"}}(F,A),D="accumulate"===y;(0,b.useRef)([]);let[E,$]=(0,b.useState)(new Map),[I,C]=(0,b.useState)([]);(0,b.useRef)(null);let[M,R]=(0,b.useState)(0),K=D?r.w:l.v,W=D?s.jsx(i.x,{type:"monotone",dataKey:"value",stroke:"#22d3ee",strokeWidth:2,dot:!1,isAnimationActive:!0,animationDuration:800}):s.jsx(n.$,{dataKey:"value",radius:[4,4,0,0],isAnimationActive:!0,animationDuration:1500,animationBegin:0,children:I.map((e,t)=>{let a=E.get(t)||e.color||"#22c55e";return s.jsx(o.b,{fill:a,style:{transition:"fill 1.2s cubic-bezier(0.4, 0, 0.2, 1)"}},`cell-${e.ts}-${t}`)})}),L=D?s.jsx(d.d,{y:k,stroke:"#f97316",strokeDasharray:"6 6"}):w?s.jsx(d.d,{y:w/60,stroke:"rgba(255, 255, 255, 0.18)",strokeWidth:2,strokeDasharray:"4 4",label:{value:"Peak Target",position:"right",fill:"rgba(255, 255, 255, 0.6)",fontSize:11}}):null;return(0,s.jsxs)("article",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-4 sm:p-6",children:[(0,s.jsxs)("header",{className:"mb-4 sm:mb-6 flex flex-col sm:flex-row sm:items-end sm:justify-between gap-2 sm:gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-white",children:"Current 30-minute block"}),(0,s.jsxs)("p",{className:"text-xs sm:text-sm text-slate-400",children:["Window ",S]})]}),s.jsx("div",{className:"rounded-md border border-slate-800 px-3 sm:px-4 py-2 text-xs text-slate-400",children:D?(0,s.jsxs)(s.Fragment,{children:["Target ",k.toFixed(1)," kWh \xb7 Accumulated ",e?.accumulated_kwh.toFixed(2)??"—"," kWh"]}):(0,s.jsxs)(s.Fragment,{children:["Target ",w?.toFixed(1)??"—"," kWh (total for 30min) \xb7 Target per bin ",(w?w/60:0).toFixed(3)," kWh"]})})]}),s.jsx("div",{className:"h-48 md:h-72 w-full",children:t&&!e?s.jsx("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:s.jsx("span",{className:"text-sm text-slate-500",children:"Loading chart…"})}):0===_.length||_.every(e=>0===e.value)?s.jsx("div",{className:"flex h-full items-center justify-center rounded-xl border border-dashed border-slate-800 bg-slate-950/40",children:s.jsx("span",{className:"text-sm text-slate-500",children:"No readings for this block yet."})}):s.jsx(c.h,{width:"100%",height:"100%",children:(0,s.jsxs)(K,{data:D?_:I,margin:{left:12,right:12,top:12,bottom:12},children:[s.jsx(u.q,{strokeDasharray:"4 4",stroke:"#1f2937"}),s.jsx(m.K,{dataKey:"ts",type:"number",domain:[F,A],tickFormatter:e=>g.format(e),stroke:"#64748b",tickLine:!1}),s.jsx(h.B,{dataKey:"value",stroke:"#64748b",tickLine:!1,width:60,tickFormatter:e=>p.format(e)}),s.jsx(x.u,{content:s.jsx(v,{target:k,targetPeakKwh:w,mode:y,binSeconds:T})}),L,W]},D?void 0:`chart-${M}`)})}),s.jsx("p",{className:"mt-4 text-xs text-slate-500",children:"Streaming series updates replace the entire 60-point window whenever the backend publishes a block update."})]})}function v({active:e,payload:t,label:a,target:r,targetPeakKwh:l,mode:i,binSeconds:n}){if(!e||!t||0===t.length||!a)return null;let o=t[0]?.value??0,d=g.format(a);if("accumulate"===i){let e=r>0?(o/r*100).toFixed(1):"0";return(0,s.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-xs text-slate-200 shadow-lg",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[d," \xb7 ",p.format(o)," kWh"]}),(0,s.jsxs)("p",{className:"text-slate-400",children:["Accumulated \xb7 ",e,"% of target"]})]})}let c=l?l/60:0,u=c>0?(o/c*100).toFixed(1):"0",m=t[0]?.payload?.color||"#22c55e",h=parseFloat(u),x="Green";return x=h>=100?"Red (≥100%)":h>=90?"Orange-Red (90-100%)":h>=75?"Yellow-Orange (75-90%)":h>=50?"Yellow-Green (50-75%)":"Green (<50%)",(0,s.jsxs)("div",{className:"rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-xs text-slate-200 shadow-lg",children:[(0,s.jsxs)("p",{className:"font-semibold",children:[d," \xb7 ",p.format(o)," kWh"]}),(0,s.jsxs)("p",{className:"text-slate-400",children:["Peak usage per ",n,"s \xb7 ",u,"% of peak target"]}),(0,s.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[s.jsx("div",{className:"h-3 w-3 rounded",style:{backgroundColor:m}}),s.jsx("span",{className:"text-slate-400",children:x})]})]})}},70065:(e,t,a)=>{a.d(t,{C:()=>i});var s=a(10326),r=a(17577);let l=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function i({connected:e,reconnecting:t,lastReadingTs:a,block:i,targetKwh:n,targetPeakKwh:o}){let[d,c]=(0,r.useState)(new Date),u="bg-slate-500",m="Disconnected";e?(u="bg-emerald-400 animate-pulse",m="Connected"):t&&(u="bg-amber-400 animate-pulse",m="Reconnecting");let h=a?l.format(new Date(a)):"—",x=o??n??i?.target_kwh??0,b=function(e,t){let a,s;if(!e||!e.block_start_local||t<=0)return{projectedTotal:0,status:"SAFE",color:"bg-emerald-500",elapsedMinutes:0,currentAccumulated:0,fillPercentage:0};let r=new Date(e.block_start_local),l=Math.min(30,Math.max(0,new Date().getTime()-r.getTime())/6e4),i=e.accumulated_kwh??0,n=Math.min(100,i/t*100);if(l<1||0===i)return{projectedTotal:i,status:n<80?"SAFE":n<100?"VERY CLOSE":"OVER",color:n<80?"bg-emerald-500":n<100?"bg-amber-500":"bg-red-500",elapsedMinutes:l,currentAccumulated:i,fillPercentage:n};let o=i/l*30,d=o/t*100;return d<80?(a="SAFE",s="bg-emerald-500"):d<100?(a="VERY CLOSE",s="bg-amber-500"):(a="OVER",s="bg-red-500"),{projectedTotal:o,status:a,color:s,elapsedMinutes:l,currentAccumulated:i,fillPercentage:n}}(i,x);return(0,s.jsxs)("div",{className:"rounded-2xl border border-slate-800 bg-slate-900/60 p-6",children:[s.jsx("h2",{className:"text-lg font-semibold text-white",children:"Live status"}),(0,s.jsxs)("div",{className:"mt-4 flex items-center gap-3",children:[s.jsx("span",{className:`h-3 w-3 rounded-full ${u}`,"aria-hidden":"true"}),s.jsx("span",{className:"text-sm text-slate-200",children:m})]}),s.jsx("dl",{className:"mt-4 space-y-2 text-xs text-slate-400",children:(0,s.jsxs)("div",{children:[s.jsx("dt",{className:"uppercase tracking-[0.2em] text-slate-500",children:"Last reading"}),s.jsx("dd",{className:"mt-1 text-sm text-slate-200",children:h})]})}),i&&x>0&&(0,s.jsxs)("div",{className:"mt-6 space-y-4",children:[s.jsx("div",{className:"text-xs uppercase tracking-[0.2em] text-slate-500 mb-3",children:"Usage Bucket"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"relative h-48 w-full rounded-b-lg border-4 border-slate-600 bg-slate-800/50 overflow-hidden",children:[(0,s.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 transition-all duration-500 ease-out",style:{height:`${Math.min(100,b.fillPercentage)}%`,backgroundColor:b.fillPercentage<80?"#22c55e":b.fillPercentage<100?"#f59e0b":"#ef4444"},children:[s.jsx("div",{className:"absolute inset-0 opacity-20 bg-gradient-to-t from-transparent via-white to-transparent animate-pulse"}),b.fillPercentage>0&&s.jsx("div",{className:"absolute top-0 left-0 right-0 h-0.5 bg-white/50"})]}),s.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-amber-400 opacity-60",style:{bottom:"20%"},children:s.jsx("span",{className:"absolute -left-12 -top-2 text-xs text-amber-400",children:"80%"})}),s.jsx("div",{className:"absolute left-0 right-0 border-t-2 border-dashed border-red-400 opacity-60",style:{bottom:"0%"},children:s.jsx("span",{className:"absolute -left-12 -top-2 text-xs text-red-400",children:"100%"})}),s.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"text-2xl font-bold text-white drop-shadow-lg",children:[b.currentAccumulated.toFixed(2)," kWh"]}),(0,s.jsxs)("div",{className:"text-xs text-slate-300 mt-1",children:[b.fillPercentage.toFixed(1),"% filled"]})]})})]}),s.jsx("div",{className:"absolute -top-2 -left-3 w-8 h-4 border-2 border-slate-600 rounded-t-full"}),s.jsx("div",{className:"absolute -top-2 -right-3 w-8 h-4 border-2 border-slate-600 rounded-t-full"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,s.jsxs)("div",{className:"rounded border border-slate-700 bg-slate-800/50 p-2",children:[s.jsx("div",{className:"text-slate-400",children:"Target"}),(0,s.jsxs)("div",{className:"text-white font-semibold",children:[x.toFixed(2)," kWh"]})]}),(0,s.jsxs)("div",{className:"rounded border border-slate-700 bg-slate-800/50 p-2",children:[s.jsx("div",{className:"text-slate-400",children:"Current"}),(0,s.jsxs)("div",{className:"text-white font-semibold",children:[b.currentAccumulated.toFixed(2)," kWh"]})]})]}),(0,s.jsxs)("div",{className:`${b.color} rounded-lg p-4 text-center shadow-lg`,children:[s.jsx("div",{className:"text-2xl font-bold text-white",children:b.status}),(0,s.jsxs)("div",{className:"mt-2 text-xs text-white/90",children:["Projected: ",b.projectedTotal.toFixed(2)," kWh"]}),(0,s.jsxs)("div",{className:"mt-1 text-xs text-white/80",children:["(",(b.projectedTotal/x*100).toFixed(1),"% of target)"]}),b.elapsedMinutes>0&&(0,s.jsxs)("div",{className:"mt-1 text-xs text-white/70",children:["Based on ",b.elapsedMinutes.toFixed(1)," min avg"]})]})]})]})}},90422:(e,t,a)=>{a.d(t,{AF:()=>n,NX:()=>o,a1:()=>i});var s=a(17577),r=a(18069),l=a(11004);function i(e=[]){let{push:t}=(0,l.p)(),[a,i]=(0,s.useState)(e),[n,o]=(0,s.useState)(0===e.length),[d,c]=(0,s.useState)(null),u=(0,s.useCallback)(async()=>{o(!0);try{let e=await (0,r.Mf)();i(e),c(null)}catch(a){let e=a instanceof Error?a.message:"Failed to load simulators";c(e),t({title:"Unable to load simulators",description:e,variant:"error"})}finally{o(!1)}},[t]),m=(0,s.useCallback)(async e=>{try{let a=await (0,r.ji)(e);return await u(),t({title:"Simulator created",description:`${a.name} is ready to run.`,variant:"success"}),a}catch(a){let e=a instanceof Error?a.message:"Failed to create simulator";throw console.error("Create simulator failed",a),t({title:"Create simulator failed",description:e,variant:"error"}),a}},[t,u]);return(0,s.useMemo)(()=>({simulators:a,loading:n,error:d,refresh:u,create:m}),[a,n,d,u,m])}function n(e,t={},a=null){let{push:i,dismiss:n}=(0,l.p)(),{onAlert80pct:o,onWindowChange:d}=t,[c,u]=(0,s.useState)({block:a,loading:!a&&!!e,error:null,connected:!1,reconnecting:!1,lastReadingTs:void 0});(0,s.useRef)(!1),(0,s.useRef)(null);let m=(0,s.useCallback)(async()=>{if(e){u(e=>({...e,loading:null==e.block}));try{let t=await (0,r.lA)(e);u(e=>({...e,block:t,loading:!1,error:null}))}catch(t){let e=t instanceof Error?t.message:"Failed to load latest block";u(t=>({...t,loading:!1,error:e})),i({title:"Unable to load latest block",description:e,variant:"error"})}finally{u(e=>({...e,loading:!1}))}}},[e,i]);return{block:c.block,loading:c.loading,error:c.error,connected:c.connected,reconnecting:c.reconnecting,lastReadingTs:c.lastReadingTs,refresh:m}}function o(e,t=10,a=[]){let{push:i}=(0,l.p)(),[n,o]=(0,s.useState)(a),[d,c]=(0,s.useState)(!!e&&0===a.length),[u,m]=(0,s.useState)(null);return{history:n,loading:d,error:u,refresh:(0,s.useCallback)(async()=>{if(e){c(!0);try{let a=await (0,r.QY)(e,t);o(a),m(null)}catch(t){let e=t instanceof Error?t.message:"Failed to load block history";m(e),i({title:"Unable to load block history",description:e,variant:"error"})}finally{c(!1)}}},[t,i,e])}}},9905:(e,t,a)=>{a.d(t,{QY:()=>h,lA:()=>m,Mf:()=>u}),process.env.NEXT_PUBLIC_BACKEND_WRITE_TOKEN,process.env.NEXT_PUBLIC_BACKEND_KEY,process.env.NEXT_PUBLIC_BACKEND_API_KEY;let s="/api/bridge",r=new Set([429,500,502,503,504]);class l extends Error{constructor(e,t,a,s){super(e),this.status=t,this.code=a,this.details=s}}async function i(e){let t=await e.text();if(t)try{return JSON.parse(t)}catch(t){throw new l(`Invalid JSON response: ${t.message}`,e.status)}}async function n(e){let t;try{t=await e.clone().json()}catch{}if(!t)try{let t=await e.text();if(t)return new l(t,e.status)}catch{}let a=t?.error?.message??t?.message??e.statusText??`Request failed with status ${e.status}`,s=t?.error?.code,r=t?.error?.details;if(t&&t.detail){r=t.detail;try{if(Array.isArray(t.detail)){let e=t.detail.map(e=>e?.msg||e?.detail||"Validation error").filter(Boolean);e.length>0&&(a=e.join("; "))}else"string"==typeof t.detail&&(a=t.detail)}catch{}}return new l(a,e.status,s,r)}function o(e){return new Promise(t=>setTimeout(t,e))}async function d(e,t,a={}){let d=function(e){if(!s)throw new l("Backend base URL is not configured.",0);return e.startsWith("http")?e:`${s}${e}`}(e);d=`http://localhost${d}`;let c=a.retryDelays??[],u=0,m=new Headers(t?.headers);m.set("Accept","application/json");let h={...t,headers:m};for(;;)try{let e=await fetch(d,h);if(!e.ok){var x;let t=await n(e);if(x=e.status,r.has(x)&&u<c.length){await o(c[u++]);continue}throw t}if(204===e.status)return;return await i(e)}catch(e){if(e instanceof l)throw e;if(u<c.length){await o(c[u++]);continue}throw e}}async function c(e,t){try{return await d(e,t)}catch(a){if(!(a instanceof l))return await d(e,t,{retryDelays:[500]});throw a}}async function u(){let e=await c("/api/v1/simulators");return Array.isArray(e)?e:e.data??[]}async function m(e){return await c(`/api/v1/blocks/latest?simulator_id=${encodeURIComponent(e)}`)}async function h(e,t=10){let a=await c(`/api/v1/blocks/history?simulator_id=${encodeURIComponent(e)}&limit=${t}`);return Array.isArray(a)?a:a.data??[]}}};