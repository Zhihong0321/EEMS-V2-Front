(()=>{var e={};e.id=998,e.ids=[998],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},26325:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>m,originalPathname:()=>d,pages:()=>u,routeModule:()=>p,tree:()=>c}),s(86512),s(35866),s(53871);var r=s(23191),a=s(88716),n=s(37922),i=s.n(n),o=s(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c=["",{children:["(sim)",{children:["[id]",{children:["run",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,86512)),"E:\\EEMS-Front\\src\\app\\(sim)\\[id]\\run\\page.tsx"]}]},{}]},{}]},{"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,53871)),"E:\\EEMS-Front\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],u=["E:\\EEMS-Front\\src\\app\\(sim)\\[id]\\run\\page.tsx"],d="/(sim)/[id]/run/page",m={require:s,loadChunk:()=>Promise.resolve()},p=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(sim)/[id]/run/page",pathname:"/[id]/run",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},25993:(e,t,s)=>{Promise.resolve().then(s.bind(s,42266))},42266:(e,t,s)=>{"use strict";s.d(t,{SimulatorRunContent:()=>c});var r=s(10326),a=s(17577),n=s(90434),i=s(42898),o=s(54053),l=s(902);function c({simulatorId:e,simulatorName:t,targetKwh:s}){let[c,u]=(0,a.useState)(320),[d,m]=(0,a.useState)(12),[p,h]=(0,a.useState)(.5),[f,g]=(0,a.useState)(800),x=(0,a.useMemo)(()=>p*f,[p,f]),y=(0,l.V)(e,c,d),w=(0,l.o)(e,()=>x),b=()=>{y.isRunning?y.stop():(w.stop(),y.start())},v=()=>{w.isRunning?w.stop():(y.stop(),w.start())};return(0,r.jsxs)("section",{className:"space-y-10",children:[(0,r.jsxs)("header",{className:"flex flex-wrap items-end justify-between gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Simulator controls"}),r.jsx("h1",{className:"text-3xl font-semibold text-white",children:t}),r.jsx("p",{className:"text-sm text-slate-400",children:"Configure auto and manual emitters. Only one mode can run at a time to avoid duplicate ticks."}),(0,r.jsxs)("p",{className:"text-xs text-slate-500",children:["Target block: ",s?`${s} kWh`:"â€”"," \xb7 Timezone ","Asia/Kuala_Lumpur"]})]}),r.jsx(n.default,{href:{pathname:"/sim/[id]",query:{id:e}},className:"inline-flex items-center rounded-md border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:border-slate-500 hover:text-white",children:"Back to dashboard"})]}),(0,r.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[r.jsx(i.l,{baseKw:c,onBaseKwChange:u,volatility:d,onVolatilityChange:m,isRunning:y.isRunning,onStart:b,onStop:b,sentCount:y.sentCount,lastSentAt:y.lastSentAt,disabled:w.isRunning,disabledReason:w.isRunning?"Manual emitter is active. Stop it before running auto mode.":void 0}),r.jsx(o.x,{sliderValue:p,onSliderChange:h,maxKw:f,onMaxKwChange:g,isRunning:w.isRunning,onStart:v,onStop:v,sentCount:w.sentCount,lastSentAt:w.lastSentAt,disabled:y.isRunning,disabledReason:y.isRunning?"Auto emitter is active. Stop it before running manual mode.":void 0})]}),(0,r.jsxs)("p",{className:"text-xs text-slate-500",children:["Auto mode sends gaussianised readings every 15 seconds; manual fast-forward emits every second with ",r.jsx("code",{className:"rounded bg-slate-800 px-1 py-0.5",children:"sample_seconds=30"})," so the backend advances by 30 seconds per tick (30x speed)."]})]})}},91664:(e,t,s)=>{"use strict";s.d(t,{z:()=>o});var r=s(10326),a=s(17577),n=s(41135);let i={variant:{primary:"bg-primary text-white shadow-sm hover:bg-cyan-600 hover:shadow-md active:scale-95",secondary:"border border-slate-700 bg-transparent text-slate-200 hover:bg-slate-800 hover:border-slate-600",ghost:"hover:bg-slate-800/50 text-slate-300 hover:text-white",danger:"bg-danger text-white shadow-sm hover:bg-red-600 hover:shadow-md active:scale-95",success:"bg-success text-white shadow-sm hover:bg-green-600 hover:shadow-md active:scale-95"},size:{sm:"px-3 py-1.5 text-xs min-h-[36px]",md:"px-4 py-2 text-sm min-h-[44px]",lg:"px-6 py-3 text-base min-h-[48px]"}},o=(0,a.forwardRef)(({className:e,variant:t="primary",size:s="md",isLoading:a,children:o,disabled:l,...c},u)=>(0,r.jsxs)("button",{className:(0,n.Z)("inline-flex items-center justify-center gap-2 rounded-md font-semibold transition-all duration-150","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950","disabled:pointer-events-none disabled:opacity-50",i.variant[t],i.size[s],e),ref:u,disabled:l||a,...c,children:[a&&(0,r.jsxs)("svg",{className:"h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r.jsx("span",{className:a?"opacity-70":"",children:o})]}));o.displayName="Button"},41190:(e,t,s)=>{"use strict";s.d(t,{II:()=>o,Ph:()=>l,SP:()=>c});var r=s(10326),a=s(17577),n=s(41135),i=s(19381);let o=(0,a.forwardRef)(({className:e,error:t,success:s,...a},i)=>r.jsx("input",{className:(0,n.Z)("w-full rounded-md border px-3 py-2 text-sm text-white transition-colors duration-150","placeholder:text-slate-500","focus:outline-none focus:ring-2","disabled:opacity-50 disabled:cursor-not-allowed",t?"border-danger bg-danger/5 focus:border-danger focus:ring-danger/20":s?"border-success bg-success/5 focus:border-success focus:ring-success/20":"border-slate-800 bg-slate-950/60 focus:border-primary focus:ring-primary/20",e),ref:i,...a}));o.displayName="Input";let l=(0,a.forwardRef)(({className:e,error:t,success:s,children:a,...i},o)=>r.jsx("select",{className:(0,n.Z)("w-full rounded-md border px-3 py-2 text-sm text-white transition-colors duration-150","focus:outline-none focus:ring-2","disabled:opacity-50 disabled:cursor-not-allowed",t?"border-danger bg-danger/5 focus:border-danger focus:ring-danger/20":s?"border-success bg-success/5 focus:border-success focus:ring-success/20":"border-slate-800 bg-slate-950/60 focus:border-primary focus:ring-primary/20",e),ref:o,...i,children:a}));function c({label:e,error:t,helperText:s,required:a,children:n}){return(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-slate-300",children:[e,a&&r.jsx("span",{className:"text-danger ml-1",children:"*"})]}),n,t&&(0,r.jsxs)("p",{className:"text-xs text-danger flex items-center gap-1",children:[r.jsx(i.Z,{className:"h-4 w-4","aria-hidden":"true"}),t]}),!t&&s&&r.jsx("p",{className:"text-xs text-slate-500",children:s})]})}l.displayName="Select"},4753:(e,t,s)=>{"use strict";s.d(t,{Dr:()=>o,HM:()=>d,Oz:()=>u,Qu:()=>p,tQ:()=>h,w:()=>m,wC:()=>c,wE:()=>l});let r=[{name:"NEXT_PUBLIC_BACKEND_TOKEN",value:"01121000099"},{name:"NEXT_PUBLIC_BACKEND_WRITE_TOKEN",value:process.env.NEXT_PUBLIC_BACKEND_WRITE_TOKEN},{name:"NEXT_PUBLIC_BACKEND_KEY",value:process.env.NEXT_PUBLIC_BACKEND_KEY},{name:"NEXT_PUBLIC_BACKEND_API_KEY",value:process.env.NEXT_PUBLIC_BACKEND_API_KEY}],a=null,n=!1;function i(){for(let e of r)if(e.value)return{name:e.name,value:e.value};return null}function o(){return i()?.value??""}function l(){return i()?.name??null}function c(){return n&&!!a}function u(e,t){a=e.trim()||null,n=!!(t?.persist&&a)}function d(){a=null,n=!1}function m(){return a||o()}function p(){return m().length>0}function h(){return o().length>0}},18069:(e,t,s)=>{"use strict";s.d(t,{Aq:()=>v,Bj:()=>h,CT:()=>a,LK:()=>p,M8:()=>b,Mf:()=>f,QY:()=>w,aj:()=>x,b0:()=>m,he:()=>_,ji:()=>g,lA:()=>y});var r=s(4753);let a="/api/bridge",n=new Set([429,500,502,503,504]);class i extends Error{constructor(e,t,s,r){super(e),this.status=t,this.code=s,this.details=r}}function o(e){if(!a)throw new i("Backend base URL is not configured.",0);return e.startsWith("http")?e:`${a}${e}`}async function l(e){let t=await e.text();if(t)try{return JSON.parse(t)}catch(t){throw new i(`Invalid JSON response: ${t.message}`,e.status)}}async function c(e){let t;try{t=await e.clone().json()}catch{}if(!t)try{let t=await e.text();if(t)return new i(t,e.status)}catch{}let s=t?.error?.message??t?.message??e.statusText??`Request failed with status ${e.status}`,r=t?.error?.code,a=t?.error?.details;if(t&&t.detail){a=t.detail;try{if(Array.isArray(t.detail)){let e=t.detail.map(e=>e?.msg||e?.detail||"Validation error").filter(Boolean);e.length>0&&(s=e.join("; "))}else"string"==typeof t.detail&&(s=t.detail)}catch{}}return new i(s,e.status,r,a)}function u(e){return new Promise(t=>setTimeout(t,e))}async function d(e,t,s={}){let r=o(e);r=`http://localhost${r}`;let a=s.retryDelays??[],d=0,m=new Headers(t?.headers);m.set("Accept","application/json");let p={...t,headers:m};for(;;)try{let e=await fetch(r,p);if(!e.ok){var h;let t=await c(e);if(h=e.status,n.has(h)&&d<a.length){await u(a[d++]);continue}throw t}if(204===e.status)return;return await l(e)}catch(e){if(e instanceof i)throw e;if(d<a.length){await u(a[d++]);continue}throw e}}function m(e){let t=new Headers(e?.headers);t.set("Content-Type","application/json");let s=(0,r.w)();return s?t.set("x-api-key",s):t.delete("x-api-key"),{...e,headers:t}}async function p(e,t){try{return await d(e,t)}catch(s){if(!(s instanceof i))return await d(e,t,{retryDelays:[500]});throw s}}function h(e){return o(e)}async function f(){let e=await p("/api/v1/simulators");return Array.isArray(e)?e:e.data??[]}async function g(e){let t=await d("/api/v1/simulators",m({method:"POST",body:JSON.stringify(e)}),{retryDelays:[500,1500,3500]});return"data"in t?t.data:t}async function x(e){console.log("deleteSimulator called with id:",e);try{await d(`/api/v1/simulators/${e}`,m({method:"DELETE"}),{retryDelays:[500,1500]}),console.log("deleteSimulator successful for id:",e)}catch(t){throw console.error("deleteSimulator error for id:",e,t),t}}async function y(e){return await p(`/api/v1/blocks/latest?simulator_id=${encodeURIComponent(e)}`)}async function w(e,t=10){let s=await p(`/api/v1/blocks/history?simulator_id=${encodeURIComponent(e)}&limit=${t}`);return Array.isArray(s)?s:s.data??[]}async function b(e){await d("/api/v1/readings:ingest",m({method:"POST",body:JSON.stringify(e)}),{retryDelays:[500,1500,3500]})}async function v(e){try{let t=new Date().toISOString();await d(`/api/v1/readings?simulator_id=${encodeURIComponent(e)}&before=${encodeURIComponent(t)}`,m({method:"DELETE"}),{retryDelays:[500,1500]})}catch(t){try{await d(`/api/v1/simulators/${encodeURIComponent(e)}/readings`,m({method:"DELETE"}),{retryDelays:[500,1500]})}catch(e){console.warn("Failed to delete future readings from backend:",t,e)}}}async function _(e){try{let t=await y(e);if(t.chart_bins?.points&&t.chart_bins.points.length>0){let e=new Date(t.block_start_local),s=t.chart_bins.bin_seconds||30,r=t.chart_bins.points.length;return new Date(e.getTime()+r*s*1e3).toISOString()}return null}catch(e){return console.warn("Failed to fetch last reading timestamp:",e),null}}},86512:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var r=s(19510),a=s(68570);let n=(0,a.createProxy)(String.raw`E:\EEMS-Front\src\components\run\simulator-run-content.tsx`),{__esModule:i,$$typeof:o}=n;n.default;let l=(0,a.createProxy)(String.raw`E:\EEMS-Front\src\components\run\simulator-run-content.tsx#SimulatorRunContent`);var c=s(9905);async function u({params:e}){let t;let s=e.id,a=`Simulator ${s}`;try{let e=(await (0,c.Mf)()).find(e=>e.id===s);e&&(a=e.name,t=e.target_kwh)}catch(e){console.error("Failed to load simulator metadata",e)}return r.jsx(l,{simulatorId:s,simulatorName:a,targetKwh:t})}},9905:(e,t,s)=>{"use strict";s.d(t,{QY:()=>p,lA:()=>m,Mf:()=>d}),process.env.NEXT_PUBLIC_BACKEND_WRITE_TOKEN,process.env.NEXT_PUBLIC_BACKEND_KEY,process.env.NEXT_PUBLIC_BACKEND_API_KEY;let r="/api/bridge",a=new Set([429,500,502,503,504]);class n extends Error{constructor(e,t,s,r){super(e),this.status=t,this.code=s,this.details=r}}async function i(e){let t=await e.text();if(t)try{return JSON.parse(t)}catch(t){throw new n(`Invalid JSON response: ${t.message}`,e.status)}}async function o(e){let t;try{t=await e.clone().json()}catch{}if(!t)try{let t=await e.text();if(t)return new n(t,e.status)}catch{}let s=t?.error?.message??t?.message??e.statusText??`Request failed with status ${e.status}`,r=t?.error?.code,a=t?.error?.details;if(t&&t.detail){a=t.detail;try{if(Array.isArray(t.detail)){let e=t.detail.map(e=>e?.msg||e?.detail||"Validation error").filter(Boolean);e.length>0&&(s=e.join("; "))}else"string"==typeof t.detail&&(s=t.detail)}catch{}}return new n(s,e.status,r,a)}function l(e){return new Promise(t=>setTimeout(t,e))}async function c(e,t,s={}){let c=function(e){if(!r)throw new n("Backend base URL is not configured.",0);return e.startsWith("http")?e:`${r}${e}`}(e);c=`http://localhost${c}`;let u=s.retryDelays??[],d=0,m=new Headers(t?.headers);m.set("Accept","application/json");let p={...t,headers:m};for(;;)try{let e=await fetch(c,p);if(!e.ok){var h;let t=await o(e);if(h=e.status,a.has(h)&&d<u.length){await l(u[d++]);continue}throw t}if(204===e.status)return;return await i(e)}catch(e){if(e instanceof n)throw e;if(d<u.length){await l(u[d++]);continue}throw e}}async function u(e,t){try{return await c(e,t)}catch(s){if(!(s instanceof n))return await c(e,t,{retryDelays:[500]});throw s}}async function d(){let e=await u("/api/v1/simulators");return Array.isArray(e)?e:e.data??[]}async function m(e){return await u(`/api/v1/blocks/latest?simulator_id=${encodeURIComponent(e)}`)}async function p(e,t=10){let s=await u(`/api/v1/blocks/history?simulator_id=${encodeURIComponent(e)}&limit=${t}`);return Array.isArray(s)?s:s.data??[]}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,808,987,548],()=>s(26325));module.exports=r})();