(()=>{var e={};e.id=998,e.ids=[998],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},26325:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>d,pages:()=>u,routeModule:()=>m,tree:()=>c}),s(86512),s(35866),s(34337);var n=s(23191),a=s(88716),r=s(37922),i=s.n(r),o=s(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c=["",{children:["(sim)",{children:["[id]",{children:["run",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,86512)),"E:\\EEMS-Front\\src\\app\\(sim)\\[id]\\run\\page.tsx"]}]},{}]},{}]},{"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,34337)),"E:\\EEMS-Front\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],u=["E:\\EEMS-Front\\src\\app\\(sim)\\[id]\\run\\page.tsx"],d="/(sim)/[id]/run/page",p={require:s,loadChunk:()=>Promise.resolve()},m=new n.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/(sim)/[id]/run/page",pathname:"/[id]/run",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},25993:(e,t,s)=>{Promise.resolve().then(s.bind(s,42266))},90434:(e,t,s)=>{"use strict";s.d(t,{default:()=>a.a});var n=s(79404),a=s.n(n)},42266:(e,t,s)=>{"use strict";s.d(t,{SimulatorRunContent:()=>c});var n=s(10326),a=s(17577),r=s(90434),i=s(42898),o=s(54053),l=s(902);function c({simulatorId:e,simulatorName:t,targetKwh:s}){let[c,u]=(0,a.useState)(320),[d,p]=(0,a.useState)(12),[m,x]=(0,a.useState)(.5),[h,g]=(0,a.useState)(800),f=(0,a.useMemo)(()=>m*h,[m,h]),y=(0,l.V)(e,c,d),w=(0,l.o)(e,()=>f),v=()=>{y.isRunning?y.stop():(w.stop(),y.start())},b=()=>{w.isRunning?w.stop():(y.stop(),w.start())};return(0,n.jsxs)("section",{className:"space-y-10",children:[(0,n.jsxs)("header",{className:"flex flex-wrap items-end justify-between gap-4",children:[(0,n.jsxs)("div",{className:"space-y-2",children:[n.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Simulator controls"}),n.jsx("h1",{className:"text-3xl font-semibold text-white",children:t}),n.jsx("p",{className:"text-sm text-slate-400",children:"Configure auto and manual emitters. Only one mode can run at a time to avoid duplicate ticks."}),(0,n.jsxs)("p",{className:"text-xs text-slate-500",children:["Target block: ",s?`${s} kWh`:"â€”"," \xb7 Timezone ","Asia/Kuala_Lumpur"]})]}),n.jsx(r.default,{href:{pathname:"/sim/[id]",query:{id:e}},className:"inline-flex items-center rounded-md border border-slate-700 px-4 py-2 text-sm font-semibold text-slate-200 transition hover:border-slate-500 hover:text-white",children:"Back to dashboard"})]}),(0,n.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[n.jsx(i.l,{baseKw:c,onBaseKwChange:u,volatility:d,onVolatilityChange:p,isRunning:y.isRunning,onStart:v,onStop:v,sentCount:y.sentCount,lastSentAt:y.lastSentAt,disabled:w.isRunning,disabledReason:w.isRunning?"Manual emitter is active. Stop it before running auto mode.":void 0}),n.jsx(o.x,{sliderValue:m,onSliderChange:x,maxKw:h,onMaxKwChange:g,isRunning:w.isRunning,onStart:b,onStop:b,sentCount:w.sentCount,lastSentAt:w.lastSentAt,disabled:y.isRunning,disabledReason:y.isRunning?"Auto emitter is active. Stop it before running manual mode.":void 0})]}),(0,n.jsxs)("p",{className:"text-xs text-slate-500",children:["Auto mode sends gaussianised readings every 15 seconds; manual fast-forward emits every second with ",n.jsx("code",{className:"rounded bg-slate-800 px-1 py-0.5",children:"sample_seconds=30"})," so the backend advances by 30 seconds per tick (30x speed)."]})]})}},86512:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var n=s(19510),a=s(68570);let r=(0,a.createProxy)(String.raw`E:\EEMS-Front\src\components\run\simulator-run-content.tsx`),{__esModule:i,$$typeof:o}=r;r.default;let l=(0,a.createProxy)(String.raw`E:\EEMS-Front\src\components\run\simulator-run-content.tsx#SimulatorRunContent`);var c=s(9905);async function u({params:e}){let t;let s=e.id,a=`Simulator ${s}`;try{let e=(await (0,c.Mf)()).find(e=>e.id===s);e&&(a=e.name,t=e.target_kwh)}catch(e){console.error("Failed to load simulator metadata",e)}return n.jsx(l,{simulatorId:s,simulatorName:a,targetKwh:t})}},9905:(e,t,s)=>{"use strict";s.d(t,{QY:()=>m,lA:()=>p,Mf:()=>d}),process.env.NEXT_PUBLIC_BACKEND_WRITE_TOKEN,process.env.NEXT_PUBLIC_BACKEND_KEY,process.env.NEXT_PUBLIC_BACKEND_API_KEY;let n="/api/bridge",a=new Set([429,500,502,503,504]);class r extends Error{constructor(e,t,s,n){super(e),this.status=t,this.code=s,this.details=n}}async function i(e){let t=await e.text();if(t)try{return JSON.parse(t)}catch(t){throw new r(`Invalid JSON response: ${t.message}`,e.status)}}async function o(e){let t;try{t=await e.clone().json()}catch{}if(!t)try{let t=await e.text();if(t)return new r(t,e.status)}catch{}let s=t?.error?.message??t?.message??e.statusText??`Request failed with status ${e.status}`,n=t?.error?.code,a=t?.error?.details;if(t&&t.detail){a=t.detail;try{if(Array.isArray(t.detail)){let e=t.detail.map(e=>e?.msg||e?.detail||"Validation error").filter(Boolean);e.length>0&&(s=e.join("; "))}else"string"==typeof t.detail&&(s=t.detail)}catch{}}return new r(s,e.status,n,a)}function l(e){return new Promise(t=>setTimeout(t,e))}async function c(e,t,s={}){let c=function(e){if(!n)throw new r("Backend base URL is not configured.",0);return e.startsWith("http")?e:`${n}${e}`}(e);c=`http://localhost${c}`;let u=s.retryDelays??[],d=0,p=new Headers(t?.headers);p.set("Accept","application/json");let m={...t,headers:p};for(;;)try{let e=await fetch(c,m);if(!e.ok){var x;let t=await o(e);if(x=e.status,a.has(x)&&d<u.length){await l(u[d++]);continue}throw t}if(204===e.status)return;return await i(e)}catch(e){if(e instanceof r)throw e;if(d<u.length){await l(u[d++]);continue}throw e}}async function u(e,t){try{return await c(e,t)}catch(s){if(!(s instanceof r))return await c(e,t,{retryDelays:[500]});throw s}}async function d(){let e=await u("/api/v1/simulators");return Array.isArray(e)?e:e.data??[]}async function p(e){return await u(`/api/v1/blocks/latest?simulator_id=${encodeURIComponent(e)}`)}async function m(e,t=10){let s=await u(`/api/v1/blocks/history?simulator_id=${encodeURIComponent(e)}&limit=${t}`);return Array.isArray(s)?s:s.data??[]}}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[948,548,65,637],()=>s(26325));module.exports=n})();