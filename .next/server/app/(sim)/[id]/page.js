(()=>{var e={};e.id=879,e.ids=[879],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},38891:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>x,tree:()=>c}),s(7569),s(35866),s(53871);var a=s(23191),r=s(88716),n=s(37922),i=s.n(n),o=s(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c=["",{children:["(sim)",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,7569)),"E:\\EEMS-Front\\src\\app\\(sim)\\[id]\\page.tsx"]}]},{}]},{"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,53871)),"E:\\EEMS-Front\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],d=["E:\\EEMS-Front\\src\\app\\(sim)\\[id]\\page.tsx"],m="/(sim)/[id]/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(sim)/[id]/page",pathname:"/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},30513:(e,t,s)=>{Promise.resolve().then(s.bind(s,40204))},40204:(e,t,s)=>{"use strict";s.d(t,{CombinedDashboard:()=>f});var a=s(10326),r=s(17577),n=s(20),i=s(30064),o=s(70065),l=s(42898),c=s(54053),d=s(90422),m=s(902),u=s(41190),x=s(17100);let h=r.forwardRef(function({title:e,titleId:t,...s},a){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":t},s),e?r.createElement("title",{id:t},e):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z"}))});var p=s(59675),g=s(41135);let b=new Intl.NumberFormat(void 0,{maximumFractionDigits:1});function f({simulatorId:e,simulatorName:t,targetKwh:s,initialBlock:f,initialHistory:v}){let[j,w]=(0,r.useState)("dashboard"),[y,k]=(0,r.useState)("accumulate"),[N,S]=(0,r.useState)(!0),[_,C]=(0,r.useState)(null),[E,P]=(0,r.useState)(320),[F,A]=(0,r.useState)(12),[M,R]=(0,r.useState)(.5),[q,K]=(0,r.useState)(800),[I,D]=(0,r.useState)(100),T=(0,r.useMemo)(()=>M*q,[M,q]),{history:O,loading:W,refresh:Z}=(0,d.NX)(e,10,v),V=(0,r.useCallback)(()=>{Z()},[Z]),{block:G,loading:L,connected:B,reconnecting:$,lastReadingTs:X,refresh:z}=(0,d.AF)(e,{onWindowChange:V},f),H=(0,r.useCallback)(e=>{e.device_ts&&(C(e.device_ts),z())},[z]),J=(0,m.V)(e,E,F,N,H),Q=(0,m.o)(e,()=>T,N,H),U=X??_,Y=()=>{J.isRunning?J.stop():(Q.stop(),J.start())},ee=()=>{Q.isRunning?Q.stop():(J.stop(),Q.start())},et=G?.percent_of_target??0,es=et>100?"text-danger":et>=80?"text-warning":"text-success";return(0,a.jsxs)("section",{className:"space-y-6 animate-fadeIn",children:[(0,a.jsxs)("header",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Simulator Dashboard"}),a.jsx("h1",{children:t}),a.jsx("p",{className:"text-sm sm:text-base text-slate-400",children:"dashboard"===j?"Live chart and block history update in real time via server-sent events from the backend.":"Manage WhatsApp notifications for energy usage thresholds."})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-sm text-slate-300",children:[(0,a.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-3 sm:px-4 py-2 text-right",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Target"}),a.jsx("p",{className:"text-sm sm:text-base font-semibold text-slate-100",children:s?`${s.toFixed(1)} kWh`:"â€”"})]}),(0,a.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-3 sm:px-4 py-2 text-right",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Current block"}),(0,a.jsxs)("p",{className:`text-sm sm:text-base font-semibold ${es}`,children:[b.format(et),"%"]})]})]})]}),a.jsx("div",{className:"border-b border-slate-700",children:(0,a.jsxs)("nav",{className:"flex space-x-8",children:[(0,a.jsxs)("button",{onClick:()=>w("dashboard"),className:(0,g.Z)("flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors","dashboard"===j?"border-primary text-primary":"border-transparent text-slate-400 hover:text-slate-300 hover:border-slate-300"),children:[a.jsx(h,{className:"h-5 w-5"}),"Dashboard"]}),(0,a.jsxs)("button",{onClick:()=>w("notifications"),className:(0,g.Z)("flex items-center gap-2 py-4 px-1 border-b-2 font-medium text-sm transition-colors","notifications"===j?"border-primary text-primary":"border-transparent text-slate-400 hover:text-slate-300 hover:border-slate-300"),children:[a.jsx(p.Z,{className:"h-5 w-5"}),"Notifications"]})]})}),"dashboard"===j&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[a.jsx("label",{htmlFor:"chart-mode-select",className:"text-sm font-medium text-slate-300",children:"Chart Mode:"}),(0,a.jsxs)(u.Ph,{id:"chart-mode-select",value:y,onChange:e=>k(e.target.value),className:"w-full sm:w-auto","aria-label":"Select chart mode",children:[a.jsx("option",{value:"accumulate",children:"Accumulate"}),a.jsx("option",{value:"non-accumulate",children:"Non-Accumulate (Peak Usage)"})]}),"non-accumulate"===y&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("label",{htmlFor:"target-peak-kwh",className:"text-sm font-medium text-slate-300 sm:ml-4",children:"Target Accumulated (kWh):"}),a.jsx(u.II,{id:"target-peak-kwh",type:"number",value:I,onChange:e=>D(parseFloat(e.target.value)||100),min:"0",step:"0.1",className:"w-full sm:w-32","aria-label":"Target accumulated kWh for peak usage mode"})]})]}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[a.jsx(n.l,{block:G??{simulator_id:e,block_start_local:new Date().toISOString(),block_start_utc:new Date().toISOString(),block_end_utc:new Date().toISOString(),target_kwh:s??0,accumulated_kwh:0,percent_of_target:0,alerted_80pct:!1,chart_bins:{bin_seconds:30,points:[]}},loading:L,targetKwh:s,targetPeakKwh:"non-accumulate"===y?I:void 0,mode:y,lastReadingTs:U}),(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[a.jsx(o.C,{connected:B,reconnecting:$,lastReadingTs:U??void 0,block:G,targetKwh:s,targetPeakKwh:"non-accumulate"===y?I:void 0}),a.jsx(i.J,{history:O,loading:W})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 border-b border-slate-800 pb-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{children:"Simulator Controls"}),a.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Configure auto and manual emitters. Only one mode can run at a time."})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-300 min-h-[44px]",children:[a.jsx("input",{type:"checkbox",checked:N,onChange:e=>S(e.target.checked),className:"w-5 h-5 rounded border-slate-600 bg-slate-800 text-primary focus:ring-2 focus:ring-primary"}),a.jsx("span",{children:"Fast-forward (30x speed)"})]})]}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[a.jsx(l.l,{baseKw:E,onBaseKwChange:P,volatility:F,onVolatilityChange:A,isRunning:J.isRunning,onStart:Y,onStop:Y,sentCount:J.sentCount,lastSentAt:J.lastSentAt,disabled:Q.isRunning,disabledReason:Q.isRunning?"Manual emitter is active. Stop it before running auto mode.":void 0}),a.jsx(c.x,{sliderValue:M,onSliderChange:R,maxKw:q,onMaxKwChange:K,isRunning:Q.isRunning,onStart:ee,onStop:ee,sentCount:Q.sentCount,lastSentAt:Q.lastSentAt,disabled:J.isRunning,disabledReason:J.isRunning?"Auto emitter is active. Stop it before running manual mode.":void 0})]})]}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:["Timezone reference: ","Asia/Kuala_Lumpur",". Chart displays the current 30-minute block based on the last received reading timestamp (prototype mode). Fast-forward mode advances simulated time by 30 seconds per real second."]})]}),"notifications"===j&&a.jsx("div",{className:"space-y-6",children:a.jsx(x.fn,{simulatorId:e,simulatorName:t})})]})}},7569:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(19510),r=s(68570);let n=(0,r.createProxy)(String.raw`E:\EEMS-Front\src\components\dashboard\combined-dashboard.tsx`),{__esModule:i,$$typeof:o}=n;n.default;let l=(0,r.createProxy)(String.raw`E:\EEMS-Front\src\components\dashboard\combined-dashboard.tsx#CombinedDashboard`);var c=s(9905);async function d({params:e}){let t;let s=e.id,r=`Simulator ${s}`,n=null,i=[];try{let e=(await (0,c.Mf)()).find(e=>e.id===s);e&&(r=e.name,t=e.target_kwh)}catch(e){console.error("Failed to load simulators list",e)}try{n=await (0,c.lA)(s),t=t??n.target_kwh}catch(e){console.error("Failed to load latest block",e)}try{i=await (0,c.QY)(s,10)}catch(e){console.error("Failed to load block history",e)}return a.jsx(l,{simulatorId:s,simulatorName:r,targetKwh:t,initialBlock:n,initialHistory:i})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,808,18,987,916,308,100,869,548],()=>s(38891));module.exports=a})();