(()=>{var e={};e.id=879,e.ids=[879],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},38891:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>x,tree:()=>c}),s(7569),s(35866),s(53871);var a=s(23191),n=s(88716),r=s(37922),i=s.n(r),l=s(95231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["(sim)",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,7569)),"E:\\EEMS-Front\\src\\app\\(sim)\\[id]\\page.tsx"]}]},{}]},{"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,53871)),"E:\\EEMS-Front\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],d=["E:\\EEMS-Front\\src\\app\\(sim)\\[id]\\page.tsx"],m="/(sim)/[id]/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/(sim)/[id]/page",pathname:"/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},30513:(e,t,s)=>{Promise.resolve().then(s.bind(s,50040))},50040:(e,t,s)=>{"use strict";s.d(t,{CombinedDashboard:()=>p});var a=s(10326),n=s(17577),r=s(20),i=s(30064),l=s(70065),o=s(42898),c=s(54053),d=s(90422),m=s(902),u=s(41190);let x=new Intl.NumberFormat(void 0,{maximumFractionDigits:1});function p({simulatorId:e,simulatorName:t,targetKwh:s,initialBlock:p,initialHistory:g}){let[h,b]=(0,n.useState)("accumulate"),[f,v]=(0,n.useState)(!0),[j,w]=(0,n.useState)(null),[k,S]=(0,n.useState)(320),[_,y]=(0,n.useState)(12),[N,C]=(0,n.useState)(.5),[P,E]=(0,n.useState)(800),[F,R]=(0,n.useState)(100),A=(0,n.useMemo)(()=>N*P,[N,P]),{history:M,loading:q,refresh:K}=(0,d.NX)(e,10,g),I=(0,n.useCallback)(()=>{K()},[K]),{block:T,loading:D,connected:O,reconnecting:G,lastReadingTs:W,refresh:V}=(0,d.AF)(e,{onWindowChange:I},p),$=(0,n.useCallback)(e=>{e.device_ts&&(w(e.device_ts),V())},[V]),B=(0,m.V)(e,k,_,f,$),L=(0,m.o)(e,()=>A,f,$),X=W??j,z=()=>{B.isRunning?B.stop():(L.stop(),B.start())},H=()=>{L.isRunning?L.stop():(B.stop(),L.start())},J=T?.percent_of_target??0,Q=J>100?"text-danger":J>=80?"text-warning":"text-success";return(0,a.jsxs)("section",{className:"space-y-10 animate-fadeIn",children:[(0,a.jsxs)("header",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Simulator Dashboard"}),a.jsx("h1",{children:t}),a.jsx("p",{className:"text-sm sm:text-base text-slate-400",children:"Live chart and block history update in real time via server-sent events from the backend."})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-sm text-slate-300",children:[(0,a.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-3 sm:px-4 py-2 text-right",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Target"}),a.jsx("p",{className:"text-sm sm:text-base font-semibold text-slate-100",children:s?`${s.toFixed(1)} kWh`:"â€”"})]}),(0,a.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-3 sm:px-4 py-2 text-right",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Current block"}),(0,a.jsxs)("p",{className:`text-sm sm:text-base font-semibold ${Q}`,children:[x.format(J),"%"]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[a.jsx("label",{htmlFor:"chart-mode-select",className:"text-sm font-medium text-slate-300",children:"Chart Mode:"}),(0,a.jsxs)(u.Ph,{id:"chart-mode-select",value:h,onChange:e=>b(e.target.value),className:"w-full sm:w-auto","aria-label":"Select chart mode",children:[a.jsx("option",{value:"accumulate",children:"Accumulate"}),a.jsx("option",{value:"non-accumulate",children:"Non-Accumulate (Peak Usage)"})]}),"non-accumulate"===h&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("label",{htmlFor:"target-peak-kwh",className:"text-sm font-medium text-slate-300 sm:ml-4",children:"Target Accumulated (kWh):"}),a.jsx(u.II,{id:"target-peak-kwh",type:"number",value:F,onChange:e=>R(parseFloat(e.target.value)||100),min:"0",step:"0.1",className:"w-full sm:w-32","aria-label":"Target accumulated kWh for peak usage mode"})]})]}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[a.jsx(r.l,{block:T??{simulator_id:e,block_start_local:new Date().toISOString(),block_start_utc:new Date().toISOString(),block_end_utc:new Date().toISOString(),target_kwh:s??0,accumulated_kwh:0,percent_of_target:0,alerted_80pct:!1,chart_bins:{bin_seconds:30,points:[]}},loading:D,targetKwh:s,targetPeakKwh:"non-accumulate"===h?F:void 0,mode:h,lastReadingTs:X}),(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[a.jsx(l.C,{connected:O,reconnecting:G,lastReadingTs:X??void 0,block:T,targetKwh:s,targetPeakKwh:"non-accumulate"===h?F:void 0}),a.jsx(i.J,{history:M,loading:q})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 border-b border-slate-800 pb-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{children:"Simulator Controls"}),a.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Configure auto and manual emitters. Only one mode can run at a time."})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-300 min-h-[44px]",children:[a.jsx("input",{type:"checkbox",checked:f,onChange:e=>v(e.target.checked),className:"w-5 h-5 rounded border-slate-600 bg-slate-800 text-primary focus:ring-2 focus:ring-primary"}),a.jsx("span",{children:"Fast-forward (30x speed)"})]})]}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[a.jsx(o.l,{baseKw:k,onBaseKwChange:S,volatility:_,onVolatilityChange:y,isRunning:B.isRunning,onStart:z,onStop:z,sentCount:B.sentCount,lastSentAt:B.lastSentAt,disabled:L.isRunning,disabledReason:L.isRunning?"Manual emitter is active. Stop it before running auto mode.":void 0}),a.jsx(c.x,{sliderValue:N,onSliderChange:C,maxKw:P,onMaxKwChange:E,isRunning:L.isRunning,onStart:H,onStop:H,sentCount:L.sentCount,lastSentAt:L.lastSentAt,disabled:B.isRunning,disabledReason:B.isRunning?"Auto emitter is active. Stop it before running manual mode.":void 0})]})]}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:["Timezone reference: ","Asia/Kuala_Lumpur",". Chart displays the current 30-minute block based on the last received reading timestamp (prototype mode). Fast-forward mode advances simulated time by 30 seconds per real second."]})]})}},7569:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(19510),n=s(68570);let r=(0,n.createProxy)(String.raw`E:\EEMS-Front\src\components\dashboard\combined-dashboard.tsx`),{__esModule:i,$$typeof:l}=r;r.default;let o=(0,n.createProxy)(String.raw`E:\EEMS-Front\src\components\dashboard\combined-dashboard.tsx#CombinedDashboard`);var c=s(9905);async function d({params:e}){let t;let s=e.id,n=`Simulator ${s}`,r=null,i=[];try{let e=(await (0,c.Mf)()).find(e=>e.id===s);e&&(n=e.name,t=e.target_kwh)}catch(e){console.error("Failed to load simulators list",e)}try{r=await (0,c.lA)(s),t=t??r.target_kwh}catch(e){console.error("Failed to load latest block",e)}try{i=await (0,c.QY)(s,10)}catch(e){console.error("Failed to load block history",e)}return a.jsx(o,{simulatorId:s,simulatorName:n,targetKwh:t,initialBlock:r,initialHistory:i})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,808,18,987,954,832,548],()=>s(38891));module.exports=a})();