(()=>{var e={};e.id=879,e.ids=[879],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8891:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>d,routeModule:()=>u,tree:()=>c}),s(7569),s(5866),s(4337);var a=s(3191),n=s(8716),r=s(7922),i=s.n(r),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let c=["",{children:["(sim)",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,7569)),"E:\\EEMS-Front\\src\\app\\(sim)\\[id]\\page.tsx"]}]},{}]},{"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,4337)),"E:\\EEMS-Front\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["E:\\EEMS-Front\\src\\app\\(sim)\\[id]\\page.tsx"],m="/(sim)/[id]/page",x={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/(sim)/[id]/page",pathname:"/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},513:(e,t,s)=>{Promise.resolve().then(s.bind(s,40))},40:(e,t,s)=>{"use strict";s.d(t,{CombinedDashboard:()=>u});var a=s(326),n=s(7577),r=s(20),i=s(3020),l=s(65),o=s(2898),c=s(4053),d=s(422),m=s(902);let x=new Intl.NumberFormat(void 0,{maximumFractionDigits:1});function u({simulatorId:e,simulatorName:t,targetKwh:s,initialBlock:u,initialHistory:p}){let[g,h]=(0,n.useState)("accumulate"),[b,f]=(0,n.useState)(!0),[v,j]=(0,n.useState)(null),[w,y]=(0,n.useState)(320),[_,S]=(0,n.useState)(12),[k,N]=(0,n.useState)(.5),[C,P]=(0,n.useState)(800),[E,F]=(0,n.useState)(100),R=(0,n.useMemo)(()=>k*C,[k,C]),{history:A,loading:M,refresh:q}=(0,d.NX)(e,10,p),K=(0,n.useCallback)(()=>{q()},[q]),{block:D,loading:T,connected:I,reconnecting:O,lastReadingTs:G,refresh:V}=(0,d.AF)(e,{onWindowChange:K},u),W=(0,n.useCallback)(e=>{e.device_ts&&(j(e.device_ts),V())},[V]),$=(0,m.V)(e,w,_,b,W),B=(0,m.o)(e,()=>R,b,W),L=G??v,U=()=>{$.isRunning?$.stop():(B.stop(),$.start())},X=()=>{B.isRunning?B.stop():($.stop(),B.start())},z=D?.percent_of_target??0,H=z>100?"text-danger":z>=80?"text-warning":"text-success";return(0,a.jsxs)("section",{className:"space-y-10",children:[(0,a.jsxs)("header",{className:"flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"Simulator Dashboard"}),a.jsx("h1",{className:"text-2xl sm:text-3xl font-semibold text-white",children:t}),a.jsx("p",{className:"text-sm text-slate-400",children:"Live chart and block history update in real time via server-sent events from the backend."})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 sm:gap-4 text-sm text-slate-300",children:[(0,a.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-3 sm:px-4 py-2 text-right",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Target"}),a.jsx("p",{className:"text-sm sm:text-base font-semibold text-slate-100",children:s?`${s.toFixed(1)} kWh`:"â€”"})]}),(0,a.jsxs)("div",{className:"rounded-lg border border-slate-800 bg-slate-900/60 px-3 sm:px-4 py-2 text-right",children:[a.jsx("p",{className:"text-xs uppercase tracking-[0.2em] text-slate-500",children:"Current block"}),(0,a.jsxs)("p",{className:`text-sm sm:text-base font-semibold ${H}`,children:[x.format(z),"%"]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[a.jsx("label",{className:"text-sm text-slate-300",children:"Chart Mode:"}),(0,a.jsxs)("select",{value:g,onChange:e=>h(e.target.value),className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-2 text-sm text-slate-100",children:[a.jsx("option",{value:"accumulate",children:"Accumulate"}),a.jsx("option",{value:"non-accumulate",children:"Non-Accumulate (Peak Usage)"})]}),"non-accumulate"===g&&(0,a.jsxs)(a.Fragment,{children:[a.jsx("label",{className:"text-sm text-slate-300 sm:ml-4",children:"Target Peak Usage (kWh per 30min):"}),a.jsx("input",{type:"number",value:E,onChange:e=>F(parseFloat(e.target.value)||100),min:"0",step:"0.1",className:"rounded-md border border-slate-700 bg-slate-800 px-3 py-2 text-sm text-slate-100 w-full sm:w-32"})]})]}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[a.jsx(r.l,{block:D??{simulator_id:e,block_start_local:new Date().toISOString(),block_start_utc:new Date().toISOString(),block_end_utc:new Date().toISOString(),target_kwh:s??0,accumulated_kwh:0,percent_of_target:0,alerted_80pct:!1,chart_bins:{bin_seconds:30,points:[]}},loading:T,targetKwh:s,targetPeakKwh:"non-accumulate"===g?E:void 0,mode:g,lastReadingTs:L}),(0,a.jsxs)("div",{className:"flex flex-col gap-6",children:[a.jsx(l.C,{connected:I,reconnecting:O,lastReadingTs:L??void 0,block:D,targetKwh:s}),a.jsx(i.J,{history:A,loading:M})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 border-b border-slate-800 pb-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h2",{className:"text-xl sm:text-2xl font-semibold text-white",children:"Simulator Controls"}),a.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"Configure auto and manual emitters. Only one mode can run at a time."})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-300 min-h-[44px]",children:[a.jsx("input",{type:"checkbox",checked:b,onChange:e=>f(e.target.checked),className:"w-5 h-5 rounded border-slate-600 bg-slate-800 text-primary focus:ring-2 focus:ring-primary"}),a.jsx("span",{children:"Fast-forward (30x speed)"})]})]}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[a.jsx(o.l,{baseKw:w,onBaseKwChange:y,volatility:_,onVolatilityChange:S,isRunning:$.isRunning,onStart:U,onStop:U,sentCount:$.sentCount,lastSentAt:$.lastSentAt,disabled:B.isRunning,disabledReason:B.isRunning?"Manual emitter is active. Stop it before running auto mode.":void 0}),a.jsx(c.x,{sliderValue:k,onSliderChange:N,maxKw:C,onMaxKwChange:P,isRunning:B.isRunning,onStart:X,onStop:X,sentCount:B.sentCount,lastSentAt:B.lastSentAt,disabled:$.isRunning,disabledReason:$.isRunning?"Auto emitter is active. Stop it before running manual mode.":void 0})]})]}),(0,a.jsxs)("p",{className:"text-xs text-slate-500",children:["Timezone reference: ","Asia/Kuala_Lumpur",". Chart displays the current 30-minute block based on the last received reading timestamp (prototype mode). Fast-forward mode advances simulated time by 30 seconds per real second."]})]})}},7569:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(9510),n=s(8570);let r=(0,n.createProxy)(String.raw`E:\EEMS-Front\src\components\dashboard\combined-dashboard.tsx`),{__esModule:i,$$typeof:l}=r;r.default;let o=(0,n.createProxy)(String.raw`E:\EEMS-Front\src\components\dashboard\combined-dashboard.tsx#CombinedDashboard`);var c=s(9905);async function d({params:e}){let t;let s=e.id,n=`Simulator ${s}`,r=null,i=[];try{let e=(await (0,c.Mf)()).find(e=>e.id===s);e&&(n=e.name,t=e.target_kwh)}catch(e){console.error("Failed to load simulators list",e)}try{r=await (0,c.lA)(s),t=t??r.target_kwh}catch(e){console.error("Failed to load latest block",e)}try{i=await (0,c.QY)(s,10)}catch(e){console.error("Failed to load block history",e)}return a.jsx(o,{simulatorId:s,simulatorName:n,targetKwh:t,initialBlock:r,initialHistory:i})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,485,630,162,760,548],()=>s(8891));module.exports=a})();