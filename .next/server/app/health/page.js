(()=>{var e={};e.id=613,e.ids=[613],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1472:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>c,routeModule:()=>m,tree:()=>d}),s(1291),s(4337),s(5866);var a=s(3191),n=s(8716),r=s(7922),i=s.n(r),l=s(5231),o={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);s.d(t,o);let d=["",{children:["health",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,1291)),"E:\\EEMS-Front\\src\\app\\health\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,4337)),"E:\\EEMS-Front\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["E:\\EEMS-Front\\src\\app\\health\\page.tsx"],u="/health/page",h={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:n.x.APP_PAGE,page:"/health/page",pathname:"/health",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},7362:(e,t,s)=>{Promise.resolve().then(s.bind(s,2758))},2758:(e,t,s)=>{"use strict";s.d(t,{default:()=>f});var a=s(326),n=s(7577),r=s(1135);let i={idle:"bg-slate-800 text-slate-300 ring-1 ring-inset ring-slate-700",running:"bg-amber-500/20 text-amber-200 ring-1 ring-inset ring-amber-400/60",success:"bg-emerald-500/20 text-emerald-200 ring-1 ring-inset ring-emerald-400/70",error:"bg-rose-500/20 text-rose-200 ring-1 ring-inset ring-rose-400/60"};function l({status:e}){return(0,a.jsxs)("span",{className:(0,r.Z)("inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold",i[e]),children:[a.jsx("span",{className:"h-2 w-2 rounded-full bg-current opacity-80"}),function(e){switch(e){case"running":return"Running";case"success":return"Healthy";case"error":return"Issue";default:return"Idle"}}(e)]})}function o({title:e,description:t,status:s,meta:n,body:r,onRun:i,actionLabel:o="Run check",disabled:d}){return(0,a.jsxs)("section",{className:"flex flex-col gap-4 rounded-2xl border border-slate-800 bg-slate-900/60 p-6 shadow-lg shadow-slate-950/30",children:[(0,a.jsxs)("header",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,a.jsxs)("div",{className:"space-y-1",children:[a.jsx("h2",{className:"text-lg font-semibold text-white",children:e}),a.jsx("p",{className:"max-w-xl text-sm text-slate-400",children:t})]}),a.jsx(l,{status:s})]}),n&&a.jsx("div",{className:"text-xs text-slate-400",children:n}),a.jsx("div",{className:"flex flex-col gap-4 text-sm text-slate-300",children:r}),i&&a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"button",onClick:i,disabled:d,className:"inline-flex items-center gap-2 rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition hover:bg-cyan-600 disabled:cursor-not-allowed disabled:bg-slate-700 disabled:text-slate-300",children:o})})]})}function d({entries:e}){return 0===e.length?a.jsx("p",{className:"rounded-lg border border-dashed border-slate-800 bg-slate-900/30 px-4 py-6 text-center text-xs text-slate-500",children:"Run any check to start logging responses."}):a.jsx("ul",{className:"space-y-3 text-xs",children:e.map(e=>(0,a.jsxs)("li",{className:"rounded-lg border border-slate-800 bg-slate-900/30 p-3 text-left text-slate-300 shadow-inner shadow-slate-950/30",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-[11px] uppercase tracking-widest text-slate-500",children:[a.jsx("span",{children:e.title}),a.jsx("span",{children:new Date(e.timestamp).toLocaleTimeString()})]}),a.jsx("p",{className:"mt-1 text-sm font-medium text-white",children:"success"===e.status?"Success":"Error"}),a.jsx("pre",{className:"mt-2 max-h-48 overflow-auto whitespace-pre-wrap rounded bg-slate-950/60 p-3 text-[11px] leading-relaxed text-slate-400",children:e.detail})]},e.id))})}var c=s(8069),u=s(4753);let h=["/healthz","/api/v1/health","/"];async function m(e,t){if(!c.CT)return{ok:!1,status:0,durationMs:0,message:"Backend base URL is not configured."};let s=(0,c.Bj)(e),a=Date.now();try{let e;let n=await fetch(s,t),r=Date.now()-a,i=`${n.status} ${n.statusText}`;try{let t=await n.text();e=t,t&&(i=`${i}
${t}`)}catch{}return{ok:n.ok,status:n.status,durationMs:r,message:i,raw:e}}catch(e){return{ok:!1,status:0,durationMs:Date.now()-a,message:e instanceof Error?e.message:"Request failed"}}}async function x(){for(let e of h){let t=await m(e);if(t.ok)return{...t,message:`Health endpoint responded at ${e}.
${t.message}`};if(404!==t.status&&405!==t.status)return{...t,message:`Health check failed at ${e}.
${t.message}`}}return{ok:!1,status:404,durationMs:0,message:"No health endpoints responded (tried /healthz, /api/v1/health, /)."}}async function p(){if(!(0,u.Qu)())return{ok:!1,status:0,durationMs:0,message:"API key is not configured. Provide one above or set NEXT_PUBLIC_BACKEND_TOKEN (or another supported env) to run the handshake check."};let e={simulator_id:"health-check",mode:"auto",ticks:[{power_kw:1,sample_seconds:15,device_ts:new Date().toISOString()}]},t=await m("/api/v1/readings:ingest",(0,c.b0)({method:"POST",body:JSON.stringify(e)}));return t.ok||401!==t.status?{...t,message:t.ok?"Ingestion endpoint accepted the payload. Review acknowledgement below.":`Handshake request failed.
${t.message}`}:{...t,message:"Handshake request failed: backend rejected the API key. Double-check the value provided above or the NEXT_PUBLIC_BACKEND_TOKEN environment variable."}}async function g(){let e=Date.now();try{let t=await (0,c.LK)("/api/v1/simulators"),s=Date.now()-e,a=Array.isArray(t)?t:t.data??[];return{ok:!0,status:200,durationMs:s,message:a.length?`Fetched ${a.length} simulator(s).`:"Simulator list responded successfully but returned no items.",raw:JSON.stringify(a,null,2)}}catch(s){let t=Date.now()-e;return{ok:!1,status:s instanceof Error&&"status"in s?Number(s.status):0,durationMs:t,message:s instanceof Error?s.message:"Simulator read failed"}}}let b={backend:{status:"idle"},handshake:{status:"idle"},simulatorRead:{status:"idle"}};function f(){let[e,t]=(0,n.useState)(b),[s,r]=(0,n.useState)([]),i=(0,n.useMemo)(()=>"https://eems-v2-backend-production.up.railway.app",[]),l=i.length>0,c=(0,n.useMemo)(()=>(0,u.Dr)(),[]),h=(0,u.tQ)(),m=(0,n.useMemo)(()=>(0,u.wE)(),[]),[f,y]=(0,n.useState)(""),[k,j]=(0,n.useState)(!1),[w,v]=(0,n.useState)(!1),[N,E]=(0,n.useState)(""),P=w?k?"Using manual override (saved locally)":"Using manual override":h?`Using ${m??"environment API key"}`:"API key not configured",S=async e=>{t(t=>({...t,[e]:{...t[e],status:"running",message:void 0}}));try{let s="backend"===e?await x():"handshake"===e?await p():await g();t(t=>({...t,[e]:{status:s.ok?"success":"error",duration:s.durationMs,message:s.message}})),r(t=>[{id:`${e}-${Date.now()}`,title:`${e} check`,status:s.ok?"success":"error",detail:s.raw??s.message,timestamp:new Date().toISOString()},...t])}catch(a){let s=a instanceof Error?a.message:"Unknown failure";t(t=>({...t,[e]:{status:"error",message:s}})),r(t=>[{id:`${e}-${Date.now()}`,title:`${e} check`,status:"error",detail:s,timestamp:new Date().toISOString()},...t])}};return(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("header",{className:"space-y-3",children:[a.jsx("h1",{className:"text-3xl font-semibold text-white",children:"Communication Health Checks"}),a.jsx("p",{className:"text-sm text-slate-400",children:"Run quick diagnostics to verify if the frontend can reach the backend services. These checks will automatically attach prototype headers and surface full responses for debugging."}),(0,a.jsxs)("div",{className:"space-y-4 rounded-xl border border-slate-800 bg-slate-900/50 p-4 text-xs text-slate-400",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{children:[a.jsx("span",{className:"font-semibold text-slate-200",children:"Backend base URL:"})," ",l?i:"Not configured"]}),(0,a.jsxs)("p",{className:"mt-1",children:[a.jsx("span",{className:"font-semibold text-slate-200",children:"API key:"})," ",N?"Configured":"Missing"]}),a.jsx("p",{className:"mt-1 text-[11px] uppercase tracking-[0.2em] text-slate-500",children:P})]}),(0,a.jsxs)("div",{className:"space-y-2 text-slate-300",children:[a.jsx("label",{className:"block text-xs font-semibold text-slate-200",htmlFor:"health-api-key",children:"Manual API key override"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[a.jsx("input",{id:"health-api-key",type:"password",value:f,onChange:e=>y(e.target.value),className:"flex-1 rounded-md border border-slate-700 bg-slate-900 px-3 py-2 text-sm text-slate-100 focus:border-primary focus:outline-none",placeholder:"Paste prototype API key"}),a.jsx("button",{type:"button",onClick:()=>{(0,u.Oz)(f,{persist:k});let e=f.trim().length>0;v(e),j(!!e&&(0,u.wC)()),E((0,u.w)())},className:"inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-semibold text-primary-foreground transition hover:bg-cyan-600",children:"Apply key"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-slate-400",children:[(0,a.jsxs)("label",{className:"inline-flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-700 bg-slate-900 text-primary focus:ring-primary",checked:k,onChange:e=>j(e.target.checked)}),"Remember on this device"]}),w&&a.jsx("button",{type:"button",onClick:()=>{(0,u.HM)(),v(!1),j(!1),y(c),E((0,u.w)())},className:"text-slate-300 underline-offset-2 hover:text-white hover:underline",children:"Clear override"}),a.jsx("span",{className:"text-slate-500",children:"Useful when Railway rewrites environment variables with “API” into secret references."})]})]})]})]}),a.jsx(o,{title:"API availability",description:"Calls the health endpoint to ensure the backend server is reachable and responding.",status:e.backend.status,meta:e.backend.duration&&(0,a.jsxs)("span",{children:["Latest response time: ",(0,a.jsxs)("strong",{children:[e.backend.duration.toFixed(0),"ms"]})]}),body:a.jsx("p",{className:"text-sm text-slate-300",children:e.backend.message??"No response logged yet."}),onRun:()=>S("backend"),disabled:!l||"running"===e.backend.status}),a.jsx(o,{title:"Simulator handshake",description:"Sends a prototype handshake payload to validate the simulator ingestion endpoint and API key authentication.",status:e.handshake.status,meta:e.handshake.duration&&(0,a.jsxs)("span",{children:["Latest response time: ",(0,a.jsxs)("strong",{children:[e.handshake.duration.toFixed(0),"ms"]})]}),body:a.jsx("p",{className:"text-sm text-slate-300",children:e.handshake.message??"No response logged yet."}),onRun:()=>S("handshake"),disabled:!l||"running"===e.handshake.status,actionLabel:"Send handshake"}),a.jsx(o,{title:"Read API sample",description:"Fetches a small simulator list to confirm read endpoints return data correctly.",status:e.simulatorRead.status,meta:e.simulatorRead.duration&&(0,a.jsxs)("span",{children:["Latest response time: ",(0,a.jsxs)("strong",{children:[e.simulatorRead.duration.toFixed(0),"ms"]})]}),body:a.jsx("p",{className:"text-sm text-slate-300",children:e.simulatorRead.message??"No response logged yet."}),onRun:()=>S("simulatorRead"),disabled:!l||"running"===e.simulatorRead.status,actionLabel:"Fetch simulators"})]}),(0,a.jsxs)("aside",{className:"space-y-3",children:[a.jsx("h2",{className:"text-lg font-semibold text-white",children:"Response log"}),a.jsx(d,{entries:s})]})]})}},1291:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c,metadata:()=>d});var a=s(9510),n=s(8570);let r=(0,n.createProxy)(String.raw`E:\EEMS-Front\src\components\health\health-check-console.tsx`),{__esModule:i,$$typeof:l}=r;r.default;let o=(0,n.createProxy)(String.raw`E:\EEMS-Front\src\components\health\health-check-console.tsx#default`),d={title:"Health Check | Eternalgy EMS"};function c(){return a.jsx(o,{})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,485,162],()=>s(1472));module.exports=a})();