(()=>{var e={};e.id=613,e.ids=[613],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},21472:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>h,originalPathname:()=>u,pages:()=>d,routeModule:()=>m,tree:()=>c}),s(71291),s(53871),s(35866);var a=s(23191),r=s(88716),n=s(37922),i=s.n(n),o=s(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);s.d(t,l);let c=["",{children:["health",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,71291)),"E:\\EEMS-Front\\src\\app\\health\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,53871)),"E:\\EEMS-Front\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],d=["E:\\EEMS-Front\\src\\app\\health\\page.tsx"],u="/health/page",h={require:s,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/health/page",pathname:"/health",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},97362:(e,t,s)=>{Promise.resolve().then(s.bind(s,72758))},72758:(e,t,s)=>{"use strict";s.d(t,{default:()=>w});var a=s(10326),r=s(17577),n=s(41135);let i={idle:"bg-slate-800 text-slate-300 ring-1 ring-inset ring-slate-700",running:"bg-amber-500/20 text-amber-200 ring-1 ring-inset ring-amber-400/60",success:"bg-emerald-500/20 text-emerald-200 ring-1 ring-inset ring-emerald-400/70",error:"bg-rose-500/20 text-rose-200 ring-1 ring-inset ring-rose-400/60"};function o({status:e}){return(0,a.jsxs)("span",{className:(0,n.Z)("inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold",i[e]),children:[a.jsx("span",{className:"h-2 w-2 rounded-full bg-current opacity-80"}),function(e){switch(e){case"running":return"Running";case"success":return"Healthy";case"error":return"Issue";default:return"Idle"}}(e)]})}var l=s(91664);function c({title:e,description:t,status:s,meta:r,body:n,onRun:i,actionLabel:c="Run check",disabled:d}){return(0,a.jsxs)("section",{className:"flex flex-col gap-4 rounded-2xl border border-slate-800 bg-slate-900/60 backdrop-blur-sm p-6 shadow-lg hover:shadow-xl transition-shadow duration-300",children:[(0,a.jsxs)("header",{className:"flex flex-wrap items-start justify-between gap-3",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx("h3",{className:"text-lg font-semibold text-white",children:e}),a.jsx("p",{className:"max-w-xl text-sm text-slate-400",children:t})]}),a.jsx(o,{status:s})]}),r&&a.jsx("div",{className:"text-xs text-slate-400",children:r}),a.jsx("div",{className:"flex flex-col gap-4 text-sm text-slate-300",children:n}),i&&a.jsx("div",{className:"flex justify-end",children:a.jsx(l.z,{variant:"primary",size:"md",onClick:i,disabled:d,children:c})})]})}function d({entries:e}){return 0===e.length?a.jsx("p",{className:"rounded-lg border border-dashed border-slate-800 bg-slate-900/30 px-4 py-6 text-center text-xs text-slate-500",children:"Run any check to start logging responses."}):a.jsx("ul",{className:"space-y-3 text-xs",children:e.map(e=>(0,a.jsxs)("li",{className:"rounded-lg border border-slate-800 bg-slate-900/30 p-3 text-left text-slate-300 shadow-inner shadow-slate-950/30",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between text-[11px] uppercase tracking-widest text-slate-500",children:[a.jsx("span",{children:e.title}),a.jsx("span",{children:new Date(e.timestamp).toLocaleTimeString()})]}),a.jsx("p",{className:"mt-1 text-sm font-medium text-white",children:"success"===e.status?"Success":"Error"}),a.jsx("pre",{className:"mt-2 max-h-48 overflow-auto whitespace-pre-wrap rounded bg-slate-950/60 p-3 text-[11px] leading-relaxed text-slate-400",children:e.detail})]},e.id))})}var u=s(18069),h=s(4753);let m=["/healthz","/api/v1/health","/"];async function p(e,t){if(!u.CT)return{ok:!1,status:0,durationMs:0,message:"Backend base URL is not configured."};let s=(0,u.Bj)(e),a=Date.now();try{let e;let r=await fetch(s,t),n=Date.now()-a,i=`${r.status} ${r.statusText}`;try{let t=await r.text();e=t,t&&(i=`${i}
${t}`)}catch{}return{ok:r.ok,status:r.status,durationMs:n,message:i,raw:e}}catch(e){return{ok:!1,status:0,durationMs:Date.now()-a,message:e instanceof Error?e.message:"Request failed"}}}async function x(){for(let e of m){let t=await p(e);if(t.ok)return{...t,message:`Health endpoint responded at ${e}.
${t.message}`};if(404!==t.status&&405!==t.status)return{...t,message:`Health check failed at ${e}.
${t.message}`}}return{ok:!1,status:404,durationMs:0,message:"No health endpoints responded (tried /healthz, /api/v1/health, /)."}}async function g(){if(!(0,h.Qu)())return{ok:!1,status:0,durationMs:0,message:"API key is not configured. Provide one above or set NEXT_PUBLIC_BACKEND_TOKEN (or another supported env) to run the handshake check."};let e={simulator_id:"health-check",mode:"auto",ticks:[{power_kw:1,sample_seconds:15,device_ts:new Date().toISOString()}]},t=await p("/api/v1/readings:ingest",(0,u.b0)({method:"POST",body:JSON.stringify(e)}));return t.ok||401!==t.status?{...t,message:t.ok?"Ingestion endpoint accepted the payload. Review acknowledgement below.":`Handshake request failed.
${t.message}`}:{...t,message:"Handshake request failed: backend rejected the API key. Double-check the value provided above or the NEXT_PUBLIC_BACKEND_TOKEN environment variable."}}async function f(){let e=Date.now();try{let t=await (0,u.LK)("/api/v1/simulators"),s=Date.now()-e,a=Array.isArray(t)?t:t.data??[];return{ok:!0,status:200,durationMs:s,message:a.length?`Fetched ${a.length} simulator(s).`:"Simulator list responded successfully but returned no items.",raw:JSON.stringify(a,null,2)}}catch(s){let t=Date.now()-e;return{ok:!1,status:s instanceof Error&&"status"in s?Number(s.status):0,durationMs:t,message:s instanceof Error?s.message:"Simulator read failed"}}}var y=s(41190);let b={backend:{status:"idle"},handshake:{status:"idle"},simulatorRead:{status:"idle"}};function w(){let[e,t]=(0,r.useState)(b),[s,n]=(0,r.useState)([]),i=(0,r.useMemo)(()=>"https://eems-v2-backend-production.up.railway.app",[]),o=i.length>0,u=(0,r.useMemo)(()=>(0,h.Dr)(),[]),m=(0,h.tQ)(),p=(0,r.useMemo)(()=>(0,h.wE)(),[]),[w,v]=(0,r.useState)(""),[k,N]=(0,r.useState)(!1),[j,E]=(0,r.useState)(!1),[_,P]=(0,r.useState)(""),S=j?k?"Using manual override (saved locally)":"Using manual override":m?`Using ${p??"environment API key"}`:"API key not configured",C=async e=>{t(t=>({...t,[e]:{...t[e],status:"running",message:void 0}}));try{let s="backend"===e?await x():"handshake"===e?await g():await f();t(t=>({...t,[e]:{status:s.ok?"success":"error",duration:s.durationMs,message:s.message}})),n(t=>[{id:`${e}-${Date.now()}`,title:`${e} check`,status:s.ok?"success":"error",detail:s.raw??s.message,timestamp:new Date().toISOString()},...t])}catch(a){let s=a instanceof Error?a.message:"Unknown failure";t(t=>({...t,[e]:{status:"error",message:s}})),n(t=>[{id:`${e}-${Date.now()}`,title:`${e} check`,status:"error",detail:s,timestamp:new Date().toISOString()},...t])}};return(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr] animate-fadeIn",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("header",{className:"space-y-3",children:[a.jsx("h1",{children:"Communication Health Checks"}),a.jsx("p",{className:"text-sm sm:text-base text-slate-400",children:"Run quick diagnostics to verify if the frontend can reach the backend services. These checks will automatically attach prototype headers and surface full responses for debugging."}),(0,a.jsxs)("div",{className:"space-y-4 rounded-xl border border-slate-800 bg-slate-900/50 p-4 text-xs text-slate-400",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{children:[a.jsx("span",{className:"font-semibold text-slate-200",children:"Backend base URL:"})," ",o?i:"Not configured"]}),(0,a.jsxs)("p",{className:"mt-1",children:[a.jsx("span",{className:"font-semibold text-slate-200",children:"API key:"})," ",_?"Configured":"Missing"]}),a.jsx("p",{className:"mt-1 text-[11px] uppercase tracking-[0.2em] text-slate-500",children:S})]}),(0,a.jsxs)("div",{className:"space-y-2 text-slate-300",children:[a.jsx("label",{className:"block text-xs font-semibold text-slate-200",htmlFor:"health-api-key",children:"Manual API key override"}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row",children:[a.jsx(y.II,{id:"health-api-key",type:"password",value:w,onChange:e=>v(e.target.value),className:"flex-1",placeholder:"Paste prototype API key"}),a.jsx(l.z,{variant:"primary",size:"md",onClick:()=>{(0,h.Oz)(w,{persist:k});let e=w.trim().length>0;E(e),N(!!e&&(0,h.wC)()),P((0,h.w)())},className:"w-full sm:w-auto",children:"Apply key"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-3 text-[11px] text-slate-400",children:[(0,a.jsxs)("label",{className:"inline-flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-slate-700 bg-slate-900 text-primary focus:ring-primary",checked:k,onChange:e=>N(e.target.checked)}),"Remember on this device"]}),j&&a.jsx(l.z,{variant:"ghost",size:"sm",onClick:()=>{(0,h.HM)(),E(!1),N(!1),v(u),P((0,h.w)())},className:"text-xs p-0 h-auto text-slate-300 hover:text-white hover:bg-transparent hover:underline",children:"Clear override"}),a.jsx("span",{className:"text-slate-500",children:"Useful when Railway rewrites environment variables with “API” into secret references."})]})]})]})]}),a.jsx(c,{title:"API availability",description:"Calls the health endpoint to ensure the backend server is reachable and responding.",status:e.backend.status,meta:e.backend.duration&&(0,a.jsxs)("span",{children:["Latest response time: ",(0,a.jsxs)("strong",{children:[e.backend.duration.toFixed(0),"ms"]})]}),body:a.jsx("p",{className:"text-sm text-slate-300",children:e.backend.message??"No response logged yet."}),onRun:()=>C("backend"),disabled:!o||"running"===e.backend.status}),a.jsx(c,{title:"Simulator handshake",description:"Sends a prototype handshake payload to validate the simulator ingestion endpoint and API key authentication.",status:e.handshake.status,meta:e.handshake.duration&&(0,a.jsxs)("span",{children:["Latest response time: ",(0,a.jsxs)("strong",{children:[e.handshake.duration.toFixed(0),"ms"]})]}),body:a.jsx("p",{className:"text-sm text-slate-300",children:e.handshake.message??"No response logged yet."}),onRun:()=>C("handshake"),disabled:!o||"running"===e.handshake.status,actionLabel:"Send handshake"}),a.jsx(c,{title:"Read API sample",description:"Fetches a small simulator list to confirm read endpoints return data correctly.",status:e.simulatorRead.status,meta:e.simulatorRead.duration&&(0,a.jsxs)("span",{children:["Latest response time: ",(0,a.jsxs)("strong",{children:[e.simulatorRead.duration.toFixed(0),"ms"]})]}),body:a.jsx("p",{className:"text-sm text-slate-300",children:e.simulatorRead.message??"No response logged yet."}),onRun:()=>C("simulatorRead"),disabled:!o||"running"===e.simulatorRead.status,actionLabel:"Fetch simulators"})]}),(0,a.jsxs)("aside",{className:"space-y-3",children:[a.jsx("h2",{className:"text-lg font-semibold text-white",children:"Response log"}),a.jsx(d,{entries:s})]})]})}},91664:(e,t,s)=>{"use strict";s.d(t,{z:()=>o});var a=s(10326),r=s(17577),n=s(41135);let i={variant:{primary:"bg-primary text-white shadow-sm hover:bg-cyan-600 hover:shadow-md active:scale-95",secondary:"border border-slate-700 bg-transparent text-slate-200 hover:bg-slate-800 hover:border-slate-600",ghost:"hover:bg-slate-800/50 text-slate-300 hover:text-white",danger:"bg-danger text-white shadow-sm hover:bg-red-600 hover:shadow-md active:scale-95",success:"bg-success text-white shadow-sm hover:bg-green-600 hover:shadow-md active:scale-95"},size:{sm:"px-3 py-1.5 text-xs min-h-[36px]",md:"px-4 py-2 text-sm min-h-[44px]",lg:"px-6 py-3 text-base min-h-[48px]"}},o=(0,r.forwardRef)(({className:e,variant:t="primary",size:s="md",isLoading:r,children:o,disabled:l,...c},d)=>(0,a.jsxs)("button",{className:(0,n.Z)("inline-flex items-center justify-center gap-2 rounded-md font-semibold transition-all duration-150","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary focus-visible:ring-offset-2 focus-visible:ring-offset-slate-950","disabled:pointer-events-none disabled:opacity-50",i.variant[t],i.size[s],e),ref:d,disabled:l||r,...c,children:[r&&(0,a.jsxs)("svg",{className:"h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","aria-hidden":"true",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),a.jsx("span",{className:r?"opacity-70":"",children:o})]}));o.displayName="Button"},41190:(e,t,s)=>{"use strict";s.d(t,{II:()=>o,Ph:()=>l,SP:()=>c});var a=s(10326),r=s(17577),n=s(41135),i=s(19381);let o=(0,r.forwardRef)(({className:e,error:t,success:s,...r},i)=>a.jsx("input",{className:(0,n.Z)("w-full rounded-md border px-3 py-2 text-sm text-white transition-colors duration-150","placeholder:text-slate-500","focus:outline-none focus:ring-2","disabled:opacity-50 disabled:cursor-not-allowed",t?"border-danger bg-danger/5 focus:border-danger focus:ring-danger/20":s?"border-success bg-success/5 focus:border-success focus:ring-success/20":"border-slate-800 bg-slate-950/60 focus:border-primary focus:ring-primary/20",e),ref:i,...r}));o.displayName="Input";let l=(0,r.forwardRef)(({className:e,error:t,success:s,children:r,...i},o)=>a.jsx("select",{className:(0,n.Z)("w-full rounded-md border px-3 py-2 text-sm text-white transition-colors duration-150","focus:outline-none focus:ring-2","disabled:opacity-50 disabled:cursor-not-allowed",t?"border-danger bg-danger/5 focus:border-danger focus:ring-danger/20":s?"border-success bg-success/5 focus:border-success focus:ring-success/20":"border-slate-800 bg-slate-950/60 focus:border-primary focus:ring-primary/20",e),ref:o,...i,children:r}));function c({label:e,error:t,helperText:s,required:r,children:n}){return(0,a.jsxs)("div",{className:"space-y-1.5",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-slate-300",children:[e,r&&a.jsx("span",{className:"text-danger ml-1",children:"*"})]}),n,t&&(0,a.jsxs)("p",{className:"text-xs text-danger flex items-center gap-1",children:[a.jsx(i.Z,{className:"h-4 w-4","aria-hidden":"true"}),t]}),!t&&s&&a.jsx("p",{className:"text-xs text-slate-500",children:s})]})}l.displayName="Select"},4753:(e,t,s)=>{"use strict";s.d(t,{Dr:()=>o,HM:()=>u,Oz:()=>d,Qu:()=>m,tQ:()=>p,w:()=>h,wC:()=>c,wE:()=>l});let a=[{name:"NEXT_PUBLIC_BACKEND_TOKEN",value:"01121000099"},{name:"NEXT_PUBLIC_BACKEND_WRITE_TOKEN",value:process.env.NEXT_PUBLIC_BACKEND_WRITE_TOKEN},{name:"NEXT_PUBLIC_BACKEND_KEY",value:process.env.NEXT_PUBLIC_BACKEND_KEY},{name:"NEXT_PUBLIC_BACKEND_API_KEY",value:process.env.NEXT_PUBLIC_BACKEND_API_KEY}],r=null,n=!1;function i(){for(let e of a)if(e.value)return{name:e.name,value:e.value};return null}function o(){return i()?.value??""}function l(){return i()?.name??null}function c(){return n&&!!r}function d(e,t){r=e.trim()||null,n=!!(t?.persist&&r)}function u(){r=null,n=!1}function h(){return r||o()}function m(){return h().length>0}function p(){return o().length>0}},18069:(e,t,s)=>{"use strict";s.d(t,{Aq:()=>v,Bj:()=>p,CT:()=>r,LK:()=>m,M8:()=>w,Mf:()=>x,QY:()=>b,aj:()=>f,b0:()=>h,he:()=>k,ji:()=>g,lA:()=>y});var a=s(4753);let r="/api/bridge",n=new Set([429,500,502,503,504]);class i extends Error{constructor(e,t,s,a){super(e),this.status=t,this.code=s,this.details=a}}function o(e){if(!r)throw new i("Backend base URL is not configured.",0);return e.startsWith("http")?e:`${r}${e}`}async function l(e){let t=await e.text();if(t)try{return JSON.parse(t)}catch(t){throw new i(`Invalid JSON response: ${t.message}`,e.status)}}async function c(e){let t;try{t=await e.clone().json()}catch{}if(!t)try{let t=await e.text();if(t)return new i(t,e.status)}catch{}let s=t?.error?.message??t?.message??e.statusText??`Request failed with status ${e.status}`,a=t?.error?.code,r=t?.error?.details;if(t&&t.detail){r=t.detail;try{if(Array.isArray(t.detail)){let e=t.detail.map(e=>e?.msg||e?.detail||"Validation error").filter(Boolean);e.length>0&&(s=e.join("; "))}else"string"==typeof t.detail&&(s=t.detail)}catch{}}return new i(s,e.status,a,r)}function d(e){return new Promise(t=>setTimeout(t,e))}async function u(e,t,s={}){let a=o(e);a=`http://localhost${a}`;let r=s.retryDelays??[],u=0,h=new Headers(t?.headers);h.set("Accept","application/json");let m={...t,headers:h};for(;;)try{let e=await fetch(a,m);if(!e.ok){var p;let t=await c(e);if(p=e.status,n.has(p)&&u<r.length){await d(r[u++]);continue}throw t}if(204===e.status)return;return await l(e)}catch(e){if(e instanceof i)throw e;if(u<r.length){await d(r[u++]);continue}throw e}}function h(e){let t=new Headers(e?.headers);t.set("Content-Type","application/json");let s=(0,a.w)();return s?t.set("x-api-key",s):t.delete("x-api-key"),{...e,headers:t}}async function m(e,t){try{return await u(e,t)}catch(s){if(!(s instanceof i))return await u(e,t,{retryDelays:[500]});throw s}}function p(e){return o(e)}async function x(){let e=await m("/api/v1/simulators");return Array.isArray(e)?e:e.data??[]}async function g(e){let t=await u("/api/v1/simulators",h({method:"POST",body:JSON.stringify(e)}),{retryDelays:[500,1500,3500]});return"data"in t?t.data:t}async function f(e){console.log("deleteSimulator called with id:",e);try{await u(`/api/v1/simulators/${e}`,h({method:"DELETE"}),{retryDelays:[500,1500]}),console.log("deleteSimulator successful for id:",e)}catch(t){throw console.error("deleteSimulator error for id:",e,t),t}}async function y(e){return await m(`/api/v1/blocks/latest?simulator_id=${encodeURIComponent(e)}`)}async function b(e,t=10){let s=await m(`/api/v1/blocks/history?simulator_id=${encodeURIComponent(e)}&limit=${t}`);return Array.isArray(s)?s:s.data??[]}async function w(e){await u("/api/v1/readings:ingest",h({method:"POST",body:JSON.stringify(e)}),{retryDelays:[500,1500,3500]})}async function v(e){try{let t=new Date().toISOString();await u(`/api/v1/readings?simulator_id=${encodeURIComponent(e)}&before=${encodeURIComponent(t)}`,h({method:"DELETE"}),{retryDelays:[500,1500]})}catch(t){try{await u(`/api/v1/simulators/${encodeURIComponent(e)}/readings`,h({method:"DELETE"}),{retryDelays:[500,1500]})}catch(e){console.warn("Failed to delete future readings from backend:",t,e)}}}async function k(e){try{let t=await y(e);if(t.chart_bins?.points&&t.chart_bins.points.length>0){let e=new Date(t.block_start_local),s=t.chart_bins.bin_seconds||30,a=t.chart_bins.points.length;return new Date(e.getTime()+a*s*1e3).toISOString()}return null}catch(e){return console.warn("Failed to fetch last reading timestamp:",e),null}}},71291:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d,metadata:()=>c});var a=s(19510),r=s(68570);let n=(0,r.createProxy)(String.raw`E:\EEMS-Front\src\components\health\health-check-console.tsx`),{__esModule:i,$$typeof:o}=n;n.default;let l=(0,r.createProxy)(String.raw`E:\EEMS-Front\src\components\health\health-check-console.tsx#default`),c={title:"Health Check | Eternalgy EMS"};function d(){return a.jsx(l,{})}}};var t=require("../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,808,987],()=>s(21472));module.exports=a})();