(()=>{var e={};e.id=931,e.ids=[931],e.modules={47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},60507:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>c,routeModule:()=>x,tree:()=>d}),a(40461),a(53871),a(35866);var r=a(23191),s=a(88716),l=a(37922),n=a.n(l),i=a(95231),o={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>i[e]);a.d(t,o);let d=["",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,40461)),"E:\\EEMS-Front\\src\\app\\page.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,53871)),"E:\\EEMS-Front\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],c=["E:\\EEMS-Front\\src\\app\\page.tsx"],u="/page",m={require:a,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/page",pathname:"/",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},61136:(e,t,a)=>{Promise.resolve().then(a.bind(a,29205))},29205:(e,t,a)=>{"use strict";a.d(t,{SimulatorsPage:()=>j});var r=a(10326),s=a(11004),l=a(17577),n=a(90434),i=a(43742),o=a(16138),d=a(90422),c=a(91664),u=a(41135);let m={default:"bg-slate-900/60",elevated:"bg-slate-900 shadow-lg",interactive:"cursor-pointer hover:border-primary-700 hover:shadow-lg",flat:"shadow-none"},x=(0,l.forwardRef)(({className:e,variant:t="default",...a},s)=>r.jsx("div",{ref:s,className:(0,u.Z)("rounded-xl border border-slate-800 backdrop-blur-sm shadow-md transition-shadow duration-200",m[t],e),...a}));x.displayName="Card",(0,l.forwardRef)(({className:e,...t},a)=>r.jsx("div",{ref:a,className:(0,u.Z)("p-4 sm:p-6 border-b border-slate-800",e),...t})).displayName="CardHeader";let p=(0,l.forwardRef)(({className:e,...t},a)=>r.jsx("div",{ref:a,className:(0,u.Z)("p-4 sm:p-6",e),...t}));p.displayName="CardContent",(0,l.forwardRef)(({className:e,...t},a)=>r.jsx("div",{ref:a,className:(0,u.Z)("p-4 sm:p-6 border-t border-slate-800",e),...t})).displayName="CardFooter";var g=a(41190);let h={success:"bg-success/10 text-success border-success/20",warning:"bg-warning/10 text-warning border-warning/20",danger:"bg-danger/10 text-danger border-danger/20",info:"bg-primary/10 text-primary border-primary/20",neutral:"bg-slate-800 text-slate-300 border-slate-700"};function f({variant:e="neutral",className:t,children:a,...s}){return r.jsx("span",{className:(0,u.Z)("inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs font-medium",h[e],t),...s,children:a})}function b({icon:e,title:t,description:a,action:s}){return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center gap-4 rounded-2xl border border-dashed border-slate-800 bg-slate-900/40 p-10 text-center",children:[e&&r.jsx("div",{className:"rounded-full bg-slate-800/50 p-3 text-slate-500",children:e}),(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("h3",{className:"text-lg font-semibold text-white",children:t}),r.jsx("p",{className:"text-sm text-slate-400 max-w-md",children:a})]}),s&&r.jsx("div",{className:"mt-2",children:s})]})}let v=l.forwardRef(function({title:e,titleId:t,...a},r){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":t},a),e?l.createElement("title",{id:t},e):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z"}))}),y=new Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",timeZone:"Asia/Kuala_Lumpur"});function j({initialSimulators:e}){let{push:t}=(0,s.p)(),{simulators:a,loading:i,refresh:o,create:u,delete:m}=(0,d.a1)(e),[g,h]=(0,l.useState)(!1),[j,k]=(0,l.useState)({name:"",target:500,whatsapp:""}),[C,E]=(0,l.useState)(!1),[S,F]=(0,l.useState)(null),[_,P]=(0,l.useState)(!1),[z,T]=(0,l.useState)(null),[M,q]=(0,l.useState)(!1),R=a.length>0,D=(0,l.useMemo)(()=>{if(!R)return"—";let e=a.map(e=>e.latest_block?.block_start_local??e.updated_at??e.created_at).filter(Boolean).sort().pop();return e?y.format(new Date(e)):"—"},[R,a]),L=async e=>{if(e.preventDefault(),!j.name.trim()){F("Name is required");return}if(j.target<=0){F("Target kWh must be greater than zero");return}let t=j.whatsapp.trim(),a=t.length>0?Number.parseInt(t,10):void 0;if(t.length>0&&Number.isNaN(a)){F("WhatsApp number must contain digits only");return}F(null),E(!0);try{await u({name:j.name.trim(),target_kwh:j.target,...void 0!==a?{whatsapp_number:a}:{}}),k({name:"",target:500,whatsapp:""}),h(!1)}catch(e){F(e instanceof Error?e.message:"Failed to create simulator")}finally{E(!1)}},A=async e=>{q(!0);try{await m(e)}finally{q(!1),P(!1)}};return(0,r.jsxs)("section",{className:"space-y-10 animate-fadeIn",children:[(0,r.jsxs)("header",{className:"space-y-3",children:[r.jsx("h1",{children:"Simulators"}),r.jsx("p",{className:"max-w-2xl text-sm sm:text-base text-slate-400",children:"Connect to an existing simulator profile or create a new one. Each profile produces live readings feeding the EMS dashboard."}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[r.jsx(c.z,{variant:"primary",size:"md",onClick:()=>h(!0),children:"New simulator"}),r.jsx(c.z,{variant:"secondary",size:"md",onClick:()=>void o(),isLoading:i,disabled:i,children:i?"Refreshing…":"Refresh list"}),(0,r.jsxs)("span",{className:"text-xs text-slate-500",children:["Last activity snapshot: ",D]})]})]}),R?r.jsx("div",{className:"grid gap-4 sm:grid-cols-1 lg:grid-cols-2 animate-slideUp",children:a.map(e=>{let t=e.latest_block,a=t?.block_start_local??e.updated_at??e.created_at,s=a?y.format(new Date(a)):"—",l=t?.percent_of_target,i=null!=l?`${l.toFixed(1)}%`:"—";return r.jsx(x,{variant:"default",children:(0,r.jsxs)(p,{className:"flex flex-col justify-between min-h-[200px]",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[r.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-white",children:e.name}),r.jsx(f,{variant:null!=l?l>100?"danger":l>=80?"warning":"success":"neutral",children:i})]}),(0,r.jsxs)("dl",{className:"grid grid-cols-2 gap-3 text-sm",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("dt",{className:"text-xs uppercase tracking-widest text-slate-500",children:"Target kWh"}),r.jsx("dd",{className:"text-base font-medium text-slate-100",children:e.target_kwh.toFixed(1)})]}),(0,r.jsxs)("div",{className:"space-y-1",children:[r.jsx("dt",{className:"text-xs uppercase tracking-widest text-slate-500",children:"Last activity"}),r.jsx("dd",{className:"text-base font-medium text-slate-100",children:s})]})]})]}),(0,r.jsxs)("div",{className:"mt-6 flex flex-col sm:flex-row gap-2",children:[r.jsx(n.default,{href:`/${e.id}`,className:"flex-1",children:r.jsx(c.z,{variant:"secondary",size:"md",className:"w-full",children:"Dashboard"})}),r.jsx(n.default,{href:`/${e.id}/run`,className:"flex-1",children:r.jsx(c.z,{variant:"primary",size:"md",className:"w-full",children:"Run"})}),r.jsx(c.z,{variant:"ghost",size:"md",onClick:()=>{T(e.id),P(!0)},className:"text-danger hover:text-danger hover:bg-danger/10",children:"Delete"})]})]})},e.id)})}):r.jsx(b,{icon:r.jsx(v,{className:"h-12 w-12"}),title:"No simulators yet",description:"Create your first simulator to start sending readings to the EMS backend.",action:r.jsx(c.z,{variant:"primary",size:"md",onClick:()=>h(!0),children:"Create simulator"})}),r.jsx(w,{open:g,onClose:()=>{C||(h(!1),F(null))},form:j,onFormChange:k,onSubmit:L,submitting:C,error:S}),r.jsx(N,{open:_,onClose:()=>{M||P(!1)},onConfirm:()=>z&&A(z),deleting:M})]})}function w({open:e,onClose:t,form:a,onFormChange:s,onSubmit:n,submitting:d,error:u}){let m=e=>t=>{if("target"===e){s({...a,target:Number(t.target.value)});return}if("whatsapp"===e){let e=t.target.value.replace(/[^0-9]/g,"");s({...a,whatsapp:e});return}s({...a,name:t.target.value})};return r.jsx(i.u,{appear:!0,show:e,as:l.Fragment,children:(0,r.jsxs)(o.V,{as:"div",className:"relative z-50",onClose:t,children:[r.jsx(i.u.Child,{as:l.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:r.jsx("div",{className:"fixed inset-0 bg-black/50"})}),r.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:r.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:r.jsx(i.u.Child,{as:l.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,r.jsxs)(o.V.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl border border-slate-700/50 bg-slate-900/95 backdrop-blur-xl p-6 text-left align-middle shadow-2xl ring-1 ring-white/5 transition-all",children:[r.jsx(o.V.Title,{className:"text-xl font-semibold text-white tracking-tight",children:"Create simulator"}),r.jsx("p",{className:"mt-2 text-sm text-slate-400 leading-relaxed",children:"Provide a friendly name, target kWh, and optional WhatsApp number for alerting. Enter digits only (no plus sign)."}),(0,r.jsxs)("form",{className:"mt-6 space-y-4",onSubmit:n,children:[r.jsx(g.SP,{label:"Name",required:!0,error:u&&""===a.name.trim()?"Name is required":void 0,children:r.jsx(g.II,{type:"text",required:!0,value:a.name,onChange:m("name"),placeholder:"Enter simulator name",error:!!u&&""===a.name.trim()})}),r.jsx(g.SP,{label:"Target kWh",required:!0,children:r.jsx(g.II,{type:"number",min:1,step:1,value:a.target,onChange:m("target"),placeholder:"e.g. 500"})}),r.jsx(g.SP,{label:"WhatsApp number",helperText:"Digits only (no plus sign). Optional for alerts.",children:r.jsx(g.II,{type:"tel",inputMode:"numeric",pattern:"\\d*",value:a.whatsapp,onChange:m("whatsapp"),placeholder:"e.g. 60123456789"})}),u&&!1==!a.name.trim()&&r.jsx("p",{className:"text-xs text-danger",children:u}),(0,r.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3 pt-2",children:[r.jsx(c.z,{type:"button",variant:"secondary",size:"md",onClick:t,disabled:d,className:"w-full sm:w-auto",children:"Cancel"}),r.jsx(c.z,{type:"submit",variant:"primary",size:"md",isLoading:d,disabled:d,className:"w-full sm:w-auto",children:d?"Creating…":"Create"})]})]})]})})})})]})})}function N({open:e,onClose:t,onConfirm:a,deleting:s}){return r.jsx(i.u,{as:l.Fragment,show:e,children:(0,r.jsxs)(o.V,{as:"div",className:"relative z-50",onClose:t,children:[r.jsx(i.u.Child,{as:l.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:r.jsx("div",{className:"fixed inset-0 bg-black/50"})}),r.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:r.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:r.jsx(i.u.Child,{as:l.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-150",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:(0,r.jsxs)(o.V.Panel,{className:"w-full max-w-md transform overflow-hidden rounded-2xl border border-danger/20 bg-slate-900/95 backdrop-blur-xl p-6 text-left align-middle shadow-2xl ring-1 ring-danger/10 transition-all",children:[(0,r.jsxs)("div",{className:"flex items-start gap-3 mb-4",children:[r.jsx("div",{className:"flex-shrink-0 rounded-full bg-danger/10 p-3",children:r.jsx("svg",{className:"h-6 w-6 text-danger",fill:"none",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor","aria-hidden":"true",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z"})})}),(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx(o.V.Title,{className:"text-xl font-semibold text-white tracking-tight",children:"Confirm Deletion"}),r.jsx("p",{className:"mt-2 text-sm text-slate-400 leading-relaxed",children:"Are you sure you want to delete this simulator? This action cannot be undone."})]})]}),(0,r.jsxs)("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 sm:gap-3",children:[r.jsx(c.z,{type:"button",variant:"secondary",size:"md",onClick:t,disabled:s,className:"w-full sm:w-auto",children:"Cancel"}),r.jsx(c.z,{type:"button",variant:"danger",size:"md",onClick:a,isLoading:s,disabled:s,className:"w-full sm:w-auto",children:s?"Deleting…":"Delete"})]})]})})})})]})})}},41190:(e,t,a)=>{"use strict";a.d(t,{II:()=>i,Ph:()=>o,SP:()=>d});var r=a(10326),s=a(17577),l=a(41135),n=a(19381);let i=(0,s.forwardRef)(({className:e,error:t,success:a,...s},n)=>r.jsx("input",{className:(0,l.Z)("w-full rounded-md border px-3 py-2 text-sm text-white transition-colors duration-150","placeholder:text-slate-500","focus:outline-none focus:ring-2","disabled:opacity-50 disabled:cursor-not-allowed",t?"border-danger bg-danger/5 focus:border-danger focus:ring-danger/20":a?"border-success bg-success/5 focus:border-success focus:ring-success/20":"border-slate-800 bg-slate-950/60 focus:border-primary focus:ring-primary/20",e),ref:n,...s}));i.displayName="Input";let o=(0,s.forwardRef)(({className:e,error:t,success:a,children:s,...n},i)=>r.jsx("select",{className:(0,l.Z)("w-full rounded-md border px-3 py-2 text-sm text-white transition-colors duration-150","focus:outline-none focus:ring-2","disabled:opacity-50 disabled:cursor-not-allowed",t?"border-danger bg-danger/5 focus:border-danger focus:ring-danger/20":a?"border-success bg-success/5 focus:border-success focus:ring-success/20":"border-slate-800 bg-slate-950/60 focus:border-primary focus:ring-primary/20",e),ref:i,...n,children:s}));function d({label:e,error:t,helperText:a,required:s,children:l}){return(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)("label",{className:"block text-sm font-medium text-slate-300",children:[e,s&&r.jsx("span",{className:"text-danger ml-1",children:"*"})]}),l,t&&(0,r.jsxs)("p",{className:"text-xs text-danger flex items-center gap-1",children:[r.jsx(n.Z,{className:"h-4 w-4","aria-hidden":"true"}),t]}),!t&&a&&r.jsx("p",{className:"text-xs text-slate-500",children:a})]})}o.displayName="Select"},90422:(e,t,a)=>{"use strict";a.d(t,{AF:()=>i,NX:()=>o,a1:()=>n});var r=a(17577),s=a(18069),l=a(11004);function n(e=[]){let{push:t}=(0,l.p)(),[a,n]=(0,r.useState)(e),[i,o]=(0,r.useState)(0===e.length),[d,c]=(0,r.useState)(null),u=(0,r.useCallback)(async()=>{o(!0);try{let e=await (0,s.Mf)();n(e),c(null)}catch(a){let e=a instanceof Error?a.message:"Failed to load simulators";c(e),t({title:"Unable to load simulators",description:e,variant:"error"})}finally{o(!1)}},[t]),m=(0,r.useCallback)(async e=>{try{let a=await (0,s.ji)(e);return await u(),t({title:"Simulator created",description:`${a.name} is ready to run.`,variant:"success"}),a}catch(a){let e=a instanceof Error?a.message:"Failed to create simulator";throw console.error("Create simulator failed",a),t({title:"Create simulator failed",description:e,variant:"error"}),a}},[t,u]),x=(0,r.useCallback)(async e=>{try{await (0,s.aj)(e),n(t=>t.filter(t=>t.id!==e)),u(),t({title:"Simulator deleted",variant:"success"})}catch(r){let e="Delete failed",a="Failed to delete simulator";throw r instanceof Error&&(404===r.status?(e="Delete not supported",a="Backend DELETE endpoint not implemented. Contact backend team to add DELETE /api/v1/simulators/{id}"):500===r.status||502===r.status||503===r.status?(e="Server error",a="The backend server encountered an error. Please try again."):401===r.status||403===r.status?(e="Permission denied",a="You don't have permission to delete this simulator"):r.status?a=r.message:(e="Connection failed",a="Could not connect to the server. Check your internet connection.")),console.error("Delete simulator failed",r),t({title:e,description:a,variant:"error"}),r}},[t,u]);return(0,r.useMemo)(()=>({simulators:a,loading:i,error:d,refresh:u,create:m,delete:x}),[a,i,d,u,m,x])}function i(e,t={},a=null){let{push:n,dismiss:i}=(0,l.p)(),{onAlert80pct:o,onWindowChange:d}=t,[c,u]=(0,r.useState)({block:a,loading:!a&&!!e,error:null,connected:!1,reconnecting:!1,lastReadingTs:void 0});(0,r.useRef)(!1),(0,r.useRef)(null);let m=(0,r.useCallback)(async()=>{if(e){u(e=>({...e,loading:null==e.block}));try{let t=await (0,s.lA)(e);u(e=>({...e,block:t,loading:!1,error:null}))}catch(t){let e=t instanceof Error?t.message:"Failed to load latest block";u(t=>({...t,loading:!1,error:e})),n({title:"Unable to load latest block",description:e,variant:"error"})}finally{u(e=>({...e,loading:!1}))}}},[e,n]);return{block:c.block,loading:c.loading,error:c.error,connected:c.connected,reconnecting:c.reconnecting,lastReadingTs:c.lastReadingTs,refresh:m}}function o(e,t=10,a=[]){let{push:n}=(0,l.p)(),[i,o]=(0,r.useState)(a),[d,c]=(0,r.useState)(!!e&&0===a.length),[u,m]=(0,r.useState)(null);return{history:i,loading:d,error:u,refresh:(0,r.useCallback)(async()=>{if(e){c(!0);try{let a=await (0,s.QY)(e,t);o(a),m(null)}catch(t){let e=t instanceof Error?t.message:"Failed to load block history";m(e),n({title:"Unable to load block history",description:e,variant:"error"})}finally{c(!1)}}},[t,n,e])}}},40461:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var r=a(19510),s=a(68570);let l=(0,s.createProxy)(String.raw`E:\EEMS-Front\src\components\simulators\simulators-page.tsx`),{__esModule:n,$$typeof:i}=l;l.default;let o=(0,s.createProxy)(String.raw`E:\EEMS-Front\src\components\simulators\simulators-page.tsx#SimulatorsPage`);var d=a(9905);async function c(){let e=[];try{e=await (0,d.Mf)()}catch(e){console.error("Failed to fetch simulators",e)}return r.jsx(o,{initialSimulators:e})}}};var t=require("../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[948,808,987,954],()=>a(60507));module.exports=r})();